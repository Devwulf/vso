{"version":3,"sources":["extensions/array.extensions.ts","managers/ScripletManager.tsx","managers/NodeConnections.tsx","models/NodeSlot.ts","utils/Types.tsx","managers/NodeSchemaManager.tsx","utils/Colors.tsx","models/NodeSchema.ts","managers/Console.ts","managers/VariableManager.tsx","models/NodeItem.ts","models/Scriplet.ts","managers/VisualScriptingDB.ts","components/Modal.tsx","components/DropdownButton.tsx","components/ScripletNavItem.tsx","components/ScripletForm.tsx","components/SettingsForm.tsx","components/SidebarNav.tsx","utils/KonvaUtils.ts","components/KonvaForm.tsx","managers/SlotConfigManager.ts","components/NodeHandle.tsx","components/NodeSlot.tsx","components/Node.tsx","components/Edge.tsx","models/Category.ts","components/SearchBar.tsx","components/SchemaSelector.tsx","components/VariableForm.tsx","components/VariableNavItem.tsx","components/CodeEditor.tsx","components/ScripletRoot.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["Array","prototype","indexOfWhen","predicate","i","this","length","currentScriplet","id","VisualScriptingDB","getScriplet","then","scriplet","catch","error","console","inputItemId","inputSlotId","ScripletManager","inputItem","getNode","inputSlot","schema","inputSlots","find","entry","outputItemId","outputSlotId","outputItem","outputSlot","outputSlots","Map","isCorrectType","type","isConnectable","otherOutput","getInputConnection","deleteConnection","itemId","slotId","setInputConnection","setOutputConnection","updateNodes","deleteInputConnection","deleteOutputConnection","toItem","some","result","conn","checkGraphCycleExists","inputFlowSlot","inputFlowSlots","outputFlowSlot","outputFlowSlots","getInputFlowConnection","deleteFlowConnection","setInputFlowConnection","otherInput","getOutputFlowConnection","setOutputFlowConnection","deleteInputFlowConnection","deleteOutputFlowConnection","nodeItem","forEach","connectedTo","inputFlow","outputFlow","NodeSlot","name","TypedNodeSlot","InputSlot","defaultValue","isEditable","item","getInputValue","otherSlot","NodeConnections","getOutputSlot","evaluate","OutputSlot","FlowNodeSlot","InputFlowSlot","returnToSlot","OutputFlowSlot","getInputFlowSlot","evaluateSlot","returnSlot","GetVariableSlot","variableId","variable","getVariable","value","startValue","GetInputSlot","inputId","input","getInput","Number","constructor","regex","match","parseInt","className","String","Boolean","Flow","Variable","nodeSchemas","schemaId","get","Error","createNew","values","Colors","Gray","100","200","300","400","500","600","700","800","900","Red","Orange","Yellow","Green","Teal","Blue","Indigo","Purple","Pink","BaseSchemaTypes","onMessage","SimpleEventDispatcher","func","subscribe","message","dispatch","color","AddSchema","target","origCtor","instantiate","args","newCtor","NodeSchemaManager","set","BaseNodeSchema","uniqueNamePrefix","width","isDeletable","isNameEditable","Math","max","createNewSchema","Start","output1","goNext","StartFlowSchema","IfElse","input1","output2","thisSlot","getValue","IfElseSchema","ForLoop","outputFlow1","outputFlow2","input2","input3","input4","index","increment","start","end","returnTo","undefined","ForLoopSchema","ForLoopBreak","ForLoopBreakSchema","WhileLoop","limit","counter","WhileLoopSchema","Input","InputSchema","Output","OutputSchema","InputNumber","InputNumberSchema","PrintNumber","Console","log","PrintNumberSchema","GetNumber","GetNumberSchema","SetNumber","setVariable","SetNumberSchema","InputBoolean","InputBooleanSchema","PrintBoolean","PrintBooleanSchema","GetBoolean","GetBooleanSchema","SetBoolean","SetBooleanSchema","InputString","InputStringSchema","PrintString","PrintStringSchema","GetString","GetStringSchema","SetString","SetStringSchema","AddNumbers","AddNumbersSchema","SubtractNumbers","SubtractNumbersSchema","MultiplyNumbers","MultiplyNumbersSchema","DivideNumbers","DivideNumbersSchema","ModuloNumbers","num1","num2","ModuloNumbersSchema","PowNumbers","pow","PowNumbersSchema","SqrtNumber","sqrt","SqrtNumberSchema","CeilNumber","ceil","CeilNumberSchema","FloorNumber","floor","FloorNumberSchema","LessThanNumbers","LessThanNumbersSchema","LessThanEqualNumbers","LessThanEqualNumbersSchema","GreaterThanNumbers","GreaterThanNumbersSchema","GreaterThanEqualNumbers","GreaterThanEqualNumbersSchema","EqualNumbers","EqualNumbersSchema","NotEqualNumbers","NotEqualNumbersSchema","AndBoolean","AndBooleanSchema","OrBoolean","OrBooleanSchema","EqualBoolean","EqualBooleanSchema","NotEqualBoolean","NotEqualBooleanSchema","NotBoolean","NotBooleanSchema","AppendString","concat","AppendStringSchema","ContainsString","includes","toLowerCase","indexOf","ContainsStringSchema","StartsWithString","startsWith","StartsWithStringSchema","EndsWithString","endsWith","EndsWithStringSchema","EqualString","EqualStringSchema","NotEqualString","NotEqualStringSchema","LengthString","LengthStringSchema","MatchesRegexString","MatchesRegexStringSchema","ReplaceSubstring","replaceAll","ReplaceSubstringSchema","ReplaceAtIndexString","substr","ReplaceAtIndexStringSchema","ReverseString","split","reverse","join","ReverseStringSchema","ToLowerCaseString","ToLowerCaseStringSchema","ToUpperCaseString","toUpperCase","ToUpperCaseStringSchema","typeCount","getBaseSchema","count","NodeItem","x","y","inputValues","customName","variableType","variableName","getOutput","VariableManager","getNextVariableName","getNewSchema","Object","defineProperties","enumerable","writable","filter","slot","push","pair","Scriplet","description","items","itemCounter","variables","variableCounter","inputs","inputCounter","outputs","outputCounter","addNodes","reloadOnFinish","nodes","node","key","updateScriplet","window","location","reload","newNode","convertToNodeItem","deleteNodes","itemIds","delete","addVariables","updateVariables","addInputs","updateInputs","addOutputs","output","updateOutputs","scriplets","version","stores","open","table","mapToClass","seedData","toArray","addScriplet","add","changes","update","where","equals","modify","ref","Dexie","Modal","props","state","isModalOpen","handleOpenModal","bind","handleCloseModal","openModal","setState","title","children","closeModal","style","zIndex","onClick","icon","React","Component","DropdownButton","moreOptions","createRef","isMoreOptions","openOptions","closeOptions","toggleOptions","current","focus","onEdit","onDelete","event","preventDefault","left","tabIndex","onBlur","marginLeft","height","borderLeft","borderRight","borderBottom","stopPropagation","ScripletNavItem","isHovered","closeNavMenu","onMouseOver","onMouseOut","to","ScripletForm","selectedId","onSaveScriplet","onCancel","onChange","rows","SettingsForm","isVerifyingReset","resetDatabase","replace","process","SidebarNav","scripletNameInput","editedScriplet","isDirtyDB","isNavMenuOpen","isSidebarOpen","openAddScripletModal","openEditScripletModal","openSettingsModal","openNavMenu","toggleNavMenu","openSidebar","closeSidebar","toggleSidebar","onScripletCreate","onScripletDelete","getScriplets","classList","contains","scripletId","deleteScriplet","map","noScrollX","callable","toString","onScripletEdit","KonvaUtils","cursorType","stage","getStage","container","cursor","KonvaForm","cancelInput","Dropdown","cancelDropdown","showInput","onHover","onHoverExit","fontSize","padding","textColor","hoverColor","borderRadius","scale","scaleX","top","absolutePosition","document","createElement","body","appendChild","position","min","innerWidth","paddingLeft","backgroundColor","onchange","ev","inputElement","setCursor","layer","currentTarget","getLayer","setAttr","draw","bgColor","fontStyle","onMouseEnter","onMouseLeave","cancelBubble","onTap","fill","cornerRadius","verticalAlign","text","parentNode","removeChild","defaultProps","HandleType","InputType","selectedIndex","showDropdown","dropdown","option","innerText","dropdownElement","configs","numberConfig","handleType","Circle","handleBorderColor","handleFillColor","inputType","defaultInputValue","initialValue","fromString","convertFromString","convertToString","booleanConfig","stringConfig","flowConfig","Arrow","None","variableConfig","NodeHandle","startPosition","onDragStart","onDragMove","onDragEnd","onMouseExit","cancel","thisCircle","parent","startPos","getPosition","endPos","pathData","path","Konva","Path","data","stroke","strokeWidth","isInput","midpointPos","isFlow","onConnect","destroy","pointerPos","getPointerPosition","screenX","screenY","elements","getAllIntersections","element","otherItemId","otherSlotId","elem","getAttr","slotType","radius","listening","data-type","data-slot-type","data-item-id","data-slot-id","draggable","InputSlotDOM","label","labelWidth","typeWidth","onInputChanged","onInputChange","config","SlotConfigManager","getConfig","val","inputConnection","OutputSlotDOM","outputConnections","offsetX","align","InputFlowSlotDOM","inputFlowConnection","OutputFlowSlotDOM","outputFlowConnection","Node","group","draggedHandlePath","isStateOpen","stateVisual","rowHeight","topBarHeight","handleDragNode","deleteNodeItem","updateDOM","maxLength","inputTypeGuard","outputTypeGuard","from","it","Fragment","setInputValue","addConnection","getOutputConnections","addFlowConnection","Edge","handleOnEnter","handleOnExit","nodeWidthOutput","nodeWidthOther","nodeHeight","handleOnClick","halfNodeHeight","onMouseDown","onTouchEnd","SchemaCategory","subCategory","subCategories","cat","contentChildren","SearchBar","searchValue","onSearchChange","onSearchReset","filterSearch","CategoryDOM","showChildren","toggleCategory","openCategory","closeCategory","category","depth","borderColor","child","SchemaSelector","schemaResults","getBaseSchemas","getRootSchemaCategory","schemas","categoryRoot","currentCategory","idArr","getSubCategory","addContent","isVisible","addNodeItem","rootCategory","innerHeight","VariableForm","selectedType","setStartValue","inputValue","onSaveVariable","disabled","hidden","VariableNavItem","require","jsbeautify","js_beautify","CodeEditor","codeResult","selector","editorValue","indent_size","isCodeOpen","isDragging","isSelecting","selectionLocation","selectedVariable","screenWidth","variableResults","editedVariable","inputResults","editedInput","openAddVariableModal","openEditVariableModal","openAddInputModal","openEditInputModal","setScreenWidth","handleRun","handleClear","handleBeautifyCode","handleEvaluateNodes","openCode","closeCode","toggleCode","onMessageLog","refreshSearch","onAddVariable","onEditVariable","onDeleteVariable","onAddInput","onEditInput","onDeleteInput","addEventListener","removeEventListener","selectScriplet","resetVariables","startSchema","getStart","startSlot","success","prevState","innerHTML","getVariables","getInputs","addVariable","deleteVariable","addInput","setInput","resetView","zoomInView","zoomOutView","dataTransfer","setData","JSON","stringify","isVariable","bottom","right","onDragEnter","onDragOver","onDrop","pageX","pageY","parse","getData","tempVariable","bubbles","ScripletRoot","stageContainer","isDirtyDOM","isReadyToMount","isReady","contextMenu","isContextMenuShown","contextMenuPos","handleDeleteEdge","handleDeleteFlowEdge","handleZoom","handleContextMenu","handleCancelContextMenu","fitToParent","FontFaceObserver","load","scaleY","addNode","deleteAllConnections","deleteNode","evt","oldScale","pointer","mousePosition","newScale","deltaY","newPos","batchDraw","getType","getChildren","stageObj","offsetWidth","offsetHeight","onWheel","onContextMenu","getNodes","getInputConnections","getInputFlowConnections","otherItem","otherSchema","containerId","visible","data-name","ParamsProvider","useParams","library","fas","App","isLocalhost","hostname","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","StrictMode","basename","getElementById","URL","href","origin","fetch","headers","response","contentType","status","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.473a4315.chunk.js","sourcesContent":["declare global {\r\n    interface Array<T> {\r\n        removeIf(predicate: (input: T) => boolean): any;\r\n        indexOfWhen(predicate: (input: T) => boolean): any;\r\n    }\r\n}\r\n\r\nArray.prototype.indexOfWhen = function(predicate) {\r\n    let i = 0;\r\n    while (i < this.length) {\r\n        if (predicate(this[i]))\r\n            return i;\r\n        i++;\r\n    }\r\n}\r\n\r\nexport {};","import { Scriplet } from \"../models/Scriplet\";\r\nimport VisualScriptingDB from \"./VisualScriptingDB\";\r\n\r\nclass ScripletManager {\r\n    public currentScriplet: Scriplet | undefined;\r\n\r\n    // Current Scriplet can be undefined if none was selected yet\r\n    async selectScriplet(id: number): Promise<boolean> {\r\n        // If already selected\r\n        if (this.currentScriplet && this.currentScriplet.id === id)\r\n            return true;\r\n\r\n        return await VisualScriptingDB.getScriplet(id).then(scriplet => {\r\n            this.currentScriplet = scriplet;\r\n            return true;\r\n        }).catch(error => {\r\n            console.error(`Something went wrong when getting the scriplet of id '${id}'. Error: ${error}`);\r\n            return false;\r\n        });\r\n    }\r\n}\r\n\r\nexport default new ScripletManager();","import '../extensions/array.extensions';\r\nimport ScripletManager from './ScripletManager';\r\nimport { InputSlot, OutputSlot, InputFlowSlot, OutputFlowSlot, ItemSlotPair } from '../models/NodeSlot';\r\n\r\nexport class NodeConnection {\r\n    public inputId: number;\r\n    public inputIO: number;\r\n    public outputId: number;\r\n    public outputIO: number;\r\n\r\n    constructor(inputId: number, inputIO: number, outputId: number, outputIO: number) {\r\n        this.inputId = inputId;\r\n        this.inputIO = inputIO;\r\n        this.outputId = outputId;\r\n        this.outputIO = outputIO;\r\n\r\n        this.equals = this.equals.bind(this);\r\n    }\r\n\r\n    equals(conn: NodeConnection): boolean {\r\n        return conn.inputId === this.inputId && conn.inputIO === this.inputIO && conn.outputId === this.outputId && conn.outputIO === this.outputIO;\r\n    }\r\n}\r\n\r\n// TODO: Repurpose this to store ids on the node items themselves\r\nclass NodeConnections {\r\n    getInputSlot(inputItemId: number, inputSlotId: number): InputSlot | undefined {      \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputSlot = inputItem.schema?.inputSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputSlot) {\r\n            console.error(`The input slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return inputSlot;\r\n    }\r\n\r\n    getInputSlots(inputItemId: number): InputSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputSlots = inputItem.schema?.inputSlots;\r\n        if (!inputSlots) {\r\n            console.error(`The schema of node item '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputSlots;\r\n    }\r\n\r\n    getInputConnections(inputItemId: number): ItemSlotPair[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputItem.inputSlots;\r\n    }\r\n\r\n    getOutputSlot(outputItemId: number, outputSlotId: number): OutputSlot | undefined {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputSlot = outputItem.schema?.outputSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputSlot) {\r\n            console.error(`The input slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return outputSlot;\r\n    }\r\n\r\n    getOutputSlots(outputItemId: number): OutputSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputSlots = outputItem.schema?.outputSlots;\r\n        if (!outputSlots) {\r\n            console.error(`The schema of node item '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return outputSlots;\r\n    }\r\n\r\n    getOutputConnections(outputItemId: number): Map<number, ItemSlotPair[]> {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return new Map<number, ItemSlotPair[]>();\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return new Map<number, ItemSlotPair[]>();\r\n        }\r\n\r\n        return outputItem.outputSlots;\r\n    }\r\n\r\n    addConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        if (inputItemId === outputItemId) {\r\n            console.error(`When adding connections, the input item id cannot be the same as the output item id.`);\r\n            return;\r\n        }\r\n        \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputSlot = inputItem.schema?.inputSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputSlot) {\r\n            console.error(`The input slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputSlot = outputItem.schema?.outputSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputSlot) {\r\n            console.error(`The output slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        if (!inputSlot.isCorrectType(outputSlot.type))\r\n            return;\r\n\r\n        if (!inputSlot.isConnectable)\r\n            return;\r\n\r\n        // Check graph cycle here\r\n        /*\r\n        if (this.checkGraphCycleExists(inputItemId, outputItemId) || this.checkFlowGraphCycleExists(inputItemId, outputItemId)) {\r\n            console.error(`Cycle detected from ${inputItemId} to ${outputItemId}.`);\r\n            return;\r\n        }\r\n        */\r\n\r\n        const otherOutput = inputItem.getInputConnection(inputSlot.id);\r\n        if (otherOutput)\r\n            this.deleteConnection(inputItemId, inputSlotId, otherOutput.itemId, otherOutput.slotId);\r\n        \r\n        inputItem.setInputConnection(inputSlot.id, outputItemId, outputSlotId);\r\n        outputItem.setOutputConnection(outputSlot.id, inputItemId, inputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n\r\n        /*\r\n        const found = outputSlot.connectedToInputs.find(pair => pair.itemId === inputItemId && pair.slotId === inputSlotId);\r\n        if (!found)\r\n            outputSlot.connectedToInputs.push({id: outputSlot.id, itemId: inputItemId, slotId: inputSlotId});\r\n        */\r\n    }\r\n\r\n    deleteConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputSlot = inputItem.schema?.inputSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputSlot) {\r\n            console.error(`The input slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputSlot = outputItem.schema?.outputSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputSlot) {\r\n            console.error(`The input slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        /*\r\n        inputSlot.connectedToOutput = undefined;\r\n        outputSlot.connectedToInputs.removeIf(entry => entry.itemId === inputItemId && entry.slotId === inputSlotId);\r\n        */\r\n\r\n        inputItem.deleteInputConnection(inputSlotId);\r\n        outputItem.deleteOutputConnection(outputSlotId, inputItemId, inputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n    }\r\n\r\n    private checkGraphCycleExists(inputItemId: number, outputItemId: number): boolean {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return true; // True is negative in this case\r\n        }\r\n\r\n        const toItem = scriplet.getNode(outputItemId);\r\n        if (!toItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return true;\r\n        }\r\n\r\n        if (toItem.inputSlots.length <= 0)\r\n            return false;\r\n        if (toItem.inputSlots.some(entry => entry.itemId === inputItemId))\r\n            return true;\r\n\r\n        var result = false;\r\n\r\n        for (var i = 0; i < toItem.inputSlots.length; i++) {\r\n            const conn = toItem.inputSlots[i];\r\n            if (!conn)\r\n                continue;\r\n            const id = conn.itemId;\r\n            result = this.checkGraphCycleExists(inputItemId, id);\r\n            if (result)\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    getInputFlowSlot(inputItemId: number, inputSlotId: number): InputFlowSlot | undefined {      \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputFlowSlot = inputItem.schema?.inputFlowSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputFlowSlot) {\r\n            console.error(`The input flow slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return inputFlowSlot;\r\n    }\r\n\r\n    getInputFlowSlots(inputItemId: number): InputFlowSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputFlowSlots = inputItem.schema?.inputFlowSlots;\r\n        if (!inputFlowSlots) {\r\n            console.error(`The schema of node item '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputFlowSlots;\r\n    }\r\n\r\n    getInputFlowConnections(inputItemId: number): ItemSlotPair[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputItem.inputFlowSlots;\r\n    }\r\n\r\n    getOutputFlowSlot(outputItemId: number, outputSlotId: number): OutputFlowSlot | undefined {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputFlowSlot = outputItem.schema?.outputFlowSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputFlowSlot) {\r\n            console.error(`The input flow slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return outputFlowSlot;\r\n    }\r\n\r\n    getOutputFlowSlots(outputItemId: number): OutputFlowSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputFlowSlots = outputItem.schema?.outputFlowSlots;\r\n        if (!outputFlowSlots) {\r\n            console.error(`The schema of node item '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return outputFlowSlots;\r\n    }\r\n\r\n    getOutputFlowConnections(outputItemId: number): ItemSlotPair[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return outputItem.outputFlowSlots;\r\n    }\r\n    \r\n    addFlowConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        if (inputItemId === outputItemId) {\r\n            console.error(`When adding connections, the input item id cannot be the same as the output item id.`);\r\n            return;\r\n        }\r\n        \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputFlowSlot = inputItem.schema?.inputFlowSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputFlowSlot) {\r\n            console.error(`The input flow slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputFlowSlot = outputItem.schema?.outputFlowSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputFlowSlot) {\r\n            console.error(`The input flow slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        if (!inputFlowSlot.isConnectable)\r\n            return;\r\n\r\n        /*\r\n        if (this.checkFlowGraphCycleExists(inputItemId, outputItemId) || this.checkGraphCycleExists(inputItemId, outputItemId)) {\r\n            console.error(`Cycle detected from ${inputItemId} to ${outputItemId}.`);\r\n            return;\r\n        }\r\n        */\r\n\r\n        const otherOutput = inputItem.getInputFlowConnection(inputSlotId);\r\n        if (otherOutput)\r\n            this.deleteFlowConnection(inputItemId, inputSlotId, otherOutput.itemId, otherOutput.slotId);\r\n        \r\n        inputItem.setInputFlowConnection(inputFlowSlot.id, outputItemId, outputSlotId);\r\n        \r\n        const otherInput = outputItem.getOutputFlowConnection(outputSlotId);\r\n        if (otherInput)\r\n            this.deleteFlowConnection(otherInput.itemId, otherInput.slotId, outputItemId, outputSlotId);\r\n        \r\n        outputItem.setOutputFlowConnection(outputFlowSlot.id, inputItemId, inputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n    }\r\n\r\n    deleteFlowConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputFlowSlot = inputItem.schema?.inputFlowSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputFlowSlot) {\r\n            console.error(`The input flow slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputFlowSlot = outputItem.schema?.outputFlowSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputFlowSlot) {\r\n            console.error(`The input flow slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        inputItem.deleteInputFlowConnection(inputSlotId);\r\n        outputItem.deleteOutputFlowConnection(outputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n    }\r\n\r\n    private checkFlowGraphCycleExists(inputItemId: number, outputItemId: number): boolean {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return true; // True is negative in this case\r\n        }\r\n\r\n        const toItem = scriplet.getNode(outputItemId);\r\n        if (!toItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return true;\r\n        }\r\n\r\n        if (toItem.inputFlowSlots.length <= 0)\r\n            return false;\r\n        if (toItem.inputFlowSlots.some(entry => entry.itemId === inputItemId))\r\n            return true;\r\n\r\n        var result = false;\r\n\r\n        for (var i = 0; i < toItem.inputFlowSlots.length; i++) {\r\n            const conn = toItem.inputFlowSlots[i];\r\n            if (!conn)\r\n                continue;\r\n            const id = conn.itemId;\r\n            result = this.checkGraphCycleExists(inputItemId, id);\r\n            if (result)\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    deleteAllConnections(itemId: number): boolean {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return false;\r\n        }\r\n\r\n        const nodeItem = scriplet.getNode(itemId);\r\n        if (!nodeItem) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return false;\r\n        }\r\n\r\n        nodeItem.outputSlots.forEach(outputSlot => {\r\n            outputSlot.forEach(connectedTo => {\r\n                this.deleteConnection(connectedTo.itemId, connectedTo.slotId, itemId, connectedTo.id);\r\n            });\r\n        });\r\n\r\n        nodeItem.inputSlots.forEach(inputSlot => {\r\n            if (!inputSlot)\r\n                return;\r\n\r\n            this.deleteConnection(itemId, inputSlot.id, inputSlot.itemId, inputSlot.slotId);\r\n        });\r\n\r\n        nodeItem.inputFlowSlots.forEach(inputFlow => {\r\n            if (!inputFlow)\r\n                return;\r\n\r\n            this.deleteFlowConnection(itemId, inputFlow.id, inputFlow.itemId, inputFlow.slotId);\r\n        });\r\n\r\n        nodeItem.outputFlowSlots.forEach(outputFlow => {\r\n            if (!outputFlow)\r\n                return;\r\n            \r\n            this.deleteFlowConnection(outputFlow.itemId, outputFlow.slotId, itemId, outputFlow.id);\r\n        });\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nexport default new NodeConnections();","import NodeConnections from \"../managers/NodeConnections\";\r\nimport ScripletManager from \"../managers/ScripletManager\";\r\n\r\nexport type ItemSlotPair = {\r\n    id: number;\r\n    itemId: number;\r\n    slotId: number;\r\n}\r\n\r\nexport abstract class NodeSlot {\r\n    public id: number;\r\n    public name?: string;\r\n\r\n    constructor(id: number, name?: string) {\r\n        this.id = id;\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport abstract class TypedNodeSlot extends NodeSlot {\r\n    public type: string;\r\n\r\n    constructor(id: number, type: string, name?: string) {\r\n        super(id, name);\r\n        this.type = type;\r\n    }\r\n\r\n    isCorrectType(type: string): boolean {\r\n        if (this.type === type)\r\n            return true;\r\n        return false;\r\n    }\r\n}\r\n\r\nexport type IdValuePair = {\r\n    id: number;\r\n    value?: any;\r\n}\r\n\r\nexport class InputSlot extends TypedNodeSlot {\r\n    //public connectedToOutput: ItemSlotPair | undefined;\r\n    // TODO: This value should also be serialized to db.\r\n    public defaultValue: any;\r\n    public isConnectable: boolean;\r\n    public isEditable: boolean;\r\n\r\n    constructor(id: number, type: string, defaultValue: any, name?: string, isConnectable?: boolean, isEditable?: boolean) {\r\n        super(id, type, name);\r\n        this.defaultValue = defaultValue;\r\n        this.isConnectable = isConnectable ?? true;\r\n        this.isEditable = isEditable ?? true;\r\n    }\r\n\r\n    getValue(itemId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const connectedTo = item.getInputConnection(this.id);\r\n        if (!connectedTo)\r\n            return item.getInputValue(this.id) ?? this.defaultValue;\r\n\r\n        const otherSlot = NodeConnections.getOutputSlot(connectedTo.itemId, connectedTo.slotId);\r\n        if (!otherSlot) {\r\n            console.error(`The output slot '${connectedTo.slotId}' of node item '${connectedTo.itemId}' could not be found.`);\r\n            return item.getInputValue(this.id) ?? this.defaultValue;\r\n        }\r\n\r\n        return otherSlot.evaluate();\r\n    }\r\n}\r\n\r\n// TODO: Flow output slots cannot be connected to multiple Flow input slots\r\nexport class OutputSlot extends TypedNodeSlot {\r\n    //public connectedToInputs: ItemSlotPair[] = [];\r\n    public evaluate: () => any;\r\n\r\n    constructor(id: number, type: string, evaluate: () => any, name?: string) {\r\n        super(id, type, name);\r\n        this.evaluate = evaluate;\r\n    }\r\n}\r\n\r\nexport abstract class FlowNodeSlot extends NodeSlot { }\r\n\r\nexport class InputFlowSlot extends FlowNodeSlot {\r\n    //public connectedToOutput: ItemSlotPair | undefined;\r\n    public isConnectable: boolean;\r\n    private evaluate: (thisSlot: InputFlowSlot, returnToSlot?: ItemSlotPair) => any;\r\n\r\n    public returnToSlot: ItemSlotPair | undefined;\r\n\r\n    constructor(id: number, evaluate: (thisSlot: InputFlowSlot, returnToSlot?: ItemSlotPair) => any, isConnectable?: boolean, name?: string) {\r\n        super(id, name);\r\n        this.evaluate = evaluate;\r\n        this.isConnectable = isConnectable ?? true;\r\n    }\r\n\r\n    evaluateSlot(returnToSlot?: ItemSlotPair) {\r\n        this.evaluate(this, returnToSlot);\r\n    }\r\n}\r\n\r\nexport class OutputFlowSlot extends FlowNodeSlot {\r\n    //public connectedToInput: ItemSlotPair | undefined;\r\n\r\n    goNext(itemId: number, returnToSlot?: ItemSlotPair) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const connectedTo = item.getOutputFlowConnection(this.id);\r\n        if (connectedTo) {\r\n            const inputSlot = NodeConnections.getInputFlowSlot(connectedTo.itemId, connectedTo.slotId);\r\n            if (!inputSlot) {\r\n                console.error(`The input flow slot '${connectedTo.slotId}' of node item '${connectedTo.itemId}' could not be found.`)\r\n                return;\r\n            }\r\n\r\n            inputSlot.evaluateSlot(returnToSlot);\r\n            return;\r\n        }\r\n\r\n        if (returnToSlot) {\r\n            // Return to where the returnToSlot points to\r\n            const returnSlot = NodeConnections.getInputFlowSlot(returnToSlot.itemId, returnToSlot.slotId);\r\n            if (!returnSlot) {\r\n                console.error(`The input flow slot '${returnToSlot.slotId}' of node item '${returnToSlot.itemId}' could not be found.`)\r\n                return;\r\n            }\r\n\r\n            returnSlot.evaluateSlot();\r\n            return;\r\n        }\r\n    }\r\n}\r\n\r\nexport class GetVariableSlot extends InputSlot {\r\n    getValue(itemId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const variableId = item.variableId;\r\n        if (variableId == null) {\r\n            console.error(`The variable id in node item '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const variable = scriplet.getVariable(variableId);\r\n        if (!variable) {\r\n            console.error(`The variable of id '${variableId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return variable.value ?? variable.startValue;\r\n    }\r\n}\r\n\r\nexport class SetVariableSlot extends OutputFlowSlot {\r\n    goNext(itemId: number, returnToSlot?: ItemSlotPair) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const variableId = item.variableId;\r\n        if (variableId == null) {\r\n            console.error(`The variable id in node item '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const variable = scriplet.getVariable(variableId);\r\n        if (!variable) {\r\n            console.error(`The variable of id '${variableId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const connectedTo = item.getOutputFlowConnection(this.id);\r\n        if (connectedTo) {\r\n            const inputSlot = NodeConnections.getInputFlowSlot(connectedTo.itemId, connectedTo.slotId);\r\n            if (!inputSlot) {\r\n                console.error(`The input flow slot '${connectedTo.slotId}' of node item '${connectedTo.itemId}' could not be found.`)\r\n                return;\r\n            }\r\n\r\n            inputSlot.evaluateSlot(returnToSlot);\r\n            return;\r\n        }\r\n\r\n        if (returnToSlot) {\r\n            // Return to where the returnToSlot points to\r\n            const returnSlot = NodeConnections.getInputFlowSlot(returnToSlot.itemId, returnToSlot.slotId);\r\n            if (!returnSlot) {\r\n                console.error(`The input flow slot '${returnToSlot.slotId}' of node item '${returnToSlot.itemId}' could not be found.`)\r\n                return;\r\n            }\r\n\r\n            returnSlot.evaluateSlot();\r\n            return;\r\n        }\r\n    }\r\n}\r\n\r\nexport class GetInputSlot extends InputSlot {\r\n    getValue(itemId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputId = item.variableId;\r\n        if (inputId == null) {\r\n            console.error(`The variable id in node item '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const input = scriplet.getInput(inputId);\r\n        if (!input) {\r\n            console.error(`The input variable of id '${inputId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return input.value ?? input.startValue;\r\n    }\r\n}\r\n\r\nexport class GetOutputSlot extends InputSlot {\r\n    getValue(itemId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputId = item.variableId;\r\n        if (outputId == null) {\r\n            console.error(`The variable id in node item '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const output = scriplet.getOutput(outputId);\r\n        if (!output) {\r\n            console.error(`The output variable of id '${outputId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return output.value ?? output.startValue;\r\n    }\r\n}","export interface IAssignable<T> {\r\n    value: T;\r\n}\r\n\r\nexport interface IAssignableStatic<T> {\r\n    defaultValue: T;\r\n}\r\n\r\nexport interface IConvertible<T> {\r\n    fromString(value: string): void;\r\n    toString(): string;\r\n}\r\n\r\nexport interface IConvertibleStatic<T> {\r\n    convertFromString(value: string): T | undefined;\r\n    convertToString(value: T): string;\r\n}\r\n\r\nexport interface INamedClassStatic {\r\n    className: string;\r\n}\r\n\r\nexport function staticImplements<T>() {\r\n    return <U extends T>(constructor: U) => { return constructor; };\r\n}\r\n\r\n// TODO: Implement type converters\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<number>>()\r\n@staticImplements<IConvertibleStatic<number>>()\r\nexport class Number implements IAssignable<number> {\r\n    public static className: string = \"Number\";\r\n    public static defaultValue: number = 0;\r\n\r\n    public value: number;\r\n    \r\n    constructor(value: number) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): number | undefined {\r\n        // TODO: Use regex to check input\r\n        const regex = \"^(-[1-9][0-9]*)|([0-9]+)$\";\r\n        const val = value.match(regex);\r\n        if (!val) {\r\n            console.error(`The input doesn't match the regex '${regex}'.`);\r\n            return;\r\n        }\r\n\r\n        return parseInt(value);\r\n    }\r\n\r\n    public static convertToString(value: number): string {\r\n        return `${value}`;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<string>>()\r\n@staticImplements<IConvertibleStatic<string>>()\r\nexport class String implements IAssignable<string> {\r\n    public static className: string = \"String\";\r\n    public static defaultValue: string = \"\";\r\n\r\n    public value: string;\r\n\r\n    constructor(value: string) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): string | undefined {\r\n        return value;\r\n    }\r\n\r\n    public static convertToString(value: string): string {\r\n        return value;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<boolean>>()\r\n@staticImplements<IConvertibleStatic<boolean>>()\r\nexport class Boolean implements IAssignable<boolean> {\r\n    public static className: string = \"Boolean\";\r\n    public static defaultValue: boolean = true;\r\n\r\n    public value: boolean;\r\n\r\n    constructor(value: boolean) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): boolean | undefined {\r\n        return value === \"true\" ? true : false;\r\n    }\r\n\r\n    public static convertToString(value: boolean): string {\r\n        return `${value}`;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<number>>()\r\n@staticImplements<IConvertibleStatic<number>>()\r\nexport class Flow implements IAssignable<number> {\r\n    public static className: string = \"Flow\";\r\n    public static defaultValue: number = -1;\r\n\r\n    public value: number;\r\n    \r\n    constructor(value: number) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): number | undefined {\r\n        // TODO: Use regex to check input\r\n        const regex = \"^([0-9]+)$\";\r\n        const val = value.match(regex);\r\n        if (!val) {\r\n            console.error(`The input doesn't match the regex '${regex}'.`);\r\n            return;\r\n        }\r\n\r\n        return parseInt(value);\r\n    }\r\n\r\n    public static convertToString(value: number): string {\r\n        return `${value}`;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<number>>()\r\nexport class Variable implements IAssignable<number> {\r\n    public static className: string = \"Variable\";\r\n    public static defaultValue: number = -1;\r\n\r\n    public value: number;\r\n\r\n    constructor(value: number) {\r\n        this.value = value;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<any>>()\r\nexport class Any implements IAssignable<any> {\r\n    public static className: string = \"Any\";\r\n    public static defaultValue: any;\r\n\r\n    public value: any;\r\n\r\n    constructor(value: any) {\r\n        this.value = value;\r\n    }\r\n}","import { BaseNodeSchema } from \"../models/NodeSchema\";\r\n\r\nclass NodeSchemaManager {\r\n    public nodeSchemas: Map<string, BaseNodeSchema>;\r\n\r\n    constructor() {\r\n        this.nodeSchemas = new Map<string, BaseNodeSchema>();\r\n    }\r\n\r\n    getNewSchema(itemId: number, schemaId: string): BaseNodeSchema {\r\n        const schema = this.nodeSchemas.get(schemaId);\r\n        if (!schema)\r\n            throw new Error(`The schema '${schemaId}' could not be found.`);\r\n        return schema.createNew(itemId);\r\n    }\r\n\r\n    getBaseSchema(id: string): BaseNodeSchema {\r\n        const schema = this.nodeSchemas.get(id);\r\n        if (!schema)\r\n            throw new Error(`The schema '${id}' could not be found.`);\r\n        return schema;\r\n    }\r\n\r\n    getBaseSchemas(): BaseNodeSchema[] {\r\n        return [...this.nodeSchemas.values()];\r\n    }\r\n}\r\n\r\nexport default new NodeSchemaManager();","export default class Colors {\r\n    static Gray = {\r\n        100: '#f7fafc',\r\n        200: '#edf2f7',\r\n        300: '#e2e8f0',\r\n        400: '#cbd5e0',\r\n        500: '#a0aec0',\r\n        600: '#718096',\r\n        700: '#4a5568',\r\n        800: '#2d3748',\r\n        900: '#1a202c',\r\n    };\r\n    static Red = {\r\n        100: '#fff5f5',\r\n        200: '#fed7d7',\r\n        300: '#feb2b2',\r\n        400: '#fc8181',\r\n        500: '#f56565',\r\n        600: '#e53e3e',\r\n        700: '#c53030',\r\n        800: '#9b2c2c',\r\n        900: '#742a2a',\r\n    };\r\n    static Orange = {\r\n        100: '#fffaf0',\r\n        200: '#feebc8',\r\n        300: '#fbd38d',\r\n        400: '#f6ad55',\r\n        500: '#ed8936',\r\n        600: '#dd6b20',\r\n        700: '#c05621',\r\n        800: '#9c4221',\r\n        900: '#7b341e',\r\n    };\r\n    static Yellow = {\r\n        100: '#fffff0',\r\n        200: '#fefcbf',\r\n        300: '#faf089',\r\n        400: '#f6e05e',\r\n        500: '#ecc94b',\r\n        600: '#d69e2e',\r\n        700: '#b7791f',\r\n        800: '#975a16',\r\n        900: '#744210',\r\n    };\r\n    static Green = {\r\n        100: '#f0fff4',\r\n        200: '#c6f6d5',\r\n        300: '#9ae6b4',\r\n        400: '#68d391',\r\n        500: '#48bb78',\r\n        600: '#38a169',\r\n        700: '#2f855a',\r\n        800: '#276749',\r\n        900: '#22543d',\r\n    };\r\n    static Teal = {\r\n        100: '#e6fffa',\r\n        200: '#b2f5ea',\r\n        300: '#81e6d9',\r\n        400: '#4fd1c5',\r\n        500: '#38b2ac',\r\n        600: '#319795',\r\n        700: '#2c7a7b',\r\n        800: '#285e61',\r\n        900: '#234e52',\r\n    };\r\n    static Blue = {\r\n        100: '#ebf8ff',\r\n        200: '#bee3f8',\r\n        300: '#90cdf4',\r\n        400: '#63b3ed',\r\n        500: '#4299e1',\r\n        600: '#3182ce',\r\n        700: '#2b6cb0',\r\n        800: '#2c5282',\r\n        900: '#2a4365',\r\n    };\r\n    static Indigo = {\r\n        100: '#ebf4ff',\r\n        200: '#c3dafe',\r\n        300: '#a3bffa',\r\n        400: '#7f9cf5',\r\n        500: '#667eea',\r\n        600: '#5a67d8',\r\n        700: '#4c51bf',\r\n        800: '#434190',\r\n        900: '#3c366b',\r\n    };\r\n    static Purple = {\r\n        100: '#faf5ff',\r\n        200: '#e9d8fd',\r\n        300: '#d6bcfa',\r\n        400: '#b794f4',\r\n        500: '#9f7aea',\r\n        600: '#805ad5',\r\n        700: '#6b46c1',\r\n        800: '#553c9a',\r\n        900: '#44337a',\r\n    };\r\n    static Pink = {\r\n        100: '#fff5f7',\r\n        200: '#fed7e2',\r\n        300: '#fbb6ce',\r\n        400: '#f687b3',\r\n        500: '#ed64a6',\r\n        600: '#d53f8c',\r\n        700: '#b83280',\r\n        800: '#97266d',\r\n        900: '#702459',\r\n    };\r\n}","import { OutputSlot, InputSlot, InputFlowSlot, OutputFlowSlot, GetVariableSlot, GetInputSlot, GetOutputSlot } from \"./NodeSlot\";\r\nimport { Number, Boolean, String, Variable } from \"../utils/Types\";\r\nimport NodeSchemaManager from \"../managers/NodeSchemaManager\";\r\nimport Console from \"../managers/Console\";\r\nimport ScripletManager from \"../managers/ScripletManager\";\r\nimport { ICategorizable } from \"./Category\";\r\n\r\nfunction AddSchema(target: Function) {\r\n    const origCtor = target;\r\n\r\n    function instantiate(constructor: any, ...args: any[]) {\r\n        return new constructor(...args);\r\n    }\r\n\r\n    const newCtor = function(...args: any[]) {\r\n        return instantiate(origCtor, ...args);\r\n    };\r\n\r\n    newCtor.prototype = origCtor.prototype;\r\n\r\n    const schema = newCtor() as BaseNodeSchema;\r\n    NodeSchemaManager.nodeSchemas.set(schema.id, schema.createNew(-1));\r\n}\r\n\r\nexport enum BaseSchemaTypes {\r\n    Start = \"Hidden/Start\",\r\n    IfElse = \"Base/ControlFlow/IfElse\",\r\n    ForLoop = \"Base/ControlFlow/ForLoop\",\r\n    ForLoopBreak = \"Base/ControlFlow/ForLoopBreak\",\r\n    WhileLoop = \"Base/ControlFlow/WhileLoop\",\r\n    Input = \"Hidden/Input\",\r\n    Output = \"Hidden/Output\",\r\n\r\n    InputNumber = \"Hidden/Input/Number\",\r\n    OutputNumber = \"Hidden/Output/Number\",\r\n    PrintNumber = \"Base/Debug/PrintNumber\",\r\n    GetNumber = \"Hidden/Getter/Number\",\r\n    SetNumber = \"Hidden/Setter/Number\",\r\n\r\n    InputBoolean = \"Hidden/Input/Boolean\",\r\n    OutputBoolean = \"Hidden/Output/Boolean\",\r\n    PrintBoolean = \"Base/Debug/PrintBoolean\",\r\n    GetBoolean = \"Hidden/Getter/Boolean\",\r\n    SetBoolean = \"Hidden/Setter/Boolean\",\r\n\r\n    InputString = \"Hidden/Input/String\",\r\n    OutputString = \"Hidden/Output/String\",\r\n    PrintString = \"Base/Debug/PrintString\",\r\n    GetString = \"Hidden/Getter/String\",\r\n    SetString = \"Hidden/Setter/String\",\r\n\r\n    AddNumbers = \"Base/Math/Number/Add\",\r\n    SubtractNumbers = \"Base/Math/Number/Subtract\",\r\n    MultiplyNumbers = \"Base/Math/Number/Multiply\",\r\n    DivideNumbers = \"Base/Math/Number/Divide\",\r\n    ModuloNumbers = \"Base/Math/Number/Modulo\",\r\n    PowNumbers = \"Base/Math/Number/Power\",\r\n    SqrtNumber = \"Base/Math/Number/SquareRoot\",\r\n    CeilNumber = \"Base/Math/Number/Ceiling\",\r\n    FloorNumber = \"Base/Math/Number/Floor\",\r\n    LessThanNumbers = \"Base/Math/Number/LessThan\",\r\n    LessThanEqualNumbers = \"Base/Math/Number/LessThanEqual\",\r\n    GreaterThanNumbers = \"Base/Math/Number/GreaterThan\",\r\n    GreaterThanEqualNumbers = \"Base/Math/Number/GreaterThanEqual\",\r\n    EqualNumbers = \"Base/Math/Number/Equal\",\r\n    NotEqualNumbers = \"Base/Math/Number/NotEqual\",\r\n\r\n    AndBoolean = \"Base/Math/Boolean/And\",\r\n    OrBoolean = \"Base/Math/Boolean/Or\",\r\n    EqualBoolean = \"Base/Math/Boolean/Equal\",\r\n    NotEqualBoolean = \"Base/Math/Boolean/NotEqual\",\r\n    NotBoolean = \"Base/Math/Boolean/Not\",\r\n\r\n    AppendString = \"Base/Utils/String/Append\", // No flow.\r\n    ContainsString = \"Base/Utils/String/Contains\", // No flow. Should also output index of substring\r\n    StartsWithString = \"Base/Utils/String/StartsWith\", // No flow.\r\n    EndsWithString = \"Base/Utils/String/EndsWith\", // No flow.\r\n    EqualString = \"Base/Utils/String/Equal\", // No flow. Should include boolean input to specify if case sensitive\r\n    NotEqualString = \"Base/Utils/String/NotEqual\", // No flow. Should include boolean input to specify if case sensitive\r\n    LengthString = \"Base/Utils/String/Length\",// No flow. \r\n    MatchesRegexString = \"Base/Utils/String/MatchesRegex\", // No flow. \r\n    ReplaceSubstring = \"Base/Utils/String/ReplaceSubstring\", // No flow.  Replaces a part of the string\r\n    ReplaceAtIndexString = \"Base/Utils/String/ReplaceAtIndex\", // No flow. \r\n    ReverseString = \"Base/Utils/String/Reverse\", // No flow. \r\n    SplitString = \"Base/Utils/String/Split\", // No flow. TODO: Outputs an array of strings, array slots need implementation first\r\n    ToLowerCaseString = \"Base/Utils/String/ToLowerCase\", // No flow. \r\n    ToUpperCaseString = \"Base/Utils/String/ToUpperCase\" // No flow. \r\n}\r\n\r\n// TODO: Possibly move all these things to a config file that is read by these and behavior is filled in\r\nexport abstract class BaseNodeSchema implements ICategorizable {\r\n    readonly id: string;\r\n    readonly name: string;\r\n    readonly uniqueNamePrefix: string;\r\n    readonly width: number;\r\n    //readonly hasVariable: boolean;\r\n    readonly inputFlowSlots: InputFlowSlot[];\r\n    readonly outputFlowSlots: OutputFlowSlot[];\r\n    readonly inputSlots: InputSlot[];\r\n    readonly outputSlots: OutputSlot[];\r\n\r\n    readonly isDeletable: boolean;\r\n    readonly isNameEditable: boolean;\r\n\r\n    protected abstract createNewSchema(itemId: number): BaseNodeSchema;\r\n\r\n    constructor(id: string, name: string, uniqueNamePrefix: string, width: number, inputFlowSlots: InputFlowSlot[], outputFlowSlots: OutputFlowSlot[], inputSlots: InputSlot[], outputSlots: OutputSlot[], isDeletable: boolean = true, isNameEditable: boolean = true) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.uniqueNamePrefix = uniqueNamePrefix;\r\n        this.width = width;\r\n        this.inputFlowSlots = inputFlowSlots;\r\n        this.outputFlowSlots = outputFlowSlots;\r\n        this.inputSlots = inputSlots;\r\n        this.outputSlots = outputSlots;\r\n\r\n        this.isDeletable = isDeletable;\r\n        this.isNameEditable = isNameEditable;\r\n    }\r\n\r\n    maxLength(): number {\r\n        return Math.max(this.inputFlowSlots.length + this.inputSlots.length, this.outputFlowSlots.length + this.outputSlots.length);\r\n    }\r\n\r\n    createNew(itemId: number): BaseNodeSchema {\r\n        return this.createNewSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class StartFlowSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.Start;\r\n        const name = \"Start\";\r\n        const uniqueNamePrefix = \"start\";\r\n\r\n        const output1 = new OutputFlowSlot(0, \"Body\");\r\n        const outputFlowSlots = [output1];\r\n        const inputFlowSlots: InputFlowSlot[] = [new InputFlowSlot(0, () => {\r\n            output1.goNext(itemId);\r\n        }, false, \" \")];\r\n\r\n        super(id, name, uniqueNamePrefix, 120, inputFlowSlots, outputFlowSlots, [], [], false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): StartFlowSchema {\r\n        return new StartFlowSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class IfElseSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.IfElse;\r\n        const name = \"If/Else\";\r\n        const uniqueNamePrefix = \"ifElse\";\r\n\r\n        const input1 = new InputSlot(1, Boolean.className, Boolean.defaultValue, \"Condition\");\r\n        const inputSlots = [input1];\r\n\r\n        const output1 = new OutputFlowSlot(0, \"True\");\r\n        const output2 = new OutputFlowSlot(1, \"False\");\r\n        const outputFlowSlots = [output1, output2];\r\n\r\n        const inputFlowSlots = [new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            if (input1.getValue(itemId) === true)\r\n                output1.goNext(itemId, returnToSlot)\r\n            else\r\n                output2.goNext(itemId, returnToSlot);\r\n        }, true, \"Entry\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 220, inputFlowSlots, outputFlowSlots, inputSlots, []);\r\n    }\r\n\r\n    createNewSchema(itemId: number): IfElseSchema {\r\n        return new IfElseSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ForLoopSchema extends BaseNodeSchema {\r\n    private start: number | undefined;\r\n    private end: number | undefined;\r\n    private increment: number | undefined;\r\n    private index: number;\r\n\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ForLoop;\r\n        const name = \"For Loop\";\r\n        const uniqueNamePrefix = \"forLoop\";\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Body\");\r\n        const outputFlow2 = new OutputFlowSlot(1, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1, outputFlow2];\r\n\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue, \"Start\");\r\n        const input3 = new InputSlot(2, Number.className, 10, \"End\");\r\n        const input4 = new InputSlot(3, Number.className, 1, \"Increment\");\r\n        const inputSlots = [input2, input3, input4];\r\n\r\n        const output3 = new OutputSlot(2, Number.className, () => {\r\n            // TODO: Kinda hackish to solve the problem below\r\n            return this.index - (this.increment ?? 1);\r\n        }, \"Index\");\r\n        const outputSlots = [output3];\r\n\r\n        const inputFlowSlots = [new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            if (!thisSlot.returnToSlot)\r\n                thisSlot.returnToSlot = returnToSlot;\r\n            if (this.start == null || this.end == null || this.increment == null) {\r\n                this.start = input2.getValue(itemId);\r\n                this.end = input3.getValue(itemId);\r\n                this.increment = input4.getValue(itemId);\r\n                this.index = this.start ?? 0;\r\n            }\r\n            \r\n            if (this.index < (this.end ?? 0)) {\r\n                // TODO: This should really increment only after everything else is done.\r\n                this.index += this.increment ?? 1;\r\n                outputFlow1.goNext(itemId, {id: -1, itemId: itemId, slotId: thisSlot.id});\r\n            } else {\r\n                const returnTo = thisSlot.returnToSlot;\r\n                thisSlot.returnToSlot = undefined;\r\n                this.index = 0;\r\n                this.start = undefined;\r\n                this.end = undefined;\r\n                outputFlow2.goNext(itemId, returnTo);\r\n            }\r\n        }, true, \"Entry\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n        this.index = 0;\r\n    }\r\n\r\n    createNewSchema(itemId: number): ForLoopSchema {\r\n        return new ForLoopSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ForLoopBreakSchema extends BaseNodeSchema {\r\n    private start: number | undefined;\r\n    private end: number | undefined;\r\n    private increment: number | undefined;\r\n    private index: number;\r\n\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ForLoopBreak;\r\n        const name = \"For Loop Break\";\r\n        const uniqueNamePrefix = \"forLoopBreak\";\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Body\");\r\n        const outputFlow2 = new OutputFlowSlot(1, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1, outputFlow2];\r\n\r\n        const input2 = new InputSlot(2, Number.className, Number.defaultValue, \"Start\");\r\n        const input3 = new InputSlot(3, Number.className, 10, \"End\");\r\n        const input4 = new InputSlot(4, Number.className, 1, \"Increment\");\r\n        const inputSlots = [input2, input3, input4];\r\n\r\n        const output3 = new OutputSlot(2, Number.className, () => {\r\n            // TODO: Kinda hackish to solve the problem below\r\n            return this.index - (this.increment ?? 1);\r\n        }, \"Index\");\r\n        const outputSlots = [output3];\r\n\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            if (!thisSlot.returnToSlot)\r\n                thisSlot.returnToSlot = returnToSlot;\r\n            if (this.start == null || this.end == null || this.increment == null) {\r\n                this.start = input2.getValue(itemId);\r\n                this.end = input3.getValue(itemId);\r\n                this.increment = input4.getValue(itemId);\r\n                this.index = this.start ?? 0;\r\n            }\r\n            \r\n            if (this.index < (this.end ?? 0)) {\r\n                // TODO: This should really increment only after everything else is done.\r\n                this.index += this.increment ?? 1;\r\n                outputFlow1.goNext(itemId, {id: -1, itemId: itemId, slotId: thisSlot.id});\r\n            } else {\r\n                const returnTo = thisSlot.returnToSlot;\r\n                thisSlot.returnToSlot = undefined;\r\n                this.index = 0;\r\n                this.start = undefined;\r\n                this.end = undefined;\r\n                outputFlow2.goNext(itemId, returnTo);\r\n            }\r\n        }, true, \"Entry\");\r\n\r\n        const inputFlow5 = new InputFlowSlot(1, (thisSlot, returnToSlot) => {\r\n            const returnTo = thisSlot.returnToSlot;\r\n            thisSlot.returnToSlot = undefined;\r\n            this.index = 0;\r\n            this.start = undefined;\r\n            this.end = undefined;\r\n            outputFlow2.goNext(itemId, returnTo);\r\n        }, true, \"Break\");\r\n\r\n        const inputFlowSlots = [inputFlow1, inputFlow5];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n        this.index = 0;\r\n    }\r\n\r\n    createNewSchema(itemId: number): ForLoopBreakSchema {\r\n        return new ForLoopBreakSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class WhileLoopSchema extends BaseNodeSchema {\r\n    // This limit is so the while loop will still halt at some point instead of \r\n    // freezing the entire app. Can be set to 0 to run forever.\r\n    private limit: number | undefined;\r\n    private counter: number;\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.WhileLoop;\r\n        const name = \"While Loop\";\r\n        const uniqueNamePrefix = \"whileLoop\";\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Body\");\r\n        const outputFlow2 = new OutputFlowSlot(1, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1, outputFlow2];\r\n\r\n        const input1 = new InputSlot(1, Boolean.className, Boolean.defaultValue, \"Condition\");\r\n        const input2 = new InputSlot(2, Number.className, 10000, \"Limit\");\r\n        const inputSlots = [input1, input2];\r\n\r\n        const outputSlots: OutputSlot[] = [];\r\n\r\n        const inputFlowSlots = [new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            if (!thisSlot.returnToSlot)\r\n                thisSlot.returnToSlot = returnToSlot;\r\n            if (this.limit == null) {\r\n                this.limit = input2.getValue(itemId);\r\n            }\r\n            \r\n            if (this.limit == null)\r\n                console.error(`The limit of while loop of id '${itemId}' is undefined, therefore this while loop won't run. Set it to 0 if it is intended to run forever.`);\r\n\r\n            if (input1.getValue(itemId) && this.limit != null && this.counter < (this.limit <= 0 ? 1 : this.limit)) {\r\n                if (this.limit > 0)\r\n                    this.counter += 1;\r\n\r\n                outputFlow1.goNext(itemId, {id: -1, itemId: itemId, slotId: thisSlot.id});\r\n            } else {\r\n                const returnTo = thisSlot.returnToSlot;\r\n                thisSlot.returnToSlot = undefined;\r\n                this.counter = 0;\r\n                this.limit = undefined;\r\n                outputFlow2.goNext(itemId, returnTo);\r\n            }\r\n        }, true, \"Entry\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n        this.counter = 0;\r\n    }\r\n\r\n    createNewSchema(itemId: number): WhileLoopSchema {\r\n        return new WhileLoopSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class InputSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.Input;\r\n        const name = \"Input\";\r\n        const uniqueNamePrefix = \"input\";\r\n\r\n        const input1 = new GetVariableSlot(0, Variable.className, Variable.defaultValue, \"Get Variable\", false, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 180, [], [], inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): InputSchema {\r\n        return new InputSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class OutputSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.Output;\r\n        const name = \"Output\";\r\n        const uniqueNamePrefix = \"output\";\r\n        const inputSlots = [new InputSlot(0, Number.className, Number.defaultValue)];\r\n        const outputSlots: OutputSlot[] = [];\r\n\r\n        super(id, name, uniqueNamePrefix, 120, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): OutputSchema {\r\n        return new OutputSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class InputNumberSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.InputNumber;\r\n        const name = \"Input Number\";\r\n        const uniqueNamePrefix = \"inputNum\";\r\n        const input1 = new GetInputSlot(0, Variable.className, Variable.defaultValue, \"Get Input\", false, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 170, [], [], inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): InputNumberSchema {\r\n        return new InputNumberSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class PrintNumberSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.PrintNumber;\r\n        const name = \"Print Number\";\r\n        const uniqueNamePrefix = \"printNum\";\r\n\r\n        const input1 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(1, Number.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1];\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            Console.log(input1.getValue(itemId));\r\n            outputFlow1.goNext(itemId, returnToSlot);\r\n        }, true, \"Entry\");\r\n        const inputFlowSlots = [inputFlow1];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): PrintNumberSchema {\r\n        return new PrintNumberSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class GetNumberSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.GetNumber;\r\n        const name = \"Get Number\";\r\n        const uniqueNamePrefix = \"getNum\";\r\n\r\n        const input1 = new GetVariableSlot(0, Variable.className, Variable.defaultValue, \"Get Variable\", false, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 180, [], [], inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): GetNumberSchema {\r\n        return new GetNumberSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class SetNumberSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.SetNumber;\r\n        const name = \"Set Number\";\r\n        const uniqueNamePrefix = \"setNum\";\r\n\r\n        const input1 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(1, Number.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1];\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            const scriplet = ScripletManager.currentScriplet;\r\n            if (!scriplet) {\r\n                console.error(`The current scriplet could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const item = scriplet.getNode(itemId);\r\n            if (!item) {\r\n                console.error(`The node item of id '${itemId}' could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const variableId = item.variableId;\r\n            if (variableId == null) {\r\n                console.error(`The variable id in node item '${itemId}' could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const variable = scriplet.getVariable(variableId);\r\n            if (!variable) {\r\n                console.error(`The variable of id '${variableId}' could not be found.`);\r\n                return;\r\n            }\r\n\r\n            if (variable.type !== Number.className) {\r\n                console.error(`Cannot set to variable '${variableId}' of type '${variable.type}' when the needed type is '${Number.className}'.`);\r\n                return;\r\n            }\r\n    \r\n            variable.value = input1.getValue(itemId);\r\n            scriplet.setVariable(variable);\r\n\r\n            outputFlow1.goNext(itemId, returnToSlot);\r\n        }, true, \"Set Variable\");\r\n        const inputFlowSlots = [inputFlow1];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): SetNumberSchema {\r\n        return new SetNumberSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class InputBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.InputBoolean;\r\n        const name = \"Input Boolean\";\r\n        const uniqueNamePrefix = \"inputBool\";\r\n        const input1 = new GetInputSlot(0, Variable.className, Variable.defaultValue, \"Get Input\", false, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 170, [], [], inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): InputBooleanSchema {\r\n        return new InputBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n// TODO: Add OutputSchema here eventually\r\n\r\n@AddSchema\r\nexport class PrintBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.PrintBoolean;\r\n        const name = \"Print Boolean\";\r\n        const uniqueNamePrefix = \"printBool\";\r\n\r\n        const input1 = new InputSlot(1, Boolean.className, Boolean.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(1, Boolean.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1];\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            Console.log(input1.getValue(itemId));\r\n            outputFlow1.goNext(itemId, returnToSlot);\r\n        }, true, \"Entry\");\r\n        const inputFlowSlots = [inputFlow1];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): PrintBooleanSchema {\r\n        return new PrintBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class GetBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.GetBoolean;\r\n        const name = \"Get Boolean\";\r\n        const uniqueNamePrefix = \"getBool\";\r\n\r\n        const input1 = new GetVariableSlot(0, Variable.className, Variable.defaultValue, \"Get Variable\", false, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 180, [], [], inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): GetBooleanSchema {\r\n        return new GetBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class SetBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.SetBoolean;\r\n        const name = \"Set Boolean\";\r\n        const uniqueNamePrefix = \"setBoolean\";\r\n\r\n        const input1 = new InputSlot(1, Boolean.className, Boolean.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(1, Boolean.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1];\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            const scriplet = ScripletManager.currentScriplet;\r\n            if (!scriplet) {\r\n                console.error(`The current scriplet could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const item = scriplet.getNode(itemId);\r\n            if (!item) {\r\n                console.error(`The node item of id '${itemId}' could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const variableId = item.variableId;\r\n            if (variableId == null) {\r\n                console.error(`The variable id in node item '${itemId}' could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const variable = scriplet.getVariable(variableId);\r\n            if (!variable) {\r\n                console.error(`The variable of id '${variableId}' could not be found.`);\r\n                return;\r\n            }\r\n\r\n            if (variable.type !== Boolean.className) {\r\n                console.error(`Cannot set to variable '${variableId}' of type '${variable.type}' when the needed type is '${Boolean.className}'.`);\r\n                return;\r\n            }\r\n    \r\n            variable.value = input1.getValue(itemId);\r\n            scriplet.setVariable(variable);\r\n\r\n            outputFlow1.goNext(itemId, returnToSlot);\r\n        }, true, \"Set Variable\");\r\n        const inputFlowSlots = [inputFlow1];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): SetBooleanSchema {\r\n        return new SetBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class InputStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.InputString;\r\n        const name = \"Input String\";\r\n        const uniqueNamePrefix = \"inputStr\";\r\n        const input1 = new GetInputSlot(0, Variable.className, Variable.defaultValue, \"Get Input\", false, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 170, [], [], inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): InputStringSchema {\r\n        return new InputStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class PrintStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.PrintString;\r\n        const name = \"Print String\";\r\n        const uniqueNamePrefix = \"printStr\";\r\n\r\n        const input1 = new InputSlot(1, String.className, String.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(1, String.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1];\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            Console.log(input1.getValue(itemId));\r\n            outputFlow1.goNext(itemId, returnToSlot);\r\n        }, true, \"Entry\");\r\n        const inputFlowSlots = [inputFlow1];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): PrintStringSchema {\r\n        return new PrintStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class GetStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.GetString;\r\n        const name = \"Get String\";\r\n        const uniqueNamePrefix = \"getStr\";\r\n\r\n        const input1 = new GetVariableSlot(0, Variable.className, Variable.defaultValue, \"Get Variable\", false, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 180, [], [], inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): GetStringSchema {\r\n        return new GetStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class SetStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.SetString;\r\n        const name = \"Set String\";\r\n        const uniqueNamePrefix = \"setStr\";\r\n\r\n        const input1 = new InputSlot(1, String.className, String.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(1, String.className, () => {\r\n            return input1.getValue(itemId);\r\n        })];\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1];\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            const scriplet = ScripletManager.currentScriplet;\r\n            if (!scriplet) {\r\n                console.error(`The current scriplet could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const item = scriplet.getNode(itemId);\r\n            if (!item) {\r\n                console.error(`The node item of id '${itemId}' could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const variableId = item.variableId;\r\n            if (variableId == null) {\r\n                console.error(`The variable id in node item '${itemId}' could not be found.`);\r\n                return;\r\n            }\r\n    \r\n            const variable = scriplet.getVariable(variableId);\r\n            if (!variable) {\r\n                console.error(`The variable of id '${variableId}' could not be found.`);\r\n                return;\r\n            }\r\n\r\n            if (variable.type !== String.className) {\r\n                console.error(`Cannot set to variable '${variableId}' of type '${variable.type}' when the needed type is '${Number.className}'.`);\r\n                return;\r\n            }\r\n    \r\n            variable.value = input1.getValue(itemId);\r\n            scriplet.setVariable(variable);\r\n\r\n            outputFlow1.goNext(itemId, returnToSlot);\r\n        }, true, \"Set Variable\");\r\n        const inputFlowSlots = [inputFlow1];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots, true, false);\r\n    }\r\n\r\n    createNewSchema(itemId: number): SetStringSchema {\r\n        return new SetStringSchema(itemId);\r\n    }\r\n}\r\n\r\n// The base class for all addition \r\n// We have two choices:\r\n// - Extend from this AddSchema to make addition nodes for different object types\r\n//   - Can customize every aspect of the node\r\n// - Create a universal way to add same-typed objects together through interfaces\r\n//   - Will only need one universal addition node that uses the interface to add objects\r\n@AddSchema\r\nexport class AddNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.AddNumbers;\r\n        const name = \"Add Numbers\";\r\n        const uniqueNamePrefix = \"addNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            // TODO: Type check maybe?\r\n            return input1.getValue(itemId) + input2.getValue(itemId);\r\n        }, \"Sum\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): AddNumbersSchema {\r\n        return new AddNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class SubtractNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.SubtractNumbers;\r\n        const name = \"Subtract Numbers\";\r\n        const uniqueNamePrefix = \"subtractNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(itemId) - input2.getValue(itemId);\r\n        }, \"Difference\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 220, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): SubtractNumbersSchema {\r\n        return new SubtractNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class MultiplyNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.MultiplyNumbers;\r\n        const name = \"Multiply Numbers\";\r\n        const uniqueNamePrefix = \"multiplyNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(itemId) * input2.getValue(itemId);\r\n        }, \"Product\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 210, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): MultiplyNumbersSchema {\r\n        return new MultiplyNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class DivideNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.DivideNumbers;\r\n        const name = \"Divide Numbers\";\r\n        const uniqueNamePrefix = \"divideNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, 1);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(itemId) / (input2.getValue(itemId) || 1);\r\n        }, \"Quotient\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 210, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): DivideNumbersSchema {\r\n        return new DivideNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ModuloNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ModuloNumbers;\r\n        const name = \"Modulo Numbers\";\r\n        const uniqueNamePrefix = \"moduloNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            const num1 = input1.getValue(itemId);\r\n            const num2 = input2.getValue(itemId);\r\n            return ((num1 % num2) + num2) % num2;\r\n        }, \"Modulo\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): ModuloNumbersSchema {\r\n        return new ModuloNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class PowNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.PowNumbers;\r\n        const name = \"Power Numbers\";\r\n        const uniqueNamePrefix = \"powNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue, \"Base\");\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue, \"Exponent\");\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return Math.pow(input1.getValue(itemId), input2.getValue(itemId));\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): PowNumbersSchema {\r\n        return new PowNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class SqrtNumberSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.SqrtNumber;\r\n        const name = \"Square Root Number\";\r\n        const uniqueNamePrefix = \"sqrtNum\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return Math.sqrt(input1.getValue(itemId));\r\n        }, \"Sqrt\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): SqrtNumberSchema {\r\n        return new SqrtNumberSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class CeilNumberSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.CeilNumber;\r\n        const name = \"Ceiling Number\";\r\n        const uniqueNamePrefix = \"ceilNum\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return Math.ceil(input1.getValue(itemId));\r\n        }, \"Ceil\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): CeilNumberSchema {\r\n        return new CeilNumberSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class FloorNumberSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.FloorNumber;\r\n        const name = \"Floor Number\";\r\n        const uniqueNamePrefix = \"floorNum\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return Math.floor(input1.getValue(itemId));\r\n        }, \"Floor\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): FloorNumberSchema {\r\n        return new FloorNumberSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class LessThanNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.LessThanNumbers;\r\n        const name = \"Less Than Numbers\";\r\n        const uniqueNamePrefix = \"lessThanNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) < input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): LessThanNumbersSchema {\r\n        return new LessThanNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class LessThanEqualNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.LessThanEqualNumbers;\r\n        const name = \"Less Than Equal Numbers\";\r\n        const uniqueNamePrefix = \"lessThanEqualNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) <= input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): LessThanEqualNumbersSchema {\r\n        return new LessThanEqualNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class GreaterThanNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.GreaterThanNumbers;\r\n        const name = \"Greater Than Numbers\";\r\n        const uniqueNamePrefix = \"greaterThanNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) > input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): GreaterThanNumbersSchema {\r\n        return new GreaterThanNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class GreaterThanEqualNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.GreaterThanEqualNumbers;\r\n        const name = \"Greater Than Equal Numbers\";\r\n        const uniqueNamePrefix = \"greaterThanEqualNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) >= input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): GreaterThanEqualNumbersSchema {\r\n        return new GreaterThanEqualNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class EqualNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.EqualNumbers;\r\n        const name = \"Equal Numbers\";\r\n        const uniqueNamePrefix = \"equalNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) === input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): EqualNumbersSchema {\r\n        return new EqualNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class NotEqualNumbersSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.NotEqualNumbers;\r\n        const name = \"Not Equal Numbers\";\r\n        const uniqueNamePrefix = \"notEqualNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) !== input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): NotEqualNumbersSchema {\r\n        return new NotEqualNumbersSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class AndBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.AndBoolean;\r\n        const name = \"And Boolean\";\r\n        const uniqueNamePrefix = \"andBool\";\r\n        const input1 = new InputSlot(0, Boolean.className, Boolean.defaultValue);\r\n        const input2 = new InputSlot(1, Boolean.className, Boolean.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) && input2.getValue(itemId);\r\n        }, \"And\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): AndBooleanSchema {\r\n        return new AndBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class OrBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.OrBoolean;\r\n        const name = \"Or Boolean\";\r\n        const uniqueNamePrefix = \"orBool\";\r\n        const input1 = new InputSlot(0, Boolean.className, Boolean.defaultValue);\r\n        const input2 = new InputSlot(1, Boolean.className, Boolean.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) || input2.getValue(itemId);\r\n        }, \"Or\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): OrBooleanSchema {\r\n        return new OrBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class EqualBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.EqualBoolean;\r\n        const name = \"Equal Boolean\";\r\n        const uniqueNamePrefix = \"equalBool\";\r\n        const input1 = new InputSlot(0, Boolean.className, Boolean.defaultValue);\r\n        const input2 = new InputSlot(1, Boolean.className, Boolean.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) === input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): EqualBooleanSchema {\r\n        return new EqualBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class NotEqualBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.NotEqualBoolean;\r\n        const name = \"Not Equal Boolean\";\r\n        const uniqueNamePrefix = \"notEqualBool\";\r\n        const input1 = new InputSlot(0, Boolean.className, Boolean.defaultValue);\r\n        const input2 = new InputSlot(1, Boolean.className, Boolean.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return input1.getValue(itemId) !== input2.getValue(itemId);\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): NotEqualBooleanSchema {\r\n        return new NotEqualBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class NotBooleanSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.NotBoolean;\r\n        const name = \"Not Boolean\";\r\n        const uniqueNamePrefix = \"notBool\";\r\n        const input1 = new InputSlot(0, Boolean.className, Boolean.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return !input1.getValue(itemId);\r\n        }, \"Not\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): NotBooleanSchema {\r\n        return new NotBooleanSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class AppendStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.AppendString;\r\n        const name = \"Append String\";\r\n        const uniqueNamePrefix = \"appendStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            return (input1.getValue(itemId) as string).concat(input2.getValue(itemId));\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): AppendStringSchema {\r\n        return new AppendStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ContainsStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ContainsString;\r\n        const name = \"Contains String\";\r\n        const uniqueNamePrefix = \"containsStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue, \"Searched\");\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue, \"Search For\");\r\n        const input3 = new InputSlot(2, Boolean.className, Boolean.defaultValue, \"Case Sensitive?\");\r\n        const inputSlots = [input1, input2, input3];\r\n\r\n        const output1 = new OutputSlot(0, Boolean.className, () => {\r\n            // TODO: For case-sensitivity, see this and its related link: https://stackoverflow.com/a/19154150/5874473\r\n            if (input3.getValue(itemId) === true)\r\n                return (input1.getValue(itemId) as string).includes(input2.getValue(itemId));\r\n\r\n            return (input1.getValue(itemId) as string).toLowerCase().includes((input2.getValue(itemId) as string).toLowerCase());\r\n        }, \"Has Found\");\r\n        const output2 = new OutputSlot(0, Number.className, () => {\r\n            if (input3.getValue(itemId) === true)\r\n                return (input1.getValue(itemId) as string).indexOf(input2.getValue(itemId));\r\n\r\n            return (input1.getValue(itemId) as string).toLowerCase().indexOf((input2.getValue(itemId) as string).toLowerCase());\r\n        }, \"Index\")\r\n        const outputSlots = [output1, output2];\r\n\r\n        super(id, name, uniqueNamePrefix, 240, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): ContainsStringSchema {\r\n        return new ContainsStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class StartsWithStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.StartsWithString;\r\n        const name = \"Starts With String\";\r\n        const uniqueNamePrefix = \"startsWithStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue, \"Searched\");\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue, \"Starts With\");\r\n        const input3 = new InputSlot(2, Boolean.className, Boolean.defaultValue, \"Case Sensitive?\");\r\n        const inputSlots = [input1, input2, input3];\r\n\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            if (input3.getValue(itemId) === true)\r\n                return (input1.getValue(itemId) as string).startsWith(input2.getValue(itemId));\r\n            \r\n            return (input1.getValue(itemId) as string).toLowerCase().startsWith((input2.getValue(itemId) as string).toLowerCase());\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 215, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): StartsWithStringSchema {\r\n        return new StartsWithStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class EndsWithStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.EndsWithString;\r\n        const name = \"Ends With String\";\r\n        const uniqueNamePrefix = \"endsWithStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue, \"Searched\");\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue, \"Ends With\");\r\n        const input3 = new InputSlot(2, Boolean.className, Boolean.defaultValue, \"Case Sensitive?\");\r\n        const inputSlots = [input1, input2, input3];\r\n\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            if (input3.getValue(itemId) === true)\r\n                return (input1.getValue(itemId) as string).endsWith(input2.getValue(itemId));\r\n            \r\n            return (input1.getValue(itemId) as string).toLowerCase().endsWith((input2.getValue(itemId) as string).toLowerCase());\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 215, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): EndsWithStringSchema {\r\n        return new EndsWithStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class EqualStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.EqualString;\r\n        const name = \"Equal String\";\r\n        const uniqueNamePrefix = \"equalStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue, \"Equal To\");\r\n        const input3 = new InputSlot(2, Boolean.className, Boolean.defaultValue, \"Case Sensitive?\");\r\n        const inputSlots = [input1, input2, input3];\r\n\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            if (input3.getValue(itemId) === true)\r\n                return input1.getValue(itemId) === input2.getValue(itemId);\r\n            \r\n            return (input1.getValue(itemId) as string).toLowerCase() === (input2.getValue(itemId) as string).toLowerCase();\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): EqualStringSchema {\r\n        return new EqualStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class NotEqualStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.NotEqualString;\r\n        const name = \"Not Equal String\";\r\n        const uniqueNamePrefix = \"notEqualStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue, \"Not Equal To\");\r\n        const input3 = new InputSlot(2, Boolean.className, Boolean.defaultValue, \"Case Sensitive?\");\r\n        const inputSlots = [input1, input2, input3];\r\n\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            if (input3.getValue(itemId) === true)\r\n                return input1.getValue(itemId) !== input2.getValue(itemId);\r\n            \r\n            return (input1.getValue(itemId) as string).toLowerCase() !== (input2.getValue(itemId) as string).toLowerCase();\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): NotEqualStringSchema {\r\n        return new NotEqualStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class LengthStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.LengthString;\r\n        const name = \"Length of String\";\r\n        const uniqueNamePrefix = \"lengthStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const inputSlots = [input1];\r\n\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return (input1.getValue(itemId) as string).length;\r\n        }, \"Length\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): LengthStringSchema {\r\n        return new LengthStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class MatchesRegexStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.MatchesRegexString;\r\n        const name = \"Matches Regex String\";\r\n        const uniqueNamePrefix = \"matchesRegexStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue, \"Regex\");\r\n        const inputSlots = [input1, input2];\r\n\r\n        const outputSlots = [new OutputSlot(0, Boolean.className, () => {\r\n            return (input1.getValue(itemId) as string).match(input2.getValue(itemId)) != null;\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): MatchesRegexStringSchema {\r\n        return new MatchesRegexStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ReplaceSubstringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ReplaceSubstring;\r\n        const name = \"Replace Substring\";\r\n        const uniqueNamePrefix = \"replaceSubstr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const input2 = new InputSlot(1, String.className, String.defaultValue, \"Search For\");\r\n        const input3 = new InputSlot(2, String.className, String.defaultValue, \"Replace To\");\r\n        const inputSlots = [input1, input2, input3];\r\n\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            return (input1.getValue(itemId) as string).replaceAll(input2.getValue(itemId), input3.getValue(itemId));\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): ReplaceSubstringSchema {\r\n        return new ReplaceSubstringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ReplaceAtIndexStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ReplaceAtIndexString;\r\n        const name = \"Replace At Index String\";\r\n        const uniqueNamePrefix = \"replaceAtIndexStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue, \"Index From\");\r\n        const input3 = new InputSlot(2, Number.className, Number.defaultValue, \"Index To\");\r\n        const input4 = new InputSlot(3, String.className, String.defaultValue, \"Replace To\");\r\n        const inputSlots = [input1, input2, input3, input4];\r\n\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            const input = input1.getValue(itemId) as string;\r\n            return input.substr(0, input2.getValue(itemId)) + input4.getValue(itemId) + input.substr(input3.getValue(itemId));\r\n        }, \"Result\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): ReplaceAtIndexStringSchema {\r\n        return new ReplaceAtIndexStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ReverseStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ReverseString;\r\n        const name = \"Reverse String\";\r\n        const uniqueNamePrefix = \"reverseStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const inputSlots = [input1];\r\n\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            return (input1.getValue(itemId) as string).split(\"\").reverse().join(\"\");\r\n        }, \"Reversed\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 215, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): ReverseStringSchema {\r\n        return new ReverseStringSchema(itemId);\r\n    }\r\n}\r\n\r\n// TODO: SplitString = \"Base/Utils/String/Split\", // No flow. TODO: Outputs an array of strings, array slots need implementation first\r\n\r\n@AddSchema\r\nexport class ToLowerCaseStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ToLowerCaseString;\r\n        const name = \"To Lower Case String\";\r\n        const uniqueNamePrefix = \"toLowerCaseStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const inputSlots = [input1];\r\n\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            return (input1.getValue(itemId) as string).toLowerCase();\r\n        }, \"Lowercase\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 220, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): ToLowerCaseStringSchema {\r\n        return new ToLowerCaseStringSchema(itemId);\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ToUpperCaseStringSchema extends BaseNodeSchema {\r\n    constructor(itemId: number) {\r\n        const id = BaseSchemaTypes.ToUpperCaseString;\r\n        const name = \"To Upper Case String\";\r\n        const uniqueNamePrefix = \"toUpperCaseStr\";\r\n        const input1 = new InputSlot(0, String.className, String.defaultValue);\r\n        const inputSlots = [input1];\r\n\r\n        const outputSlots = [new OutputSlot(0, String.className, () => {\r\n            return (input1.getValue(itemId) as string).toUpperCase();\r\n        }, \"Uppercase\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 220, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(itemId: number): ToUpperCaseStringSchema {\r\n        return new ToUpperCaseStringSchema(itemId);\r\n    }\r\n}\r\n","import Colors from \"../utils/Colors\";\r\nimport { SimpleEventDispatcher, ISimpleEventHandler } from \"ste-simple-events\";\r\n\r\nexport type ConsoleMessage = {\r\n    message: string;\r\n    color: string;\r\n}\r\n\r\nclass Console {\r\n    private onMessage = new SimpleEventDispatcher<ConsoleMessage>();\r\n\r\n    subscribe(func: ISimpleEventHandler<ConsoleMessage>) {\r\n        this.onMessage.subscribe(func)\r\n    }\r\n\r\n    log(message: string) {\r\n        this.onMessage.dispatch({message: message, color: Colors.Gray[100]});\r\n    }\r\n\r\n    error(message: string) {\r\n        this.onMessage.dispatch({message: message, color: Colors.Red[500]});\r\n    }\r\n\r\n    success(message: string) {\r\n        this.onMessage.dispatch({message: message, color: Colors.Green[400]});\r\n    }\r\n}\r\n\r\nexport default new Console();","import NodeSchemaManager from \"./NodeSchemaManager\";\r\n\r\nclass VariableManager {\r\n    private typeCount: Map<string, number>;\r\n\r\n    constructor() {\r\n        this.typeCount = new Map<string, number>();\r\n    }\r\n\r\n    getNextVariableName(schemaId: string): string | undefined {\r\n        const schema = NodeSchemaManager.getBaseSchema(schemaId);\r\n        if (!schema) {\r\n            console.error(`The schema of id '${schemaId}' could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        let count = this.typeCount.get(schemaId);\r\n        // This shouldn't be written as !count because having a value of 0 will always return true.\r\n        if (count == null) {\r\n            this.typeCount.set(schemaId, 1);\r\n            count = 1;\r\n        }\r\n        else\r\n            this.typeCount.set(schemaId, count + 1);\r\n\r\n        return `${schema.uniqueNamePrefix}${count}`;\r\n    }\r\n}\r\n\r\nexport default new VariableManager();","import { BaseNodeSchema } from './NodeSchema';\r\nimport NodeSchemaManager from '../managers/NodeSchemaManager';\r\nimport VariableManager from '../managers/VariableManager';\r\nimport { IdValuePair, ItemSlotPair } from './NodeSlot';\r\nimport ScripletManager from '../managers/ScripletManager';\r\nimport { VariableItem } from './Scriplet';\r\n\r\n// TODO: Implement slot connections here instead because...\r\n// When getting a node from the scriplet, it always creates a new schema,\r\n// therefore the slot connections added there when connecting nodes are not saved.\r\nexport interface INodeItem {\r\n    id: number;\r\n    customName?: string;\r\n    x: number;\r\n    y: number;\r\n    schemaId: string;\r\n    inputValues: IdValuePair[];\r\n    inputSlots: ItemSlotPair[];\r\n    inputFlowSlots: ItemSlotPair[];\r\n    outputSlots: Map<number, ItemSlotPair[]>;\r\n    outputFlowSlots: ItemSlotPair[];\r\n    variableId?: number;\r\n    variableType?: string;\r\n}\r\n\r\n// TODO: When position changes, new x and y coords are not saved to db\r\nexport class NodeItem implements INodeItem {\r\n    public id: number;\r\n    public customName?: string;\r\n    public x: number;\r\n    public y: number;\r\n    public schemaId: string;\r\n    public inputValues: IdValuePair[];\r\n    public inputSlots: ItemSlotPair[];\r\n    public inputFlowSlots: ItemSlotPair[];\r\n    public outputSlots: Map<number, ItemSlotPair[]>;\r\n    public outputFlowSlots: ItemSlotPair[];\r\n    public variableId?: number;\r\n    public variableType?: string;\r\n\r\n    public variableName: string;\r\n    public schema: BaseNodeSchema;\r\n\r\n    constructor(id: number, x: number, y: number, schemaId: string, inputValues: IdValuePair[], inputSlots: ItemSlotPair[], inputFlowSlots: ItemSlotPair[], outputSlots: Map<number, ItemSlotPair[]>, outputFlowSlots: ItemSlotPair[], customName?: string, variableId?: number, variableType?: string) {\r\n        this.id = id;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.schemaId = schemaId;\r\n        this.inputValues = inputValues;\r\n        this.inputSlots = inputSlots;\r\n        this.inputFlowSlots = inputFlowSlots;\r\n        this.outputSlots = outputSlots;\r\n        this.outputFlowSlots = outputFlowSlots;\r\n        \r\n        if (variableId != null) {\r\n            // TODO: Take into account input and output variables too\r\n            const scriplet = ScripletManager.currentScriplet;\r\n            let variable: VariableItem | undefined;\r\n            if (variableType === \"Variable\")\r\n                variable = scriplet?.getVariable(variableId);\r\n            else if (variableType === \"Input\")\r\n                variable = scriplet?.getInput(variableId);\r\n            else {\r\n                variable = scriplet?.getOutput(variableId);\r\n            }\r\n\r\n            this.customName = variable?.name;\r\n            this.variableId = variableId;\r\n            this.variableType = variableType;\r\n        } else {\r\n            this.customName = customName;\r\n        }\r\n\r\n        this.variableName = VariableManager.getNextVariableName(schemaId) ?? \"undefined\";\r\n        this.schema = NodeSchemaManager.getNewSchema(id, schemaId);\r\n\r\n        // Necessary so the variableName and schema are not serialized to db\r\n        Object.defineProperties(this, {\r\n            variableName: {enumerable: false, writable: true},\r\n            schema: {enumerable: false, writable: true}\r\n        });\r\n    }\r\n\r\n    getInputConnection(slotId: number): ItemSlotPair | undefined {\r\n        const result = this.inputSlots.filter(slot => slot.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Input slot '${slotId}' of node item '${this.id}' can only have 1 connection. Will return the first connection found.`);\r\n\r\n        if (result.length < 1)\r\n            return;\r\n        \r\n        return result[0];\r\n    }\r\n\r\n    setInputConnection(id: number, itemId: number, slotId: number) {\r\n        // TODO: Save changes to db\r\n        const result = this.inputSlots.filter(slot => slot.id === id);\r\n        if (result.length > 1)\r\n            console.error(`Input slot '${id}' of node item '${this.id}' can only have 1 connection. Will replace the first connection found.`);\r\n\r\n        if (result.length < 1) {\r\n            this.inputSlots.push({id, itemId, slotId});\r\n            return;\r\n        }\r\n        \r\n        const slot = result[0];\r\n        slot.itemId = itemId;\r\n        slot.slotId = slotId;\r\n    }\r\n\r\n    deleteInputConnection(slotId: number) {\r\n        this.inputSlots = this.inputSlots.filter(pair => pair.id !== slotId);\r\n    }\r\n\r\n    // I'm an idiot... I really made just one field to store the input\r\n    // value of a node when a node can have multiple input slots... *facepalm*\r\n    getInputValue(slotId: number): any {\r\n        const result = this.inputValues.filter(value => value.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Input value '${slotId}' of node item '${this.id}' can only have 1 value. Will return the first value found.`);\r\n\r\n        if (result.length < 1)\r\n            return;\r\n        \r\n        return result[0].value;\r\n    }\r\n\r\n    setInputValue(slotId: number, value?: any) {\r\n        const result = this.inputValues.filter(value => value.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Input value '${slotId}' of node item '${this.id}' can only have 1 value. Will return the first value found.`);\r\n\r\n        if (result.length < 1) {\r\n            this.inputValues.push({id: slotId, value: value});\r\n            return;\r\n        }\r\n\r\n        const val = result[0];\r\n        val.value = value;\r\n    }\r\n\r\n    getOutputConnections(slotId: number): ItemSlotPair[] {\r\n        // TODO: Also check if all slots in a subset have the same ids\r\n        const result = this.outputSlots.get(slotId);\r\n        if (!result)\r\n            return [];\r\n\r\n        return result;\r\n    }\r\n\r\n    setOutputConnection(id: number, itemId: number, slotId: number) {\r\n        const result = this.outputSlots.get(id);\r\n        if (!result) {\r\n            this.outputSlots.set(id, [{id, itemId, slotId}]);\r\n            return;\r\n        }\r\n\r\n        const similar = result.find(pair => pair.id === id && pair.itemId === itemId && pair.slotId === slotId);\r\n        if (similar) {\r\n            console.error(`The connection '${itemId}, ${slotId}' is already connected to node item slot '${this.id}, ${id}'. Something in the code may have caused this duplication.`);\r\n            return;\r\n        }\r\n\r\n        result.push({id, itemId, slotId});\r\n    }\r\n\r\n    deleteOutputConnection(id: number, itemId: number, slotId: number) {\r\n        let result = this.outputSlots.get(id);\r\n        if (result) {\r\n            result = result.filter(pair => pair.id !== id && pair.itemId !== itemId && pair.slotId !== slotId);\r\n            this.outputSlots.set(id, result);\r\n        }\r\n    }\r\n\r\n    getInputFlowConnection(slotId: number): ItemSlotPair | undefined {\r\n        const result = this.inputFlowSlots.filter(slot => slot.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Input flow slot '${slotId}' of node item '${this.id}' can only have 1 connection. Will return the first connection found.`);\r\n\r\n        if (result.length < 1)\r\n            return;\r\n        \r\n        return result[0];\r\n    }\r\n\r\n    setInputFlowConnection(id: number, itemId: number, slotId: number) {\r\n        // TODO: Save changes to db\r\n        const result = this.inputFlowSlots.filter(slot => slot.id === id);\r\n        if (result.length > 1)\r\n            console.error(`Input flow slot '${id}' of node item '${this.id}' can only have 1 connection. Will replace the first connection found.`);\r\n\r\n        if (result.length < 1) {\r\n            this.inputFlowSlots.push({id, itemId, slotId});\r\n            return;\r\n        }\r\n        \r\n        const slot = result[0];\r\n        slot.itemId = itemId;\r\n        slot.slotId = slotId;\r\n    }\r\n\r\n    deleteInputFlowConnection(slotId: number) {\r\n        this.inputFlowSlots = this.inputFlowSlots.filter(pair => pair.id !== slotId);\r\n    }\r\n\r\n    getOutputFlowConnection(slotId: number): ItemSlotPair | undefined {\r\n        const result = this.outputFlowSlots.filter(slot => slot.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Output flow slot '${slotId}' of node item '${this.id}' can only have 1 connection. Will return the first connection found.`);\r\n\r\n        if (result.length < 1)\r\n            return;\r\n        \r\n        return result[0];\r\n    }\r\n\r\n    setOutputFlowConnection(id: number, itemId: number, slotId: number) {\r\n        // TODO: Save changes to db\r\n        const result = this.outputFlowSlots.filter(slot => slot.id === id);\r\n        if (result.length > 1)\r\n            console.error(`Output flow slot '${id}' of node item '${this.id}' can only have 1 connection. Will replace the first connection found.`);\r\n\r\n        if (result.length < 1) {\r\n            this.outputFlowSlots.push({id, itemId, slotId});\r\n            return;\r\n        }\r\n        \r\n        const slot = result[0];\r\n        slot.itemId = itemId;\r\n        slot.slotId = slotId;\r\n    }\r\n\r\n    deleteOutputFlowConnection(slotId: number) {\r\n        this.outputFlowSlots = this.outputFlowSlots.filter(pair => pair.id !== slotId);\r\n    }\r\n}","import { INodeItem, NodeItem } from \"./NodeItem\";\r\nimport { BaseSchemaTypes } from \"./NodeSchema\";\r\nimport VisualScriptingDB from \"../managers/VisualScriptingDB\";\r\nimport { IdValuePair, ItemSlotPair } from \"./NodeSlot\";\r\n\r\nexport type VariableItem = {\r\n    id: number;\r\n    name: string;\r\n    type: string;\r\n    startValue: any;\r\n    value: any;\r\n}\r\n\r\nexport interface IScriplet {\r\n    id?: number;\r\n    name: string;\r\n    description?: string;\r\n    start?: INodeItem;\r\n    items?: Map<number, INodeItem>;\r\n    itemCounter?: number;\r\n    variables?: Map<number, VariableItem>;\r\n    variableCounter?: number;\r\n    inputs?: Map<number, VariableItem>;\r\n    inputCounter?: number;\r\n    outputs?: Map<number, VariableItem>;\r\n    outputCounter?: number;\r\n}\r\n\r\nexport class Scriplet implements IScriplet {\r\n    public id: number;\r\n    public name: string;\r\n    public description: string;\r\n    public start: INodeItem;\r\n    public items: Map<number, INodeItem>;\r\n    public itemCounter: number;\r\n    public variables: Map<number, VariableItem>;\r\n    public variableCounter: number;\r\n    public inputs: Map<number, VariableItem>;\r\n    public inputCounter: number;\r\n    public outputs: Map<number, VariableItem>;\r\n    public outputCounter: number;\r\n\r\n    constructor(name: string, id?: number, description?: string, start?: INodeItem, items?: Map<number, INodeItem>, itemCounter?: number, variables?: Map<number, VariableItem>, variableCounter?: number, inputs?: Map<number, VariableItem>, inputCounter?: number, outputs?: Map<number, VariableItem>, outputCounter?: number) {\r\n        this.id = id ?? 0;\r\n        this.itemCounter = itemCounter ?? 1;\r\n        this.variableCounter = variableCounter ?? 1;\r\n        this.inputCounter = inputCounter ?? 1;\r\n        this.outputCounter = outputCounter ?? 1;\r\n\r\n        this.name = name;\r\n        this.description = description ?? \"\";\r\n        this.start = start ?? {id: 0, x: 0, y: 0, schemaId: BaseSchemaTypes.Start, inputValues: [], inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: []};\r\n        if (items == null) {\r\n            this.items = new Map<number, INodeItem>();\r\n            this.items.set(0, this.start);\r\n        } else\r\n            this.items = items;\r\n        \r\n        this.variables = variables ?? new Map<number, VariableItem>();\r\n        this.inputs = inputs ?? new Map<number, VariableItem>();\r\n        this.outputs = outputs ?? new Map<number, VariableItem>();\r\n    }\r\n\r\n    // TODO: Add variable type to here\r\n    addNode(x: number, y: number, schemaId: string, inputValues: IdValuePair[], inputSlots: ItemSlotPair[], inputFlowSlots: ItemSlotPair[], outputSlots: Map<number, ItemSlotPair[]>, outputFlowSlots: ItemSlotPair[], customName?: string, variableId?: number, variableType?: string) {\r\n        this.addNodes(false, {x, y, schemaId, inputValues, inputSlots, inputFlowSlots, outputSlots, outputFlowSlots, customName, variableId, variableType});\r\n    }\r\n\r\n    // TODO: reloadOnFinish is only needed when seeding the db, seems hackish...\r\n    addNodes(reloadOnFinish: boolean, ...nodes: {x: number, y: number, schemaId: string, inputValues: IdValuePair[], inputSlots: ItemSlotPair[], inputFlowSlots: ItemSlotPair[], outputSlots: Map<number, ItemSlotPair[]>, outputFlowSlots: ItemSlotPair[], customName?: string, variableId?: number, variableType?: string}[]) {\r\n        nodes.forEach(node => {\r\n            const key = this.itemCounter++;\r\n            this.items.set(key, {id: key, x: node.x, y: node.y, schemaId: node.schemaId, inputValues: node.inputValues, inputSlots: node.inputSlots, inputFlowSlots: node.inputFlowSlots, outputSlots: node.outputSlots, outputFlowSlots: node.outputFlowSlots, customName: node.customName, variableId: node.variableId, variableType: node.variableType});\r\n        });\r\n\r\n        VisualScriptingDB.updateScriplet(this.id, {\"items\": this.items, \"itemCounter\": this.itemCounter}).then(result => {\r\n            if (result && reloadOnFinish)\r\n                window.location.reload();\r\n        });\r\n    }\r\n\r\n    getStart(): NodeItem {\r\n        if (!(this.start as NodeItem).schema) {\r\n            const newNode = new NodeItem(this.start.id, this.start.x, this.start.y, this.start.schemaId, this.start.inputValues, this.start.inputSlots, this.start.inputFlowSlots, this.start.outputSlots, this.start.outputFlowSlots, this.start.customName, this.start.variableId, this.start.variableType);\r\n            this.start = newNode;\r\n            return newNode;\r\n        }\r\n        return this.start as NodeItem;\r\n    }\r\n\r\n    getNode(itemId: number): NodeItem | undefined {\r\n        const result = this.items.get(itemId);\r\n        if (!result)\r\n            return;\r\n        \r\n        return this.convertToNodeItem(result);\r\n    }\r\n\r\n    getNodes(): NodeItem[] {\r\n        const result: NodeItem[] = [];\r\n        this.items.forEach(node => {\r\n            result.push(this.convertToNodeItem(node));\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    convertToNodeItem(node: INodeItem): NodeItem {\r\n        if (!(node as NodeItem).schema) {\r\n            const newNode = new NodeItem(node.id, node.x, node.y, node.schemaId, node.inputValues, node.inputSlots, node.inputFlowSlots, node.outputSlots, node.outputFlowSlots, node.customName, node.variableId, node.variableType);\r\n            this.items.set(node.id, newNode);\r\n            return newNode;\r\n        }\r\n\r\n        return node as NodeItem;\r\n    }\r\n\r\n    updateNodes() {\r\n        VisualScriptingDB.updateScriplet(this.id, {\"items\": this.items});\r\n    }\r\n\r\n    deleteNode(itemId: number): boolean {\r\n        return this.deleteNodes(itemId);\r\n    }\r\n\r\n    deleteNodes(...itemIds: number[]): boolean {\r\n        let result = true;\r\n        itemIds.forEach(itemId => {\r\n            if(!this.items.delete(itemId))\r\n                result = false;\r\n        });\r\n\r\n        VisualScriptingDB.updateScriplet(this.id, {\"items\": this.items});\r\n        return result;\r\n    }\r\n\r\n    addVariable(name: string, type: string, startValue: any, value: any) {\r\n        this.addVariables({name, type, startValue, value});\r\n    }\r\n\r\n    addVariables(...variables: {name: string, type: string, startValue: any, value: any}[]) {\r\n        variables.forEach(variable => {\r\n            const key = this.variableCounter++;\r\n            this.variables.set(key, {id: key, name: variable.name, type: variable.type, startValue: variable.startValue, value: variable.value});\r\n        });\r\n\r\n        VisualScriptingDB.updateScriplet(this.id, {\"variables\": this.variables, \"variableCounter\": this.variableCounter});\r\n    }\r\n\r\n    getVariable(id: number): VariableItem | undefined {\r\n        return this.variables.get(id);\r\n    }\r\n\r\n    getVariables() {\r\n        return [...this.variables.values()];\r\n    }\r\n\r\n    updateVariables() {\r\n        VisualScriptingDB.updateScriplet(this.id, {\"variables\": this.variables});\r\n    }\r\n\r\n    // TODO: Be able to set a default value for the variable, which should also be serialized to db\r\n    setVariable(variable: VariableItem) {\r\n        this.variables.set(variable.id, variable);\r\n    }\r\n\r\n    resetVariables() {\r\n        this.variables.forEach(variable => {\r\n            variable.value = undefined;\r\n        });\r\n    }\r\n\r\n    deleteVariable(id: number): boolean {\r\n        if (this.variables.delete(id)) {\r\n            this.updateVariables();\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    addInput(name: string, type: string, startValue: any, value: any) {\r\n        this.addInputs({name, type, startValue, value});\r\n    }\r\n\r\n    addInputs(...inputs: {name: string, type: string, startValue: any, value: any}[]) {\r\n        inputs.forEach(input => {\r\n            const key = this.inputCounter++;\r\n            this.inputs.set(key, {id: key, name: input.name, type: input.type, startValue: input.startValue, value: input.value});\r\n        });\r\n\r\n        VisualScriptingDB.updateScriplet(this.id, {\"inputs\": this.inputs, \"inputCounter\": this.inputCounter});\r\n    }\r\n\r\n    getInput(id: number): VariableItem | undefined {\r\n        return this.inputs.get(id);\r\n    }\r\n\r\n    getInputs() {\r\n        return [...this.inputs.values()];\r\n    }\r\n\r\n    updateInputs() {\r\n        VisualScriptingDB.updateScriplet(this.id, {\"inputs\": this.inputs});\r\n    }\r\n\r\n    // TODO: Be able to set a default value for the variable, which should also be serialized to db\r\n    setInput(input: VariableItem) {\r\n        this.inputs.set(input.id, input);\r\n        this.updateInputs();\r\n    }\r\n\r\n    deleteInput(id: number): boolean {\r\n        if (this.inputs.delete(id)) {\r\n            this.updateInputs();\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    addOutput(name: string, type: string, startValue: any, value: any) {\r\n        this.addOutputs({name, type, startValue, value});\r\n    }\r\n\r\n    addOutputs(...outputs: {name: string, type: string, startValue: any, value: any}[]) {\r\n        outputs.forEach(output => {\r\n            const key = this.outputCounter++;\r\n            this.outputs.set(key, {id: key, name: output.name, type: output.type, startValue: output.startValue, value: output.value});\r\n        });\r\n\r\n        VisualScriptingDB.updateScriplet(this.id, {\"outputs\": this.outputs, \"outputCounter\": this.outputCounter});\r\n    }\r\n\r\n    getOutput(id: number): VariableItem | undefined {\r\n        return this.outputs.get(id);\r\n    }\r\n\r\n    getOutputs() {\r\n        return [...this.outputs.values()];\r\n    }\r\n\r\n    updateOutputs() {\r\n        VisualScriptingDB.updateScriplet(this.id, {\"outputs\": this.outputs});\r\n    }\r\n\r\n    // TODO: Be able to set a default value for the variable, which should also be serialized to db\r\n    setOutput(output: VariableItem) {\r\n        this.outputs.set(output.id, output);\r\n        this.updateOutputs();\r\n    }\r\n\r\n    deleteOutput(id: number): boolean {\r\n        if (this.outputs.delete(id)) {\r\n            this.updateOutputs();\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import Dexie from 'dexie';\r\nimport { INodeItem } from '../models/NodeItem';\r\nimport { BaseSchemaTypes } from '../models/NodeSchema';\r\nimport { ItemSlotPair } from '../models/NodeSlot';\r\nimport { IScriplet, Scriplet, VariableItem } from '../models/Scriplet';\r\n\r\nclass VisualScriptingDB extends Dexie {\r\n    public scriplets: Dexie.Table<IScriplet, number>;\r\n\r\n    constructor() {\r\n        super(\"VisualScriptingDB\");\r\n\r\n        this.version(1).stores({\r\n            scriplets: \"++id, name\"\r\n        });\r\n        this.open().catch(error => {\r\n            console.error(`Opening the db '${this.name}' failed: ${error}`);\r\n        });\r\n\r\n        this.scriplets = this.table(\"scriplets\");\r\n        this.scriplets.mapToClass(Scriplet);\r\n\r\n        this.seedData();\r\n    }\r\n\r\n    seedData() {\r\n        this.scriplets.toArray().then(scriplets => {\r\n            if (scriplets.length <= 0) {\r\n                const start: INodeItem = {id: 0, x: 0, y: 0, schemaId: BaseSchemaTypes.Start, inputValues: [], inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [{id: 0, itemId: 4, slotId: 0}], customName: undefined, variableId: undefined};\r\n                this.addScriplet(\"Check If Prime\", \"Checks if the provided number is a prime.\", start).then(scriplet => {\r\n                    if (!scriplet) {\r\n                        console.error(\"Something went wrong when creating a scriplet. Check if scriplet name is not empty.\");\r\n                        return;\r\n                    }\r\n\r\n                    /*\r\n                    scriplet.addNodes(true,\r\n                        {x: -530, y: 240, schemaId: BaseSchemaTypes.InputNumber, inputValues: [{id: 0, value: 97}], inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 2, slotId: 0}, {id: 0, itemId: 3, slotId: 0}]]]), outputFlowSlots: [], customName: \"Number To Check\"},\r\n                        {x: -290, y: 118, schemaId: BaseSchemaTypes.DivideNumbers, inputValues: [{id: 1, value: 2}], inputSlots: [{id: 0, itemId: 1, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 3, slotId: 0}]]]), outputFlowSlots: [], customName: \"Half Number\"},\r\n                        {x: -32, y: 118, schemaId: BaseSchemaTypes.AddNumbers, inputValues: [{id: 1, value: 1}], inputSlots: [{id: 0, itemId: 2, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 4, slotId: 3}]]]), outputFlowSlots: [], customName: \"Plus One\"},\r\n                        {x: 225, y: 0, schemaId: BaseSchemaTypes.ForLoopBreak, inputValues: [{id: 2, value: 2}], inputSlots: [{id: 3, itemId: 3, slotId: 0}], inputFlowSlots: [{id: 0, itemId: 0, slotId: 0}, {id: 1, itemId: 8, slotId: 0}], outputSlots: new Map<number, ItemSlotPair[]>([[2, [{id: 2, itemId: 5, slotId: 1}]]]), outputFlowSlots: [{id: 0, itemId: 7, slotId: 0}, {id: 1, itemId: 9, slotId: 0}]},\r\n                        {x: 473, y: 240, schemaId: BaseSchemaTypes.ModuloNumbers, inputValues: [], inputSlots: [{id: 0, itemId: 1, slotId: 0}, {id: 1, itemId: 4, slotId: 2}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 6, slotId: 0}]]]), outputFlowSlots: []},\r\n                        {x: 743, y: 132, schemaId: BaseSchemaTypes.EqualNumbers, inputValues: [], inputSlots: [{id: 0, itemId: 5, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 7, slotId: 1}]]]), outputFlowSlots: [], customName: \"Equals Zero\"},\r\n                        {x: 986, y: -18, schemaId: BaseSchemaTypes.IfElse, inputValues: [], inputSlots: [{id: 1, itemId: 6, slotId: 0}], inputFlowSlots: [{id: 0, itemId: 4, slotId: 0}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [{id: 0, itemId: 8, slotId: 0}], customName: \"Check If Prime\"},\r\n                        {x: 1250, y: 100, schemaId: BaseSchemaTypes.PrintBoolean, inputValues: [{id: 1, value: false}], inputSlots: [], inputFlowSlots: [{id: 0, itemId: 7, slotId: 0}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [{id: 0, itemId: 4, slotId: 1}], customName: \"Is Not Prime\"},\r\n                        {x: 864, y: 278, schemaId: BaseSchemaTypes.PrintBoolean, inputValues: [], inputSlots: [], inputFlowSlots: [{id: 0, itemId: 4, slotId: 1}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [], customName: \"Is Prime\"}\r\n                    );\r\n                    */\r\n\r\n                    scriplet.addVariables({name: \"Is Prime\", type: \"Boolean\", startValue: true, value: undefined});\r\n                    scriplet.addInputs({name: \"Number to Check\", type: \"Number\", startValue: 97, value: undefined});\r\n                   \r\n                    scriplet.addNodes(true,\r\n                        {x: -530, y: 240, schemaId: BaseSchemaTypes.InputNumber, inputValues: [], inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 2, slotId: 0}, {id: 0, itemId: 3, slotId: 0}]]]), outputFlowSlots: [], customName: \"Number To Check\", variableId: 1, variableType: \"Input\"},\r\n                        {x: -290, y: 118, schemaId: BaseSchemaTypes.DivideNumbers, inputValues: [{id: 1, value: 2}], inputSlots: [{id: 0, itemId: 1, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 3, slotId: 0}]]]), outputFlowSlots: [], customName: \"Half Number\"},\r\n                        {x: -32, y: 118, schemaId: BaseSchemaTypes.AddNumbers, inputValues: [{id: 1, value: 1}], inputSlots: [{id: 0, itemId: 2, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 4, slotId: 3}]]]), outputFlowSlots: [], customName: \"Plus One\"},\r\n                        {x: 225, y: 0, schemaId: BaseSchemaTypes.ForLoopBreak, inputValues: [{id: 2, value: 2}], inputSlots: [{id: 3, itemId: 3, slotId: 0}], inputFlowSlots: [{id: 0, itemId: 0, slotId: 0}, {id: 1, itemId: 8, slotId: 0}], outputSlots: new Map<number, ItemSlotPair[]>([[2, [{id: 2, itemId: 5, slotId: 1}]]]), outputFlowSlots: [{id: 0, itemId: 7, slotId: 0}, {id: 1, itemId: 9, slotId: 0}]},\r\n                        {x: 473, y: 240, schemaId: BaseSchemaTypes.ModuloNumbers, inputValues: [], inputSlots: [{id: 0, itemId: 1, slotId: 0}, {id: 1, itemId: 4, slotId: 2}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 6, slotId: 0}]]]), outputFlowSlots: []},\r\n                        {x: 743, y: 132, schemaId: BaseSchemaTypes.EqualNumbers, inputValues: [], inputSlots: [{id: 0, itemId: 5, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 7, slotId: 1}]]]), outputFlowSlots: [], customName: \"Equals Zero\"},\r\n                        {x: 986, y: -18, schemaId: BaseSchemaTypes.IfElse, inputValues: [], inputSlots: [{id: 1, itemId: 6, slotId: 0}], inputFlowSlots: [{id: 0, itemId: 4, slotId: 0}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [{id: 0, itemId: 8, slotId: 0}], customName: \"Check If Prime\"},\r\n                        {x: 1250, y: 100, schemaId: BaseSchemaTypes.SetBoolean, inputValues: [{id: 1, value: false}], inputSlots: [], inputFlowSlots: [{id: 0, itemId: 7, slotId: 0}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [{id: 0, itemId: 4, slotId: 1}], customName: \"Set Is Prime\", variableId: 1, variableType: \"Variable\"},\r\n                        {x: 864, y: 278, schemaId: BaseSchemaTypes.IfElse, inputValues: [], inputSlots: [{id: 1, itemId: 12, slotId: 0}], inputFlowSlots: [{id: 0, itemId: 4, slotId: 1}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [{id: 0, itemId: 10, slotId: 0}, {id: 1, itemId: 11, slotId: 0}], customName: \"If IsPrime is True\"},\r\n                        {x: 1164, y: 278, schemaId: BaseSchemaTypes.PrintBoolean, inputValues: [], inputSlots: [], inputFlowSlots: [{id: 0, itemId: 9, slotId: 0}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [], customName: \"Is Definitely Prime\"},\r\n                        {x: 1164, y: 420, schemaId: BaseSchemaTypes.PrintBoolean, inputValues: [{id: 1, value: false}], inputSlots: [], inputFlowSlots: [{id: 0, itemId: 9, slotId: 1}], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: [], customName: \"Is Definitely Not Prime\"},\r\n                        {x: 564, y: 400, schemaId: BaseSchemaTypes.GetBoolean, inputValues: [], inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 9, slotId: 1}]]]), outputFlowSlots: [], customName: \"Get Is Prime\", variableId: 1, variableType: \"Variable\"}\r\n                    );\r\n                });\r\n\r\n                this.addScriplet(\"Empty Scriplet\").then(scriplet => {\r\n                    if (!scriplet) {\r\n                        console.error(\"Something went wrong when creating a scriplet. Check if scriplet name is not empty.\");\r\n                        return;\r\n                    }\r\n\r\n                    scriplet.addVariables({name: \"Test Variable\", type: \"Number\", startValue: 16, value: undefined});\r\n\r\n                    scriplet.addNodes(true, \r\n                        {x: 0, y: 100, schemaId: BaseSchemaTypes.GetNumber, inputValues: [], inputSlots: [], inputFlowSlots: [], outputSlots: new Map(), outputFlowSlots: [], customName: \"Test Name\", variableId: 1},\r\n                        {x: 0, y: 200, schemaId: BaseSchemaTypes.SetNumber, inputValues: [], inputSlots: [], inputFlowSlots: [], outputSlots: new Map(), outputFlowSlots: [], customName: \"Test Name 2\", variableId: 1}\r\n                    );\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    async getScriplet(id: number): Promise<Scriplet | undefined> {\r\n        const scriplet = await this.scriplets.get(id);\r\n        if (!scriplet)\r\n            return;\r\n        return new Scriplet(scriplet.name, scriplet.id, scriplet.description, scriplet.start, scriplet.items, scriplet.itemCounter, scriplet.variables, scriplet.variableCounter, scriplet.inputs, scriplet.inputCounter, scriplet.outputs, scriplet.outputCounter);\r\n    }\r\n\r\n    async getScriplets(): Promise<Scriplet[]> {\r\n        const scriplets = await this.scriplets.toArray();\r\n        const result: Scriplet[] = [];\r\n        scriplets.forEach(scriplet => {\r\n            result.push(new Scriplet(scriplet.name, scriplet.id, scriplet.description, scriplet.start, scriplet.items, scriplet.itemCounter, scriplet.variables, scriplet.variableCounter, scriplet.inputs, scriplet.inputCounter, scriplet.outputs, scriplet.outputCounter));\r\n        });\r\n        return result;\r\n    }\r\n\r\n    async addScriplet(name: string, description?: string, start?: INodeItem, items?: Map<number, INodeItem>, itemCounter?: number, variables?: Map<number, VariableItem>, variableCounter?: number, inputs?: Map<number, VariableItem>, inputCounter?: number, outputs?: Map<number, VariableItem>, outputCounter?: number): Promise<Scriplet | undefined> {\r\n        if (!name) {\r\n            console.error(\"When creating a scriplet, it cannot have an empty name.\");\r\n            return;\r\n        }\r\n\r\n        const scriplet: IScriplet = {name, description, start, items, itemCounter, variables, variableCounter, inputs, inputCounter, outputs, outputCounter}; \r\n        const id = await this.scriplets.add(scriplet);\r\n        return new Scriplet(name, id, description, start, items, itemCounter, variables, variableCounter, inputs, inputCounter, outputs, outputCounter);\r\n    }\r\n\r\n    async updateScriplet(id: number, changes: {[keyPath: string]: any}): Promise<boolean> {\r\n        const result = await this.scriplets.update(id, changes);\r\n        if (result === 0) {\r\n            console.error(`The scriplet of id '${id}' could not be found in the database; nothing was updated.`);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n    \r\n    async updateEntireScriplet(scriplet: Scriplet): Promise<boolean> {\r\n        const result = await this.scriplets\r\n                                .where(\":id\")\r\n                                .equals(scriplet.id)\r\n                                .modify((value, ref) => ref.value = scriplet);\r\n        \r\n        if (result === 0) {\r\n            console.error(`The scriplet of id '${scriplet.id}' could not be found in the database; nothing was updated.`);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    async deleteScriplet(id: number) {\r\n        await this.scriplets.delete(id);\r\n    }\r\n\r\n    async resetDatabase() {\r\n        return await this.delete();\r\n    }\r\n}\r\n\r\nexport default new VisualScriptingDB();","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\n\r\nexport type ModalProps = {\r\n    title: string;\r\n    openModal: (callable: () => void) => void;\r\n    children?: (closeModal: () => void) => React.ReactNode | null;\r\n}\r\n\r\nexport type ModalState = {\r\n    isModalOpen: boolean\r\n}\r\n\r\nexport default class Modal extends React.Component<ModalProps, ModalState> {\r\n    constructor(props: ModalProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isModalOpen: false\r\n        };\r\n\r\n        this.handleOpenModal = this.handleOpenModal.bind(this);\r\n        this.handleCloseModal = this.handleCloseModal.bind(this);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        this.props.openModal(this.handleOpenModal);\r\n    }\r\n\r\n    handleOpenModal() {\r\n        this.setState({isModalOpen: true});\r\n    }\r\n\r\n    handleCloseModal() {\r\n        this.setState({isModalOpen: false});\r\n    }\r\n\r\n    render() {\r\n        const { title, children } = this.props;\r\n        const { isModalOpen } = this.state;\r\n        const closeModal = this.handleCloseModal;\r\n        return(\r\n            <div className={`${isModalOpen ? 'flex' : 'hidden'} absolute-full items-center justify-center`} style={{zIndex: 100}}>\r\n                <div className=\"absolute-full opacity-50 bg-gray-900 cursor-pointer\"\r\n                     onClick={this.handleCloseModal}></div>\r\n                <div className=\"p-4 sm:p-8 w-2/3 lg:w-1/2 bg-gray-100 z-40 rounded shadow-lg\">\r\n                    <div className=\"mb-4 flex items-center justify-between text-gray-800\">\r\n                        <span className=\"text-lg font-medium\">\r\n                            {title}\r\n                        </span>\r\n                        <FontAwesomeIcon className=\"text-lg sm:text-xl cursor-pointer\" \r\n                                         icon=\"times\"\r\n                                         onClick={this.handleCloseModal} />\r\n                    </div>\r\n                    <div>\r\n                        {children != null ? children(closeModal) : null}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React from 'react';\r\nimport Colors from '../utils/Colors';\r\n\r\nexport type DropdownButtonProps = {\r\n    onEdit: () => void;\r\n    onDelete: () => void;\r\n}\r\n\r\nexport type DropdownButtonState = {\r\n    isMoreOptions: boolean;\r\n}\r\n\r\nexport default class DropdownButton extends React.Component<DropdownButtonProps, DropdownButtonState> {\r\n    private moreOptions: React.RefObject<HTMLDivElement>;\r\n    constructor(props: DropdownButtonProps) {\r\n        super(props);\r\n\r\n        this.moreOptions = React.createRef<HTMLDivElement>();\r\n\r\n        this.state = {\r\n            isMoreOptions: false\r\n        }\r\n\r\n        this.openOptions = this.openOptions.bind(this);\r\n        this.closeOptions = this.closeOptions.bind(this);\r\n        this.toggleOptions = this.toggleOptions.bind(this);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.state.isMoreOptions)\r\n            this.moreOptions.current?.focus();\r\n    }\r\n\r\n    openOptions() {\r\n        this.setState({isMoreOptions: true});\r\n    }\r\n\r\n    closeOptions() {\r\n        this.setState({isMoreOptions: false});\r\n    }\r\n\r\n    toggleOptions() {\r\n        if (this.state.isMoreOptions)\r\n            this.closeOptions();\r\n        else\r\n            this.openOptions();\r\n    }\r\n\r\n    render() {\r\n        const { onEdit, onDelete } = this.props;\r\n        const { isMoreOptions } = this.state;\r\n\r\n        return(\r\n            <div className=\"relative\">\r\n                <button className=\"px-2 py-1 flex items-center rounded bg-blue-600 hover:bg-blue-500\"\r\n                        onClick={event => {\r\n                            event.preventDefault();\r\n                            this.toggleOptions();\r\n                        }}>\r\n                    <FontAwesomeIcon className=\"text-sm text-gray-100\" icon=\"ellipsis-v\" />\r\n                </button>\r\n                <div ref={this.moreOptions}\r\n                        className={`${isMoreOptions ? \"\" : \"hidden\"} absolute outline-none`} \r\n                        style={{left: \"-54px\", zIndex: 10}}\r\n                        tabIndex={0}\r\n                        onBlur={() => {\r\n                            this.closeOptions();\r\n                        }}>\r\n                    <div className=\"\" style={{marginLeft: \"56px\", width: \"0\", height: \"12px\", borderLeft: \"8px solid transparent\", borderRight: \"8px solid transparent\", borderBottom: `8px solid ${Colors.Gray[900]}`}}></div>\r\n                    <div className=\"w-20 rounded shadow bg-gray-900\" style={{height: \"58px\"}}>\r\n                        <div className=\"px-2 py-1 flex flex-row items-center rounded text-gray-100 hover:bg-gray-600 cursor-pointer\"\r\n                                onClick={event => {\r\n                                    event.stopPropagation();\r\n                                    this.closeOptions();\r\n                                    onEdit();\r\n                                }}>\r\n                            <FontAwesomeIcon className=\"text-xs text-gray-100\" icon=\"pencil-alt\" />\r\n                            <div className=\"w-full flex justify-center text-sm\">\r\n                                <div className=\"\">Edit</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"px-2 py-1 flex flex-row items-center rounded text-gray-100 hover:bg-red-500 cursor-pointer\"\r\n                                onClick={event => {\r\n                                    event.stopPropagation();\r\n                                    this.closeOptions();\r\n                                    onDelete();\r\n                                }}>\r\n                            <FontAwesomeIcon className=\"text-xs text-gray-100\" icon=\"trash\" />\r\n                            <div className=\"w-full flex justify-center text-sm\">\r\n                                <div className=\"\">Delete</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { Scriplet } from '../models/Scriplet';\r\nimport DropdownButton from './DropdownButton';\r\n\r\nexport type ScripletNavItemProps = {\r\n    scriplet: Scriplet;\r\n    closeNavMenu: () => void;\r\n    onEdit: (scripletId: number) => void;\r\n    onDelete: (scripletId: number) => void;\r\n}\r\n\r\nexport type ScripletNavItemState = {\r\n    isHovered: boolean;\r\n}\r\n\r\nexport default class ScripletNavItem extends React.Component<ScripletNavItemProps, ScripletNavItemState> {\r\n    constructor(props: ScripletNavItemProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isHovered: false,\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { scriplet, closeNavMenu, onEdit, onDelete } = this.props;\r\n        const { isHovered } = this.state;\r\n\r\n        return (\r\n            <div className=\"flex flex-row mb-1 px-4 py-2 rounded-md hover:bg-gray-900\"\r\n                    onMouseOver={() => {\r\n                        this.setState({isHovered: true});\r\n                    }}\r\n                    onMouseOut={() => {\r\n                        this.setState({isHovered: false});\r\n                    }}>\r\n                <Link onClick={closeNavMenu} \r\n                        to={\"/scriplet/\" + scriplet.id} \r\n                        className=\"w-full flex items-center text-gray-100\">\r\n                    <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" icon=\"folder\" />\r\n                    {scriplet.name}\r\n                </Link>\r\n                {/* TODO: Possibly remove the isHovered here since the dropdown also vanishes when unhovering */}\r\n                <div className={`${isHovered ? \"\" : \"hidden\"}`}>\r\n                    <DropdownButton onEdit={() => onEdit(scriplet.id)}\r\n                                    onDelete={() => onDelete(scriplet.id)} />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Scriplet } from '../models/Scriplet';\r\n\r\nexport type ScripletFormProps = {\r\n    scriplet?: Scriplet;\r\n    onSaveScriplet: (name: string, description: string) => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nexport type ScripletFormState = {\r\n    selectedId: number;\r\n    name: string;\r\n    description: string;\r\n}\r\n\r\nexport default class ScripletForm extends React.Component<ScripletFormProps, ScripletFormState> {\r\n    constructor(props: ScripletFormProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            selectedId: -1,\r\n            name: \"\",\r\n            description: \"\"\r\n        }\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        const { scriplet } = this.props;\r\n        const { selectedId } = this.state;\r\n        if (!scriplet)\r\n            return;\r\n\r\n        if (selectedId !== scriplet.id)\r\n            this.setState({selectedId: scriplet.id, name: scriplet.name, description: scriplet.description});\r\n    }\r\n    \r\n    render() {\r\n        const { name, description } = this.state;\r\n        const { onSaveScriplet, onCancel } = this.props;\r\n\r\n        return(\r\n            <div className=\"flex flex-col\">\r\n                <div className=\"flex flex-col mb-4\">\r\n                    <label className=\"mb-1 text-sm text-gray-700\">\r\n                        Name\r\n                    </label>\r\n                    <input className=\"px-2 border-2 rounded\" \r\n                            type=\"text\" \r\n                            name=\"name\" \r\n                            value={name} \r\n                            onChange={event => {\r\n                                this.setState({name: event.target.value});\r\n                            }} />\r\n                </div>\r\n                <div className=\"flex flex-col mb-4\">\r\n                    <label className=\"mb-1 text-sm text-gray-700\">\r\n                        Description\r\n                    </label>\r\n                    <textarea className=\"px-2 border-2 rounded\" \r\n                            name=\"description\" \r\n                            rows={3}\r\n                            value={description} \r\n                            onChange={event => {\r\n                                this.setState({description: event.target.value});\r\n                            }} />\r\n                </div>\r\n                <div className=\"flex flex-row-reverse\">\r\n                    <button className=\"ml-4 px-2 py-1 rounded bg-blue-600 text-gray-100 hover:bg-blue-500\" \r\n                            onClick={() => {\r\n                                // TODO: Do validation feedback eventually\r\n                                if (!name || !description) {\r\n                                    console.error(`The form for creating a scriplet cannot have empty fields.`);\r\n                                    return;\r\n                                }\r\n\r\n                                onSaveScriplet(name, description);\r\n                                onCancel();\r\n                            }}>\r\n                        Save\r\n                    </button>\r\n                    <button className=\"px-2 py-1 rounded bg-gray-500 text-gray-100 hover:bg-gray-400\" \r\n                            onClick={onCancel}>\r\n                        Cancel\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React from 'react';\r\nimport VisualScriptingDB from '../managers/VisualScriptingDB';\r\n\r\nexport type SettingsFormProps = {\r\n\r\n}\r\n\r\nexport type SettingsFormState = {\r\n    isVerifyingReset: boolean;\r\n}\r\n\r\nexport default class SettingsForm extends React.Component<SettingsFormProps, SettingsFormState> {\r\n    constructor(props: SettingsFormProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isVerifyingReset: false\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { isVerifyingReset } = this.state;\r\n\r\n        return(\r\n            <div className=\"flex flex-col\">\r\n                <div className=\"mb-2 text-lg text-gray-800\">\r\n                    Others\r\n                </div>\r\n                <div className=\"mb-4 text-sm text-red-500\">\r\n                    Warning: This will reset the database where your scriplets are stored to when it was first initialized, and will thus delete every progress you have made so far. Only click on this if absolutely necessary!\r\n                </div>\r\n                <div className=\"mb-4\">\r\n                    <div className=\"px-4 py-2 inline rounded bg-red-500 hover:bg-red-400 text-gray-100 cursor-pointer select-none\"\r\n                            onClick={() => this.setState({isVerifyingReset: true})}>\r\n                        <FontAwesomeIcon className=\"mr-3\" icon=\"redo-alt\" />\r\n                        Reset Database\r\n                    </div>\r\n                </div>\r\n                <div className={`${isVerifyingReset ? \"\" : \"hidden\"}`}>\r\n                    <div className=\"mb-2 font-bold text-gray-900\">\r\n                        Are you sure?\r\n                    </div>\r\n                    <div className=\"flex flex-row\">\r\n                        <div className=\"px-4 py-2 mr-4 rounded bg-red-500 hover:bg-red-400 text-gray-100 cursor-pointer select-none\"\r\n                                onClick={() => {\r\n                                    VisualScriptingDB.resetDatabase().then(() => {\r\n                                        this.setState({isVerifyingReset: false}, () => {\r\n                                            // This removes current page from the history!\r\n                                            // Still works in this case because the previous page of a scriplet\r\n                                            // may already be gone when resetting the database and going back\r\n                                            // to it may just lead to errors/404\r\n                                            window.location.replace(\"/vso\");\r\n                                        });\r\n                                    });\r\n                                }}>\r\n                            <FontAwesomeIcon className=\"mr-3\" icon=\"check\" />\r\n                            Yes, reset!\r\n                        </div>\r\n                        <div className=\"px-4 py-2 rounded bg-gray-600 hover:bg-gray-500 text-gray-100 cursor-pointer select-none\"\r\n                                onClick={() => this.setState({isVerifyingReset: false})}>\r\n                            <FontAwesomeIcon className=\"mr-3\" icon=\"times\" />\r\n                            No, don't!\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div className=\"mt-2 mb-2 text-lg text-gray-800\">\r\n                    About\r\n                </div>\r\n                <div className=\"mb-2 font-medium text-xl text-gray-900\">\r\n                    Visual Scripting Online (ver. {process.env.REACT_APP_VERSION})\r\n                </div>\r\n                <div className=\"text-gray-900\">\r\n                    Made by <span className=\"font-medium\">Mark Malabanan (Devwulf)</span> \r\n                </div>\r\n                <div className=\"text-gray-900\">\r\n                    Made with <span className=\"font-medium\">React JS</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { Link } from 'react-router-dom';\r\nimport Scrollbar from 'react-scrollbars-custom';\r\nimport VisualScriptingDB from '../managers/VisualScriptingDB';\r\nimport { Scriplet } from '../models/Scriplet';\r\nimport Modal from './Modal';\r\nimport ScripletNavItem from './ScripletNavItem';\r\nimport AddItem from './AddItem';\r\nimport ScripletForm from './ScripletForm';\r\nimport SettingsForm from './SettingsForm';\r\n\r\nexport type SidebarProps = {\r\n    \r\n}\r\n\r\nexport type SidebarState = {\r\n    scriplets: Scriplet[];\r\n    editedScriplet: Scriplet | undefined;\r\n    isDirtyDB: boolean;\r\n    isNavMenuOpen: boolean;\r\n    isSidebarOpen: boolean;\r\n    openAddScripletModal: () => void;\r\n    openEditScripletModal: () => void;\r\n    openSettingsModal: () => void;\r\n}\r\n\r\nexport default class SidebarNav extends React.Component<SidebarProps, SidebarState> {\r\n    private scripletNameInput: React.RefObject<HTMLInputElement>;\r\n\r\n    constructor(props: SidebarProps) {\r\n        super(props);\r\n\r\n        this.scripletNameInput = React.createRef<HTMLInputElement>();\r\n\r\n        this.state = {\r\n            scriplets: [],\r\n            editedScriplet: undefined,\r\n            isDirtyDB: false,\r\n            isNavMenuOpen: false,\r\n            isSidebarOpen: true,\r\n            openAddScripletModal: () => {},\r\n            openEditScripletModal: () => {},\r\n            openSettingsModal: () => {}\r\n        };\r\n\r\n        this.openNavMenu = this.openNavMenu.bind(this);\r\n        this.closeNavMenu = this.closeNavMenu.bind(this);\r\n        this.toggleNavMenu = this.toggleNavMenu.bind(this);\r\n        this.openSidebar = this.openSidebar.bind(this);\r\n        this.closeSidebar = this.closeSidebar.bind(this);\r\n        this.toggleSidebar = this.toggleSidebar.bind(this);\r\n        this.onScripletCreate = this.onScripletCreate.bind(this);\r\n        this.onScripletDelete = this.onScripletDelete.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        VisualScriptingDB.getScriplets().then(scriplets => {\r\n            this.setState({scriplets: scriplets});\r\n        });\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.state.isDirtyDB) {\r\n            VisualScriptingDB.getScriplets().then(scriplets => {\r\n                this.setState({scriplets: scriplets, isDirtyDB: false});\r\n            });\r\n        }\r\n\r\n        const input = this.scripletNameInput.current;\r\n        if (!input)\r\n            return;\r\n\r\n        if (input.classList.contains(\"hidden\"))\r\n            return;\r\n\r\n        input.focus();\r\n    }\r\n\r\n    openNavMenu() {\r\n        this.setState({isNavMenuOpen: true});\r\n    }\r\n\r\n    closeNavMenu() {\r\n        this.setState({isNavMenuOpen: false});\r\n    }\r\n\r\n    toggleNavMenu() {\r\n        if (this.state.isNavMenuOpen)\r\n            this.closeNavMenu();\r\n        else\r\n            this.openNavMenu();\r\n    }\r\n\r\n    openSidebar() {\r\n        this.setState({isSidebarOpen: true});\r\n    }\r\n\r\n    closeSidebar() {\r\n        this.setState({isSidebarOpen: false});\r\n    }\r\n\r\n    toggleSidebar() {\r\n        if (this.state.isSidebarOpen)\r\n            this.closeSidebar();\r\n        else\r\n            this.openSidebar();\r\n    }\r\n\r\n    onScripletCreate(name: string, description: string) {\r\n        VisualScriptingDB.addScriplet(name, description).then(scriplet => {\r\n            if (scriplet)\r\n                this.setState({isDirtyDB: true});\r\n        });\r\n    }\r\n\r\n    onScripletEdit(id: number, name: string, description: string) {\r\n        VisualScriptingDB.updateScriplet(id, {\"name\": name, \"description\": description}).then(result => {\r\n            if (result)\r\n                this.setState({isDirtyDB: true});\r\n        });\r\n    }\r\n\r\n    onScripletDelete(scripletId: number) {\r\n        VisualScriptingDB.deleteScriplet(scripletId).then(() => {\r\n            window.location.replace(\"/vso\");\r\n        });\r\n    }\r\n\r\n    render() {\r\n        const { scriplets, editedScriplet, isNavMenuOpen, isSidebarOpen, openAddScripletModal, openEditScripletModal, openSettingsModal } = this.state;\r\n        return (\r\n            <nav className=\"nav\">\r\n                {/* \r\n                * Plan is to have a top navigation for md and below\r\n                * screen sizes, but have sidebar for lg and above\r\n                * \r\n                * Ignore animations for now\r\n                */}\r\n\r\n                { /* Top navbar */ }\r\n                <div className=\"topbar\">\r\n                    <div className=\"lg:hidden flex items-center justify-between p-4 bg-gray-800\">\r\n                        { /* Logo */ }\r\n                        <div className=\"\">\r\n                            <Link to=\"/\" className=\"text-xl text-gray-100 font-semibold\">\r\n                                <FontAwesomeIcon className=\"mr-4 text-2xl text-indigo-500\" \r\n                                                    icon=\"project-diagram\" />\r\n                                Visual Scripting\r\n                            </Link>\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-row\">\r\n                            {/* Settings */}\r\n                            <div className=\"\">\r\n                                <button className=\"px-3 py-2 mr-3 flex items-center text-indigo-500 rounded border border-indigo-500 hover:bg-indigo-300 cursor-pointer select-none\"\r\n                                        onClick={() => openSettingsModal()}>\r\n                                    <FontAwesomeIcon icon=\"cog\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            { /* Hamburger for sidebar items */ }\r\n                            <div className=\"block\">\r\n                                <button className=\"flex items-center py-2 px-3 text-indigo-500 rounded border border-indigo-500 hover:bg-indigo-300\"\r\n                                        onClick={this.toggleNavMenu} >\r\n                                    <FontAwesomeIcon icon=\"bars\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    { /* Nav Items */ }\r\n                    <div className={`${isNavMenuOpen ? '' : 'hidden'} lg:hidden relative z-20`}>\r\n                        <div className=\"absolute w-full px-4 pb-4 bg-gray-800\">\r\n                            {\r\n                                scriplets.map((scriplet, i) => (\r\n                                    <Link key={i} \r\n                                            onClick={this.closeNavMenu} \r\n                                            to={\"/scriplet/\" + scriplet.id} \r\n                                            className=\"block mb-1 px-4 py-2 rounded-md hover:bg-gray-900 focus:bg-gray-900 text-gray-100\">\r\n                                        <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" icon=\"folder\" />\r\n                                        {scriplet.name}\r\n                                    </Link>\r\n                                ))\r\n                            }\r\n                            <div className={`${scriplets.length > 0 ? \"hidden\" : \"flex\"} justify-center mb-2 select-none`}>\r\n                                <div className=\"p-3 text-gray-400 italic\">\r\n                                    No scriplets found\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"w-full mb-1 rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\">\r\n                                <div className={`px-4 py-2`}\r\n                                        onClick={() => {\r\n                                            openAddScripletModal();\r\n                                        }}>\r\n                                    <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" \r\n                                                    icon=\"plus\" />\r\n                                    <span className=\"font-medium\">Add Scriplet</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                { /* Sidebar */ }\r\n                <div>\r\n                    <div className={`${isSidebarOpen ? \"sidebar shadow\" : \"hidden\"}`}>\r\n                        <div className=\"flex-grow h-screen bg-gray-800 relative\">\r\n                            { /* Logo */ }\r\n                            <div className=\"p-4 h-16\">\r\n                                <Link to=\"/\" className=\"text-xl text-gray-100 font-semibold\">\r\n                                    <FontAwesomeIcon className=\"mr-4 text-2xl text-indigo-500\" \r\n                                                    icon=\"project-diagram\" />\r\n                                    Visual Scripting\r\n                                </Link>\r\n                            </div>\r\n\r\n                            { /* Sidebar Items */ }\r\n                            <div className=\"p-2 my-auto lg:w-64\" style={{height: \"calc(100vh - 8rem)\"}}>\r\n                                { /* TODO: Place the dashboard item here */ }\r\n                                <Scrollbar noScrollX>\r\n                                    {\r\n                                        scriplets.map((scriplet, i) => (\r\n                                            <ScripletNavItem key={`scriplet-${i}`}\r\n                                                                scriplet={scriplet}\r\n                                                                closeNavMenu={this.closeNavMenu}\r\n                                                                onEdit={() => this.setState({editedScriplet: scriplet}, () => openEditScripletModal())}\r\n                                                                onDelete={this.onScripletDelete} />\r\n                                        ))\r\n                                    }\r\n                                    <div className={`${scriplets.length > 0 ? \"hidden\" : \"flex\"} justify-center mb-2 select-none`}>\r\n                                        <div className=\"p-3 text-gray-400 italic\">\r\n                                            No scriplets found\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"w-full mb-1 rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\">\r\n                                        <div className={`px-4 py-2`}\r\n                                                onClick={() => {\r\n                                                    openAddScripletModal();\r\n                                                }}>\r\n                                            <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" \r\n                                                            icon=\"plus\" />\r\n                                            <span className=\"font-medium\">Add Scriplet</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </Scrollbar>\r\n                            </div>\r\n\r\n                            {/* Settings */}\r\n                            <div className=\"px-4 py-3 h-16\">\r\n                                <button className=\"px-4 py-2 w-full flex items-center rounded bg-gray-700 hover:bg-gray-600 text-gray-100 cursor-pointer select-none\"\r\n                                        onClick={() => openSettingsModal()}>\r\n                                    <FontAwesomeIcon className=\"mr-3\" icon=\"cog\" />\r\n                                    Settings\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className={`${isSidebarOpen ? \"hidden\" : \"collapsed-sidebar shadow\"}`}>\r\n                        <div className=\"flex-grow h-screen bg-gray-800 relative\">\r\n                            { /* Logo */ }\r\n                            <div className=\"p-4 h-16 text-center\">\r\n                                <Link to=\"/\" className=\"text-xl text-gray-100 font-semibold\">\r\n                                    <FontAwesomeIcon className=\"text-2xl text-indigo-500\" \r\n                                                    icon=\"project-diagram\" />\r\n                                </Link>\r\n                            </div>\r\n\r\n                            { /* Sidebar Items */ }\r\n                            <div className=\"sidebar-items p-2 fixed top-16 bottom-0 my-auto\">\r\n                                { /* TODO: Place the dashboard item here */ }\r\n                                <Scrollbar noScrollX>\r\n                                    {\r\n                                        scriplets.map((scriplet, i) => (\r\n                                            <Link key={i} \r\n                                                    onClick={this.closeNavMenu} \r\n                                                    to={\"/scriplet/\" + scriplet.id} \r\n                                                    className=\"block border-gray-700 border-solid border hover:border-opacity-0 mb-1 py-2 text-center rounded-md hover:bg-gray-900 focus:bg-gray-900 text-gray-100 font-bold\">\r\n                                                {scriplet.name[0]}\r\n                                            </Link>\r\n                                        ))\r\n                                    }\r\n                                    <div className=\"flex mb-1 py-2 justify-center rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\"\r\n                                            onClick={() => {\r\n                                                console.log(\"test\");\r\n                                                openAddScripletModal();\r\n                                            }}>\r\n                                        <div className=\"inline-block\">\r\n                                            <FontAwesomeIcon className=\"text-lg text-gray-600\" \r\n                                                            icon=\"plus\" />\r\n                                        </div>\r\n                                    </div>\r\n                                </Scrollbar>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <button className={`${isSidebarOpen ? \"w-64 ml-8 pl-56\" : \"w-16 ml-8 pl-8\"} sidebar-toggle items-center rounded-full bg-gray-700`}\r\n                            onClick={this.toggleSidebar}>\r\n                        <div className=\"inline-block pl-2\">\r\n                            <FontAwesomeIcon icon=\"chevron-left\"\r\n                                                className={`${isSidebarOpen ? \"block\" : \"hidden\"} text-gray-300`} />\r\n                            <FontAwesomeIcon icon=\"chevron-right\"\r\n                                                className={`${isSidebarOpen ? \"hidden\" : \"block\"} text-gray-300`} />\r\n                        </div>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Modals here */}\r\n                <Modal title=\"Create New Scriplet\"\r\n                        openModal={callable => {\r\n                            if (openAddScripletModal.toString() === (() => {}).toString())\r\n                                this.setState({openAddScripletModal: callable});\r\n                        }}>\r\n                    {(closeModal) => (\r\n                        <ScripletForm onSaveScriplet={(name, description) => {\r\n                                                            this.onScripletCreate(name, description);\r\n                                                        }}\r\n                                        onCancel={closeModal} />\r\n                    )}\r\n                </Modal>\r\n                <Modal title=\"Edit Scriplet\"\r\n                        openModal={callable => {\r\n                            if (openEditScripletModal.toString() === (() => {}).toString())\r\n                                this.setState({openEditScripletModal: callable});\r\n                        }}>\r\n                    {(closeModal) => (\r\n                        <ScripletForm scriplet={editedScriplet}\r\n                                        onSaveScriplet={(name, description) => {\r\n                                                            if (!editedScriplet) {\r\n                                                                console.error(`No edited scriplet could be found.`);\r\n                                                                return;\r\n                                                            }\r\n\r\n                                                            this.onScripletEdit(editedScriplet.id, name, description);\r\n                                                        }}\r\n                                        onCancel={closeModal} />\r\n                    )}\r\n                </Modal>\r\n                <Modal title=\"Settings\"\r\n                        openModal={callable => {\r\n                            if (openSettingsModal.toString() === (() => {}).toString())\r\n                                this.setState({openSettingsModal: callable});\r\n                        }}>\r\n                    {(closeModal) => (\r\n                        <SettingsForm />\r\n                    )}\r\n                </Modal>\r\n            </nav>\r\n        );\r\n    }\r\n}","import { KonvaEventObject } from \"konva/types/Node\";\r\n\r\nexport class KonvaUtils {\r\n    public static setCursor(event: KonvaEventObject<Event>, cursorType: string) {\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        stage.container().style.cursor = cursorType;\r\n    }\r\n}","import React from 'react';\r\nimport { Label, Tag, Text } from 'react-konva';\r\nimport { KonvaEventObject } from 'konva/types/Node';\r\nimport { KonvaUtils } from '../utils/KonvaUtils';\r\n\r\nexport class KonvaForm {\r\n    public static cancel() {\r\n        Input.cancelInput();\r\n        Dropdown.cancelDropdown();\r\n    }\r\n} \r\n\r\nexport type InputModel = {\r\n    value: string;\r\n    type: string;\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type OutputModel = {\r\n    values: string[];\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type InputProps = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    fontSize: number;\r\n    fontStyle: string;\r\n    padding: number;\r\n    textColor: string;\r\n    bgColor: string;\r\n    hoverColor: string;\r\n    borderRadius: number;\r\n    zIndex: number;\r\n    value: string;\r\n    type: string;\r\n    isEditable: boolean;\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type InputState = {\r\n    value: string;\r\n}\r\n\r\nexport class Input extends React.Component<InputProps, InputState> {\r\n    private static inputElement: HTMLInputElement;\r\n    \r\n    static defaultProps: InputProps = {\r\n        x: 0,\r\n        y: 0,\r\n        width: 100,\r\n        height: 20,\r\n        fontSize: 12,\r\n        fontStyle: \"normal\",\r\n        padding: 0,\r\n        textColor: \"#000000\",\r\n        bgColor: \"#ffffff\",\r\n        hoverColor: \"#cccccc\",\r\n        borderRadius: 0,\r\n        zIndex: 0,\r\n        value: \"\",\r\n        type: \"text\",\r\n        isEditable: true,\r\n        onChange: () => { return false; }\r\n    }\r\n\r\n    constructor(props: InputProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            value: \"\"\r\n        }\r\n\r\n        this.showInput = this.showInput.bind(this);\r\n        this.onHover = this.onHover.bind(this);\r\n        this.onHoverExit = this.onHoverExit.bind(this);\r\n    }\r\n\r\n    showInput(event: KonvaEventObject<Event>) {\r\n        Input.cancelInput();\r\n\r\n        const { width, height, fontSize, padding, textColor, hoverColor, borderRadius, zIndex, type, isEditable, onChange } = this.props;\r\n        const value = this.state.value === \"\" ? this.props.value : this.state.value;\r\n\r\n        if (!isEditable)\r\n            return;\r\n\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n        const scale = stage.scaleX();\r\n\r\n        const top = event.target.absolutePosition().y;\r\n        const left = event.target.absolutePosition().x;\r\n\r\n        const input = document.createElement(\"input\");\r\n        document.body.appendChild(input);\r\n\r\n        input.value = value;\r\n        input.type = type;\r\n        input.style.position = \"absolute\";\r\n        input.style.top = `${top}px`;\r\n        input.style.left = `${left}px`;\r\n        input.style.width = `${Math.min(width * scale, window.innerWidth - left)}px`;\r\n        input.style.height = `${height * scale}px`;\r\n        input.style.paddingLeft = `${padding * scale}px`;\r\n        input.style.fontSize = `${fontSize * scale}px`;\r\n        input.style.color = textColor;\r\n        input.style.backgroundColor = hoverColor;\r\n        input.style.borderRadius = `${borderRadius * scale}px`;\r\n        input.style.zIndex = `${zIndex}`;\r\n        input.focus();\r\n        input.onchange = (ev: Event) => {\r\n            const target = ev.target as HTMLInputElement;\r\n\r\n            if (!target) {\r\n                console.error(`Cannot cast target to 'HTMLInputElement'.`);\r\n                Input.cancelInput();\r\n                return;\r\n            }\r\n\r\n            if (!target.value) {\r\n                console.error(`No value typed in while editing the text.`);\r\n                Input.cancelInput();\r\n                return;\r\n            }\r\n\r\n            if (!onChange(target.value)) {\r\n                console.error(`Input value requirements not met.`);\r\n                Input.cancelInput();\r\n                return;\r\n            }\r\n\r\n            this.setState({value: target.value});\r\n            Input.cancelInput();\r\n        }\r\n\r\n        Input.inputElement = input;\r\n    }\r\n\r\n    public static cancelInput() {\r\n        const input = Input.inputElement;\r\n        if (!input)\r\n            return;\r\n        \r\n        input.onchange = null;\r\n        input.parentNode?.removeChild(input);\r\n    }\r\n\r\n    onHover(event: KonvaEventObject<Event>) {\r\n        if (!this.props.isEditable)\r\n            return;\r\n\r\n        KonvaUtils.setCursor(event, \"text\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.hoverColor);\r\n        layer.draw();\r\n    }\r\n\r\n    onHoverExit(event: KonvaEventObject<Event>) {\r\n        if (!this.props.isEditable)\r\n            return;\r\n            \r\n        KonvaUtils.setCursor(event, \"default\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.bgColor);\r\n        layer.draw();\r\n    }\r\n\r\n    render() {\r\n        const { x, y, width, height, fontSize, fontStyle, padding, textColor, bgColor, borderRadius } = this.props;\r\n        const value = this.state.value === \"\" ? this.props.value : this.state.value;\r\n\r\n        return(\r\n            <Label name=\"top-bar-label\"\r\n                x={x}\r\n                y={y}\r\n                onMouseEnter={this.onHover}\r\n                onMouseLeave={this.onHoverExit} \r\n                onClick={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showInput(event);\r\n                }}\r\n                onTap={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showInput(event);\r\n                }}>\r\n                <Tag fill={bgColor}\r\n                        cornerRadius={borderRadius} />\r\n                <Text name=\"top-bar-text\"\r\n                        width={width}\r\n                        height={height}\r\n                        fontStyle={fontStyle}\r\n                        fontSize={fontSize}\r\n                        verticalAlign=\"middle\"\r\n                        padding={padding}\r\n                        fill={textColor}\r\n                        text={value} />\r\n            </Label>\r\n        );\r\n    }\r\n}\r\n\r\nexport type DropdownProps = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    fontSize: number;\r\n    fontStyle: string;\r\n    padding: number;\r\n    textColor: string;\r\n    bgColor: string;\r\n    hoverColor: string;\r\n    borderRadius: number;\r\n    zIndex: number;\r\n    values: string[];\r\n    value: string;\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type DropdownState = {\r\n    selectedIndex: number;\r\n}\r\n\r\nexport class Dropdown extends React.Component<DropdownProps, DropdownState> {\r\n    private static dropdownElement: HTMLSelectElement;\r\n    \r\n    static defaultProps: DropdownProps = {\r\n        x: 0,\r\n        y: 0,\r\n        width: 100,\r\n        height: 20,\r\n        fontSize: 12,\r\n        fontStyle: \"normal\",\r\n        padding: 0,\r\n        textColor: \"#000000\",\r\n        bgColor: \"#ffffff\",\r\n        hoverColor: \"#cccccc\",\r\n        borderRadius: 0,\r\n        zIndex: 0,\r\n        values: [],\r\n        value: \"\",\r\n        onChange: () => { return false; }\r\n    }\r\n\r\n    constructor(props: DropdownProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            selectedIndex: 0\r\n        };\r\n\r\n        this.showDropdown = this.showDropdown.bind(this);\r\n        this.onHover = this.onHover.bind(this);\r\n        this.onHoverExit = this.onHoverExit.bind(this);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        const { value, values } = this.props;\r\n        const { selectedIndex } = this.state;\r\n\r\n        if (value != null && values.includes(value) && selectedIndex !== values.indexOf(value))\r\n            this.setState({selectedIndex: values.indexOf(value)});\r\n    }\r\n\r\n    showDropdown(event: KonvaEventObject<Event>) {\r\n        Dropdown.cancelDropdown();\r\n\r\n        const { width, height, padding, fontSize, textColor, hoverColor, borderRadius, zIndex, values, onChange } = this.props;\r\n\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n        const scale = stage.scaleX();\r\n\r\n        const top = event.target.absolutePosition().y;\r\n        const left = event.target.absolutePosition().x;\r\n\r\n        const dropdown = document.createElement(\"select\");\r\n        document.body.appendChild(dropdown);\r\n\r\n        // Add classes here\r\n        //dropdown.classList.add(\"block\", \"appearance-none\", \"w-full\", \"bg-white\", \"border\", \"border-gray-400\", \"hover:border-gray-500\", \"px-4\", \"py-2\", \"pr-8\", \"rounded\", \"shadow\", \"leading-tight\", \"focus:outline-none\", \"focus:shadow-outline\");\r\n        values.forEach(value => {\r\n            const option = document.createElement(\"option\");\r\n            option.value = value;\r\n            option.innerText = value;\r\n            dropdown.add(option);\r\n        });\r\n\r\n        dropdown.selectedIndex = this.state.selectedIndex;\r\n        dropdown.style.position = \"absolute\";\r\n        dropdown.style.top = `${top}px`;\r\n        dropdown.style.left = `${left}px`;\r\n        dropdown.style.width = `${Math.min(width * scale, window.innerWidth - left)}px`;\r\n        dropdown.style.height = `${height * scale}px`;\r\n        dropdown.style.paddingLeft = `${padding * scale}px`;\r\n        dropdown.style.fontSize = `${fontSize * scale}px`;\r\n        dropdown.style.color = textColor;\r\n        dropdown.style.backgroundColor = hoverColor;\r\n        dropdown.style.borderRadius = `${borderRadius * scale}px`;\r\n        dropdown.style.zIndex = `${zIndex}`;\r\n        dropdown.focus();\r\n        dropdown.onchange = (ev: Event) => {\r\n            const target = ev.target as HTMLSelectElement;\r\n\r\n            if (!target) {\r\n                console.error(`Cannot cast target to 'HTMLSelectElement'.`);\r\n                Dropdown.cancelDropdown();\r\n                return;\r\n            }\r\n\r\n            if (!target.value) {\r\n                console.error(`No value selected.`);\r\n                Dropdown.cancelDropdown();\r\n                return;\r\n            }\r\n\r\n            if (!onChange(target.value)) {\r\n                console.error(`Input value requirements not met.`);\r\n                Dropdown.cancelDropdown();\r\n                return;\r\n            }\r\n\r\n            this.setState({selectedIndex: target.selectedIndex});\r\n            Dropdown.cancelDropdown();\r\n        };\r\n\r\n        Dropdown.dropdownElement = dropdown;\r\n    }\r\n\r\n    public static cancelDropdown() {\r\n        const dropdown = Dropdown.dropdownElement;\r\n        if (!dropdown)\r\n            return;\r\n        \r\n        dropdown.onchange = null;\r\n        dropdown.parentNode?.removeChild(dropdown);\r\n    }\r\n\r\n    onHover(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"pointer\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.hoverColor);\r\n        layer.draw();\r\n    }\r\n\r\n    onHoverExit(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"default\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.bgColor);\r\n        layer.draw();\r\n    }\r\n\r\n    render() {\r\n        const { x, y, width, height, fontSize, fontStyle, padding, textColor, bgColor, borderRadius, values, value } = this.props;\r\n\r\n        return(\r\n            <Label name=\"top-bar-label\"\r\n                x={x}\r\n                y={y}\r\n                onMouseEnter={this.onHover}\r\n                onMouseLeave={this.onHoverExit} \r\n                onClick={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showDropdown(event);\r\n                }}\r\n                onTap={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showDropdown(event);\r\n                }}>\r\n                <Tag fill={bgColor}\r\n                        cornerRadius={borderRadius} />\r\n                <Text name=\"top-bar-text\"\r\n                        width={width}\r\n                        height={height}\r\n                        fontStyle={fontStyle}\r\n                        fontSize={fontSize}\r\n                        verticalAlign=\"middle\"\r\n                        padding={padding}\r\n                        fill={textColor}\r\n                        text={value != null && values.includes(value) ? value : values[this.state.selectedIndex]} />\r\n            </Label>\r\n        );\r\n    }\r\n}","import Colors from \"../utils/Colors\";\r\nimport { Number, Boolean, Flow, Variable, String } from \"../utils/Types\";\r\n\r\nexport enum HandleType {\r\n    Circle,\r\n    Arrow\r\n}\r\n\r\nexport enum InputType {\r\n    None,\r\n    Input,\r\n    Dropdown\r\n}\r\n\r\nexport type SlotConfig = {\r\n    // handle config\r\n    handleType: HandleType;\r\n    handleBorderColor: string;\r\n    handleFillColor: string;\r\n\r\n    inputType: InputType;\r\n    defaultInputValue: string | string[];\r\n    initialValue: any;\r\n\r\n    fromString: (value: string) => any;\r\n    toString: (value: any) => string;\r\n}\r\n\r\nclass SlotConfigManager {\r\n    private configs: Map<string, SlotConfig>;\r\n\r\n    constructor() {\r\n        this.configs = new Map<string, SlotConfig>();\r\n\r\n        const numberConfig: SlotConfig = {\r\n            handleType: HandleType.Circle,\r\n            handleBorderColor: Colors.Green[700],\r\n            handleFillColor: Colors.Green[600],\r\n            inputType: InputType.Input,\r\n            defaultInputValue: \"\",\r\n            initialValue: Number.defaultValue,\r\n            fromString: Number.convertFromString,\r\n            toString: Number.convertToString\r\n        };\r\n\r\n        const booleanConfig: SlotConfig = {\r\n            handleType: HandleType.Circle,\r\n            handleBorderColor: Colors.Purple[600],\r\n            handleFillColor: Colors.Purple[500],\r\n            inputType: InputType.Dropdown,\r\n            defaultInputValue: [\"true\", \"false\"],\r\n            initialValue: Boolean.defaultValue,\r\n            fromString: Boolean.convertFromString,\r\n            toString: Boolean.convertToString\r\n        };\r\n\r\n        const stringConfig: SlotConfig = {\r\n            handleType: HandleType.Circle,\r\n            handleBorderColor: Colors.Orange[700],\r\n            handleFillColor: Colors.Orange[500],\r\n            inputType: InputType.Input,\r\n            defaultInputValue: \"\",\r\n            initialValue: String.defaultValue,\r\n            fromString: String.convertFromString,\r\n            toString: String.convertToString\r\n        };\r\n\r\n        const flowConfig: SlotConfig = {\r\n            handleType: HandleType.Arrow,\r\n            handleBorderColor: Colors.Gray[500],\r\n            handleFillColor: Colors.Gray[100],\r\n            inputType: InputType.None,\r\n            defaultInputValue: \"\",\r\n            initialValue: Flow.defaultValue,\r\n            fromString: Flow.convertFromString,\r\n            toString: Flow.convertToString\r\n        }\r\n\r\n        const variableConfig: SlotConfig = {\r\n            handleType: HandleType.Circle,\r\n            handleBorderColor: Colors.Gray[100],\r\n            handleFillColor: Colors.Gray[100],\r\n            inputType: InputType.None,\r\n            defaultInputValue: \"\",\r\n            initialValue: Variable.defaultValue,\r\n            fromString: () => {},\r\n            toString: () => \"\"\r\n        }\r\n\r\n        this.configs.set(Number.className, numberConfig);\r\n        this.configs.set(Boolean.className, booleanConfig);\r\n        this.configs.set(String.className, stringConfig);\r\n        this.configs.set(Flow.className, flowConfig);\r\n        this.configs.set(Variable.className, variableConfig);\r\n    }\r\n\r\n    getConfig(type: string) {\r\n        return this.configs.get(type);\r\n    }\r\n}\r\n\r\nexport default new SlotConfigManager();\r\n\r\n","import React from 'react';\r\nimport { Circle, Path } from 'react-konva';\r\nimport { HandleType } from '../managers/SlotConfigManager';\r\nimport { KonvaForm } from './KonvaForm';\r\nimport { KonvaEventObject } from 'konva/types/Node';\r\nimport Konva from 'konva';\r\nimport Colors from '../utils/Colors';\r\nimport { Vector2d } from 'konva/types/types';\r\nimport { KonvaUtils } from '../utils/KonvaUtils';\r\n\r\nexport type NodeHandleProps = {\r\n    fill: string;\r\n    stroke: string;\r\n    type: HandleType;\r\n    isInput: boolean;\r\n    isFlow: boolean;\r\n    itemId: number;\r\n    slotId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type NodeHandleState = {\r\n    startPosition: Vector2d;\r\n}\r\n\r\nexport class NodeHandle extends React.Component<NodeHandleProps, NodeHandleState> {\r\n    private static path: Konva.Path | null = null;\r\n\r\n    constructor(props: NodeHandleProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            startPosition: {x: 0, y: 0},\r\n        }\r\n        \r\n        this.onDragStart = this.onDragStart.bind(this);\r\n        this.onDragMove = this.onDragMove.bind(this);\r\n        this.onDragEnd = this.onDragEnd.bind(this);\r\n        this.onMouseEnter = this.onMouseEnter.bind(this);\r\n        this.onMouseExit = this.onMouseExit.bind(this);\r\n    }\r\n\r\n    onDragStart(event: KonvaEventObject<DragEvent>) {\r\n        const layer: Konva.Layer | null = event.target.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        KonvaForm.cancel();\r\n        \r\n        const thisCircle = event.target;\r\n        const parent = thisCircle.parent;\r\n        if (!parent) {\r\n            console.error(`This Konva node should be under a container node.`);\r\n            return;\r\n        }\r\n\r\n        const startPos = thisCircle.getPosition();\r\n        const endPos = startPos;\r\n        const pathData = `M${startPos.x} ${startPos.y - 2} L${endPos.x} ${endPos.y - 2}`;\r\n        const path = new Konva.Path({\r\n            data: pathData,\r\n            stroke: Colors.Gray[800],\r\n            strokeWidth: 4\r\n        });\r\n\r\n        parent.add(path);\r\n        NodeHandle.path = path;\r\n        this.setState({startPosition: startPos});\r\n    }\r\n\r\n    onDragMove(event: KonvaEventObject<DragEvent>) {\r\n        const { isInput } = this.props;\r\n        const { startPosition } = this.state;\r\n\r\n        const layer: Konva.Layer | null = event.target.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const thisCircle = event.target;\r\n        const position = thisCircle.getPosition();\r\n        let startPos, endPos;\r\n\r\n        if (isInput) {\r\n            // The isInput specifies if its either the input handle or the output\r\n            // handle that's being dragged.\r\n            // Gotta flip the start and end positions so the path forms an S shape\r\n            // instead of a mirrored S shape when dragged.\r\n            startPos = position;\r\n            endPos = startPosition;\r\n        } else {\r\n            startPos = startPosition;\r\n            endPos = position;\r\n        }\r\n\r\n        const midpointPos: Vector2d = {\r\n            x: ((endPos.x - startPos.x) / 2) + (startPos.x),\r\n            y: ((endPos.y - startPos.y) / 2) + (startPos.y)\r\n        }\r\n        const pathData = `M${startPos.x} ${startPos.y - 2} Q${startPos.x + 30} ${startPos.y - 2} ${midpointPos.x} ${midpointPos.y - 2} Q${endPos.x - 30} ${endPos.y - 2} ${endPos.x} ${endPos.y - 2}`;\r\n        const path = NodeHandle.path;\r\n        if (!path) {\r\n            console.error(`The Konva path could not be found.`);\r\n            return;\r\n        }\r\n\r\n        path.data(pathData);\r\n    }\r\n\r\n    onDragEnd(event: KonvaEventObject<DragEvent>) {\r\n        const { isInput, isFlow, itemId, onConnect } = this.props;\r\n        const { startPosition } = this.state;\r\n\r\n        const thisCircle = event.target;\r\n        thisCircle.position(startPosition);\r\n\r\n        const path = NodeHandle.path;\r\n        if (path != null) {\r\n            path.destroy();\r\n            NodeHandle.path = null;\r\n        }\r\n\r\n        const stage = thisCircle.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        stage.draw();\r\n\r\n        const pointerPos = stage.getPointerPosition();\r\n        if (!pointerPos) {\r\n            console.error(`The Konva pointer position could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const screenX = Math.floor(pointerPos.x);\r\n        const screenY = Math.floor(pointerPos.y);\r\n\r\n        const elements = stage.getAllIntersections({x: screenX, y: screenY}) as Konva.Shape[];\r\n        \r\n        if (!elements || elements.length <= 0)\r\n            return;\r\n\r\n        let element: Konva.Shape | undefined;\r\n        let otherItemId: number = 0;\r\n        let otherSlotId: number = 0;\r\n\r\n        let i;\r\n        for (i = 0; i < elements.length; i++) {\r\n            const elem = elements[i];\r\n            const type = elem.getAttr(\"data-type\");\r\n            if (!type || (isInput ? type !== \"output\" : type !== \"input\"))\r\n                continue;\r\n            const slotType = elem.getAttr(\"data-slot-type\");\r\n            if (!slotType || (isFlow ? slotType !== \"control\" : slotType !== \"data\"))\r\n                continue;\r\n\r\n            otherItemId = elem.getAttr(\"data-item-id\");\r\n            otherSlotId = elem.getAttr(\"data-slot-id\");\r\n            // NOTE: These ids can be 0 and !id will return true\r\n            // TODO: Make ids to be unique uuids\r\n            if (otherItemId == null || otherSlotId == null) {\r\n                console.error(`No attributes 'data-item-id' or 'data-slot-id' could be found from the element.`);\r\n                continue;\r\n            }\r\n\r\n            if (itemId === otherItemId)\r\n                continue;\r\n\r\n            element = elem;\r\n            break;\r\n        }\r\n\r\n        if (!element)\r\n            return;\r\n\r\n        onConnect(otherItemId, otherSlotId);\r\n    }\r\n\r\n    onMouseEnter(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"pointer\");\r\n    }\r\n\r\n    onMouseExit(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"default\");\r\n    }\r\n\r\n    render() {\r\n        const { fill, stroke, type, isInput, isFlow, itemId, slotId } = this.props;\r\n        \r\n        return(\r\n            <>\r\n            {(type === HandleType.Circle &&\r\n                <Circle x={isInput ? 18 : -18}\r\n                    y={18}\r\n                    radius={4}\r\n                    fill={fill}\r\n                    stroke={stroke}\r\n                    strokeWidth={1}\r\n                    scale={{x: 1.5, y: 1.5}}\r\n                    listening={false} />\r\n            ) ||\r\n            (type === HandleType.Arrow &&\r\n                <Path data=\"M6.659,13.549L12.139,8.753C12.356,8.563 12.481,8.288 12.481,8C12.481,7.712 12.356,7.437 12.139,7.247L6.66,2.451C6.011,1.885 5,2.345 5,3.204L5,12.796C5,12.796 5,12.797 5,12.797C5,13.345 5.451,13.797 6,13.797C6.242,13.797 6.477,13.709 6.659,13.549Z\"\r\n                    x={isInput ? 5 : -31}\r\n                    y={6}\r\n                    fill={fill}\r\n                    stroke={stroke}\r\n                    strokeWidth={1}\r\n                    scale={{x: 1.5, y: 1.5}}\r\n                    listening={false} />\r\n            )}\r\n\r\n            <Circle data-type={`${isInput ? \"input\" : \"output\"}`}\r\n                    data-slot-type={`${isFlow ? \"control\" : \"data\"}`}\r\n                    data-item-id={itemId}\r\n                    data-slot-id={slotId}\r\n                    x={isInput ? 18 : -18}\r\n                    y={22}\r\n                    radius={15}\r\n                    fill=\"transparent\"\r\n                    draggable\r\n                    onDragStart={event => {\r\n                        event.cancelBubble = true;\r\n                        this.onDragStart(event);\r\n                    }}\r\n                    onDragMove={event => {\r\n                        event.cancelBubble = true;\r\n                        this.onDragMove(event);\r\n                    }}\r\n                    onDragEnd={event => {\r\n                        event.cancelBubble = true;\r\n                        this.onDragEnd(event);\r\n                    }}\r\n                    onMouseEnter={this.onMouseEnter}\r\n                    onMouseLeave={this.onMouseExit} />\r\n            </>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Group, Text } from 'react-konva';\r\nimport Konva from 'konva';\r\nimport Colors from '../utils/Colors';\r\nimport { Input, Dropdown } from './KonvaForm';\r\nimport SlotConfigManager, { InputType, HandleType } from '../managers/SlotConfigManager';\r\nimport { NodeHandle } from './NodeHandle';\r\nimport { InputSlot, OutputSlot, InputFlowSlot, OutputFlowSlot, ItemSlotPair } from '../models/NodeSlot';\r\nimport ScripletManager from '../managers/ScripletManager';\r\n\r\nexport type InputSlotProps = {\r\n    inputSlot: InputSlot;\r\n    inputConnection: ItemSlotPair | undefined;\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onInputChange: (value: any) => boolean;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type InputSlotState = {\r\n    labelWidth: number;\r\n    typeWidth: number;\r\n}\r\n\r\nexport class InputSlotDOM extends React.Component<InputSlotProps, InputSlotState> {\r\n    private label: React.RefObject<Konva.Text>;\r\n    private type: React.RefObject<Konva.Text>;\r\n\r\n    constructor(props: InputSlotProps) {\r\n        super(props);\r\n\r\n        this.label = React.createRef();\r\n        this.type = React.createRef();\r\n\r\n        this.state = {\r\n            labelWidth: 100,\r\n            typeWidth: 100\r\n        };\r\n\r\n        this.onInputChanged = this.onInputChanged.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        const labelWidth = this.label.current?.width();\r\n        const typeWidth = this.type.current?.width();\r\n        if (!labelWidth || !typeWidth) {\r\n            console.error(`The referenced Konva label or type text could not be found.`);\r\n            return;\r\n        }\r\n\r\n        this.setState({labelWidth: labelWidth, typeWidth: typeWidth});\r\n    }\r\n\r\n    onInputChanged(value: string): boolean {\r\n        const { inputSlot, onInputChange } = this.props;\r\n        const config = SlotConfigManager.getConfig(inputSlot.type);\r\n        if (!config) {\r\n            console.error(`Cannot find the input initial values for the given type '${inputSlot.type}'.`);\r\n            return false;\r\n        }\r\n\r\n        const val = config.fromString(value);\r\n        if (val == null)\r\n            return false;\r\n\r\n        return onInputChange(val);\r\n    }\r\n\r\n    render() {\r\n        const { inputSlot, inputConnection, x, y, itemId, onConnect } = this.props;\r\n        const { labelWidth, typeWidth } = this.state;\r\n        const config = SlotConfigManager.getConfig(inputSlot.type);\r\n        if (!config) {\r\n            console.error(`Cannot find the input initial values for the given type '${inputSlot.type}'.`);\r\n            return null;\r\n        }\r\n\r\n        const item = ScripletManager.currentScriplet?.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return null;\r\n        }\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text ref={this.label}\r\n                        x={inputSlot.isConnectable ? 36 : 16}\r\n                        y={0}\r\n                        height={20}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        verticalAlign=\"bottom\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={inputSlot.name} />\r\n                <Text ref={this.type}\r\n                        x={inputSlot.isConnectable ? 36 : 16}\r\n                        y={20}\r\n                        height={20}\r\n                        fontSize={10}\r\n                        verticalAlign=\"top\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={inputSlot.type} />\r\n                {(!inputConnection &&\r\n                ((config.inputType === InputType.Input &&\r\n                    <Input x={inputSlot.isConnectable ? 44 + Math.max(labelWidth, typeWidth) : 24 + Math.max(labelWidth, typeWidth)}\r\n                            y={12}\r\n                            width={30}\r\n                            height={12}\r\n                            fontSize={10}\r\n                            padding={2}\r\n                            borderRadius={2}\r\n                            textColor={Colors.Gray[100]}\r\n                            bgColor={Colors.Gray[700]}\r\n                            hoverColor={Colors.Gray[600]}\r\n                            value={`${item.getInputValue(inputSlot.id) ?? inputSlot.defaultValue}`}\r\n                            isEditable={inputSlot.isEditable}\r\n                            onChange={this.onInputChanged} />\r\n                ) ||\r\n                (config.inputType === InputType.Dropdown &&\r\n                    <Dropdown x={inputSlot.isConnectable ? 44 + Math.max(labelWidth, typeWidth) : 24 + Math.max(labelWidth, typeWidth)}\r\n                            y={12}\r\n                            width={30}\r\n                            height={12}\r\n                            fontSize={10}\r\n                            padding={2}\r\n                            borderRadius={2}\r\n                            textColor={Colors.Gray[100]}\r\n                            bgColor={Colors.Gray[700]}\r\n                            hoverColor={Colors.Gray[600]}\r\n                            values={config.defaultInputValue as string[]}\r\n                            value={item.getInputValue(inputSlot.id) != null ? `${item.getInputValue(inputSlot.id)}` : `${inputSlot.defaultValue}`}\r\n                            onChange={this.onInputChanged} />\r\n                )))}\r\n                {(inputSlot.isConnectable &&\r\n                    <NodeHandle fill={inputConnection ? config.handleFillColor : \"transparent\"}\r\n                                stroke={config.handleBorderColor}\r\n                                type={config.handleType}\r\n                                isInput={true}\r\n                                isFlow={false}\r\n                                itemId={itemId}\r\n                                slotId={inputSlot.id}\r\n                                onConnect={onConnect} />\r\n                )}\r\n            </Group>\r\n        );\r\n    }\r\n}\r\n\r\nexport type OutputSlotProps = {\r\n    outputSlot: OutputSlot;\r\n    outputConnections: ItemSlotPair[];\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n};\r\n\r\nexport type OutputSlotState = {\r\n    labelWidth: number;\r\n    typeWidth: number;\r\n}\r\n\r\nexport class OutputSlotDOM extends React.Component<OutputSlotProps, OutputSlotState> {\r\n    private label: React.RefObject<Konva.Text>;\r\n    private type: React.RefObject<Konva.Text>;\r\n\r\n    constructor(props: OutputSlotProps) {\r\n        super(props);\r\n\r\n        this.label = React.createRef();\r\n        this.type = React.createRef();\r\n\r\n        this.state = {\r\n            labelWidth: 100,\r\n            typeWidth: 100\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        const labelWidth = this.label.current?.width();\r\n        const typeWidth = this.type.current?.width();\r\n        if (!labelWidth || !typeWidth) {\r\n            console.error(`The referenced Konva label or type text could not be found.`);\r\n            return;\r\n        }\r\n\r\n        this.setState({labelWidth: labelWidth, typeWidth: typeWidth});\r\n    }\r\n\r\n    render() {\r\n        const { outputSlot, outputConnections, x, y, itemId, onConnect } = this.props;\r\n        const { labelWidth, typeWidth } = this.state;\r\n        const config = SlotConfigManager.getConfig(outputSlot.type);\r\n        if (!config) {\r\n            console.error(`Cannot find the input initial values for the given type '${outputSlot.type}'.`);\r\n            return null;\r\n        }\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text ref={this.label}\r\n                        x={0}\r\n                        y={0}\r\n                        offsetX={36 + labelWidth}\r\n                        height={20}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        align=\"right\"\r\n                        verticalAlign=\"bottom\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={outputSlot.name} />\r\n                <Text ref={this.type}\r\n                        x={0}\r\n                        y={20}\r\n                        offsetX={36 + typeWidth}\r\n                        height={20}\r\n                        fontSize={10}\r\n                        align=\"right\"\r\n                        verticalAlign=\"top\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={outputSlot.type} />\r\n                <NodeHandle fill={outputConnections.length > 0 ? config.handleFillColor : \"transparent\"}\r\n                            stroke={config.handleBorderColor}\r\n                            type={config.handleType}\r\n                            isInput={false}\r\n                            isFlow={false}\r\n                            itemId={itemId}\r\n                            slotId={outputSlot.id}\r\n                            onConnect={onConnect} />\r\n            </Group>\r\n        );\r\n    }\r\n}\r\n\r\nexport type InputFlowSlotProps = {\r\n    inputFlowSlot: InputFlowSlot;\r\n    inputFlowConnection: ItemSlotPair | undefined;\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type InputFlowSlotState = {\r\n    \r\n}\r\n\r\nexport class InputFlowSlotDOM extends React.Component<InputFlowSlotProps, InputFlowSlotState> {\r\n    render() {\r\n        const { inputFlowSlot, inputFlowConnection, x, y, itemId, onConnect } = this.props;\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text x={inputFlowSlot.isConnectable ? 36 : 16}\r\n                        y={0}\r\n                        height={40}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        verticalAlign=\"middle\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={inputFlowSlot.name} />\r\n                {(inputFlowSlot.isConnectable && \r\n                    <NodeHandle fill={inputFlowConnection ? Colors.Gray[100] : \"transparent\"}\r\n                                stroke={Colors.Gray[500]}\r\n                                type={HandleType.Arrow}\r\n                                isInput={true}\r\n                                isFlow={true}\r\n                                itemId={itemId}\r\n                                slotId={inputFlowSlot.id}\r\n                                onConnect={onConnect} />\r\n                )}\r\n            </Group>\r\n        );\r\n    }\r\n}\r\n\r\nexport type OutputFlowSlotProps = {\r\n    outputFlowSlot: OutputFlowSlot;\r\n    outputFlowConnection: ItemSlotPair | undefined;\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type OutputFlowSlotState = {\r\n    labelWidth: number;\r\n}\r\n\r\nexport class OutputFlowSlotDOM extends React.Component<OutputFlowSlotProps, OutputFlowSlotState> {\r\n    private label: React.RefObject<Konva.Text>;\r\n\r\n    constructor(props: OutputFlowSlotProps) {\r\n        super(props);\r\n\r\n        this.label = React.createRef();\r\n\r\n        this.state = {\r\n            labelWidth: 100\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        const labelWidth = this.label.current?.width();\r\n        if (!labelWidth) {\r\n            console.error(`The referenced Konva label text could not be found.`);\r\n            return;\r\n        }\r\n\r\n        this.setState({labelWidth: labelWidth});\r\n    }\r\n    \r\n    render() {\r\n        const { outputFlowSlot, outputFlowConnection, x, y, itemId, onConnect } = this.props;\r\n        const { labelWidth } = this.state;\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text ref={this.label}\r\n                        x={0}\r\n                        y={0}\r\n                        offsetX={36 + labelWidth}\r\n                        height={40}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        align=\"right\"\r\n                        verticalAlign=\"middle\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={outputFlowSlot.name} />\r\n                <NodeHandle fill={outputFlowConnection ? Colors.Gray[100] : \"transparent\"}\r\n                            stroke={Colors.Gray[500]}\r\n                            type={HandleType.Arrow}\r\n                            isInput={false}\r\n                            isFlow={true}\r\n                            itemId={itemId}\r\n                            slotId={outputFlowSlot.id}\r\n                            onConnect={onConnect} />\r\n            </Group>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Rect, Group, Label, Tag, Text } from 'react-konva';\r\nimport { Group as KonvaGroup } from 'konva/types/Group';\r\nimport Colors from '../utils/Colors';\r\nimport NodeConnections from '../managers/NodeConnections';\r\nimport { Input, KonvaForm } from '../components/KonvaForm';\r\nimport { Path } from 'konva/types/shapes/Path';\r\nimport { NodeItem } from '../models/NodeItem';\r\nimport { InputSlot, OutputSlot, InputFlowSlot, OutputFlowSlot } from '../models/NodeSlot';\r\nimport { InputSlotDOM, OutputSlotDOM, InputFlowSlotDOM, OutputFlowSlotDOM } from './NodeSlot';\r\nimport { KonvaUtils } from '../utils/KonvaUtils';\r\nimport '../assets/css/fontawesome.min.css';\r\nimport '../assets/css/solid.min.css';\r\nimport ScripletManager from '../managers/ScripletManager';\r\n\r\nexport type NodeProps = {\r\n    item: NodeItem;\r\n    width: number;\r\n    rowHeight: number;\r\n    topBarHeight: number;\r\n    handleDragNode(index: number, x: number, y: number): any;\r\n    deleteNodeItem(id: number): any;\r\n    updateDOM(): any;\r\n}\r\n\r\nexport type NodeState = {\r\n    draggedHandlePath: Path | null;\r\n    isStateOpen: boolean;\r\n    stateVisual: KonvaGroup | null;\r\n}\r\n\r\nexport default class Node extends React.Component<NodeProps, NodeState> {\r\n    private group: React.RefObject<KonvaGroup>;\r\n    \r\n    constructor(props: NodeProps) {\r\n        super(props);\r\n\r\n        this.group = React.createRef<KonvaGroup>();\r\n\r\n        this.state = {\r\n            draggedHandlePath: null,\r\n            isStateOpen: false,\r\n            stateVisual: null\r\n        }\r\n\r\n        /*\r\n        this.handleHoverEnterEditableText = this.handleHoverEnterEditableText.bind(this);\r\n        this.handleHoverExitEditableText = this.handleHoverExitEditableText.bind(this);\r\n        this.handleHoverEnterToggleState = this.handleHoverEnterToggleState.bind(this);\r\n        this.handleHoverExitToggleState = this.handleHoverExitToggleState.bind(this);\r\n        this.openState = this.openState.bind(this);\r\n        this.closeState = this.closeState.bind(this);\r\n        this.toggleState = this.toggleState.bind(this);\r\n        */\r\n    }\r\n\r\n    componentDidMount() {\r\n        const layer = this.group.current?.getLayer();\r\n        if (layer) {\r\n        }\r\n    }\r\n\r\n    // These commented code below can eventually be used if there are some node schemas\r\n    // in the future that can have some state saved beyond their inputs.\r\n    /* \r\n    handleHoverEnterToggleState(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"pointer\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", Colors.Gray[700]);\r\n        layer.draw();\r\n    }\r\n\r\n    handleHoverExitToggleState(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"default\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", Colors.Gray[900]);\r\n        layer.draw();\r\n    }\r\n\r\n    openState() {\r\n        if (this.state.stateVisual) {\r\n            console.error(`This node already has an opened state visual. Close it first then try again.`);\r\n            return;\r\n        }\r\n\r\n        const { item, rowHeight, topBarHeight } = this.props;\r\n\r\n        // Show the custom schema state visual here\r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The node schema could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const state = schema.createNewSchema();\r\n\r\n        const stateVisual = schema.state.onShowStateVisual(this.props);\r\n        if (!stateVisual) {\r\n            console.error(`The Konva group to show the node state could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const thisGroup = this.group.current;\r\n        if (!thisGroup) {\r\n            console.error(`The Konva group for this node could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const layer = thisGroup.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const bgRect = this.group.current?.children[0] as Konva.Rect;\r\n        if (!bgRect) {\r\n            console.error(`The Konva bg rect could not be found.`);\r\n            return;\r\n        }\r\n\r\n        bgRect.cornerRadius([5, 5, 0, 0]);\r\n\r\n        const height = schema.maxLength() * rowHeight + topBarHeight + 10;\r\n        stateVisual.x(0);\r\n        stateVisual.y(height);\r\n        thisGroup.add(stateVisual);\r\n        layer.draw();\r\n\r\n        this.setState({isStateOpen: true, stateVisual: stateVisual});\r\n    }\r\n\r\n    closeState() {\r\n        if (!this.state.stateVisual) {\r\n            console.error(`This node has no state visual to close.`);\r\n            return;\r\n        }\r\n\r\n        const bgRect = this.group.current?.children[0] as Konva.Rect;\r\n        if (!bgRect) {\r\n            console.error(`The Konva bg rect could not be found.`);\r\n            return;\r\n        }\r\n\r\n        bgRect.cornerRadius(5);\r\n\r\n        this.state.stateVisual.destroy();\r\n        this.setState({isStateOpen: false, stateVisual: null});\r\n    }\r\n\r\n    toggleState() {\r\n        if (this.state.isStateOpen)\r\n            this.closeState();\r\n        else\r\n            this.openState();\r\n    }\r\n    */\r\n\r\n\r\n    render() {\r\n        const { item, width, rowHeight, topBarHeight, handleDragNode, deleteNodeItem, updateDOM } = this.props;\r\n        const height = item.schema ? item.schema.maxLength() * rowHeight + topBarHeight : 0;\r\n        \r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The schema for node item '${item.id}' could not be found.`);\r\n            return null;\r\n        }\r\n\r\n        const inputSlots: InputSlot[] = schema.inputSlots;\r\n        const outputSlots: OutputSlot[] = schema.outputSlots;\r\n        const inputFlowSlots: InputFlowSlot[] = schema.inputFlowSlots;\r\n        const outputFlowSlots: OutputFlowSlot[] = schema.outputFlowSlots;\r\n\r\n        let inputs: (InputSlot | InputFlowSlot)[] = [];\r\n        inputs = inputs.concat(inputFlowSlots, inputSlots);\r\n\r\n        let outputs: (OutputSlot | OutputFlowSlot)[] = [];\r\n        outputs = outputs.concat(outputFlowSlots, outputSlots);\r\n\r\n        // TODO: These two seem hackish\r\n        const inputTypeGuard = (input: InputSlot | InputFlowSlot): input is InputSlot => {\r\n            if ((input as InputSlot).type)\r\n                return true;\r\n            return false;\r\n        }\r\n        const outputTypeGuard = (output: OutputSlot | OutputFlowSlot): output is OutputSlot => {\r\n            if ((output as OutputSlot).type)\r\n                return true;\r\n            return false;\r\n        }\r\n        return(\r\n            <Group id={`node-${item.id}`}\r\n                    ref={this.group}\r\n                    x={item.x}\r\n                    y={item.y}\r\n                    width={width}\r\n                    height={height}\r\n                    draggable\r\n                    onDragStart={event => {\r\n                        KonvaUtils.setCursor(event, \"move\");\r\n                        KonvaForm.cancel();\r\n                    }}\r\n                    onDragEnd={event => {\r\n                        KonvaUtils.setCursor(event, \"default\");\r\n                        ScripletManager.currentScriplet?.updateNodes();\r\n                    }}\r\n                    onDragMove={event => handleDragNode(item.id, event.target.x(), event.target.y())}>\r\n                <Rect name=\"background\"\r\n                        x={0}\r\n                        y={0}\r\n                        width={width}\r\n                        height={height + 10}\r\n                        fill={Colors.Gray[900]}\r\n                        cornerRadius={5} />\r\n                <Rect name=\"top-bar\"\r\n                        x={0}\r\n                        y={0}\r\n                        width={width}\r\n                        height={topBarHeight}\r\n                        fill={Colors.Gray[900]}\r\n                        cornerRadius={[5, 5, 0, 0]} />\r\n                <Input x={10}\r\n                        y={2.5}\r\n                        width={schema.isDeletable ? width - 40 : width - 20}\r\n                        height={topBarHeight - 5}\r\n                        borderRadius={2}\r\n                        padding={6}\r\n                        textColor={Colors.Gray[100]}\r\n                        bgColor={Colors.Gray[900]}\r\n                        hoverColor={Colors.Gray[800]}\r\n                        value={(!item.customName || item.customName === \"\") ? item.schema?.name ?? \"undefined\" : item.customName}\r\n                        isEditable={schema.isNameEditable}\r\n                        onChange={value => {\r\n                            item.customName = value;\r\n                            ScripletManager.currentScriplet?.updateNodes();\r\n                            \r\n                            return true;\r\n                        }} />\r\n                {(schema.isDeletable && \r\n                    <Label x={width - 20}\r\n                            y={8}\r\n                            onMouseEnter={event => {\r\n                                event.cancelBubble = true;\r\n                                KonvaUtils.setCursor(event, \"pointer\");\r\n                            }}\r\n                            onMouseLeave={event => {\r\n                                event.cancelBubble = true;\r\n                                KonvaUtils.setCursor(event, \"default\");\r\n                            }}\r\n                            onClick={event => {\r\n                                KonvaUtils.setCursor(event, \"default\");\r\n                                KonvaForm.cancel();\r\n                                deleteNodeItem(item.id);\r\n                            }}>\r\n                        <Tag fill={Colors.Red[500]}\r\n                            cornerRadius={15} />\r\n                        <Text width={12}\r\n                                height={12}\r\n                                fontSize={14}\r\n                                fontStyle=\"bold\"\r\n                                align=\"center\"\r\n                                verticalAlign=\"center\"\r\n                                fill={Colors.Gray[900]}\r\n                                text=\"&#215;\" />\r\n                    </Label>\r\n                )}\r\n                <Rect x={0}\r\n                        y={topBarHeight}\r\n                        width={width}\r\n                        height={rowHeight * (item.schema?.maxLength() ?? 1)}\r\n                        fill={Colors.Gray[800]} />\r\n                {Array.from(Array(item.schema?.maxLength() ?? 0)).map((it, i) => {\r\n                const input: InputSlot | undefined = i < inputs.length && inputTypeGuard(inputs[i]) ? inputs[i] as InputSlot : undefined;\r\n                const output: OutputSlot | undefined = i < outputs.length && outputTypeGuard(outputs[i]) ? outputs[i] as OutputSlot : undefined;\r\n\r\n                if (input && input.name == null)\r\n                    input.name = `Input${i}`;\r\n                if (output && output.name == null)\r\n                    output.name = `Output${i}`;\r\n\r\n                const inputFlow: InputFlowSlot | undefined = i < inputs.length && !inputTypeGuard(inputs[i]) ? inputs[i] as InputFlowSlot : undefined;\r\n                const outputFlow: OutputFlowSlot | undefined = i < outputs.length && !outputTypeGuard(outputs[i]) ? outputs[i] as OutputFlowSlot : undefined;\r\n                \r\n                if (inputFlow && inputFlow.name == null)\r\n                    inputFlow.name = `Flow${i}`;\r\n                if (outputFlow && outputFlow.name == null)\r\n                    outputFlow.name = `Flow${i}`;\r\n                return(\r\n                    <React.Fragment key={`node-slot-${item.id}-${i}`}>\r\n                        {input != null  && \r\n                            <>\r\n                            <InputSlotDOM inputSlot={input}\r\n                                        inputConnection={item.getInputConnection(input.id)}\r\n                                        x={0}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onInputChange={value => {\r\n                                            item.setInputValue(input.id, value);\r\n                                            ScripletManager.currentScriplet?.updateNodes();\r\n                                            updateDOM();\r\n\r\n                                            return true;\r\n                                        }}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addConnection(item.id, input.id, otherItemId, otherSlotId);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                        {output != null &&\r\n                            <>\r\n                            <OutputSlotDOM outputSlot={output}\r\n                                        outputConnections={item.getOutputConnections(output.id)}\r\n                                        x={width}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addConnection(otherItemId, otherSlotId, item.id, output.id);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                        {inputFlow != null  && \r\n                            <>\r\n                            <InputFlowSlotDOM inputFlowSlot={inputFlow}\r\n                                        inputFlowConnection={item.getInputFlowConnection(inputFlow.id)}\r\n                                        x={0}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addFlowConnection(item.id, inputFlow.id, otherItemId, otherSlotId);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                        {outputFlow != null &&\r\n                            <>\r\n                            <OutputFlowSlotDOM outputFlowSlot={outputFlow}\r\n                                        outputFlowConnection={item.getOutputFlowConnection(outputFlow.id)}\r\n                                        x={width}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addFlowConnection(otherItemId, otherSlotId, item.id, outputFlow.id);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                    </React.Fragment>\r\n                );\r\n                })}\r\n                {/*\r\n                <Label name=\"show-state\"\r\n                        x={0}\r\n                        y={height}\r\n                        width={width}\r\n                        height={5}\r\n                        onMouseEnter={this.handleHoverEnterToggleState}\r\n                        onMouseLeave={this.handleHoverExitToggleState}\r\n                        onClick={this.toggleState}>\r\n                    <Tag fill={Colors.Gray[900]}\r\n                            cornerRadius={5} />\r\n                    <Text width={width}\r\n                            height={10}\r\n                            fontFamily=\"Font Awesome\\ 5 Free\"\r\n                            text={`${this.state.isStateOpen ? \"\\uf106\" : \"\\uf107\"}`}\r\n                            fill={Colors.Gray[100]}\r\n                            align=\"center\"\r\n                            verticalAlign=\"middle\" />\r\n                </Label>\r\n                */}\r\n            </Group>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Vector2d } from 'konva/types/types';\r\nimport { Path } from 'react-konva';\r\nimport Colors from '../utils/Colors';\r\n\r\nexport type EdgeProps = {\r\n    startPos: Vector2d;\r\n    endPos: Vector2d;\r\n    nodeWidthOther: number;\r\n    nodeHeight: number;\r\n    handleOnClick?: () => any;\r\n    children?: (midpointPos: Vector2d, isHovered: boolean) => React.ReactNode | null;\r\n}\r\n\r\nexport type EdgeState = {\r\n    isHovered: boolean;\r\n}\r\n\r\nexport default class Edge extends React.Component<EdgeProps, EdgeState> {\r\n    constructor(props: EdgeProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isHovered: false\r\n        };\r\n\r\n        this.handleOnEnter = this.handleOnEnter.bind(this);\r\n        this.handleOnExit = this.handleOnExit.bind(this);\r\n    }\r\n\r\n    handleOnEnter() {\r\n        this.setState({isHovered: true});\r\n    }\r\n\r\n    handleOnExit() {\r\n        this.setState({isHovered: false});\r\n    }\r\n\r\n    render() {\r\n        const { startPos, endPos, nodeWidthOther: nodeWidthOutput, nodeHeight, handleOnClick, children } = this.props;\r\n        const { isHovered } = this.state;\r\n        const halfNodeHeight = nodeHeight / 2;\r\n        const midpointPos: Vector2d = {\r\n            x: ((endPos.x - startPos.x - nodeWidthOutput) / 2) + (startPos.x + nodeWidthOutput),\r\n            y: ((endPos.y + halfNodeHeight - startPos.y - halfNodeHeight) / 2) + (startPos.y + halfNodeHeight)\r\n        }\r\n        const pathData = `M${startPos.x + nodeWidthOutput} ${startPos.y + halfNodeHeight - 2} Q${startPos.x + nodeWidthOutput + 30} ${startPos.y + halfNodeHeight - 2} ${midpointPos.x} ${midpointPos.y - 2} Q${endPos.x - 30} ${endPos.y + halfNodeHeight - 2} ${endPos.x} ${endPos.y + halfNodeHeight - 2}`;\r\n        return(\r\n            <>\r\n                <Path data={pathData}\r\n                    stroke={Colors.Gray[800]}\r\n                    strokeWidth={4} />\r\n                <Path data={pathData}\r\n                    className=\"cursor-pointer\"\r\n                    stroke=\"transparent\"\r\n                    strokeWidth={50}\r\n                    onMouseEnter={event => {\r\n                        this.handleOnEnter();\r\n                        const stage = event.target.getStage();\r\n                        if (!stage) {\r\n                            console.error(`The Konva stage could not be found.`);\r\n                            return;\r\n                        }\r\n                        stage.container().style.cursor = \"pointer\";\r\n                    }}\r\n                    onMouseLeave={event => {\r\n                        this.handleOnExit();\r\n                        const stage = event.target.getStage();\r\n                        if (!stage) {\r\n                            console.error(`The Konva stage could not be found.`);\r\n                            return;\r\n                        }\r\n                        stage.container().style.cursor = \"default\";\r\n                    }}\r\n                    onMouseDown={handleOnClick}\r\n                    onTouchEnd={handleOnClick} />\r\n                {children != null ? children(midpointPos, isHovered) : null}\r\n            </>\r\n        );\r\n    }\r\n}","import { BaseNodeSchema } from \"./NodeSchema\";\r\nimport NodeSchemaManager from \"../managers/NodeSchemaManager\";\r\n\r\nexport interface ICategorizable {\r\n    id: any;\r\n    name: string;\r\n}\r\n\r\nexport abstract class Category<T extends ICategorizable> {\r\n    public name: string;\r\n    public subCategories: Category<T>[];\r\n    public contentChildren: T[];\r\n\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.subCategories = [];\r\n        this.contentChildren = [];\r\n    }\r\n\r\n    abstract getSubCategory(name: string): Category<T>;\r\n    abstract addContent(id: any): void;\r\n}\r\n\r\nexport class SchemaCategory extends Category<BaseNodeSchema> {\r\n    getSubCategory(name: string): SchemaCategory {\r\n        let subCategory = this.subCategories.find(cat => cat.name === name);\r\n        if (!subCategory) {\r\n            subCategory = new SchemaCategory(name);\r\n            this.subCategories.push(subCategory);\r\n        }\r\n\r\n        return subCategory;\r\n    }\r\n\r\n    addContent(id: string) {\r\n        if (this.contentChildren.find(schema => schema.name === id)) {\r\n            console.error(`A duplicate of the schema '${id}' was found.`);\r\n            return;\r\n        }\r\n\r\n        const schema = NodeSchemaManager.getBaseSchema(id);\r\n        this.contentChildren.push(schema);\r\n    }\r\n}","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React from 'react';\r\n\r\nexport type SearchBarProps = {\r\n    filterSearch: (searchValue: string) => void;\r\n}\r\n\r\nexport type SearchBarState = {\r\n    searchValue: string;\r\n}\r\n\r\nexport default class SearchBar extends React.Component<SearchBarProps, SearchBarState> {\r\n    constructor(props: SearchBarProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            searchValue: \"\"\r\n        }\r\n\r\n        this.onSearchChange = this.onSearchChange.bind(this);\r\n        this.onSearchReset = this.onSearchReset.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.props.filterSearch(\"\");\r\n    }\r\n\r\n    onSearchChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n        const searchValue = event.target.value;\r\n        this.setState({searchValue});\r\n        this.props.filterSearch(searchValue);\r\n    }\r\n\r\n    onSearchReset() {\r\n        this.setState({searchValue: \"\"});\r\n        this.props.filterSearch(\"\");\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"h-6 flex flex-row w-full\">\r\n                <div className=\"px-2 rounded-l-full bg-gray-100\">\r\n                    <FontAwesomeIcon icon=\"search\" \r\n                                        className=\"text-sm text-gray-700\" />\r\n                </div>\r\n                \r\n                <input type=\"text\" \r\n                            value={this.state.searchValue}\r\n                            className=\"w-full bg-gray-100 border-none text-sm\"\r\n                            onChange={this.onSearchChange} />\r\n                <button className=\"px-2 flex items-center rounded-r-full bg-gray-100\"\r\n                        onClick={this.onSearchReset}>\r\n                    <FontAwesomeIcon icon=\"times-circle\" \r\n                                        className=\"text-sm text-gray-700\" />\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport NodeSchemaManager from '../managers/NodeSchemaManager';\r\nimport Scrollbar from 'react-scrollbars-custom';\r\nimport { BaseNodeSchema } from '../models/NodeSchema';\r\nimport { Category, ICategorizable, SchemaCategory } from '../models/Category';\r\nimport SearchBar from './SearchBar';\r\n\r\nexport type CategoryDOMProps<T extends ICategorizable> = {\r\n    category: Category<T>;\r\n    depth: number;\r\n    onClick: (id: any) => any;\r\n}\r\n\r\nexport type CategoryDOMState = {\r\n    showChildren: boolean;\r\n}\r\n\r\nclass CategoryDOM<T extends ICategorizable> extends React.Component<CategoryDOMProps<T>, CategoryDOMState> {\r\n    constructor(props: CategoryDOMProps<T>) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            showChildren: true\r\n        }\r\n\r\n        this.toggleCategory = this.toggleCategory.bind(this);\r\n        this.openCategory = this.openCategory.bind(this);\r\n        this.closeCategory = this.closeCategory.bind(this);\r\n    }\r\n\r\n    toggleCategory() {\r\n        if (this.state.showChildren)\r\n            this.closeCategory();\r\n        else\r\n            this.openCategory();\r\n    }\r\n\r\n    openCategory() {\r\n        this.setState({showChildren: true});\r\n    }\r\n\r\n    closeCategory() {\r\n        this.setState({showChildren: false});\r\n    }\r\n\r\n    render() {\r\n        const { category, depth, onClick } = this.props;\r\n        const { showChildren } = this.state;\r\n        if (category.name.toLowerCase() === \"hidden\")\r\n            return null;\r\n        return (\r\n            <div style={{marginLeft: `${category.name === \"root\" ? -1 : 0}rem`}}>\r\n                {category.name !== \"root\" && (\r\n                    <div className=\"flex flex-row items-center rounded-sm border-b bg-gray-900 hover:bg-gray-800 text-gray-100 cursor-pointer select-none\" \r\n                            style={{borderColor: \"#111111\"}}\r\n                            onClick={this.toggleCategory}>\r\n                        <div className=\"px-2 text-xs\">\r\n                            <FontAwesomeIcon icon=\"chevron-down\" className={`${showChildren ? \"hidden\" : \"\"}`} />\r\n                            <FontAwesomeIcon icon=\"chevron-up\" className={`${showChildren ? \"\" : \"hidden\"}`} />\r\n                        </div>\r\n                        <div className=\"text-sm\">\r\n                            {category.name}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n                <div className={`${showChildren ? \"\" : \"hidden\"} pl-4 border-l border-dashed border-gray-700`}>\r\n                    <div className=\"\">\r\n                        {category.subCategories.map((subCategory, index) => (\r\n                            <CategoryDOM key={`category-${depth}-${index}`}\r\n                                            category={subCategory} \r\n                                            depth={depth + 1}\r\n                                            onClick={onClick} />\r\n                        ))}\r\n                    </div>\r\n                    <div className=\"\">\r\n                        {category.contentChildren.map((child, index) => (\r\n                            <div key={`child-${depth}-${index}`} \r\n                                className=\"px-2 rounded-sm hover:bg-gray-700 text-gray-100 cursor-pointer select-none\"\r\n                                onClick={event => {\r\n                                    event.stopPropagation();\r\n                                    onClick(child.id);\r\n                                }}>\r\n                                {child.name}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nexport type SchemaSelectorProps = {\r\n    isVisible: boolean;\r\n    x: number;\r\n    y: number;\r\n    addNodeItem: (id: string) => any;\r\n}\r\n\r\nexport type SchemaSelectorState = {\r\n    schemaResults: BaseNodeSchema[];\r\n}\r\n\r\n// TODO: Categorized selector\r\nexport default class SchemaSelector extends React.Component<SchemaSelectorProps, SchemaSelectorState> {\r\n    constructor(props: SchemaSelectorProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            schemaResults: NodeSchemaManager.getBaseSchemas()\r\n        }\r\n\r\n        this.filterSearch = this.filterSearch.bind(this);\r\n        this.getRootSchemaCategory = this.getRootSchemaCategory.bind(this);\r\n    }\r\n\r\n    filterSearch(searchValue: string) {\r\n        let schemas = NodeSchemaManager.getBaseSchemas();\r\n        schemas = schemas.filter(schema => (schema.name.toLowerCase().includes(searchValue.toLowerCase()) || \r\n                                            schema.id.toLowerCase().includes(searchValue.toLowerCase())) &&\r\n                                            !schema.id.toLowerCase().includes(\"hidden\"));\r\n        this.setState({schemaResults: schemas});\r\n    }\r\n\r\n    getRootSchemaCategory(): SchemaCategory {\r\n        const { schemaResults } = this.state;\r\n        const categoryRoot = new SchemaCategory(\"root\");\r\n\r\n        let currentCategory = categoryRoot;\r\n        schemaResults.forEach(schema => {\r\n            const idArr = schema.id.split(\"/\");\r\n            let i;\r\n            for (i = 0; i < idArr.length - 1; i++) {\r\n                currentCategory = currentCategory.getSubCategory(idArr[i]);\r\n            }\r\n            currentCategory.addContent(schema.id);\r\n            currentCategory = categoryRoot;\r\n        });\r\n\r\n        return categoryRoot;\r\n    }\r\n\r\n    render() {\r\n        const { isVisible, x, y, addNodeItem } = this.props;\r\n        const { schemaResults } = this.state;\r\n\r\n        const width = 300;\r\n        const height = 250;\r\n\r\n        const rootCategory = this.getRootSchemaCategory();\r\n        return (\r\n            <div className={`${isVisible ? \"flex\" : \"hidden\"} flex-col absolute rounded bg-gray-900 bg-opacity-90`} \r\n                    style={{top: y, left: x, width: `${Math.min(width, window.innerWidth - x)}px`, height: `${Math.min(height, window.innerHeight - y)}px`}}>\r\n                <div className=\"p-3\">\r\n                    <SearchBar filterSearch={this.filterSearch} />\r\n                </div>\r\n                <Scrollbar noScrollX>\r\n                    <div className=\"pb-4\">\r\n                        <CategoryDOM category={rootCategory} depth={0} onClick={addNodeItem} />\r\n                    </div>\r\n                    \r\n                    <div className={`${schemaResults.length > 0 ? \"hidden\" : \"flex\"} justify-center mb-2 select-none`}>\r\n                        <div className=\"text-gray-400 italic\">\r\n                            No schemas found\r\n                        </div>\r\n                    </div>\r\n                </Scrollbar>\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { VariableItem } from '../models/Scriplet';\r\n\r\nexport type VariableFormProps = {\r\n    variable?: VariableItem;\r\n    onSaveVariable: (name: string, type: string, startValue: any) => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nexport type VariableFormState = {\r\n    selectedId: number;\r\n    name: string;\r\n    selectedType: string;\r\n    startValue: any;\r\n}\r\n\r\nexport default class VariableForm extends React.Component<VariableFormProps, VariableFormState> {\r\n    constructor(props: VariableFormProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            selectedId: -1,\r\n            name: \"\",\r\n            selectedType: \"String\",\r\n            startValue: undefined\r\n        }\r\n\r\n        this.setStartValue = this.setStartValue.bind(this);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        const { variable } = this.props;\r\n        const { selectedId } = this.state;\r\n        if (!variable)\r\n            return;\r\n\r\n        if (selectedId !== variable.id)\r\n            this.setState({selectedId: variable.id, name: variable.name, selectedType: variable.type, startValue: variable.startValue});\r\n    }\r\n    \r\n    setStartValue(inputValue: string) {\r\n        let startValue;\r\n\r\n        switch (this.state.selectedType) {\r\n            case \"Number\":\r\n                startValue = parseInt(inputValue);\r\n                break;\r\n            case \"Boolean\":\r\n                startValue = (inputValue === \"true\");\r\n                break;\r\n            default:\r\n                startValue = inputValue;\r\n                break;\r\n        }\r\n\r\n        this.setState({startValue: startValue});\r\n    }\r\n\r\n    render() {\r\n        const { name, selectedType, startValue } = this.state;\r\n        const { onSaveVariable, onCancel } = this.props;\r\n\r\n        return(\r\n            <div className=\"flex flex-col\">\r\n                <div className=\"flex flex-col mb-4\">\r\n                    <label className=\"mb-1 text-sm text-gray-700\">\r\n                        Name\r\n                    </label>\r\n                    <input className=\"px-2 border-2 rounded\" \r\n                            type=\"text\" \r\n                            name=\"title\" \r\n                            value={name} \r\n                            onChange={event => {\r\n                                this.setState({name: event.target.value});\r\n                            }} />\r\n                </div>\r\n                <div className=\"flex flex-col mb-4\">\r\n                    <label className=\"mb-1 text-sm text-gray-700\">\r\n                        Type\r\n                    </label>\r\n                    <select className=\"px-1 border-2 rounded text-gray-800\" \r\n                            name=\"\" \r\n                            id=\"\" \r\n                            value={selectedType}\r\n                            onChange={event => {\r\n                                this.setState({selectedType: event.target.value});\r\n                            }}>\r\n                        {/* TODO: Base this off of the Variable Type */}\r\n                        <option value=\"Number\">Number</option>\r\n                        <option value=\"Boolean\">Boolean</option>\r\n                        <option value=\"String\">String</option>\r\n                    </select>\r\n                </div>\r\n                <div className=\"flex flex-col mb-6\">\r\n                    <label className=\"mb-1 text-sm text-gray-700\">\r\n                        Start Value\r\n                    </label>\r\n                    {(selectedType === \"Number\" && \r\n                        <input className=\"px-2 border-2 rounded\" \r\n                                type=\"number\" \r\n                                name=\"title\" \r\n                                value={`${startValue ?? \"\"}`}\r\n                                onChange={event => this.setStartValue(event.target.value)} />\r\n                    ) || \r\n                    (selectedType === \"Boolean\" && \r\n                        <select className=\"px-2 border-2 rounded text-gray-800\" \r\n                                name=\"\" \r\n                                id=\"\"\r\n                                value={`${startValue ?? \"\"}`}\r\n                                onChange={event => this.setStartValue(event.target.value)}>\r\n                            <option value=\"\" disabled hidden>Select a value...</option>\r\n                            <option value=\"true\">True</option>\r\n                            <option value=\"false\">False</option>\r\n                        </select>\r\n                    ) ||\r\n                    ((selectedType === \"String\" || selectedType === \"\") &&\r\n                        <input className=\"px-2 border-2 rounded\" \r\n                                type=\"text\" \r\n                                name=\"title\" \r\n                                value={`${startValue ?? \"\"}`}\r\n                                onChange={event => this.setStartValue(event.target.value)} />\r\n                    )}\r\n                </div>\r\n                <div className=\"flex flex-row-reverse\">\r\n                    <button className=\"ml-4 px-2 py-1 rounded bg-blue-600 text-gray-100 hover:bg-blue-500\" \r\n                            onClick={() => {\r\n                                // TODO: Do validation feedback eventually\r\n                                if (!name || !selectedType || startValue == null || startValue === \"\") {\r\n                                    console.error(`The form for creating a variable cannot have empty fields.`);\r\n                                    return;\r\n                                }\r\n\r\n                                onSaveVariable(name, selectedType, startValue);\r\n                                onCancel();\r\n                            }}>\r\n                        Save\r\n                    </button>\r\n                    <button className=\"px-2 py-1 rounded bg-gray-500 text-gray-100 hover:bg-gray-400\" \r\n                            onClick={onCancel}>\r\n                        Cancel\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { VariableItem } from '../models/Scriplet';\r\nimport DropdownButton from './DropdownButton';\r\n\r\nexport type VariableNavItemProps = {\r\n    variable: VariableItem;\r\n    onDragStart: (event: React.DragEvent<HTMLDivElement>) => void;\r\n    onDragEnd: (event: React.DragEvent<HTMLDivElement>) => void;\r\n    onEdit: (variableId: number) => void;\r\n    onDelete: (variableId: number) => void;\r\n}\r\n\r\nexport type VariableNavItemState = {\r\n    \r\n}\r\n\r\nexport default class VariableNavItem extends React.Component<VariableNavItemProps, VariableNavItemState> {\r\n    constructor(props: VariableNavItemProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            \r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { variable, onDragStart, onDragEnd, onEdit, onDelete } = this.props;\r\n\r\n        return(\r\n            <div className=\"mb-2 select-none\" \r\n                    draggable\r\n                    onDragStart={onDragStart}\r\n                    onDragEnd={onDragEnd}>\r\n                {/* hover:bg-gray-700 */}\r\n                <div className=\"flex flex-row items-center px-2 py-1 rounded hover:bg-gray-700\" style={{cursor: \"grab\"}}>\r\n                    <div className=\"flex flex-col w-full mr-2\">\r\n                        <div className=\"text-sm text-gray-100\">\r\n                            {variable.name}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-300\">\r\n                            {variable.type}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"px-2 py-2 w-full text-gray-100\">\r\n                        <div className=\"px-1 rounded-sm bg-gray-600\">\r\n                            {`${variable.startValue}`}\r\n                        </div>\r\n                    </div>\r\n                    <DropdownButton onEdit={() => onEdit(variable.id)}\r\n                                    onDelete={() => onDelete(variable.id)} />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Controlled as CodeMirror } from 'react-codemirror2';\r\nimport 'codemirror/lib/codemirror.css';\r\nimport 'codemirror/theme/material.css';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport ScripletManager from '../managers/ScripletManager';\r\nimport Console, { ConsoleMessage } from '../managers/Console';\r\nimport Scrollbar from 'react-scrollbars-custom';\r\nimport SearchBar from './SearchBar';\r\nimport { Vector2d } from 'konva/types/types';\r\nimport { VariableItem } from '../models/Scriplet';\r\nimport Modal from './Modal';\r\nimport VariableForm from './VariableForm';\r\nimport VariableNavItem from './VariableNavItem';\r\nimport InputNavItem from './InputNavItem';\r\n\r\nrequire('codemirror/mode/javascript/javascript');\r\nvar jsbeautify = require('js-beautify').js_beautify;\r\n\r\nexport class EvalResult {\r\n    public inputVars: string[];\r\n    public outputVar: string;\r\n    public evalValue: any;\r\n    public toParent: string;\r\n    public toCode: string;\r\n\r\n    constructor(evalValue: any, toParent: string, toCode: string) {\r\n        this.inputVars = [];\r\n        this.outputVar = \"\";\r\n        this.evalValue = evalValue;\r\n        this.toParent = toParent;\r\n        this.toCode = toCode;\r\n    }\r\n}\r\n\r\nexport type CodeProps = {\r\n    scripletId: number;\r\n    addNodeItem: (schemaId: string, x?: number, y?: number, customName?: string, variableId?: number, variableType?: string) => void;\r\n    resetView: () => void;\r\n    zoomInView: () => void;\r\n    zoomOutView: () => void;\r\n}\r\n\r\nexport type CodeState = {\r\n    selectedId: number;\r\n    editorValue: string;\r\n    isCodeOpen: boolean;\r\n    isDragging: boolean;\r\n    isSelecting: boolean;\r\n    selectionLocation: Vector2d;\r\n    selectedVariable: VariableItem;\r\n    screenWidth: number;\r\n    searchValue: string;\r\n    variableResults: VariableItem[];\r\n    editedVariable: VariableItem;\r\n    inputResults: VariableItem[];\r\n    editedInput: VariableItem;\r\n    openAddVariableModal: () => void;\r\n    openEditVariableModal: () => void;\r\n    openAddInputModal: () => void;\r\n    openEditInputModal: () => void;\r\n}\r\n\r\nexport default class CodeEditor extends React.Component<CodeProps, CodeState> {\r\n    private codeResult: React.RefObject<HTMLDivElement>;\r\n    private selector: React.RefObject<HTMLDivElement>;\r\n    constructor(props: CodeProps) {\r\n        super(props);\r\n\r\n        this.codeResult = React.createRef();\r\n        this.selector = React.createRef();\r\n\r\n        this.state = {\r\n            selectedId: 0,\r\n            editorValue: jsbeautify(\"return 42;\", { indent_size: 4 }),\r\n            isCodeOpen: false,\r\n            isDragging: false,\r\n            isSelecting: false,\r\n            selectionLocation: {x: 0, y: 0},\r\n            selectedVariable: {id: -1, name: \"\", type: \"\", startValue: undefined, value: undefined},\r\n            screenWidth: window.innerWidth,\r\n            searchValue: \"\",\r\n            variableResults: [],\r\n            editedVariable: {id: -1, name: \"\", type: \"\", startValue: undefined, value: undefined},\r\n            inputResults: [],\r\n            editedInput: {id: -1, name: \"\", type: \"\", startValue: undefined, value: undefined},\r\n            openAddVariableModal: () => {},\r\n            openEditVariableModal: () => {},\r\n            openAddInputModal: () => {},\r\n            openEditInputModal: () => {}\r\n        }\r\n\r\n        this.setScreenWidth = this.setScreenWidth.bind(this);\r\n        this.handleRun = this.handleRun.bind(this);\r\n        this.handleClear = this.handleClear.bind(this);\r\n        this.handleBeautifyCode = this.handleBeautifyCode.bind(this);\r\n        this.handleEvaluateNodes = this.handleEvaluateNodes.bind(this);\r\n        //this.evaluateNodes = this.evaluateNodes.bind(this);\r\n        this.openCode = this.openCode.bind(this);\r\n        this.closeCode = this.closeCode.bind(this);\r\n        this.toggleCode = this.toggleCode.bind(this);\r\n\r\n        this.onMessageLog = this.onMessageLog.bind(this);\r\n        this.filterSearch = this.filterSearch.bind(this);\r\n        this.refreshSearch = this.refreshSearch.bind(this);\r\n\r\n        this.onAddVariable = this.onAddVariable.bind(this);\r\n        this.onEditVariable = this.onEditVariable.bind(this);\r\n        this.onDeleteVariable = this.onDeleteVariable.bind(this);\r\n\r\n        this.onAddInput = this.onAddInput.bind(this);\r\n        this.onEditInput = this.onEditInput.bind(this);\r\n        this.onDeleteInput = this.onDeleteInput.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener(\"resize\", this.setScreenWidth);\r\n        \r\n        Console.subscribe(message => this.onMessageLog(message));\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"resize\", this.setScreenWidth);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        const id = this.props.scripletId;\r\n        if (this.state.selectedId !== id) {\r\n            ScripletManager.selectScriplet(id).then(result => {\r\n                this.filterSearch(\"\");\r\n                this.handleClear();\r\n                this.setState({selectedId: id});\r\n            })\r\n        }\r\n    }\r\n\r\n    setScreenWidth() {\r\n        this.setState({screenWidth: window.innerWidth});\r\n    }\r\n\r\n    handleRun() {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.resetVariables();\r\n\r\n        const startNode = scriplet.getStart();\r\n        const startSchema = startNode.schema;\r\n        if (!startSchema) {\r\n            console.error(`The start node is missing the schema.`);\r\n            return;\r\n        }\r\n\r\n        const startSlot = startSchema.inputFlowSlots[0];\r\n        if (!startSlot) {\r\n            console.error(`The start node is missing the Entry input flow slot.`);\r\n            return;\r\n        }\r\n\r\n        startSlot.evaluateSlot();\r\n        Console.success(\"Finished running code!\");\r\n    }\r\n\r\n    handleClear() {\r\n        const codeResult = this.codeResult.current;\r\n        if (!codeResult) {\r\n            console.error(`App console could not be found.`);\r\n            return;\r\n        }\r\n\r\n        codeResult.innerText = \"Run code first\";\r\n    }\r\n\r\n    handleBeautifyCode() {\r\n        this.setState(prevState => ({editorValue: jsbeautify(prevState.editorValue, { indent_size: 4 })}));\r\n    }\r\n\r\n    handleEvaluateNodes() {\r\n        /*\r\n        // Look for the output node\r\n        const scriplet = this.state.scriplet;\r\n        if (!scriplet) {\r\n            console.error(`The scriplet in this state could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const items = [...scriplet.items];\r\n        const inputEntries = items.filter(entry => entry[1].schema?.name === \"Input\");\r\n        if (!inputEntries) {\r\n            console.error(`No input nodes were found in the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n        const outputEntries = items.filter(entry => entry[1].schema?.name === \"Output\");\r\n        if (!outputEntries) {\r\n            console.error(`No output nodes were found in the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n        \r\n        let visited = new Map<number, EvalResult>();\r\n        const results: EvalResult[] = [];\r\n        let inputInitStrs = \"\";\r\n        outputEntries.forEach(entry => {\r\n            const result = this.evaluateNodes(new EvalResult(0, \"\", \"\"), visited, entry[1].id);\r\n            if (result)\r\n                results.push(result);\r\n            \r\n            inputEntries.forEach(entry2 => {\r\n                const inputRes = visited.get(entry2[1].id);\r\n                if (inputRes) {\r\n                    const code = `const ${entry2[1].variableName} = ${inputRes.evalValue}; `;\r\n                    if (!inputInitStrs.includes(code))\r\n                        inputInitStrs += code;\r\n                }\r\n            });\r\n            visited = new Map<number, EvalResult>();\r\n        });\r\n\r\n        if (!results) {\r\n            console.error(`Something went wrong when evaluating the nodes of the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n        \r\n        const codeResult = this.codeResult.current;\r\n        if (!codeResult) {\r\n            console.error(`Could not get the div element of the referenced code result element.`);\r\n            return;\r\n        }\r\n\r\n        let fullCode: string = `${inputInitStrs}`;\r\n        const evalValues: any[] = [];\r\n        results.forEach(result => {\r\n            const code = `function ${result.outputVar}(${result.inputVars}) { ${result.toCode} }`;\r\n            evalValues.push(result.evalValue);\r\n            if (code)\r\n                fullCode += code;\r\n        });\r\n        fullCode += \"return [\";\r\n        results.forEach((result, index) => {\r\n            fullCode += index === results.length - 1 ? `${result.outputVar}(${result.inputVars})` : `${result.outputVar}(${result.inputVars}), `;\r\n        });\r\n        fullCode += \"];\"\r\n\r\n        codeResult.textContent = evalValues.toString();\r\n        this.setState({editorValue: jsbeautify(fullCode, { indent_size: 4 })});\r\n        */\r\n    }\r\n\r\n    /* TODO: This is too hackish\r\n    // What this should do is place all the state data (like evaluated value, )\r\n    evaluateNodes(result: EvalResult, visited: Map<number, EvalResult>, itemId: number): EvalResult | undefined {\r\n        const scriplet = this.state.scriplet;\r\n        if (!scriplet) {\r\n            console.error(`The scriplet in this state could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const items = scriplet.items;\r\n        if (!items) {\r\n            console.error(`Could not get the node items in the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n\r\n        const item = items.get(itemId);\r\n        if (!item) {\r\n            console.error(`The item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The schema of the item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const variableName = schema.state.hasVariable ? item.variableName : \"\";\r\n        if (schema.name === \"Input\") {\r\n            result.evalValue = schema.evalFunction();\r\n            result.toParent = variableName;\r\n            result.inputVars.push(variableName);\r\n            visited.set(item.id, new EvalResult(result.evalValue, result.toParent, result.toCode));\r\n            return result;\r\n        }\r\n\r\n        if (schema.name === \"Output\") {\r\n            result.outputVar = item.variableName;\r\n        }\r\n\r\n        const children = NodeConnections.getInputConnections(itemId);\r\n        if (!children) {\r\n            console.error(`The children of the node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n        if (children.size <= 0) {\r\n            const visitedRes = visited.get(itemId);\r\n            if (visitedRes)\r\n                return visitedRes;\r\n            result.evalValue = schema.evalFunction();\r\n            result.toParent = schema.toParent() === \"variable\" ? variableName : schema.toParent();\r\n            result.toCode = `${result.toCode} ${schema.state.hasVariable ? \"const \" + variableName + \" = \" + schema.toCode() : schema.toCode()};`;\r\n            visited.set(item.id, new EvalResult(result.evalValue, result.toParent, result.toCode));\r\n            return result;\r\n        }\r\n        \r\n        var i;\r\n        let arr: any[] = [];\r\n        let arrStr: string[] = [];\r\n        // This for loop is determining the values of the toParent functions of the children\r\n        // TODO: Don't travel to the already visited nodes\r\n        for (i = 0; i < schema.inputSlots.length; i++) {\r\n            const childConn = children.get(schema.inputSlots[i].id);\r\n            if (!childConn) {\r\n                arr.push(schema.inputSlots[i].defaultValue);\r\n                arrStr.push(schema.inputSlots[i].defaultValueStr);\r\n                continue;\r\n            }\r\n\r\n            const childItem = scriplet.items.get(childConn.outputId);\r\n            if (!childItem) {\r\n                console.error(`The node item of id '${childConn.outputId}' could not be found in the scriplet.`);\r\n                return;\r\n            }\r\n            const visitedRes = visited.get(childItem.id);\r\n            if (visitedRes != null) {\r\n                arr.push(visitedRes.evalValue);\r\n                arrStr.push(visitedRes.toParent);\r\n                continue;\r\n            }\r\n            \r\n            const res = this.evaluateNodes(result, visited, childItem.id);\r\n            if (!res) {\r\n                console.error(`Something went wrong when evaluating the child nodes of the node item of id '${childItem.id}'.`);\r\n                return;\r\n            }\r\n            \r\n            arr.push(res.evalValue);\r\n            arrStr.push(res.toParent);\r\n        }\r\n\r\n        schema.state.onEvaluate(...arr);\r\n\r\n        result.evalValue = schema.evalFunction(...arr);\r\n        result.toParent = schema.toParent(...arrStr) === \"variable\" ? variableName : schema.toParent(...arrStr);\r\n        result.toCode = `${result.toCode} ${schema.state.hasVariable ? \"const \" + variableName + \" = \" + schema.toCode(...arrStr) : schema.toCode(...arrStr)};`;\r\n        visited.set(item.id, new EvalResult(result.evalValue, result.toParent, result.toCode));\r\n\r\n        return result;\r\n    }\r\n    /**/\r\n\r\n    openCode() {\r\n        this.setState({isCodeOpen: true});\r\n    }\r\n\r\n    closeCode() {\r\n        this.setState({isCodeOpen: false});\r\n    }\r\n\r\n    toggleCode() {\r\n        if (this.state.isCodeOpen)\r\n            this.closeCode();\r\n        else\r\n            this.openCode();\r\n    }\r\n\r\n    onMessageLog(message: ConsoleMessage) {\r\n        const codeResult = this.codeResult.current;\r\n        if (!codeResult) {\r\n            console.error(`App console could not be found.`);\r\n            return;\r\n        }\r\n\r\n        if (codeResult.innerText === \"Run code first\")\r\n            codeResult.innerHTML = `<p style=\"color: ${message.color}\">${message.message}</p>`;\r\n        else\r\n            codeResult.innerHTML += `<p style=\"color: ${message.color}\">${message.message}</p>`;\r\n    }\r\n\r\n    filterSearch(searchValue: string) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        let variables = scriplet.getVariables();\r\n        variables = variables.filter(variable => (variable.name.toLowerCase().includes(searchValue.toLowerCase()) || \r\n                                                    variable.type.toLowerCase().includes(searchValue.toLowerCase()) ||\r\n                                                    `${variable.startValue}`.toLowerCase().includes(searchValue.toLowerCase())));\r\n\r\n        let inputs = scriplet.getInputs();\r\n        inputs = inputs.filter(input => (input.name.toLowerCase().includes(searchValue.toLowerCase()) || \r\n                                            input.type.toLowerCase().includes(searchValue.toLowerCase()) ||\r\n                                            `${input.startValue}`.toLowerCase().includes(searchValue.toLowerCase())));\r\n\r\n        this.setState({variableResults: variables, inputResults: inputs});\r\n    }\r\n\r\n    refreshSearch() {\r\n        this.filterSearch(\"\");\r\n    }\r\n\r\n    onAddVariable(name: string, type: string, startValue: any) {\r\n        // TODO: Make sure the name is not taken by another variable already\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.addVariable(name, type, startValue, undefined);\r\n    }\r\n\r\n    onEditVariable(id: number, name: string, type: string, startValue: any) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.setVariable({id, name, type, startValue, value: undefined});\r\n        scriplet.updateVariables();\r\n    }\r\n\r\n    onDeleteVariable(id: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.deleteVariable(id);\r\n        this.refreshSearch();\r\n    }\r\n\r\n    onAddInput(name: string, type: string, value: any) {\r\n        // TODO: Make sure the name is not taken by another variable already\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.addInput(name, type, value, undefined);\r\n    }\r\n\r\n    onEditInput(id: number, name: string, type: string, value: any) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.setInput({id, name, type, startValue: value, value: undefined});\r\n    }\r\n\r\n    onDeleteInput(id: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.deleteVariable(id);\r\n        this.refreshSearch();\r\n    }\r\n\r\n    render() {\r\n        const { isCodeOpen, isDragging, isSelecting, selectionLocation, selectedVariable, screenWidth, variableResults, editedVariable, inputResults, editedInput, openAddVariableModal, openEditVariableModal, openAddInputModal, openEditInputModal } = this.state;\r\n        const { addNodeItem, resetView, zoomInView, zoomOutView } = this.props;\r\n\r\n        if (isSelecting)\r\n            this.selector.current?.focus();\r\n\r\n        return(\r\n            <>\r\n                <div className={`${isCodeOpen ? \"code-container\" : \"hidden\"} shadow flex flex-row lg:flex-col`}>\r\n                    {/* \r\n                    <CodeMirror value={this.state.editorValue}\r\n                                options={{\r\n                                    mode: 'javascript',\r\n                                    theme: 'code-editor material',\r\n                                    lineNumbers: true\r\n                                }}\r\n                                onBeforeChange={(editor, data, value) => {\r\n                                    this.setState({editorValue: value});\r\n                                }}\r\n                                onChange={(editor, data, value) => {\r\n\r\n                                }} />\r\n                    <button className=\"beautify-code items-center justify-center rounded shadow bg-gray-700 text-gray-200 hover:bg-gray-600 select-none\" onClick={this.handleBeautifyCode}>\r\n                        <FontAwesomeIcon className=\"text-sm\" icon=\"magic\" />&nbsp;\r\n                        Beautify\r\n                    </button>\r\n                    <button className=\"eval-code items-center justify-center rounded shadow bg-gray-700 text-gray-200 hover:bg-gray-600 select-none\" onClick={this.handleEvaluateNodes}>\r\n                        <FontAwesomeIcon className=\"text-sm\" icon=\"lightbulb\" />&nbsp;\r\n                        Evaluate\r\n                    </button>\r\n                    */}\r\n\r\n                    <div className=\"flex flex-col p-3 w-2/3 lg:w-full lg:h-2/3 lg:border-b-2 border-gray-900 bg-gray-800\">\r\n                        <SearchBar filterSearch={this.filterSearch} />\r\n                        <div className=\"flex flex-row lg:flex-col h-full w-full\">\r\n                            <div className=\"w-1/2 h-full lg:w-full lg:h-1/2 pr-2 lg:pr-0\">\r\n                                <div className=\"mt-2 mb-1 text-gray-100\">\r\n                                    Variables\r\n                                    <hr className=\"mt-1\" />\r\n                                </div>\r\n                                <div className=\"w-full h-5/6\">\r\n                                    <Scrollbar noScrollX>\r\n                                        {variableResults.map((variable, index) => (\r\n                                            <VariableNavItem key={`variable-${index}`} \r\n                                                            variable={variable}\r\n                                                            onDragStart={event => {\r\n                                                                event.stopPropagation();\r\n                                                                event.dataTransfer.setData(\"text/plain\", JSON.stringify({id: variable.id, isVariable: true, isInput: false}));\r\n                                                                this.setState({isDragging: true});\r\n                                                            }}\r\n                                                            onDragEnd={() => {\r\n                                                                this.setState({isDragging: false});\r\n                                                            }}\r\n                                                            onEdit={id => {\r\n                                                                this.setState({editedVariable: variable}, () => openEditVariableModal());\r\n                                                            }}\r\n                                                            onDelete={id => {\r\n                                                                this.onDeleteVariable(id);\r\n                                                            }} />\r\n                                        ))}\r\n                                        <div className={`${variableResults.length > 0 ? \"hidden\" : \"flex\"} justify-center mb-2 select-none`}>\r\n                                            <div className=\"p-3 text-gray-400 italic\">\r\n                                                No variables found\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"w-full mb-1 rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\">\r\n                                            <div className={`px-4 py-2`}\r\n                                                    onClick={() => {\r\n                                                        openAddVariableModal();\r\n                                                    }}>\r\n                                                <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" \r\n                                                                icon=\"plus\" />\r\n                                                <span className=\"font-medium\">Add Variable</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </Scrollbar>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"w-1/2 h-full lg:h-1/2 lg:w-full pl-2 lg:pl-0\">\r\n                                <div className=\"mt-2 mb-1 text-gray-100\">\r\n                                    Inputs\r\n                                    <hr className=\"mt-1\" />\r\n                                </div>\r\n                                <div className=\"w-full h-5/6\">\r\n                                    <Scrollbar noScrollX>\r\n                                        {inputResults.map((input, index) => (\r\n                                            <VariableNavItem key={`variable-${index}`} \r\n                                                            variable={input}\r\n                                                            onDragStart={event => {\r\n                                                                event.stopPropagation();\r\n                                                                event.dataTransfer.setData(\"text/plain\", JSON.stringify({id: input.id, isVariable: false, isInput: true}));\r\n                                                                this.setState({isDragging: true});\r\n                                                            }}\r\n                                                            onDragEnd={() => {\r\n                                                                this.setState({isDragging: false});\r\n                                                            }}\r\n                                                            onEdit={id => {\r\n                                                                this.setState({editedInput: input}, () => openEditInputModal());\r\n                                                            }}\r\n                                                            onDelete={id => {\r\n                                                                this.onDeleteInput(id);\r\n                                                            }} />\r\n                                        ))}\r\n                                        <div className={`${inputResults.length > 0 ? \"hidden\" : \"flex\"} justify-center mb-2 select-none`}>\r\n                                            <div className=\"p-3 text-gray-400 italic\">\r\n                                                No inputs found\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"w-full mb-1 rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\">\r\n                                            <div className={`px-4 py-2`}\r\n                                                    onClick={() => {\r\n                                                        openAddInputModal();\r\n                                                    }}>\r\n                                                <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" \r\n                                                                icon=\"plus\" />\r\n                                                <span className=\"font-medium\">Add Input</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </Scrollbar>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"w-1/3 h-full lg:w-full lg:h-1/3 bg-gray-800\">\r\n                        <Scrollbar>\r\n                            <div className=\"px-4 py-2 lg:w-auto flex-grow text-gray-100\" ref={this.codeResult}>\r\n                                Run code first\r\n                            </div>\r\n                        </Scrollbar>\r\n                    </div>\r\n                    <button className=\"run-code items-center justify-center rounded shadow bg-gray-700 text-gray-200 hover:bg-gray-600 select-none\" onClick={this.handleRun}>\r\n                        <FontAwesomeIcon className=\"text-sm\" icon=\"play\"/>&nbsp;\r\n                        Run\r\n                    </button>\r\n                    <button className=\"clear-code items-center justify-center rounded shadow bg-gray-700 text-gray-200 hover:bg-gray-600 select-none\" onClick={this.handleClear}>\r\n                        <FontAwesomeIcon className=\"text-sm\" icon=\"trash\"/>&nbsp;\r\n                        Clear\r\n                    </button>\r\n\r\n                    <button className=\"absolute px-2 py-1 rounded shadow bg-gray-700 hover:bg-gray-600 text-gray-100\" style={screenWidth >= 1024 ? {top: \"1rem\", left: \"-7rem\"} : {bottom: \"15rem\", right: \"3.5rem\"}}\r\n                            onClick={resetView}>\r\n                        Reset\r\n                    </button>\r\n                    <button className=\"absolute px-2 py-1 rounded shadow bg-gray-700 hover:bg-gray-600 text-gray-100\" style={screenWidth >= 1024 ? {top: \"1rem\", left: \"-3rem\"} : {bottom: \"17.5rem\", right: \"1rem\"}}\r\n                            onClick={zoomInView}>\r\n                        <FontAwesomeIcon icon=\"plus\" />\r\n                    </button>\r\n                    <button className=\"absolute px-2 py-1 rounded shadow bg-gray-700 hover:bg-gray-600 text-gray-100\" style={screenWidth >= 1024 ? {top: \"3.5rem\", left: \"-3rem\"} : {bottom: \"15rem\", right: \"1rem\"}}\r\n                            onClick={zoomOutView}>\r\n                        <FontAwesomeIcon icon=\"minus\" />\r\n                    </button>\r\n                </div>\r\n                <div className={`${isCodeOpen ? \"hidden\" : \"collapsed-code\"} shadow bg-gray-800 items-center lg:justify-center lg:items-start`}>\r\n                    <div className=\"p-4\">\r\n                        <FontAwesomeIcon icon=\"code\" className=\"text-xl text-gray-300\" />\r\n                    </div>\r\n\r\n                    <button className=\"absolute px-2 py-1 rounded shadow bg-gray-700 hover:bg-gray-600 text-gray-100\" style={screenWidth >= 1024 ? {top: \"1rem\", left: \"-7rem\"} : {bottom: \"5rem\", right: \"3.5rem\"}}\r\n                            onClick={resetView}>\r\n                        Reset\r\n                    </button>\r\n                    <button className=\"absolute px-2 py-1 rounded shadow bg-gray-700 hover:bg-gray-600 text-gray-100\" style={screenWidth >= 1024 ? {top: \"1rem\", left: \"-3rem\"} : {bottom: \"7.5rem\", right: \"1rem\"}}\r\n                            onClick={zoomInView}>\r\n                        <FontAwesomeIcon icon=\"plus\" />\r\n                    </button>\r\n                    <button className=\"absolute px-2 py-1 rounded shadow bg-gray-700 hover:bg-gray-600 text-gray-100\" style={screenWidth >= 1024 ? {top: \"3.5rem\", left: \"-3rem\"} : {bottom: \"5rem\", right: \"1rem\"}}\r\n                            onClick={zoomOutView}>\r\n                        <FontAwesomeIcon icon=\"minus\" />\r\n                    </button>\r\n                </div>\r\n                <button className={`${isCodeOpen ? \"h-56 mb-8 pb-48\" : \"h-16 mb-8 pb-8\"} ${screenWidth >= 1024 ? \"hidden\" : \"code-toggle\"} items-center flex-col-reverse rounded-full bg-gray-700`}\r\n                        onClick={this.toggleCode}>\r\n                    <div className=\"inline-block pb-1\">\r\n                        <FontAwesomeIcon icon=\"chevron-down\"\r\n                                            className={`${isCodeOpen ? \"block\" : \"hidden\"} text-gray-300`} />\r\n                        <FontAwesomeIcon icon=\"chevron-up\"\r\n                                            className={`${isCodeOpen ? \"hidden\" : \"block\"} text-gray-300`} />\r\n                    </div>\r\n                </button>\r\n                <button className={`${isCodeOpen ? \"w-64 mr-8 pr-56\" : \"w-16 mr-8 pr-8\"} ${screenWidth >= 1024 ? \"code-toggle\" : \"hidden\"} items-center flex-row-reverse rounded-full bg-gray-700`}\r\n                        onClick={this.toggleCode}>\r\n                    <div className=\"inline-block pr-2\">\r\n                        <FontAwesomeIcon icon=\"chevron-right\"\r\n                                            className={`${isCodeOpen ? \"block\" : \"hidden\"} text-gray-300`} />\r\n                        <FontAwesomeIcon icon=\"chevron-left\"\r\n                                            className={`${isCodeOpen ? \"hidden\" : \"block\"} text-gray-300`} />\r\n                    </div>\r\n                </button>\r\n                <div className={`${isDragging ? \"flex\" : \"hidden\"} absolute-full justify-center items-center z-10 bg-gray-700 bg-opacity-25`}\r\n                        onDragEnter={event => event.preventDefault()}\r\n                        onDragOver={event => event.preventDefault()}\r\n                        onDrop={event => {\r\n                            event.preventDefault();\r\n                            const x = event.pageX;\r\n                            const y = event.pageY;\r\n                            const data: {id: number, isVariable: boolean, isInput: boolean} = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\r\n\r\n                            const scriplet = ScripletManager.currentScriplet;\r\n                            if (!scriplet) {\r\n                                console.error(`The current scriplet could not be found.`);\r\n                                return;\r\n                            }\r\n\r\n                            let variable: VariableItem;\r\n                            if (data.isVariable) {\r\n                                const tempVariable = scriplet.getVariable(data.id);\r\n                                if (!tempVariable) {\r\n                                    console.error(`The variable of id '${data.id}' could not be found.`);\r\n                                    return;\r\n                                }\r\n\r\n                                variable = tempVariable;\r\n                            } else {\r\n                                if (data.isInput) {\r\n                                    const input = scriplet.getInput(data.id);\r\n                                    if (!input) {\r\n                                        console.error(`The input of id '${data.id}' could not be found.`);\r\n                                        return;\r\n                                    }\r\n\r\n                                    addNodeItem(`Hidden/Input/${input.type}`, x, y, undefined, input.id, \"Input\");\r\n                                    return;\r\n                                } else {\r\n                                    const output = scriplet.getOutput(data.id);\r\n                                    if (!output) {\r\n                                        console.error(`The output of id '${data.id}' could not be found.`);\r\n                                        return;\r\n                                    }\r\n\r\n                                    addNodeItem(`Hidden/Output/${output.type}`, x, y, undefined, output.id, \"Output\");\r\n                                    return;\r\n                                }\r\n                            }\r\n\r\n                            this.setState({isSelecting: data.isVariable, selectionLocation: {x, y}, selectedVariable: variable});\r\n                        }}>\r\n                    <div className=\"text-xl text-gray-900\">\r\n                        Drag here...\r\n                    </div>\r\n                </div>\r\n                <div ref={this.selector}\r\n                        className={`${isSelecting ? \"flex\" : \"hidden\"} flex-col rounded bg-gray-700 outline-none`} \r\n                        style={{position: \"absolute\", top: `${selectionLocation.y}px`, left: `${selectionLocation.x}px`}}\r\n                        tabIndex={0}\r\n                        onBlur={() => {\r\n                            this.setState({isSelecting: false});\r\n                        }}>\r\n                    <div className=\"px-2 py-1 rounded hover:bg-gray-600 text-gray-100 select-none cursor-pointer\"\r\n                            onClick={event => {\r\n                                event.bubbles = true;\r\n                                addNodeItem(`Hidden/Getter/${selectedVariable.type}`, selectionLocation.x, selectionLocation.y, undefined, selectedVariable.id, \"Variable\");\r\n                                this.setState({isSelecting: false});\r\n                            }}>\r\n                        {`Get ${selectedVariable.name}`}\r\n                    </div>\r\n                    <div className=\"px-2 py-1 rounded hover:bg-gray-600 text-gray-100 select-none cursor-pointer\"\r\n                            onClick={event => {\r\n                                event.stopPropagation();\r\n                                addNodeItem(`Hidden/Setter/${selectedVariable.type}`, selectionLocation.x, selectionLocation.y, undefined, selectedVariable.id, \"Variable\");\r\n                                this.setState({isSelecting: false});\r\n                            }}>\r\n                        {`Set ${selectedVariable.name}`}\r\n                    </div>\r\n                </div>\r\n                <Modal title=\"Create New Variable\"\r\n                        openModal={callable => {\r\n                            if (openAddVariableModal.toString() === (() => {}).toString())\r\n                                this.setState({openAddVariableModal: callable});\r\n                        }}>\r\n                    {(closeModal) => (\r\n                        <VariableForm onSaveVariable={(name, type, startValue) => {\r\n                                                        this.onAddVariable(name, type, startValue);\r\n                                                        this.refreshSearch();\r\n                                                    }} \r\n                                        onCancel={closeModal} />\r\n                    )}\r\n                </Modal>\r\n                <Modal title=\"Edit Variable\"\r\n                        openModal={callable => {\r\n                            if (openEditVariableModal.toString() === (() => {}).toString())\r\n                                this.setState({openEditVariableModal: callable});\r\n                        }}>\r\n                    {(closeModal) => (\r\n                        <VariableForm variable={editedVariable}\r\n                                        onSaveVariable={(name, type, startValue) => {\r\n                                                            this.onEditVariable(editedVariable.id, name, type, startValue);\r\n                                                            this.refreshSearch();\r\n                                                        }} \r\n                                        onCancel={closeModal} />\r\n                    )}\r\n                </Modal>\r\n                <Modal title=\"Create New Input\"\r\n                        openModal={callable => {\r\n                            if (openAddInputModal.toString() === (() => {}).toString())\r\n                                this.setState({openAddInputModal: callable});\r\n                        }}>\r\n                    {(closeModal) => (\r\n                        <VariableForm onSaveVariable={(name, type, startValue) => {\r\n                                                        this.onAddInput(name, type, startValue);\r\n                                                        this.refreshSearch();\r\n                                                    }} \r\n                                        onCancel={closeModal} />\r\n                    )}\r\n                </Modal>\r\n                <Modal title=\"Edit Input\"\r\n                        openModal={callable => {\r\n                            if (openEditInputModal.toString() === (() => {}).toString())\r\n                                this.setState({openEditInputModal: callable});\r\n                        }}>\r\n                    {(closeModal) => (\r\n                        <VariableForm variable={editedInput}\r\n                                        onSaveVariable={(name, type, startValue) => {\r\n                                                            this.onEditInput(editedInput.id, name, type, startValue);\r\n                                                            this.refreshSearch();\r\n                                                        }} \r\n                                        onCancel={closeModal} />\r\n                    )}\r\n                </Modal>\r\n            </>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport Node from './Node';\r\nimport { Stage, Layer, Group, Rect, Text } from 'react-konva';\r\nimport { Stage as PortalStage, Layer as PortalLayer, Portal } from 'react-konva-portal';\r\nimport Edge from './Edge';\r\nimport Colors from '../utils/Colors';\r\nimport { KonvaEventObject } from 'konva/types/Node';\r\nimport NodeConnections from '../managers/NodeConnections';\r\nimport ScripletManager from '../managers/ScripletManager';\r\nimport Konva from 'konva';\r\nimport FontFaceObserver from 'fontfaceobserver';\r\nimport { KonvaForm } from './KonvaForm';\r\nimport SchemaSelector from './SchemaSelector';\r\nimport { Vector2d } from 'konva/types/types';\r\nimport { ItemSlotPair } from '../models/NodeSlot';\r\nimport CodeEditor from './CodeEditor';\r\n\r\nexport type ScripletRootProps = {\r\n    scripletId: number;\r\n}\r\n\r\nexport type ScripletRootState = {\r\n    selectedId: number;\r\n    isDirtyDOM: boolean;\r\n    isReadyToMount: boolean;\r\n    isReady: boolean;\r\n    contextMenu: Konva.Node | null;\r\n    inputElement: HTMLInputElement | null;\r\n    isContextMenuShown: boolean;\r\n    contextMenuPos: Vector2d;\r\n}\r\n\r\nexport default class ScripletRoot extends React.Component<ScripletRootProps, ScripletRootState> {\r\n    private stageContainer: React.RefObject<HTMLDivElement>;\r\n    private stage: React.RefObject<Stage>;\r\n\r\n    constructor(props: ScripletRootProps) {\r\n        super(props);\r\n\r\n        this.stageContainer = React.createRef<HTMLDivElement>();\r\n        this.stage = React.createRef<Stage>();\r\n\r\n        this.state = {\r\n            selectedId: 0,\r\n            isDirtyDOM: false,\r\n            isReadyToMount: false,\r\n            isReady: false,\r\n            contextMenu: null,\r\n            inputElement: null,\r\n            isContextMenuShown: false,\r\n            contextMenuPos: {x: 0, y: 0}\r\n        };\r\n\r\n        this.updateDOM = this.updateDOM.bind(this);\r\n        this.addNodeItem = this.addNodeItem.bind(this);\r\n        this.deleteNodeItem = this.deleteNodeItem.bind(this);\r\n        this.handleDragNode = this.handleDragNode.bind(this);\r\n        this.handleDeleteEdge = this.handleDeleteEdge.bind(this);\r\n        this.handleDeleteFlowEdge = this.handleDeleteFlowEdge.bind(this);\r\n        this.handleZoom = this.handleZoom.bind(this);\r\n        this.handleContextMenu = this.handleContextMenu.bind(this);\r\n        this.handleCancelContextMenu = this.handleCancelContextMenu.bind(this);\r\n        this.fitToParent = this.fitToParent.bind(this);\r\n        this.resetView = this.resetView.bind(this);\r\n        this.zoomInView = this.zoomInView.bind(this);\r\n        this.zoomOutView = this.zoomOutView.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        ScripletManager.selectScriplet(this.props.scripletId).then(result => {\r\n            if (!result)\r\n                return;\r\n\r\n            this.resetView();\r\n            this.setState({isReadyToMount: true});\r\n        });\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener('resize', this.fitToParent);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.state.isReadyToMount) {\r\n            window.addEventListener('resize', this.fitToParent);\r\n            this.fitToParent();\r\n\r\n            const stage = this.stage.current?.getStage();\r\n            if (stage) {\r\n                const fontAwesomeObserver = new FontFaceObserver(\"Font Awesome 5 Free\");\r\n                // This is necessary to show the fontawesome icons at start\r\n                fontAwesomeObserver.load().then(() => {\r\n                    console.log(\"Font Awesome 5 has loaded!\");\r\n                    stage.draw();\r\n                }, () => {\r\n                    console.error(\"Font Awesome 5 has not loaded!\");\r\n                });\r\n            }\r\n\r\n            this.setState({isReadyToMount: false, isReady: true});\r\n        }\r\n\r\n        if (this.state.isDirtyDOM) {\r\n            this.setState({isDirtyDOM: false});\r\n        }\r\n\r\n        const id = this.props.scripletId;\r\n        if (this.state.selectedId !== id) {\r\n            ScripletManager.selectScriplet(id).then(result => {\r\n                if (!result)\r\n                    return;\r\n                \r\n                this.resetView();\r\n                this.setState({selectedId: id});\r\n            });\r\n        }\r\n    }\r\n\r\n    updateDOM() {\r\n        this.setState({isDirtyDOM: true});\r\n    }\r\n\r\n    addNodeItem(schemaId: string, x?: number, y?: number, customName?: string, variableId?: number, variableType?: string) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const stage = this.stage.current?.getStage();\r\n        if (!stage) {\r\n            console.error(`The konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const pointerPos = stage.getPointerPosition();\r\n        if (!pointerPos) {\r\n            console.error(`The Konva pointer position could not be found.`);\r\n            return;\r\n        }\r\n\r\n        pointerPos.x = ((x ?? pointerPos.x) - stage.x()) / stage.scaleX();\r\n        pointerPos.y = ((y ?? pointerPos.y) - stage.y()) / stage.scaleY();\r\n\r\n        scriplet.addNode(pointerPos.x, pointerPos.y, schemaId, [], [], [], new Map<number, ItemSlotPair[]>(), [], customName, variableId, variableType);\r\n        this.handleCancelContextMenu();\r\n        this.updateDOM();\r\n    }\r\n\r\n    deleteNodeItem(id: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(id);\r\n        if (!item) {\r\n            console.error(`The node item of id '${id}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The schema of node item '${id}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        if (!schema.isDeletable) {\r\n            console.error(`This schema cannot be deleted.`);\r\n            return;\r\n        }\r\n\r\n        // Delete the node connections to other nodes too\r\n        if (NodeConnections.deleteAllConnections(id)) {\r\n            scriplet.deleteNode(id);\r\n            this.updateDOM();\r\n        }\r\n    }\r\n\r\n    // Should only happen on drag end, but node connections won't follow anymore if not done on drag move\r\n    // TODO: Optimize this!\r\n    handleDragNode(itemId: number, x: number, y: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const node = scriplet.getNode(itemId);\r\n        if (!node) {\r\n            console.error(`The node of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        node.x = x;\r\n        node.y = y;\r\n\r\n        scriplet.items.set(itemId, node);\r\n\r\n        // TODO: This lags! If possible, access the edges (konva path) directly and change the coords there\r\n        this.updateDOM();\r\n    }\r\n\r\n    handleDeleteEdge(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        NodeConnections.deleteConnection(inputItemId, inputSlotId, outputItemId, outputSlotId);\r\n        this.updateDOM();\r\n    }\r\n\r\n    handleDeleteFlowEdge(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        NodeConnections.deleteFlowConnection(inputItemId, inputSlotId, outputItemId, outputSlotId);\r\n        this.updateDOM();\r\n    }\r\n\r\n    handleZoom(event: KonvaEventObject<WheelEvent>) {\r\n        event.evt.preventDefault();\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva Stage could not be found.`);\r\n            return;\r\n        }\r\n            \r\n        const oldScale: number = stage.scaleX();\r\n        const scaleBy = 1.1;\r\n        const pointer = stage.getPointerPosition();\r\n        if (!pointer) {\r\n            console.error(`The Konva pointer position could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const mousePosition = {\r\n            x: (pointer.x - stage.x()) / oldScale,\r\n            y: (pointer.y - stage.y()) / oldScale\r\n        };\r\n\r\n        const newScale = event.evt.deltaY < 0 ? oldScale * scaleBy : oldScale / scaleBy;\r\n\r\n        stage.scale({ x: newScale, y: newScale});\r\n\r\n        const newPos = {\r\n            x: pointer.x - mousePosition.x * newScale,\r\n            y: pointer.y - mousePosition.y * newScale\r\n        };\r\n        stage.position(newPos);\r\n        stage.batchDraw();\r\n    }\r\n\r\n    handleContextMenu(event: KonvaEventObject<PointerEvent>) {\r\n        if (event.target.getType() !== \"Stage\")\r\n            return;\r\n        const stage = event.target.getStage();\r\n        const layer: Konva.Layer | null = event.target.getChildren(item => item.getAttr(\"data-name\") === \"context-menu-layer\")[0];\r\n        if (!layer || !stage) {\r\n            console.error(`Either the Konva layer or Konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        this.setState({isContextMenuShown: true, contextMenuPos: {x: event.evt.pageX, y: event.evt.pageY}});\r\n    }\r\n\r\n    handleCancelContextMenu() {\r\n        this.setState({isContextMenuShown: false});\r\n    }\r\n\r\n    fitToParent() {\r\n        const container = this.stageContainer.current;\r\n        const stage = this.stage.current;\r\n        if (!container || !stage) {\r\n            console.error(`Either the referenced container or referenced stage could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const stageObj = stage.getStage();\r\n        stageObj.width(container.offsetWidth);\r\n        stageObj.height(container.offsetHeight);\r\n        stageObj.draw();\r\n    }\r\n\r\n    resetView() {\r\n        const stage = this.stage.current?.getStage();\r\n        if (!stage) {\r\n            console.error(`The konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        stage.x(275);\r\n        stage.y(275);\r\n        stage.scaleX(1);\r\n        stage.scaleY(1);\r\n        stage.draw();\r\n    }\r\n\r\n    zoomInView() {\r\n        const stage = this.stage.current?.getStage();\r\n        if (!stage) {\r\n            console.error(`The konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        stage.scaleX(stage.scaleX() * 1.2);\r\n        stage.scaleY(stage.scaleY() * 1.2);\r\n        stage.draw();\r\n    }\r\n\r\n    zoomOutView() {\r\n        const stage = this.stage.current?.getStage();\r\n        if (!stage) {\r\n            console.error(`The konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        stage.scaleX(stage.scaleX() * 0.8);\r\n        stage.scaleY(stage.scaleY() * 0.8);\r\n        stage.draw();\r\n    }\r\n    \r\n    render() {\r\n        const { isReadyToMount, isReady, isContextMenuShown, contextMenuPos } = this.state;\r\n\r\n        if (!isReadyToMount && !isReady)\r\n            return null;\r\n\r\n        const rowHeight = 40;\r\n        const topBarHeight = 30;\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return null;\r\n        }\r\n\r\n        return(\r\n            <>\r\n                <div ref={this.stageContainer} className=\"main\">\r\n                    <PortalStage ref={this.stage}\r\n                        className=\"bg-gray-200\"\r\n                        onWheel={(event: KonvaEventObject<WheelEvent>) => {\r\n                            this.handleZoom(event);\r\n                            this.handleCancelContextMenu();\r\n                            KonvaForm.cancel();\r\n                        }}\r\n                        onContextMenu={(event: KonvaEventObject<PointerEvent>) => {\r\n                            event.evt.preventDefault();\r\n                            event.cancelBubble = true;\r\n\r\n                            this.handleContextMenu(event);\r\n                        }}\r\n                        onClick={(event: KonvaEventObject<MouseEvent>) => {\r\n                            this.handleCancelContextMenu();\r\n                            KonvaForm.cancel();\r\n                        }}\r\n                        onDragStart={(event: KonvaEventObject<DragEvent>)  => {\r\n                            this.handleCancelContextMenu();\r\n                            KonvaForm.cancel();\r\n                        }}\r\n                        draggable>\r\n                        <PortalLayer id=\"edges-layer\">\r\n                        </PortalLayer>\r\n                        <Layer>\r\n                            {[...scriplet.getNodes()].map(item => {\r\n                            const schema = item.schema;\r\n                            if (!schema) {\r\n                                console.error(`The schema for node item '${item.id}' could not be found.`);\r\n                                return null;\r\n                            }\r\n                            const inputSlots = NodeConnections.getInputConnections(item.id);\r\n                            const inputFlowSlots = NodeConnections.getInputFlowConnections(item.id);\r\n                            return (\r\n                                <Group key={`node-${item.id}`}>\r\n                                    {inputSlots.map(conn => {\r\n                                    if (!conn)\r\n                                        return null;\r\n                                    const otherItem = scriplet.getNode(conn.itemId);\r\n                                    if (!otherItem) {\r\n                                        console.error(`The node item of id '${conn.itemId}' could not be found.`);\r\n                                        return null;\r\n                                    }\r\n                                    const otherSchema = otherItem.schema;\r\n                                    if (!otherSchema) {\r\n                                        console.error(`The schema for node item '${otherItem.id}' could not be found.`);\r\n                                        return null;\r\n                                    }\r\n                                    return(\r\n                                        <Portal key={`edge-${item.id}-${conn.id}-${conn.itemId}-${conn.slotId}`} \r\n                                                containerId=\"edges-layer\">\r\n                                            <Edge \r\n                                                startPos={{x: otherItem.x, y: otherItem.y + (conn.slotId * rowHeight) + topBarHeight}}\r\n                                                endPos={{x: item.x, y: item.y + (conn.id * rowHeight) + topBarHeight}}\r\n                                                nodeWidthOther={otherSchema.width}\r\n                                                nodeHeight={rowHeight}\r\n                                                handleOnClick={() => this.handleDeleteEdge(item.id, conn.id, conn.itemId, conn.slotId)}>\r\n                                                {(midpointPos, isHovered) => (\r\n                                                    <>\r\n                                                        <Rect visible={isHovered}\r\n                                                            x={midpointPos.x - 12}\r\n                                                            y={midpointPos.y - 10}\r\n                                                            width={24}\r\n                                                            height={16}\r\n                                                            fill={Colors.Gray[800]}\r\n                                                            listening={false} />\r\n                                                        <Text visible={isHovered}\r\n                                                            x={midpointPos.x - 12}\r\n                                                            y={midpointPos.y - 10}\r\n                                                            width={24}\r\n                                                            height={19}\r\n                                                            text=\"&#215;\"\r\n                                                            fontStyle=\"bold\"\r\n                                                            fontSize={20}\r\n                                                            align=\"center\"\r\n                                                            verticalAlign=\"middle\"\r\n                                                            fill={Colors.Gray[100]}\r\n                                                            listening={false} />\r\n                                                    </>\r\n                                                )}\r\n                                            </Edge>\r\n                                        </Portal>\r\n                                    );\r\n                                    })}\r\n                                    {inputFlowSlots.map(conn => {\r\n                                    if (!conn)\r\n                                        return null;\r\n                                    const otherItem = scriplet.getNode(conn.itemId);\r\n                                    if (!otherItem) {\r\n                                        console.error(`The item of id '${conn.itemId}' could not be found.`);\r\n                                        return null;\r\n                                    }\r\n                                    const otherSchema = otherItem.schema;\r\n                                    if (!otherSchema) {\r\n                                        console.error(`The schema for node item '${otherItem.id}' could not be found.`);\r\n                                        return null;\r\n                                    }\r\n                                    return(\r\n                                        <Portal key={`edge-flow-${item.id}-${conn.id}-${conn.itemId}-${conn.slotId}`} \r\n                                                containerId=\"edges-layer\">\r\n                                            <Edge \r\n                                                startPos={{x: otherItem.x, y: otherItem.y + (conn.slotId * rowHeight) + topBarHeight}}\r\n                                                endPos={{x: item.x, y: item.y + (conn.id * rowHeight) + topBarHeight}}\r\n                                                nodeWidthOther={otherSchema.width}\r\n                                                nodeHeight={rowHeight}\r\n                                                handleOnClick={() => this.handleDeleteFlowEdge(item.id, conn.id, conn.itemId, conn.slotId)}>\r\n                                                {(midpointPos, isHovered) => (\r\n                                                    <>\r\n                                                        <Rect visible={isHovered}\r\n                                                            x={midpointPos.x - 12}\r\n                                                            y={midpointPos.y - 10}\r\n                                                            width={24}\r\n                                                            height={16}\r\n                                                            fill={Colors.Gray[800]}\r\n                                                            listening={false} />\r\n                                                        <Text visible={isHovered}\r\n                                                            x={midpointPos.x - 12}\r\n                                                            y={midpointPos.y - 10}\r\n                                                            width={24}\r\n                                                            height={19}\r\n                                                            text=\"&#215;\"\r\n                                                            fontStyle=\"bold\"\r\n                                                            fontSize={20}\r\n                                                            align=\"center\"\r\n                                                            verticalAlign=\"middle\"\r\n                                                            fill={Colors.Gray[100]}\r\n                                                            listening={false} />\r\n                                                    </>\r\n                                                )}\r\n                                            </Edge>\r\n                                        </Portal>\r\n                                    );\r\n                                    })}\r\n                                    <Node item={item}\r\n                                        width={schema.width}\r\n                                        rowHeight={rowHeight}\r\n                                        topBarHeight={topBarHeight}\r\n                                        handleDragNode={this.handleDragNode}\r\n                                        deleteNodeItem={this.deleteNodeItem}\r\n                                        updateDOM={this.updateDOM} />\r\n                                </Group>\r\n                            );\r\n                            })}\r\n                        </Layer>\r\n                        <Layer data-name=\"context-menu-layer\">\r\n                        </Layer>\r\n                    </PortalStage>\r\n                    <SchemaSelector isVisible={isContextMenuShown} x={contextMenuPos.x} y={contextMenuPos.y} addNodeItem={this.addNodeItem} />\r\n                </div>\r\n                <CodeEditor scripletId={this.props.scripletId} \r\n                            addNodeItem={this.addNodeItem}\r\n                            resetView={this.resetView}\r\n                            zoomInView={this.zoomInView}\r\n                            zoomOutView={this.zoomOutView} />\r\n            </>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\nimport './assets/main.css';\r\n\r\nimport { library } from '@fortawesome/fontawesome-svg-core';\r\nimport { fas } from '@fortawesome/free-solid-svg-icons';\r\nimport { Switch, Route, useParams } from 'react-router-dom';\r\n\r\nimport SidebarNav from './components/SidebarNav';\r\nimport ScripletRoot from './components/ScripletRoot';\r\nimport CodeEditor from './components/CodeEditor';\r\n\r\nlibrary.add(fas);\r\n\r\nfunction App() {\r\n    return(\r\n        <div className=\"flex flex-col lg:flex-row\">\r\n            <SidebarNav />\r\n            <main>\r\n                <Switch>\r\n                    <Route path=\"/scriplet/:scripletId\">\r\n                        <ParamsProvider>\r\n                            {(scripletId) => (\r\n                                <>\r\n                                    <ScripletRoot scripletId={scripletId} />\r\n                                </>\r\n                            )}\r\n                        </ParamsProvider>\r\n                    </Route>\r\n                    <Route path=\"/\">\r\n                        <div className=\"p-6 flex justify-center items-center h-screen w-screen\">\r\n                            <h1 className=\"text-xl text-gray-600\">\r\n                                Please select a scriplet first.\r\n                            </h1>\r\n                        </div>\r\n                    </Route>\r\n                </Switch>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n\r\ntype ParamsProps = {\r\n    children?(scripletId: number): React.ReactNode | null;\r\n}\r\n\r\nfunction ParamsProvider({children}: ParamsProps): JSX.Element {\r\n    const { scripletId } = useParams();\r\n    return (\r\n        <>\r\n            {children != null ? children(parseInt(scripletId)) : null}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport { BrowserRouter } from 'react-router-dom';\n\nReactDOM.render(\n  <React.StrictMode>\n    <BrowserRouter basename=\"/vso\">\n      <App />\n    </BrowserRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}