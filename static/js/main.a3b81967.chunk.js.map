{"version":3,"sources":["extensions/array.extensions.ts","managers/ScripletManager.tsx","managers/NodeConnections.tsx","models/NodeSlot.ts","utils/Types.tsx","models/NodeSchema.ts","managers/NodeSchemaManager.tsx","managers/VariableManager.tsx","models/NodeItem.ts","models/Scriplet.ts","managers/VisualScriptingDB.ts","components/SidebarNav.tsx","utils/Colors.tsx","utils/KonvaUtils.ts","components/KonvaForm.tsx","managers/SlotConfigManager.ts","components/NodeHandle.tsx","components/NodeSlot.tsx","components/Node.tsx","components/Edge.tsx","managers/CategoryManager.ts","components/SchemaSelector.tsx","components/ScripletRoot.tsx","components/CodeEditor.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["Array","prototype","indexOfWhen","predicate","i","this","length","currentScriplet","id","VisualScriptingDB","getScriplet","then","scriplet","console","log","catch","error","inputItemId","inputSlotId","ScripletManager","inputItem","getNode","inputSlot","schema","inputSlots","find","entry","outputItemId","outputSlotId","outputItem","outputSlot","outputSlots","Map","isCorrectType","type","isConnectable","checkGraphCycleExists","checkFlowGraphCycleExists","otherOutput","getInputConnection","deleteConnection","itemId","slotId","setInputConnection","setOutputConnection","updateNodes","deleteInputConnection","deleteOutputConnection","toItem","some","result","conn","inputFlowSlot","inputFlowSlots","outputFlowSlot","outputFlowSlots","getInputFlowConnection","deleteFlowConnection","setInputFlowConnection","otherInput","getOutputFlowConnection","setOutputFlowConnection","deleteInputFlowConnection","deleteOutputFlowConnection","nodeItem","forEach","connectedTo","inputFlow","outputFlow","NodeSlot","name","TypedNodeSlot","InputSlot","defaultValue","item","value","otherSlot","NodeConnections","getOutputSlot","evaluate","OutputSlot","FlowNodeSlot","InputFlowSlot","returnToSlot","OutputFlowSlot","getInputFlowSlot","evaluateSlot","returnSlot","BaseSchemaTypes","Number","constructor","regex","match","parseInt","className","Boolean","Flow","nodeSchemas","schemaId","get","Error","createNew","values","AddSchema","target","origCtor","instantiate","args","newCtor","NodeSchemaManager","set","BaseNodeSchema","uniqueNamePrefix","width","isDeletable","Math","max","createNewSchema","Start","output1","goNext","StartFlowSchema","IfElse","input1","output2","thisSlot","getValue","IfElseSchema","ForLoop","outputFlow1","outputFlow2","input2","input3","input4","index","increment","start","end","returnTo","undefined","ForLoopSchema","WhileLoop","limit","counter","WhileLoopSchema","Input","InputSchema","Output","OutputSchema","Print","PrintSchema","AddNumbers","AddNumbersSchema","SubtractNumbers","SubtractNumbersSchema","MultiplyNumbers","MultiplyNumbersSchema","DivideNumbers","DivideNumbersSchema","typeCount","getBaseSchema","count","NodeItem","x","y","customName","variableName","VariableManager","getNextVariableName","getNewSchema","Object","defineProperties","enumerable","writable","filter","slot","push","pair","Scriplet","items","itemCounter","addNodes","reloadOnFinish","nodes","node","key","updateScriplet","window","location","reload","newNode","convertToNodeItem","deleteNodes","itemIds","delete","scriplets","version","stores","open","table","mapToClass","seedData","toArray","addScriplet","add","changes","update","where","equals","modify","ref","Dexie","SidebarNav","props","state","isNavMenuOpen","isSidebarOpen","openNavMenu","bind","closeNavMenu","toggleNavMenu","openSidebar","closeSidebar","toggleSidebar","handleOnScripletCreate","getScriplets","setState","to","icon","onClick","map","noScrollX","React","Component","Colors","Gray","100","200","300","400","500","600","700","800","900","Red","Orange","Yellow","Green","Teal","Blue","Indigo","Purple","Pink","KonvaUtils","event","cursorType","stage","getStage","container","style","cursor","KonvaForm","cancelInput","Dropdown","cancelDropdown","showInput","onHover","onHoverExit","height","fontSize","padding","textColor","hoverColor","borderRadius","zIndex","onChange","scale","scaleX","top","absolutePosition","left","input","document","createElement","body","appendChild","position","min","innerWidth","paddingLeft","color","backgroundColor","focus","onchange","ev","inputElement","setCursor","layer","currentTarget","getLayer","children","setAttr","draw","bgColor","fontStyle","onMouseEnter","onMouseLeave","cancelBubble","onTap","fill","cornerRadius","verticalAlign","text","parentNode","removeChild","defaultProps","HandleType","InputType","selectedIndex","showDropdown","dropdown","option","innerText","dropdownElement","configs","numberConfig","handleType","Circle","handleBorderColor","handleFillColor","inputType","defaultInputValue","initialValue","fromString","convertFromString","toString","convertToString","booleanConfig","flowConfig","Arrow","None","NodeHandle","startPosition","onDragStart","onDragMove","onDragEnd","onMouseExit","cancel","thisCircle","parent","startPos","getPosition","endPos","pathData","path","Konva","Path","data","stroke","strokeWidth","isInput","midpointPos","isFlow","onConnect","destroy","pointerPos","getPointerPosition","screenX","floor","screenY","elements","getAllIntersections","element","otherItemId","otherSlotId","elem","getAttr","slotType","radius","listening","data-type","data-slot-type","data-item-id","data-slot-id","draggable","InputSlotDOM","label","createRef","labelWidth","typeWidth","onInputChanged","current","onInputChange","config","SlotConfigManager","getConfig","val","inputConnection","OutputSlotDOM","outputConnections","offsetX","align","InputFlowSlotDOM","inputFlowConnection","OutputFlowSlotDOM","outputFlowConnection","Node","group","draggedHandlePath","isStateOpen","stateVisual","rowHeight","topBarHeight","handleDragNode","deleteNodeItem","updateDOM","maxLength","inputs","concat","outputs","inputTypeGuard","outputTypeGuard","output","from","it","Fragment","addConnection","getOutputConnections","addFlowConnection","Edge","isHovered","handleOnEnter","handleOnExit","nodeWidthOutput","nodeWidthOther","nodeHeight","handleOnClick","halfNodeHeight","onMouseDown","onTouchEnd","Category","subCategories","contentChildren","subCategory","cat","schemas","categoryRoot","currentCategory","idArr","split","getSubCategory","addContent","SchemaCategory","showChildren","toggleCategory","openCategory","closeCategory","category","depth","addNodeItem","toLowerCase","marginLeft","borderColor","child","stopPropagation","SchemaSelector","searchValue","schemaResults","getBaseSchemas","onSearchChange","onSearchReset","filterSearch","includes","isVisible","rootCategory","CategoryManager","getRootSchemaCategory","innerHeight","ScripletRoot","stageContainer","isDirtyDOM","isReadyToMount","isReady","contextMenu","isContextMenuShown","contextMenuPos","nodeInitPos","handleDeleteEdge","handleDeleteFlowEdge","handleZoom","handleContextMenu","handleCancelContextMenu","fitToParent","selectScriplet","scripletId","removeEventListener","addEventListener","FontFaceObserver","load","addNode","deleteAllConnections","deleteNode","evt","preventDefault","oldScale","pointer","mousePosition","newScale","deltaY","newPos","batchDraw","getType","getChildren","scaleY","pageX","pageY","stageObj","offsetWidth","offsetHeight","onWheel","onContextMenu","getNodes","getInputConnections","getInputFlowConnections","otherItem","otherSchema","containerId","visible","data-name","require","jsbeautify","js_beautify","CodeEditor","codeResult","editorValue","indent_size","isCodeOpen","screenWidth","setScreenWidth","handleRun","handleBeautifyCode","handleEvaluateNodes","openCode","closeCode","toggleCode","startSchema","getStart","startSlot","prevState","options","mode","theme","lineNumbers","onBeforeChange","editor","ParamsProvider","useParams","library","fas","App","hostname","ReactDOM","render","StrictMode","basename","getElementById","navigator","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.a3b81967.chunk.js","sourcesContent":["declare global {\r\n    interface Array<T> {\r\n        removeIf(predicate: (input: T) => boolean): any;\r\n        indexOfWhen(predicate: (input: T) => boolean): any;\r\n    }\r\n}\r\n\r\nArray.prototype.indexOfWhen = function(predicate) {\r\n    let i = 0;\r\n    while (i < this.length) {\r\n        if (predicate(this[i]))\r\n            return i;\r\n        i++;\r\n    }\r\n}\r\n\r\nexport {};","import { Scriplet } from \"../models/Scriplet\";\r\nimport VisualScriptingDB from \"./VisualScriptingDB\";\r\n\r\nclass ScripletManager {\r\n    public currentScriplet: Scriplet | undefined;\r\n\r\n    // Current Scriplet can be undefined if none was selected yet\r\n    async selectScriplet(id: number): Promise<boolean> {\r\n        return await VisualScriptingDB.getScriplet(id).then(scriplet => {\r\n            console.log(scriplet);\r\n            this.currentScriplet = scriplet;\r\n            return true;\r\n        }).catch(error => {\r\n            console.error(`Something went wrong when getting the scriplet of id '${id}'. Error: ${error}`);\r\n            return false;\r\n        });\r\n    }\r\n}\r\n\r\nexport default new ScripletManager();","import '../extensions/array.extensions';\r\nimport ScripletManager from './ScripletManager';\r\nimport { InputSlot, OutputSlot, InputFlowSlot, OutputFlowSlot, ItemSlotPair } from '../models/NodeSlot';\r\n\r\nexport class NodeConnection {\r\n    public inputId: number;\r\n    public inputIO: number;\r\n    public outputId: number;\r\n    public outputIO: number;\r\n\r\n    constructor(inputId: number, inputIO: number, outputId: number, outputIO: number) {\r\n        this.inputId = inputId;\r\n        this.inputIO = inputIO;\r\n        this.outputId = outputId;\r\n        this.outputIO = outputIO;\r\n\r\n        this.equals = this.equals.bind(this);\r\n    }\r\n\r\n    equals(conn: NodeConnection): boolean {\r\n        return conn.inputId === this.inputId && conn.inputIO === this.inputIO && conn.outputId === this.outputId && conn.outputIO === this.outputIO;\r\n    }\r\n}\r\n\r\n// TODO: Repurpose this to store ids on the node items themselves\r\nclass NodeConnections {\r\n    getInputSlot(inputItemId: number, inputSlotId: number): InputSlot | undefined {      \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputSlot = inputItem.schema?.inputSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputSlot) {\r\n            console.error(`The input slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return inputSlot;\r\n    }\r\n\r\n    getInputSlots(inputItemId: number): InputSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputSlots = inputItem.schema?.inputSlots;\r\n        if (!inputSlots) {\r\n            console.error(`The schema of node item '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputSlots;\r\n    }\r\n\r\n    getInputConnections(inputItemId: number): ItemSlotPair[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputItem.inputSlots;\r\n    }\r\n\r\n    getOutputSlot(outputItemId: number, outputSlotId: number): OutputSlot | undefined {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputSlot = outputItem.schema?.outputSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputSlot) {\r\n            console.error(`The input slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return outputSlot;\r\n    }\r\n\r\n    getOutputSlots(outputItemId: number): OutputSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputSlots = outputItem.schema?.outputSlots;\r\n        if (!outputSlots) {\r\n            console.error(`The schema of node item '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return outputSlots;\r\n    }\r\n\r\n    getOutputConnections(outputItemId: number): Map<number, ItemSlotPair[]> {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return new Map<number, ItemSlotPair[]>();\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return new Map<number, ItemSlotPair[]>();\r\n        }\r\n\r\n        return outputItem.outputSlots;\r\n    }\r\n\r\n    addConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        if (inputItemId === outputItemId) {\r\n            console.error(`When adding connections, the input item id cannot be the same as the output item id.`);\r\n            return;\r\n        }\r\n        \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputSlot = inputItem.schema?.inputSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputSlot) {\r\n            console.error(`The input slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputSlot = outputItem.schema?.outputSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputSlot) {\r\n            console.error(`The output slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        if (!inputSlot.isCorrectType(outputSlot.type))\r\n            return;\r\n\r\n        if (!inputSlot.isConnectable)\r\n            return;\r\n\r\n        // TODO: Check graph cycle here\r\n        if (this.checkGraphCycleExists(inputItemId, outputItemId) || this.checkFlowGraphCycleExists(inputItemId, outputItemId)) {\r\n            console.error(`Cycle detected from ${inputItemId} to ${outputItemId}.`);\r\n            return;\r\n        }\r\n\r\n        const otherOutput = inputItem.getInputConnection(inputSlot.id);\r\n        if (otherOutput)\r\n            this.deleteConnection(inputItemId, inputSlotId, otherOutput.itemId, otherOutput.slotId);\r\n        \r\n        inputItem.setInputConnection(inputSlot.id, outputItemId, outputSlotId);\r\n        outputItem.setOutputConnection(outputSlot.id, inputItemId, inputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n\r\n        /*\r\n        const found = outputSlot.connectedToInputs.find(pair => pair.itemId === inputItemId && pair.slotId === inputSlotId);\r\n        if (!found)\r\n            outputSlot.connectedToInputs.push({id: outputSlot.id, itemId: inputItemId, slotId: inputSlotId});\r\n        */\r\n    }\r\n\r\n    deleteConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputSlot = inputItem.schema?.inputSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputSlot) {\r\n            console.error(`The input slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputSlot = outputItem.schema?.outputSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputSlot) {\r\n            console.error(`The input slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        /*\r\n        inputSlot.connectedToOutput = undefined;\r\n        outputSlot.connectedToInputs.removeIf(entry => entry.itemId === inputItemId && entry.slotId === inputSlotId);\r\n        */\r\n\r\n        inputItem.deleteInputConnection(inputSlotId);\r\n        outputItem.deleteOutputConnection(outputSlotId, inputItemId, inputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n    }\r\n\r\n    private checkGraphCycleExists(inputItemId: number, outputItemId: number): boolean {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return true; // True is negative in this case\r\n        }\r\n\r\n        const toItem = scriplet.getNode(outputItemId);\r\n        if (!toItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return true;\r\n        }\r\n\r\n        if (toItem.inputSlots.length <= 0)\r\n            return false;\r\n        if (toItem.inputSlots.some(entry => entry.itemId === inputItemId))\r\n            return true;\r\n\r\n        var result = false;\r\n\r\n        for (var i = 0; i < toItem.inputSlots.length; i++) {\r\n            const conn = toItem.inputSlots[i];\r\n            if (!conn)\r\n                continue;\r\n            const id = conn.itemId;\r\n            result = this.checkGraphCycleExists(inputItemId, id);\r\n            if (result)\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    getInputFlowSlot(inputItemId: number, inputSlotId: number): InputFlowSlot | undefined {      \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputFlowSlot = inputItem.schema?.inputFlowSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputFlowSlot) {\r\n            console.error(`The input flow slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return inputFlowSlot;\r\n    }\r\n\r\n    getInputFlowSlots(inputItemId: number): InputFlowSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputFlowSlots = inputItem.schema?.inputFlowSlots;\r\n        if (!inputFlowSlots) {\r\n            console.error(`The schema of node item '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputFlowSlots;\r\n    }\r\n\r\n    getInputFlowConnections(inputItemId: number): ItemSlotPair[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return inputItem.inputFlowSlots;\r\n    }\r\n\r\n    getOutputFlowSlot(outputItemId: number, outputSlotId: number): OutputFlowSlot | undefined {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputFlowSlot = outputItem.schema?.outputFlowSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputFlowSlot) {\r\n            console.error(`The input flow slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        return outputFlowSlot;\r\n    }\r\n\r\n    getOutputFlowSlots(outputItemId: number): OutputFlowSlot[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputFlowSlots = outputItem.schema?.outputFlowSlots;\r\n        if (!outputFlowSlots) {\r\n            console.error(`The schema of node item '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return outputFlowSlots;\r\n    }\r\n\r\n    getOutputFlowConnections(outputItemId: number): ItemSlotPair[] {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return [];\r\n        }\r\n\r\n        return outputItem.outputFlowSlots;\r\n    }\r\n    \r\n    addFlowConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        if (inputItemId === outputItemId) {\r\n            console.error(`When adding connections, the input item id cannot be the same as the output item id.`);\r\n            return;\r\n        }\r\n        \r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputFlowSlot = inputItem.schema?.inputFlowSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputFlowSlot) {\r\n            console.error(`The input flow slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputFlowSlot = outputItem.schema?.outputFlowSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputFlowSlot) {\r\n            console.error(`The input flow slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        if (!inputFlowSlot.isConnectable)\r\n            return;\r\n\r\n        // TODO: Check graph cycle here\r\n        if (this.checkFlowGraphCycleExists(inputItemId, outputItemId) || this.checkGraphCycleExists(inputItemId, outputItemId)) {\r\n            console.error(`Cycle detected from ${inputItemId} to ${outputItemId}.`);\r\n            return;\r\n        }\r\n\r\n        const otherOutput = inputItem.getInputFlowConnection(inputSlotId);\r\n        if (otherOutput)\r\n            this.deleteFlowConnection(inputItemId, inputSlotId, otherOutput.itemId, otherOutput.slotId);\r\n        \r\n        inputItem.setInputFlowConnection(inputFlowSlot.id, outputItemId, outputSlotId);\r\n        \r\n        const otherInput = outputItem.getOutputFlowConnection(outputSlotId);\r\n        if (otherInput)\r\n            this.deleteFlowConnection(otherInput.itemId, otherInput.slotId, outputItemId, outputSlotId);\r\n        \r\n        outputItem.setOutputFlowConnection(outputFlowSlot.id, inputItemId, inputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n    }\r\n\r\n    deleteFlowConnection(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputItem = scriplet.getNode(inputItemId);\r\n        if (!inputItem) {\r\n            console.error(`The node item of id '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const inputFlowSlot = inputItem.schema?.inputFlowSlots.find(entry => entry.id === inputSlotId);\r\n        if (!inputFlowSlot) {\r\n            console.error(`The input flow slot of id '${inputSlotId}' from node item '${inputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputItem = scriplet.getNode(outputItemId);\r\n        if (!outputItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const outputFlowSlot = outputItem.schema?.outputFlowSlots.find(entry => entry.id === outputSlotId);\r\n        if (!outputFlowSlot) {\r\n            console.error(`The input flow slot of id '${outputSlotId}' from node item '${outputItemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        inputItem.deleteInputFlowConnection(inputSlotId);\r\n        outputItem.deleteOutputFlowConnection(outputSlotId);\r\n\r\n        scriplet.updateNodes();\r\n    }\r\n\r\n    private checkFlowGraphCycleExists(inputItemId: number, outputItemId: number): boolean {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return true; // True is negative in this case\r\n        }\r\n\r\n        const toItem = scriplet.getNode(outputItemId);\r\n        if (!toItem) {\r\n            console.error(`The node item of id '${outputItemId}' could not be found.`);\r\n            return true;\r\n        }\r\n\r\n        if (toItem.inputFlowSlots.length <= 0)\r\n            return false;\r\n        if (toItem.inputFlowSlots.some(entry => entry.itemId === inputItemId))\r\n            return true;\r\n\r\n        var result = false;\r\n\r\n        for (var i = 0; i < toItem.inputFlowSlots.length; i++) {\r\n            const conn = toItem.inputFlowSlots[i];\r\n            if (!conn)\r\n                continue;\r\n            const id = conn.itemId;\r\n            result = this.checkGraphCycleExists(inputItemId, id);\r\n            if (result)\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    deleteAllConnections(itemId: number): boolean {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return false;\r\n        }\r\n\r\n        const nodeItem = scriplet.getNode(itemId);\r\n        if (!nodeItem) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return false;\r\n        }\r\n\r\n        nodeItem.outputSlots.forEach(outputSlot => {\r\n            outputSlot.forEach(connectedTo => {\r\n                this.deleteConnection(connectedTo.itemId, connectedTo.slotId, itemId, connectedTo.id);\r\n            });\r\n        });\r\n\r\n        nodeItem.inputSlots.forEach(inputSlot => {\r\n            if (!inputSlot)\r\n                return;\r\n\r\n            this.deleteConnection(itemId, inputSlot.id, inputSlot.itemId, inputSlot.slotId);\r\n        });\r\n\r\n        nodeItem.inputFlowSlots.forEach(inputFlow => {\r\n            if (!inputFlow)\r\n                return;\r\n\r\n            this.deleteFlowConnection(itemId, inputFlow.id, inputFlow.itemId, inputFlow.slotId);\r\n        });\r\n\r\n        nodeItem.outputFlowSlots.forEach(outputFlow => {\r\n            if (!outputFlow)\r\n                return;\r\n            \r\n            this.deleteFlowConnection(outputFlow.itemId, outputFlow.slotId, itemId, outputFlow.id);\r\n        });\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nexport default new NodeConnections();","import NodeConnections from \"../managers/NodeConnections\";\r\nimport ScripletManager from \"../managers/ScripletManager\";\r\n\r\nexport type ItemSlotPair = {\r\n    id: number;\r\n    itemId: number;\r\n    slotId: number;\r\n}\r\n\r\nexport abstract class NodeSlot {\r\n    public id: number;\r\n    public name?: string;\r\n\r\n    constructor(id: number, name?: string) {\r\n        this.id = id;\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport abstract class TypedNodeSlot extends NodeSlot {\r\n    public type: string;\r\n\r\n    constructor(id: number, type: string, name?: string) {\r\n        super(id, name);\r\n        this.type = type;\r\n    }\r\n\r\n    isCorrectType(type: string): boolean {\r\n        if (this.type === type)\r\n            return true;\r\n        return false;\r\n    }\r\n}\r\n\r\nexport class InputSlot extends TypedNodeSlot {\r\n    //public connectedToOutput: ItemSlotPair | undefined;\r\n    // TODO: This value should also be serialized to db.\r\n    public defaultValue: any;\r\n    public isConnectable: boolean;\r\n\r\n    constructor(id: number, type: string, defaultValue: any, isConnectable?: boolean, name?: string) {\r\n        super(id, type, name);\r\n        this.defaultValue = defaultValue;\r\n        this.isConnectable = isConnectable ?? true;\r\n    }\r\n\r\n    getValue(itemId: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const connectedTo = item.getInputConnection(this.id);\r\n        if (!connectedTo)\r\n            return item.value ?? this.defaultValue;\r\n\r\n        const otherSlot = NodeConnections.getOutputSlot(connectedTo.itemId, connectedTo.slotId);\r\n        if (!otherSlot) {\r\n            console.error(`The output slot '${connectedTo.slotId}' of node item '${connectedTo.itemId}' could not be found.`);\r\n            return item.value ?? this.defaultValue;\r\n        }\r\n\r\n        return otherSlot.evaluate();\r\n    }\r\n}\r\n\r\n// TODO: Flow output slots cannot be connected to multiple Flow input slots\r\nexport class OutputSlot extends TypedNodeSlot {\r\n    //public connectedToInputs: ItemSlotPair[] = [];\r\n    public evaluate: () => any;\r\n\r\n    constructor(id: number, type: string, evaluate: () => any, name?: string) {\r\n        super(id, type, name);\r\n        this.evaluate = evaluate;\r\n    }\r\n}\r\n\r\nexport abstract class FlowNodeSlot extends NodeSlot { }\r\n\r\nexport class InputFlowSlot extends FlowNodeSlot {\r\n    //public connectedToOutput: ItemSlotPair | undefined;\r\n    public isConnectable: boolean;\r\n    private evaluate: (thisSlot: InputFlowSlot, returnToSlot?: ItemSlotPair) => any;\r\n\r\n    public returnToSlot: ItemSlotPair | undefined;\r\n\r\n    constructor(id: number, evaluate: (thisSlot: InputFlowSlot, returnToSlot?: ItemSlotPair) => any, isConnectable?: boolean, name?: string) {\r\n        super(id, name);\r\n        this.evaluate = evaluate;\r\n        this.isConnectable = isConnectable ?? true;\r\n    }\r\n\r\n    evaluateSlot(returnToSlot?: ItemSlotPair) {\r\n        this.evaluate(this, returnToSlot);\r\n    }\r\n}\r\n\r\nexport class OutputFlowSlot extends FlowNodeSlot {\r\n    //public connectedToInput: ItemSlotPair | undefined;\r\n\r\n    goNext(itemId: number, returnToSlot?: ItemSlotPair) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const connectedTo = item.getOutputFlowConnection(this.id);\r\n        if (connectedTo) {\r\n            const inputSlot = NodeConnections.getInputFlowSlot(connectedTo.itemId, connectedTo.slotId);\r\n            if (!inputSlot) {\r\n                console.error(`The input flow slot '${connectedTo.slotId}' of node item '${connectedTo.itemId}' could not be found.`)\r\n                return;\r\n            }\r\n\r\n            inputSlot.evaluateSlot(returnToSlot);\r\n            return;\r\n        }\r\n\r\n        if (returnToSlot) {\r\n            // Return to where the returnToSlot points to\r\n            const returnSlot = NodeConnections.getInputFlowSlot(returnToSlot.itemId, returnToSlot.slotId);\r\n            if (!returnSlot) {\r\n                console.error(`The input flow slot '${returnToSlot.slotId}' of node item '${returnToSlot.itemId}' could not be found.`)\r\n                return;\r\n            }\r\n\r\n            returnSlot.evaluateSlot();\r\n            return;\r\n        }\r\n    }\r\n}","export interface IAssignable<T> {\r\n    value: T;\r\n}\r\n\r\nexport interface IAssignableStatic<T> {\r\n    defaultValue: T;\r\n}\r\n\r\nexport interface IConvertible<T> {\r\n    fromString(value: string): void;\r\n    toString(): string;\r\n}\r\n\r\nexport interface IConvertibleStatic<T> {\r\n    convertFromString(value: string): T | undefined;\r\n    convertToString(value: T): string;\r\n}\r\n\r\nexport interface INamedClassStatic {\r\n    className: string;\r\n}\r\n\r\nexport function staticImplements<T>() {\r\n    return <U extends T>(constructor: U) => { return constructor; };\r\n}\r\n\r\n// TODO: Implement type converters\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<number>>()\r\n@staticImplements<IConvertibleStatic<number>>()\r\nexport class Number implements IAssignable<number> {\r\n    public static className: string = \"Number\";\r\n    public static defaultValue: number = 0;\r\n\r\n    public value: number;\r\n    \r\n    constructor(value: number) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): number | undefined {\r\n        // TODO: Use regex to check input\r\n        const regex = \"^(-[1-9][0-9]*)|([0-9]+)$\";\r\n        const val = value.match(regex);\r\n        if (!val) {\r\n            console.error(`The input doesn't match the regex '${regex}'.`);\r\n            return;\r\n        }\r\n\r\n        return parseInt(value);\r\n    }\r\n\r\n    public static convertToString(value: number): string {\r\n        return `${value}`;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<string>>()\r\n@staticImplements<IConvertibleStatic<string>>()\r\nexport class String implements IAssignable<string> {\r\n    public static className: string = \"String\";\r\n    public static defaultValue: string = \"\";\r\n\r\n    public value: string;\r\n\r\n    constructor(value: string) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): string | undefined {\r\n        return value;\r\n    }\r\n\r\n    public static convertToString(value: string): string {\r\n        return value;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<boolean>>()\r\n@staticImplements<IConvertibleStatic<boolean>>()\r\nexport class Boolean implements IAssignable<boolean> {\r\n    public static className: string = \"Boolean\";\r\n    public static defaultValue: boolean = false;\r\n\r\n    public value: boolean;\r\n\r\n    constructor(value: boolean) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): boolean | undefined {\r\n        return value === \"true\" ? true : false;\r\n    }\r\n\r\n    public static convertToString(value: boolean): string {\r\n        return `${value}`;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<number>>()\r\n@staticImplements<IConvertibleStatic<number>>()\r\nexport class Flow implements IAssignable<number> {\r\n    public static className: string = \"Flow\";\r\n    public static defaultValue: number = -1;\r\n\r\n    public value: number;\r\n    \r\n    constructor(value: number) {\r\n        this.value = value;\r\n    }\r\n\r\n    public static convertFromString(value: string): number | undefined {\r\n        // TODO: Use regex to check input\r\n        const regex = \"^([0-9]+)$\";\r\n        const val = value.match(regex);\r\n        if (!val) {\r\n            console.error(`The input doesn't match the regex '${regex}'.`);\r\n            return;\r\n        }\r\n\r\n        return parseInt(value);\r\n    }\r\n\r\n    public static convertToString(value: number): string {\r\n        return `${value}`;\r\n    }\r\n}\r\n\r\n@staticImplements<INamedClassStatic>()\r\n@staticImplements<IAssignableStatic<any>>()\r\nexport class Any implements IAssignable<any> {\r\n    public static className: string = \"Any\";\r\n    public static defaultValue: any;\r\n\r\n    public value: any;\r\n\r\n    constructor(value: any) {\r\n        this.value = value;\r\n    }\r\n}","import { OutputSlot, InputSlot, InputFlowSlot, OutputFlowSlot } from \"./NodeSlot\";\r\nimport { Number, Boolean } from \"../utils/Types\";\r\nimport NodeSchemaManager from \"../managers/NodeSchemaManager\";\r\n\r\nfunction AddSchema(target: Function) {\r\n    const origCtor = target;\r\n\r\n    function instantiate(constructor: any, ...args: any[]) {\r\n        return new constructor(...args);\r\n    }\r\n\r\n    const newCtor = function(...args: any[]) {\r\n        return instantiate(origCtor, ...args);\r\n    };\r\n\r\n    newCtor.prototype = origCtor.prototype;\r\n\r\n    const schema = newCtor() as BaseNodeSchema;\r\n    NodeSchemaManager.nodeSchemas.set(schema.id, schema.createNew(-1));\r\n}\r\n\r\nexport enum BaseSchemaTypes {\r\n    Start = \"Hidden/Start\",\r\n    IfElse = \"Base/ControlFlow/IfElse\",\r\n    ForLoop = \"Base/ControlFlow/ForLoop\",\r\n    WhileLoop = \"Base/ControlFlow/WhileLoop\",\r\n    Input = \"Hidden/Input\",\r\n    Output = \"Hidden/Output\",\r\n    Print = \"Base/Debug/Print\",\r\n    AddNumbers = \"Base/Math/AddNumbers\",\r\n    SubtractNumbers = \"Base/Math/SubtractNumbers\",\r\n    MultiplyNumbers = \"Base/Math/MultiplyNumbers\",\r\n    DivideNumbers = \"Base/Math/DivideNumbers\"\r\n}\r\n\r\n// TODO: Possibly move all these things to a config file that is read by these and behavior is filled in\r\nexport abstract class BaseNodeSchema {\r\n    readonly id: string;\r\n    readonly name: string;\r\n    readonly uniqueNamePrefix: string;\r\n    readonly width: number;\r\n    //readonly hasVariable: boolean;\r\n    readonly inputFlowSlots: InputFlowSlot[];\r\n    readonly outputFlowSlots: OutputFlowSlot[];\r\n    readonly inputSlots: InputSlot[];\r\n    readonly outputSlots: OutputSlot[];\r\n\r\n    readonly isDeletable: boolean;\r\n\r\n    itemId: number = -1;\r\n\r\n    protected abstract createNewSchema(): BaseNodeSchema;\r\n\r\n    constructor(id: string, name: string, uniqueNamePrefix: string, width: number, inputFlowSlots: InputFlowSlot[], outputFlowSlots: OutputFlowSlot[], inputSlots: InputSlot[], outputSlots: OutputSlot[], isDeletable: boolean = true) {\r\n        this.id = id;\r\n        this.name = name;\r\n        this.uniqueNamePrefix = uniqueNamePrefix;\r\n        this.width = width;\r\n        this.inputFlowSlots = inputFlowSlots;\r\n        this.outputFlowSlots = outputFlowSlots;\r\n        this.inputSlots = inputSlots;\r\n        this.outputSlots = outputSlots;\r\n\r\n        this.isDeletable = isDeletable;\r\n    }\r\n\r\n    maxLength(): number {\r\n        return Math.max(this.inputFlowSlots.length + this.inputSlots.length, this.outputFlowSlots.length + this.outputSlots.length);\r\n    }\r\n\r\n    createNew(itemId: number): BaseNodeSchema {\r\n        const schema = this.createNewSchema();\r\n        schema.itemId = itemId;\r\n        return schema;\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class StartFlowSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.Start;\r\n        const name = \"Start\";\r\n        const uniqueNamePrefix = \"start\";\r\n\r\n        const output1 = new OutputFlowSlot(0, \"Body\");\r\n        const outputFlowSlots = [output1];\r\n        const inputFlowSlots: InputFlowSlot[] = [new InputFlowSlot(0, () => {\r\n            output1.goNext(this.itemId);\r\n        }, false, \" \")];\r\n\r\n        super(id, name, uniqueNamePrefix, 120, inputFlowSlots, outputFlowSlots, [], [], false);\r\n    }\r\n\r\n    createNewSchema(): StartFlowSchema {\r\n        return new StartFlowSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class IfElseSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.IfElse;\r\n        const name = \"If/Else\";\r\n        const uniqueNamePrefix = \"ifElse\";\r\n\r\n        const input1 = new InputSlot(1, Boolean.className, Boolean.defaultValue, true, \"Condition\");\r\n        const inputSlots = [input1];\r\n\r\n        const output1 = new OutputFlowSlot(0, \"True\");\r\n        const output2 = new OutputFlowSlot(1, \"False\");\r\n        const outputFlowSlots = [output1, output2];\r\n\r\n        const inputFlowSlots = [new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            if (input1.getValue(this.itemId) === true)\r\n                output1.goNext(this.itemId, returnToSlot)\r\n            else\r\n                output2.goNext(this.itemId, returnToSlot);\r\n        }, true, \"Entry\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 220, inputFlowSlots, outputFlowSlots, inputSlots, []);\r\n    }\r\n\r\n    createNewSchema(): IfElseSchema {\r\n        return new IfElseSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class ForLoopSchema extends BaseNodeSchema {\r\n    private start: number | undefined;\r\n    private end: number | undefined;\r\n    private increment: number | undefined;\r\n    private index: number;\r\n\r\n    constructor() {\r\n        const id = BaseSchemaTypes.ForLoop;\r\n        const name = \"For Loop\";\r\n        const uniqueNamePrefix = \"forLoop\";\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Body\");\r\n        const outputFlow2 = new OutputFlowSlot(1, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1, outputFlow2];\r\n\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue, true, \"Start\");\r\n        const input3 = new InputSlot(2, Number.className, 10, true, \"End\");\r\n        const input4 = new InputSlot(3, Number.className, 1, true, \"Increment\");\r\n        const inputSlots = [input2, input3, input4];\r\n\r\n        const output3 = new OutputSlot(2, Number.className, () => {\r\n            // TODO: Kinda hackish to solve the problem below\r\n            return this.index - (this.increment ?? 1);\r\n        }, \"Index\");\r\n        const outputSlots = [output3];\r\n\r\n        const inputFlowSlots = [new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            if (!thisSlot.returnToSlot)\r\n                thisSlot.returnToSlot = returnToSlot;\r\n            if (this.start == null || this.end == null || this.increment == null) {\r\n                this.start = input2.getValue(this.itemId);\r\n                this.end = input3.getValue(this.itemId);\r\n                this.increment = input4.getValue(this.itemId);\r\n                this.index = this.start ?? 0;\r\n            }\r\n            \r\n            if (this.index < (this.end ?? 0)) {\r\n                // TODO: This should really increment only after everything else is done.\r\n                this.index += this.increment ?? 1;\r\n                outputFlow1.goNext(this.itemId, {id: -1, itemId: this.itemId, slotId: thisSlot.id});\r\n            } else {\r\n                const returnTo = thisSlot.returnToSlot;\r\n                thisSlot.returnToSlot = undefined;\r\n                this.index = 0;\r\n                this.start = undefined;\r\n                this.end = undefined;\r\n                outputFlow2.goNext(this.itemId, returnTo);\r\n            }\r\n        }, true, \"Entry\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n        this.index = 0;\r\n    }\r\n\r\n    createNewSchema(): ForLoopSchema {\r\n        return new ForLoopSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class WhileLoopSchema extends BaseNodeSchema {\r\n    // This limit is so the while loop will still halt at some point instead of \r\n    // freezing the entire app. Can be set to 0 to run forever.\r\n    private limit: number | undefined;\r\n    private counter: number;\r\n    constructor() {\r\n        const id = BaseSchemaTypes.WhileLoop;\r\n        const name = \"While Loop\";\r\n        const uniqueNamePrefix = \"whileLoop\";\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Body\");\r\n        const outputFlow2 = new OutputFlowSlot(1, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1, outputFlow2];\r\n\r\n        const input1 = new InputSlot(1, Boolean.className, Boolean.defaultValue, true, \"Condition\");\r\n        const input2 = new InputSlot(2, Number.className, 10000, true, \"Limit\");\r\n        const inputSlots = [input1, input2];\r\n\r\n        const outputSlots: OutputSlot[] = [];\r\n\r\n        const inputFlowSlots = [new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            if (!thisSlot.returnToSlot)\r\n                thisSlot.returnToSlot = returnToSlot;\r\n            if (this.limit == null) {\r\n                this.limit = input2.getValue(this.itemId);\r\n            }\r\n            \r\n            if (this.limit == null)\r\n                console.error(`The limit of while loop of id '${this.itemId}' is undefined, therefore this while loop won't run. Set it to 0 if it is intended to run forever.`);\r\n\r\n            if (input1.getValue(this.itemId) && this.limit != null && this.counter < (this.limit <= 0 ? 1 : this.limit)) {\r\n                if (this.limit > 0)\r\n                    this.counter += 1;\r\n\r\n                outputFlow1.goNext(this.itemId, {id: -1, itemId: this.itemId, slotId: thisSlot.id});\r\n            } else {\r\n                const returnTo = thisSlot.returnToSlot;\r\n                thisSlot.returnToSlot = undefined;\r\n                this.counter = 0;\r\n                this.limit = undefined;\r\n                outputFlow2.goNext(this.itemId, returnTo);\r\n            }\r\n        }, true, \"Entry\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n        this.counter = 0;\r\n    }\r\n\r\n    createNewSchema(): WhileLoopSchema {\r\n        return new WhileLoopSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class InputSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.Input;\r\n        const name = \"Input\";\r\n        const uniqueNamePrefix = \"input\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue, false);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(this.itemId);\r\n        })];\r\n\r\n        super(id, name, uniqueNamePrefix, 190, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(): InputSchema {\r\n        return new InputSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class OutputSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.Output;\r\n        const name = \"Output\";\r\n        const uniqueNamePrefix = \"output\";\r\n        const inputSlots = [new InputSlot(0, Number.className, Number.defaultValue)];\r\n        const outputSlots: OutputSlot[] = [];\r\n\r\n        super(id, name, uniqueNamePrefix, 120, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(): OutputSchema {\r\n        return new OutputSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class PrintSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.Print;\r\n        const name = \"Print\";\r\n        const uniqueNamePrefix = \"print\";\r\n\r\n        const input1 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1];\r\n        const outputSlots = [new OutputSlot(1, Number.className, () => {\r\n            return input1.getValue(this.itemId);\r\n        })];\r\n\r\n        const outputFlow1 = new OutputFlowSlot(0, \"Exit\");\r\n        const outputFlowSlots = [outputFlow1];\r\n        const inputFlow1 = new InputFlowSlot(0, (thisSlot, returnToSlot) => {\r\n            console.log(input1.getValue(this.itemId));\r\n            outputFlow1.goNext(this.itemId, returnToSlot);\r\n        }, true, \"Entry\");\r\n        const inputFlowSlots = [inputFlow1];\r\n\r\n        super(id, name, uniqueNamePrefix, 205, inputFlowSlots, outputFlowSlots, inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(): PrintSchema {\r\n        return new PrintSchema();\r\n    }\r\n}\r\n\r\n// The base class for all addition \r\n// We have two choices:\r\n// - Extend from this AddSchema to make addition nodes for different object types\r\n//   - Can customize every aspect of the node\r\n// - Create a universal way to add same-typed objects together through interfaces\r\n//   - Will only need one universal addition node that uses the interface to add objects\r\n@AddSchema\r\nexport class AddNumbersSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.AddNumbers;\r\n        const name = \"Add Numbers\";\r\n        const uniqueNamePrefix = \"addNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            // TODO: Type check maybe?\r\n            return input1.getValue(this.itemId) + input2.getValue(this.itemId);\r\n        }, \"Sum\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 200, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(): AddNumbersSchema {\r\n        return new AddNumbersSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class SubtractNumbersSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.SubtractNumbers;\r\n        const name = \"Subtract Numbers\";\r\n        const uniqueNamePrefix = \"subtractNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(this.itemId) - input2.getValue(this.itemId);\r\n        }, \"Difference\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 220, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(): SubtractNumbersSchema {\r\n        return new SubtractNumbersSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class MultiplyNumbersSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.MultiplyNumbers;\r\n        const name = \"Multiply Numbers\";\r\n        const uniqueNamePrefix = \"multiplyNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, Number.defaultValue);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(this.itemId) * input2.getValue(this.itemId);\r\n        }, \"Product\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 210, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(): MultiplyNumbersSchema {\r\n        return new MultiplyNumbersSchema();\r\n    }\r\n}\r\n\r\n@AddSchema\r\nexport class DivideNumbersSchema extends BaseNodeSchema {\r\n    constructor() {\r\n        const id = BaseSchemaTypes.DivideNumbers;\r\n        const name = \"Divide Numbers\";\r\n        const uniqueNamePrefix = \"divideNums\";\r\n        const input1 = new InputSlot(0, Number.className, Number.defaultValue);\r\n        const input2 = new InputSlot(1, Number.className, 1);\r\n        const inputSlots = [input1, input2];\r\n        const outputSlots = [new OutputSlot(0, Number.className, () => {\r\n            return input1.getValue(this.itemId) / (input2.getValue(this.itemId) ?? 1);\r\n        }, \"Quotient\")];\r\n\r\n        super(id, name, uniqueNamePrefix, 210, [], [], inputSlots, outputSlots);\r\n    }\r\n\r\n    createNewSchema(): DivideNumbersSchema {\r\n        return new DivideNumbersSchema();\r\n    }\r\n}","import { BaseNodeSchema } from \"../models/NodeSchema\";\r\n\r\nclass NodeSchemaManager {\r\n    public nodeSchemas: Map<string, BaseNodeSchema>;\r\n\r\n    constructor() {\r\n        this.nodeSchemas = new Map<string, BaseNodeSchema>();\r\n    }\r\n\r\n    getNewSchema(itemId: number, schemaId: string): BaseNodeSchema {\r\n        const schema = this.nodeSchemas.get(schemaId);\r\n        if (!schema)\r\n            throw new Error(`The schema '${schemaId}' could not be found.`);\r\n        return schema.createNew(itemId);\r\n    }\r\n\r\n    getBaseSchema(id: string): BaseNodeSchema {\r\n        const schema = this.nodeSchemas.get(id);\r\n        if (!schema)\r\n            throw new Error(`The schema '${id}' could not be found.`);\r\n        return schema;\r\n    }\r\n\r\n    getBaseSchemas(): BaseNodeSchema[] {\r\n        return [...this.nodeSchemas.values()];\r\n    }\r\n}\r\n\r\nexport default new NodeSchemaManager();","import NodeSchemaManager from \"./NodeSchemaManager\";\r\n\r\nclass VariableManager {\r\n    private typeCount: Map<string, number>;\r\n\r\n    constructor() {\r\n        this.typeCount = new Map<string, number>();\r\n    }\r\n\r\n    getNextVariableName(schemaId: string): string | undefined {\r\n        const schema = NodeSchemaManager.getBaseSchema(schemaId);\r\n        if (!schema) {\r\n            console.error(`The schema of id '${schemaId}' could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        let count = this.typeCount.get(schemaId);\r\n        // This shouldn't be written as !count because having a value of 0 will always return true.\r\n        if (count == null) {\r\n            this.typeCount.set(schemaId, 1);\r\n            count = 1;\r\n        }\r\n        else\r\n            this.typeCount.set(schemaId, count + 1);\r\n\r\n        return `${schema.uniqueNamePrefix}${count}`;\r\n    }\r\n}\r\n\r\nexport default new VariableManager();","import { BaseNodeSchema } from './NodeSchema';\r\nimport NodeSchemaManager from '../managers/NodeSchemaManager';\r\nimport VariableManager from '../managers/VariableManager';\r\nimport { ItemSlotPair } from './NodeSlot';\r\n\r\n// TODO: Implement slot connections here instead because...\r\n// When getting a node from the scriplet, it always creates a new schema,\r\n// therefore the slot connections added there when connecting nodes are not saved.\r\nexport interface INodeItem {\r\n    id: number;\r\n    customName?: string;\r\n    value?: any;\r\n    x: number;\r\n    y: number;\r\n    schemaId: string;\r\n    inputSlots: ItemSlotPair[];\r\n    inputFlowSlots: ItemSlotPair[];\r\n    outputSlots: Map<number, ItemSlotPair[]>;\r\n    outputFlowSlots: ItemSlotPair[];\r\n}\r\n\r\n// TODO: When position changes, new x and y coords are not saved to db\r\nexport class NodeItem implements INodeItem {\r\n    public id: number;\r\n    public customName?: string;\r\n    public value?: any;\r\n    public x: number;\r\n    public y: number;\r\n    public schemaId: string;\r\n    public inputSlots: ItemSlotPair[];\r\n    public inputFlowSlots: ItemSlotPair[];\r\n    public outputSlots: Map<number, ItemSlotPair[]>;\r\n    public outputFlowSlots: ItemSlotPair[];\r\n\r\n    public variableName: string;\r\n    public schema: BaseNodeSchema;\r\n\r\n    constructor(id: number, x: number, y: number, schemaId: string, inputSlots: ItemSlotPair[], inputFlowSlots: ItemSlotPair[], outputSlots: Map<number, ItemSlotPair[]>, outputFlowSlots: ItemSlotPair[], customName?: string, value?: any) {\r\n        this.id = id;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.schemaId = schemaId;\r\n        this.inputSlots = inputSlots;\r\n        this.inputFlowSlots = inputFlowSlots;\r\n        this.outputSlots = outputSlots;\r\n        this.outputFlowSlots = outputFlowSlots;\r\n        \r\n        if (customName)\r\n            this.customName = customName;\r\n        if (value)\r\n            this.value = value;\r\n\r\n        this.variableName = VariableManager.getNextVariableName(schemaId) ?? \"undefined\";\r\n        this.schema = NodeSchemaManager.getNewSchema(id, schemaId);\r\n\r\n        // Necessary so the variableName and schema are not serialized to db\r\n        Object.defineProperties(this, {\r\n            variableName: {enumerable: false, writable: true},\r\n            schema: {enumerable: false, writable: true}\r\n        });\r\n    }\r\n\r\n    getInputConnection(slotId: number): ItemSlotPair | undefined {\r\n        const result = this.inputSlots.filter(slot => slot.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Input slot '${slotId}' of node item '${this.id}' can only have 1 connection. Will return the first connection found.`);\r\n\r\n        if (result.length < 1)\r\n            return;\r\n        \r\n        return result[0];\r\n    }\r\n\r\n    setInputConnection(id: number, itemId: number, slotId: number) {\r\n        // TODO: Save changes to db\r\n        const result = this.inputSlots.filter(slot => slot.id === id);\r\n        if (result.length > 1)\r\n            console.error(`Input slot '${id}' of node item '${this.id}' can only have 1 connection. Will replace the first connection found.`);\r\n\r\n        if (result.length < 1) {\r\n            this.inputSlots.push({id, itemId, slotId});\r\n            return;\r\n        }\r\n        \r\n        const slot = result[0];\r\n        slot.itemId = itemId;\r\n        slot.slotId = slotId;\r\n    }\r\n\r\n    deleteInputConnection(slotId: number) {\r\n        this.inputSlots = this.inputSlots.filter(pair => pair.id !== slotId);\r\n    }\r\n\r\n    getOutputConnections(slotId: number): ItemSlotPair[] {\r\n        // TODO: Also check if all slots in a subset have the same ids\r\n        const result = this.outputSlots.get(slotId);\r\n        if (!result)\r\n            return [];\r\n\r\n        return result;\r\n    }\r\n\r\n    setOutputConnection(id: number, itemId: number, slotId: number) {\r\n        const result = this.outputSlots.get(id);\r\n        if (!result) {\r\n            this.outputSlots.set(id, [{id, itemId, slotId}]);\r\n            return;\r\n        }\r\n\r\n        const similar = result.find(pair => pair.id === id && pair.itemId === itemId && pair.slotId === slotId);\r\n        if (similar) {\r\n            console.error(`The connection '${itemId}, ${slotId}' is already connected to node item slot '${this.id}, ${id}'. Something in the code may have caused this duplication.`);\r\n            return;\r\n        }\r\n\r\n        result.push({id, itemId, slotId});\r\n    }\r\n\r\n    deleteOutputConnection(id: number, itemId: number, slotId: number) {\r\n        let result = this.outputSlots.get(id);\r\n        if (result) {\r\n            result = result.filter(pair => pair.id !== id && pair.itemId !== itemId && pair.slotId !== slotId);\r\n            this.outputSlots.set(id, result);\r\n        }\r\n    }\r\n\r\n    getInputFlowConnection(slotId: number): ItemSlotPair | undefined {\r\n        const result = this.inputFlowSlots.filter(slot => slot.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Input flow slot '${slotId}' of node item '${this.id}' can only have 1 connection. Will return the first connection found.`);\r\n\r\n        if (result.length < 1)\r\n            return;\r\n        \r\n        return result[0];\r\n    }\r\n\r\n    setInputFlowConnection(id: number, itemId: number, slotId: number) {\r\n        // TODO: Save changes to db\r\n        const result = this.inputFlowSlots.filter(slot => slot.id === id);\r\n        if (result.length > 1)\r\n            console.error(`Input flow slot '${id}' of node item '${this.id}' can only have 1 connection. Will replace the first connection found.`);\r\n\r\n        if (result.length < 1) {\r\n            this.inputFlowSlots.push({id, itemId, slotId});\r\n            return;\r\n        }\r\n        \r\n        const slot = result[0];\r\n        slot.itemId = itemId;\r\n        slot.slotId = slotId;\r\n    }\r\n\r\n    deleteInputFlowConnection(slotId: number) {\r\n        this.inputFlowSlots = this.inputFlowSlots.filter(pair => pair.id !== slotId);\r\n    }\r\n\r\n    getOutputFlowConnection(slotId: number): ItemSlotPair | undefined {\r\n        const result = this.outputFlowSlots.filter(slot => slot.id === slotId);\r\n        if (result.length > 1)\r\n            console.error(`Output flow slot '${slotId}' of node item '${this.id}' can only have 1 connection. Will return the first connection found.`);\r\n\r\n        if (result.length < 1)\r\n            return;\r\n        \r\n        return result[0];\r\n    }\r\n\r\n    setOutputFlowConnection(id: number, itemId: number, slotId: number) {\r\n        // TODO: Save changes to db\r\n        const result = this.outputFlowSlots.filter(slot => slot.id === id);\r\n        if (result.length > 1)\r\n            console.error(`Output flow slot '${id}' of node item '${this.id}' can only have 1 connection. Will replace the first connection found.`);\r\n\r\n        if (result.length < 1) {\r\n            this.outputFlowSlots.push({id, itemId, slotId});\r\n            return;\r\n        }\r\n        \r\n        const slot = result[0];\r\n        slot.itemId = itemId;\r\n        slot.slotId = slotId;\r\n    }\r\n\r\n    deleteOutputFlowConnection(slotId: number) {\r\n        this.outputFlowSlots = this.outputFlowSlots.filter(pair => pair.id !== slotId);\r\n    }\r\n}","import { INodeItem, NodeItem } from \"./NodeItem\";\r\nimport { BaseSchemaTypes } from \"./NodeSchema\";\r\nimport VisualScriptingDB from \"../managers/VisualScriptingDB\";\r\nimport { ItemSlotPair } from \"./NodeSlot\";\r\n\r\nexport class Scriplet {\r\n    public id: number;\r\n    public name: string;\r\n    public start: INodeItem;\r\n    public items: Map<number, INodeItem>;\r\n    public itemCounter: number;\r\n\r\n    constructor(name: string) {\r\n        this.id = 0;\r\n        this.itemCounter = 1;\r\n\r\n        this.name = name;\r\n        this.items = new Map<number, INodeItem>();\r\n        this.start = {id: 0, x: 0, y: 0, schemaId: BaseSchemaTypes.Start, inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: []};\r\n        this.items.set(0, this.start);\r\n    }\r\n\r\n    addNode(x: number, y: number, schemaId: string, inputSlots: ItemSlotPair[], inputFlowSlots: ItemSlotPair[], outputSlots: Map<number, ItemSlotPair[]>, outputFlowSlots: ItemSlotPair[], customName?: string, value?: any) {\r\n        this.addNodes(false, {x, y, schemaId, inputSlots, inputFlowSlots, outputSlots, outputFlowSlots, customName, value});\r\n    }\r\n\r\n    // TODO: reloadOnFinish is only needed when seeding the db, seems hackish...\r\n    addNodes(reloadOnFinish: boolean, ...nodes: {x: number, y: number, schemaId: string, inputSlots: ItemSlotPair[], inputFlowSlots: ItemSlotPair[], outputSlots: Map<number, ItemSlotPair[]>, outputFlowSlots: ItemSlotPair[], customName?: string, value?: any}[]) {\r\n        nodes.forEach(node => {\r\n            const key = this.itemCounter++;\r\n            this.items.set(key, {id: key, x: node.x, y: node.y, schemaId: node.schemaId, inputSlots: node.inputSlots, inputFlowSlots: node.inputFlowSlots, outputSlots: node.outputSlots, outputFlowSlots: node.outputFlowSlots, customName: node.customName, value: node.value});\r\n        });\r\n\r\n        VisualScriptingDB.updateScriplet(this.id, {\"items\": this.items, \"itemCounter\": this.itemCounter}).then(result => {\r\n            if (result && reloadOnFinish)\r\n                window.location.reload();\r\n        });\r\n    }\r\n\r\n    getStart(): NodeItem {\r\n        if (!(this.start as NodeItem).schema) {\r\n            const newNode = new NodeItem(this.start.id, this.start.x, this.start.y, this.start.schemaId, this.start.inputSlots, this.start.inputFlowSlots, this.start.outputSlots, this.start.outputFlowSlots, this.start.customName, this.start.value);\r\n            this.start = newNode;\r\n            return newNode;\r\n        }\r\n        return this.start as NodeItem;\r\n    }\r\n\r\n    getNode(itemId: number): NodeItem | undefined {\r\n        const result = this.items.get(itemId);\r\n        if (!result)\r\n            return;\r\n        \r\n        return this.convertToNodeItem(result);\r\n    }\r\n\r\n    getNodes(): NodeItem[] {\r\n        const result: NodeItem[] = [];\r\n        this.items.forEach(node => {\r\n            result.push(this.convertToNodeItem(node));\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    convertToNodeItem(node: INodeItem): NodeItem {\r\n        if (!(node as NodeItem).schema) {\r\n            const newNode = new NodeItem(node.id, node.x, node.y, node.schemaId, node.inputSlots, node.inputFlowSlots, node.outputSlots, node.outputFlowSlots, node.customName, node.value);\r\n            this.items.set(node.id, newNode);\r\n            return newNode;\r\n        }\r\n\r\n        return node as NodeItem;\r\n    }\r\n\r\n    updateNodes() {\r\n        VisualScriptingDB.updateScriplet(this.id, {\"items\": this.items});\r\n    }\r\n\r\n    deleteNode(itemId: number): boolean {\r\n        return this.deleteNodes(itemId);\r\n    }\r\n\r\n    deleteNodes(...itemIds: number[]): boolean {\r\n        let result = true;\r\n        itemIds.forEach(itemId => {\r\n            if(!this.items.delete(itemId))\r\n                result = false;\r\n        });\r\n\r\n        VisualScriptingDB.updateScriplet(this.id, {\"items\": this.items});\r\n        return result;\r\n    }\r\n}","import Dexie from 'dexie';\r\nimport { BaseSchemaTypes } from '../models/NodeSchema';\r\nimport { ItemSlotPair } from '../models/NodeSlot';\r\nimport { Scriplet } from '../models/Scriplet';\r\n\r\nclass VisualScriptingDB extends Dexie {\r\n    public scriplets: Dexie.Table<Scriplet, number>;\r\n\r\n    constructor() {\r\n        super(\"VisualScriptingDB\");\r\n\r\n        this.version(1).stores({\r\n            scriplets: \"++id, name\"\r\n        });\r\n        this.open().catch(error => {\r\n            console.error(`Opening the db '${this.name}' failed: ${error}`);\r\n        });\r\n\r\n        this.scriplets = this.table(\"scriplets\");\r\n        this.scriplets.mapToClass(Scriplet);\r\n\r\n        this.seedData();\r\n    }\r\n\r\n    seedData() {\r\n        /*\r\n        NodeConnections.addConnection(2, 1, 1, 0);\r\n        NodeConnections.addConnection(4, 0, 2, 0);\r\n        NodeConnections.addConnection(3, 1, 2, 0);\r\n        NodeConnections.addConnection(4, 1, 3, 1);\r\n        NodeConnections.addConnection(5, 0, 4, 0);\r\n        NodeConnections.addConnection(7, 0, 4, 0);\r\n        NodeConnections.addConnection(7, 1, 6, 0);\r\n        NodeConnections.addConnection(8, 0, 7, 0);\r\n        */\r\n\r\n        this.scriplets.toArray().then(scriplets => {\r\n            if (scriplets.length <= 0) {\r\n                this.addScriplet(\"Test\").then(scriplet => {\r\n                    scriplet.addNodes(true,\r\n                        {x: 0, y: 100, schemaId: BaseSchemaTypes.Input, inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 2, slotId: 1}]]]), outputFlowSlots: []}, \r\n                        {x: 250, y: 100, schemaId: BaseSchemaTypes.SubtractNumbers, inputSlots: [{id: 1, itemId: 1, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 4, slotId: 0}, {id: 0, itemId: 3, slotId: 1}]]]), outputFlowSlots: []},\r\n                        {x: 500, y: 250, schemaId: BaseSchemaTypes.Print, inputSlots: [{id: 1, itemId: 2, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[1, [{id: 1, itemId: 4, slotId: 1}]]]), outputFlowSlots: []},\r\n                        {x: 750, y: 100, schemaId: BaseSchemaTypes.MultiplyNumbers, inputSlots: [{id: 0, itemId: 2, slotId: 0}, {id: 1, itemId: 3, slotId: 1}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 5, slotId: 0}, {id: 0, itemId: 7, slotId: 0}]]]), outputFlowSlots: []},\r\n                        {x: 1000, y: 100, schemaId: BaseSchemaTypes.Output, inputSlots: [{id: 0, itemId: 4, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: []},\r\n                        {x: 750, y: 350, schemaId: BaseSchemaTypes.Input, inputSlots: [], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 7, slotId: 1}]]]), outputFlowSlots: []},\r\n                        {x: 1000, y: 300, schemaId: BaseSchemaTypes.AddNumbers, inputSlots: [{id: 0, itemId: 4, slotId: 0}, {id: 1, itemId: 6, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>([[0, [{id: 0, itemId: 8, slotId: 0}]]]), outputFlowSlots: []},\r\n                        {x: 1250, y: 300, schemaId: BaseSchemaTypes.Output, inputSlots: [{id: 0, itemId: 7, slotId: 0}], inputFlowSlots: [], outputSlots: new Map<number, ItemSlotPair[]>(), outputFlowSlots: []}\r\n                    );\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    async getScriplet(id: number): Promise<Scriplet | undefined> {\r\n        return await this.scriplets.get(id);\r\n    }\r\n\r\n    async getScriplets(): Promise<Scriplet[]> {\r\n        return await this.scriplets.toArray();\r\n    }\r\n\r\n    async addScriplet(name: string): Promise<Scriplet> {\r\n        const scriplet = new Scriplet(name);\r\n        const id = await this.scriplets.add(scriplet);\r\n        scriplet.id = id;\r\n        return scriplet;\r\n    }\r\n\r\n    async updateScriplet(id: number, changes: {[keyPath: string]: any}): Promise<boolean> {\r\n        const result = await this.scriplets.update(id, changes);\r\n        if (result === 0) {\r\n            console.error(`The scriplet of id '${id}' could not be found in the database; nothing was updated.`);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n    \r\n    async updateEntireScriplet(scriplet: Scriplet): Promise<boolean> {\r\n        const result = await this.scriplets\r\n                                .where(\":id\")\r\n                                .equals(scriplet.id)\r\n                                .modify((value, ref) => ref.value = scriplet);\r\n        \r\n        if (result === 0) {\r\n            console.error(`The scriplet of id '${scriplet.id}' could not be found in the database; nothing was updated.`);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    async deleteScriplet(id: number) {\r\n        await this.scriplets.delete(id);\r\n    }\r\n}\r\n\r\nexport default new VisualScriptingDB();","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { Link } from 'react-router-dom';\r\nimport Scrollbar from 'react-scrollbars-custom';\r\nimport VisualScriptingDB from '../managers/VisualScriptingDB';\r\nimport { Scriplet } from '../models/Scriplet';\r\n\r\nexport type SidebarState = {\r\n    scriplets: Scriplet[];\r\n    isNavMenuOpen: boolean;\r\n    isSidebarOpen: boolean;\r\n}\r\n\r\nexport type SidebarProps = {\r\n    \r\n}\r\n\r\nexport default class SidebarNav extends React.Component<SidebarProps, SidebarState> {\r\n    constructor(props: SidebarProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            scriplets: [],\r\n            isNavMenuOpen: false,\r\n            isSidebarOpen: true\r\n        };\r\n\r\n        this.openNavMenu = this.openNavMenu.bind(this);\r\n        this.closeNavMenu = this.closeNavMenu.bind(this);\r\n        this.toggleNavMenu = this.toggleNavMenu.bind(this);\r\n        this.openSidebar = this.openSidebar.bind(this);\r\n        this.closeSidebar = this.closeSidebar.bind(this);\r\n        this.toggleSidebar = this.toggleSidebar.bind(this);\r\n        this.handleOnScripletCreate = this.handleOnScripletCreate.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        VisualScriptingDB.getScriplets().then(scriplets => {\r\n            this.setState({scriplets: scriplets});\r\n        });\r\n    }\r\n\r\n    openNavMenu() {\r\n        this.setState({isNavMenuOpen: true});\r\n    }\r\n\r\n    closeNavMenu() {\r\n        this.setState({isNavMenuOpen: false});\r\n    }\r\n\r\n    toggleNavMenu() {\r\n        if (this.state.isNavMenuOpen)\r\n            this.closeNavMenu();\r\n        else\r\n            this.openNavMenu();\r\n    }\r\n\r\n    openSidebar() {\r\n        this.setState({isSidebarOpen: true});\r\n    }\r\n\r\n    closeSidebar() {\r\n        this.setState({isSidebarOpen: false});\r\n    }\r\n\r\n    toggleSidebar() {\r\n        if (this.state.isSidebarOpen)\r\n            this.closeSidebar();\r\n        else\r\n            this.openSidebar();\r\n    }\r\n\r\n    handleOnScripletCreate(name: string) {\r\n        // TODO: Show feedback for invalid input\r\n        if (!name)\r\n            return false;\r\n\r\n        return true;\r\n    }\r\n\r\n    render() {\r\n        const { scriplets } = this.state;\r\n        return (\r\n            <nav className=\"nav\">\r\n                {/* \r\n                * Plan is to have a top navigation for md and below\r\n                * screen sizes, but have sidebar for lg and above\r\n                * \r\n                * Ignore animations for now\r\n                */}\r\n\r\n                { /* Top navbar */ }\r\n                <div className=\"topbar\">\r\n                    <div className=\"lg:hidden flex items-center justify-between p-4 bg-gray-800\">\r\n                        { /* Logo */ }\r\n                        <div className=\"\">\r\n                            <Link to=\"/\" className=\"text-xl text-gray-100 font-semibold\">\r\n                                <FontAwesomeIcon className=\"mr-4 text-2xl text-indigo-500\" \r\n                                                    icon=\"project-diagram\" />\r\n                                Visual Scripting\r\n                            </Link>\r\n                        </div>\r\n\r\n                        { /* Hamburger for sidebar items */ }\r\n                        <div className=\"block\">\r\n                            <button className=\"flex items-center py-2 px-3 text-indigo-500 rounded border border-indigo-500 hover:bg-indigo-300\"\r\n                                    onClick={this.toggleNavMenu} >\r\n                                <FontAwesomeIcon icon=\"bars\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    { /* Nav Items */ }\r\n                    <div className={`${this.state.isNavMenuOpen ? '' : 'hidden'} lg:hidden relative z-20`}>\r\n                        <div className=\"absolute w-full px-4 pb-4 bg-gray-800\">\r\n                            {\r\n                                scriplets.map((scriplet, i) => (\r\n                                    <Link key={i} \r\n                                            onClick={this.closeNavMenu} \r\n                                            to={\"/scriplet/\" + scriplet.id} \r\n                                            className=\"block mb-1 px-4 py-2 rounded-md hover:bg-gray-900 focus:bg-gray-900 text-gray-100\">\r\n                                        <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" icon=\"folder\" />\r\n                                        {scriplet.name}\r\n                                    </Link>\r\n                                ))\r\n                            }\r\n                                <div className=\"w-full mb-1 px-4 py-2 rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\"\r\n                                        onClick={() => {\r\n                                            //this.state.openProjectModal();\r\n                                            this.closeNavMenu();\r\n                                        }}>\r\n                                    <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" icon=\"plus\" />\r\n                                    <span className=\"font-medium\">Add Scriplet</span>\r\n                                </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                { /* Sidebar */ }\r\n                <div>\r\n                    <div className={`${this.state.isSidebarOpen ? \"sidebar shadow\" : \"hidden\"}`}>\r\n                        <div className=\"flex-grow h-screen bg-gray-800 relative\">\r\n                            { /* Logo */ }\r\n                            <div className=\"p-4 h-16\">\r\n                                <Link to=\"/\" className=\"text-xl text-gray-100 font-semibold\">\r\n                                    <FontAwesomeIcon className=\"mr-4 text-2xl text-indigo-500\" \r\n                                                    icon=\"project-diagram\" />\r\n                                    Visual Scripting\r\n                                </Link>\r\n                            </div>\r\n\r\n                            { /* Sidebar Items */ }\r\n                            <div className=\"p-2 fixed top-16 bottom-0 my-auto lg:w-64\">\r\n                                { /* TODO: Place the dashboard item here */ }\r\n                                <Scrollbar noScrollX>\r\n                                    {\r\n                                        scriplets.map((scriplet, i) => (\r\n                                            <Link key={i} \r\n                                                    onClick={this.closeNavMenu} \r\n                                                    to={\"/scriplet/\" + scriplet.id} \r\n                                                    className=\"block mb-1 px-4 py-2 rounded-md hover:bg-gray-900 focus:bg-gray-900 text-gray-100\">\r\n                                                <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" icon=\"folder\" />\r\n                                                {scriplet.name}\r\n                                            </Link>\r\n                                        ))\r\n                                    }\r\n                                    <div className=\"w-full mb-1 px-4 py-2 rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\"\r\n                                            onClick={() => {\r\n                                                //this.state.openProjectModal;\r\n                                            }}>\r\n                                        <FontAwesomeIcon className=\"mr-4 text-lg text-gray-600\" \r\n                                                        icon=\"plus\" />\r\n                                        <span className=\"font-medium\">Add Scriplet</span>\r\n                                    </div>\r\n                                </Scrollbar>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div className={`${this.state.isSidebarOpen ? \"hidden\" : \"collapsed-sidebar shadow\"}`}>\r\n                        <div className=\"flex-grow h-screen bg-gray-800 relative\">\r\n                            { /* Logo */ }\r\n                            <div className=\"p-4 h-16 text-center\">\r\n                                <Link to=\"/\" className=\"text-xl text-gray-100 font-semibold\">\r\n                                    <FontAwesomeIcon className=\"text-2xl text-indigo-500\" \r\n                                                    icon=\"project-diagram\" />\r\n                                </Link>\r\n                            </div>\r\n\r\n                            { /* Sidebar Items */ }\r\n                            <div className=\"sidebar-items p-2 fixed top-16 bottom-0 my-auto\">\r\n                                { /* TODO: Place the dashboard item here */ }\r\n                                <Scrollbar noScrollX>\r\n                                    {\r\n                                        scriplets.map((scriplet, i) => (\r\n                                            <Link key={i} \r\n                                                    onClick={this.closeNavMenu} \r\n                                                    to={\"/scriplet/\" + scriplet.id} \r\n                                                    className=\"block border-gray-700 border-solid border hover:border-opacity-0 mb-1 py-2 text-center rounded-md hover:bg-gray-900 focus:bg-gray-900 text-gray-100 font-bold\">\r\n                                                {scriplet.name[0]}\r\n                                            </Link>\r\n                                        ))\r\n                                    }\r\n                                    <div className=\"flex mb-1 py-2 justify-center rounded-md border-gray-600 border-dashed border-2 cursor-pointer hover:bg-gray-900 focus:bg-gray-900 text-gray-500\"\r\n                                            onClick={() => {\r\n                                                //this.state.openProjectModal;\r\n                                            }}>\r\n                                        <div className=\"inline-block\">\r\n                                            <FontAwesomeIcon className=\"text-lg text-gray-600\" \r\n                                                            icon=\"plus\" />\r\n                                        </div>\r\n                                    </div>\r\n                                </Scrollbar>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <button className={`${this.state.isSidebarOpen ? \"w-64 ml-8 pl-56\" : \"w-16 ml-8 pl-8\"} sidebar-toggle items-center rounded-full bg-gray-700`}\r\n                            onClick={this.toggleSidebar}>\r\n                        <div className=\"inline-block pl-2\">\r\n                            <FontAwesomeIcon icon=\"chevron-left\"\r\n                                                className={`${this.state.isSidebarOpen ? \"block\" : \"hidden\"} text-gray-300`} />\r\n                            <FontAwesomeIcon icon=\"chevron-right\"\r\n                                                className={`${this.state.isSidebarOpen ? \"hidden\" : \"block\"} text-gray-300`} />\r\n                        </div>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Modals here */}\r\n                {/*\r\n                <Modal title=\"Create New Project\"\r\n                        openModal={callable => {\r\n                            if (!this.state.openProjectModal)\r\n                                this.setState({openProjectModal: callable});\r\n                        }}>\r\n                    {({closeModal}) => (\r\n                    <ProjectForm title=\"\"\r\n                                    description=\"\"\r\n                                    handleOnProjectCreate={this.handleOnScripletCreate}\r\n                                    handleCloseModal={closeModal} />\r\n                    )}\r\n                </Modal>\r\n                */}\r\n            </nav>\r\n        );\r\n    }\r\n}","export default class Colors {\r\n    static Gray = {\r\n        100: '#f7fafc',\r\n        200: '#edf2f7',\r\n        300: '#e2e8f0',\r\n        400: '#cbd5e0',\r\n        500: '#a0aec0',\r\n        600: '#718096',\r\n        700: '#4a5568',\r\n        800: '#2d3748',\r\n        900: '#1a202c',\r\n    };\r\n    static Red = {\r\n        100: '#fff5f5',\r\n        200: '#fed7d7',\r\n        300: '#feb2b2',\r\n        400: '#fc8181',\r\n        500: '#f56565',\r\n        600: '#e53e3e',\r\n        700: '#c53030',\r\n        800: '#9b2c2c',\r\n        900: '#742a2a',\r\n    };\r\n    static Orange = {\r\n        100: '#fffaf0',\r\n        200: '#feebc8',\r\n        300: '#fbd38d',\r\n        400: '#f6ad55',\r\n        500: '#ed8936',\r\n        600: '#dd6b20',\r\n        700: '#c05621',\r\n        800: '#9c4221',\r\n        900: '#7b341e',\r\n    };\r\n    static Yellow = {\r\n        100: '#fffff0',\r\n        200: '#fefcbf',\r\n        300: '#faf089',\r\n        400: '#f6e05e',\r\n        500: '#ecc94b',\r\n        600: '#d69e2e',\r\n        700: '#b7791f',\r\n        800: '#975a16',\r\n        900: '#744210',\r\n    };\r\n    static Green = {\r\n        100: '#f0fff4',\r\n        200: '#c6f6d5',\r\n        300: '#9ae6b4',\r\n        400: '#68d391',\r\n        500: '#48bb78',\r\n        600: '#38a169',\r\n        700: '#2f855a',\r\n        800: '#276749',\r\n        900: '#22543d',\r\n    };\r\n    static Teal = {\r\n        100: '#e6fffa',\r\n        200: '#b2f5ea',\r\n        300: '#81e6d9',\r\n        400: '#4fd1c5',\r\n        500: '#38b2ac',\r\n        600: '#319795',\r\n        700: '#2c7a7b',\r\n        800: '#285e61',\r\n        900: '#234e52',\r\n    };\r\n    static Blue = {\r\n        100: '#ebf8ff',\r\n        200: '#bee3f8',\r\n        300: '#90cdf4',\r\n        400: '#63b3ed',\r\n        500: '#4299e1',\r\n        600: '#3182ce',\r\n        700: '#2b6cb0',\r\n        800: '#2c5282',\r\n        900: '#2a4365',\r\n    };\r\n    static Indigo = {\r\n        100: '#ebf4ff',\r\n        200: '#c3dafe',\r\n        300: '#a3bffa',\r\n        400: '#7f9cf5',\r\n        500: '#667eea',\r\n        600: '#5a67d8',\r\n        700: '#4c51bf',\r\n        800: '#434190',\r\n        900: '#3c366b',\r\n    };\r\n    static Purple = {\r\n        100: '#faf5ff',\r\n        200: '#e9d8fd',\r\n        300: '#d6bcfa',\r\n        400: '#b794f4',\r\n        500: '#9f7aea',\r\n        600: '#805ad5',\r\n        700: '#6b46c1',\r\n        800: '#553c9a',\r\n        900: '#44337a',\r\n    };\r\n    static Pink = {\r\n        100: '#fff5f7',\r\n        200: '#fed7e2',\r\n        300: '#fbb6ce',\r\n        400: '#f687b3',\r\n        500: '#ed64a6',\r\n        600: '#d53f8c',\r\n        700: '#b83280',\r\n        800: '#97266d',\r\n        900: '#702459',\r\n    };\r\n}","import { KonvaEventObject } from \"konva/types/Node\";\r\n\r\nexport class KonvaUtils {\r\n    public static setCursor(event: KonvaEventObject<Event>, cursorType: string) {\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        stage.container().style.cursor = cursorType;\r\n    }\r\n}","import React from 'react';\r\nimport { Label, Tag, Text } from 'react-konva';\r\nimport { KonvaEventObject } from 'konva/types/Node';\r\nimport { KonvaUtils } from '../utils/KonvaUtils';\r\n\r\nexport class KonvaForm {\r\n    public static cancel() {\r\n        Input.cancelInput();\r\n        Dropdown.cancelDropdown();\r\n    }\r\n} \r\n\r\nexport type InputModel = {\r\n    value: string;\r\n    type: string;\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type OutputModel = {\r\n    values: string[];\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type InputProps = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    fontSize: number;\r\n    fontStyle: string;\r\n    padding: number;\r\n    textColor: string;\r\n    bgColor: string;\r\n    hoverColor: string;\r\n    borderRadius: number;\r\n    zIndex: number;\r\n    value: string;\r\n    type: string;\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type InputState = {\r\n    value: string;\r\n}\r\n\r\nexport class Input extends React.Component<InputProps, InputState> {\r\n    private static inputElement: HTMLInputElement;\r\n    \r\n    static defaultProps: InputProps = {\r\n        x: 0,\r\n        y: 0,\r\n        width: 100,\r\n        height: 20,\r\n        fontSize: 12,\r\n        fontStyle: \"normal\",\r\n        padding: 0,\r\n        textColor: \"#000000\",\r\n        bgColor: \"#ffffff\",\r\n        hoverColor: \"#cccccc\",\r\n        borderRadius: 0,\r\n        zIndex: 0,\r\n        value: \"\",\r\n        type: \"text\",\r\n        onChange: () => { return false; }\r\n    }\r\n\r\n    constructor(props: InputProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            value: \"\"\r\n        }\r\n\r\n        this.showInput = this.showInput.bind(this);\r\n        this.onHover = this.onHover.bind(this);\r\n        this.onHoverExit = this.onHoverExit.bind(this);\r\n    }\r\n\r\n    showInput(event: KonvaEventObject<Event>) {\r\n        Input.cancelInput();\r\n\r\n        const { width, height, fontSize, padding, textColor, hoverColor, borderRadius, zIndex, type, onChange } = this.props;\r\n        const value = this.state.value === \"\" ? this.props.value : this.state.value;\r\n\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n        const scale = stage.scaleX();\r\n\r\n        const top = event.target.absolutePosition().y;\r\n        const left = event.target.absolutePosition().x;\r\n\r\n        const input = document.createElement(\"input\");\r\n        document.body.appendChild(input);\r\n\r\n        input.value = value;\r\n        input.type = type;\r\n        input.style.position = \"absolute\";\r\n        input.style.top = `${top}px`;\r\n        input.style.left = `${left}px`;\r\n        input.style.width = `${Math.min(width * scale, window.innerWidth - left)}px`;\r\n        input.style.height = `${height * scale}px`;\r\n        input.style.paddingLeft = `${padding * scale}px`;\r\n        input.style.fontSize = `${fontSize * scale}px`;\r\n        input.style.color = textColor;\r\n        input.style.backgroundColor = hoverColor;\r\n        input.style.borderRadius = `${borderRadius * scale}px`;\r\n        input.style.zIndex = `${zIndex}`;\r\n        input.focus();\r\n        input.onchange = (ev: Event) => {\r\n            const target = ev.target as HTMLInputElement;\r\n\r\n            if (!target) {\r\n                console.error(`Cannot cast target to 'HTMLInputElement'.`);\r\n                Input.cancelInput();\r\n                return;\r\n            }\r\n\r\n            if (!target.value) {\r\n                console.error(`No value typed in while editing the text.`);\r\n                Input.cancelInput();\r\n                return;\r\n            }\r\n\r\n            if (!onChange(target.value)) {\r\n                console.error(`Input value requirements not met.`);\r\n                Input.cancelInput();\r\n                return;\r\n            }\r\n\r\n            onChange(target.value);\r\n            this.setState({value: target.value});\r\n            Input.cancelInput();\r\n        }\r\n\r\n        Input.inputElement = input;\r\n    }\r\n\r\n    public static cancelInput() {\r\n        const input = Input.inputElement;\r\n        if (!input)\r\n            return;\r\n        \r\n        input.onchange = null;\r\n        input.parentNode?.removeChild(input);\r\n    }\r\n\r\n    onHover(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"text\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.hoverColor);\r\n        layer.draw();\r\n    }\r\n\r\n    onHoverExit(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"default\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.bgColor);\r\n        layer.draw();\r\n    }\r\n\r\n    render() {\r\n        const { x, y, width, height, fontSize, fontStyle, padding, textColor, bgColor, borderRadius } = this.props;\r\n        const value = this.state.value === \"\" ? this.props.value : this.state.value;\r\n\r\n        return(\r\n            <Label name=\"top-bar-label\"\r\n                x={x}\r\n                y={y}\r\n                onMouseEnter={this.onHover}\r\n                onMouseLeave={this.onHoverExit} \r\n                onClick={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showInput(event);\r\n                }}\r\n                onTap={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showInput(event);\r\n                }}>\r\n                <Tag fill={bgColor}\r\n                        cornerRadius={borderRadius} />\r\n                <Text name=\"top-bar-text\"\r\n                        width={width}\r\n                        height={height}\r\n                        fontStyle={fontStyle}\r\n                        fontSize={fontSize}\r\n                        verticalAlign=\"middle\"\r\n                        padding={padding}\r\n                        fill={textColor}\r\n                        text={value} />\r\n            </Label>\r\n        );\r\n    }\r\n}\r\n\r\nexport type DropdownProps = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    fontSize: number;\r\n    fontStyle: string;\r\n    padding: number;\r\n    textColor: string;\r\n    bgColor: string;\r\n    hoverColor: string;\r\n    borderRadius: number;\r\n    zIndex: number;\r\n    values: string[];\r\n    onChange: (value: string) => boolean;\r\n}\r\n\r\nexport type DropdownState = {\r\n    selectedIndex: number;\r\n}\r\n\r\nexport class Dropdown extends React.Component<DropdownProps, DropdownState> {\r\n    private static dropdownElement: HTMLSelectElement;\r\n    \r\n    static defaultProps: DropdownProps = {\r\n        x: 0,\r\n        y: 0,\r\n        width: 100,\r\n        height: 20,\r\n        fontSize: 12,\r\n        fontStyle: \"normal\",\r\n        padding: 0,\r\n        textColor: \"#000000\",\r\n        bgColor: \"#ffffff\",\r\n        hoverColor: \"#cccccc\",\r\n        borderRadius: 0,\r\n        zIndex: 0,\r\n        values: [],\r\n        onChange: () => { return false; }\r\n    }\r\n\r\n    constructor(props: DropdownProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            selectedIndex: 0\r\n        };\r\n\r\n        this.showDropdown = this.showDropdown.bind(this);\r\n        this.onHover = this.onHover.bind(this);\r\n        this.onHoverExit = this.onHoverExit.bind(this);\r\n    }\r\n\r\n    showDropdown(event: KonvaEventObject<Event>) {\r\n        Dropdown.cancelDropdown();\r\n\r\n        const { width, height, padding, fontSize, textColor, hoverColor, borderRadius, zIndex, values, onChange } = this.props;\r\n\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n        const scale = stage.scaleX();\r\n\r\n        const top = event.target.absolutePosition().y;\r\n        const left = event.target.absolutePosition().x;\r\n\r\n        const dropdown = document.createElement(\"select\");\r\n        document.body.appendChild(dropdown);\r\n\r\n        // Add classes here\r\n        //dropdown.classList.add(\"block\", \"appearance-none\", \"w-full\", \"bg-white\", \"border\", \"border-gray-400\", \"hover:border-gray-500\", \"px-4\", \"py-2\", \"pr-8\", \"rounded\", \"shadow\", \"leading-tight\", \"focus:outline-none\", \"focus:shadow-outline\");\r\n        values.forEach(value => {\r\n            const option = document.createElement(\"option\");\r\n            option.value = value;\r\n            option.innerText = value;\r\n            dropdown.add(option);\r\n        });\r\n\r\n        dropdown.selectedIndex = this.state.selectedIndex;\r\n        dropdown.style.position = \"absolute\";\r\n        dropdown.style.top = `${top}px`;\r\n        dropdown.style.left = `${left}px`;\r\n        dropdown.style.width = `${Math.min(width * scale, window.innerWidth - left)}px`;\r\n        dropdown.style.height = `${height * scale}px`;\r\n        dropdown.style.paddingLeft = `${padding * scale}px`;\r\n        dropdown.style.fontSize = `${fontSize * scale}px`;\r\n        dropdown.style.color = textColor;\r\n        dropdown.style.backgroundColor = hoverColor;\r\n        dropdown.style.borderRadius = `${borderRadius * scale}px`;\r\n        dropdown.style.zIndex = `${zIndex}`;\r\n        dropdown.focus();\r\n        dropdown.onchange = (ev: Event) => {\r\n            const target = ev.target as HTMLSelectElement;\r\n\r\n            if (!target) {\r\n                console.error(`Cannot cast target to 'HTMLSelectElement'.`);\r\n                Dropdown.cancelDropdown();\r\n                return;\r\n            }\r\n\r\n            if (!target.value) {\r\n                console.error(`No value selected.`);\r\n                Dropdown.cancelDropdown();\r\n                return;\r\n            }\r\n\r\n            if (!onChange(target.value)) {\r\n                console.error(`Input value requirements not met.`);\r\n                Dropdown.cancelDropdown();\r\n                return;\r\n            }\r\n\r\n            onChange(target.value);\r\n            this.setState({selectedIndex: target.selectedIndex});\r\n            Dropdown.cancelDropdown();\r\n        };\r\n\r\n        Dropdown.dropdownElement = dropdown;\r\n    }\r\n\r\n    public static cancelDropdown() {\r\n        const dropdown = Dropdown.dropdownElement;\r\n        if (!dropdown)\r\n            return;\r\n        \r\n        dropdown.onchange = null;\r\n        dropdown.parentNode?.removeChild(dropdown);\r\n    }\r\n\r\n    onHover(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"pointer\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.hoverColor);\r\n        layer.draw();\r\n    }\r\n\r\n    onHoverExit(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"default\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", this.props.bgColor);\r\n        layer.draw();\r\n    }\r\n\r\n    render() {\r\n        const { x, y, width, height, fontSize, fontStyle, padding, textColor, bgColor, borderRadius, values } = this.props;\r\n\r\n        return(\r\n            <Label name=\"top-bar-label\"\r\n                x={x}\r\n                y={y}\r\n                onMouseEnter={this.onHover}\r\n                onMouseLeave={this.onHoverExit} \r\n                onClick={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showDropdown(event);\r\n                }}\r\n                onTap={event => {\r\n                    event.cancelBubble = true;\r\n                    this.showDropdown(event);\r\n                }}>\r\n                <Tag fill={bgColor}\r\n                        cornerRadius={borderRadius} />\r\n                <Text name=\"top-bar-text\"\r\n                        width={width}\r\n                        height={height}\r\n                        fontStyle={fontStyle}\r\n                        fontSize={fontSize}\r\n                        verticalAlign=\"middle\"\r\n                        padding={padding}\r\n                        fill={textColor}\r\n                        text={values[this.state.selectedIndex]} />\r\n            </Label>\r\n        );\r\n    }\r\n}","import Colors from \"../utils/Colors\";\r\nimport { Number, Boolean, Flow } from \"../utils/Types\";\r\n\r\nexport enum HandleType {\r\n    Circle,\r\n    Arrow\r\n}\r\n\r\nexport enum InputType {\r\n    None,\r\n    Input,\r\n    Dropdown\r\n}\r\n\r\nexport type SlotConfig = {\r\n    // handle config\r\n    handleType: HandleType;\r\n    handleBorderColor: string;\r\n    handleFillColor: string;\r\n\r\n    inputType: InputType;\r\n    defaultInputValue: string | string[];\r\n    initialValue: any;\r\n\r\n    fromString: (value: string) => any;\r\n    toString: (value: any) => string;\r\n}\r\n\r\nclass SlotConfigManager {\r\n    private configs: Map<string, SlotConfig>;\r\n\r\n    constructor() {\r\n        this.configs = new Map<string, SlotConfig>();\r\n\r\n        const numberConfig: SlotConfig = {\r\n            handleType: HandleType.Circle,\r\n            handleBorderColor: Colors.Green[700],\r\n            handleFillColor: Colors.Green[600],\r\n            inputType: InputType.Input,\r\n            defaultInputValue: \"\",\r\n            initialValue: Number.defaultValue,\r\n            fromString: Number.convertFromString,\r\n            toString: Number.convertToString\r\n        };\r\n\r\n        const booleanConfig: SlotConfig = {\r\n            handleType: HandleType.Circle,\r\n            handleBorderColor: Colors.Purple[600],\r\n            handleFillColor: Colors.Purple[500],\r\n            inputType: InputType.Dropdown,\r\n            defaultInputValue: [\"true\", \"false\"],\r\n            initialValue: Boolean.defaultValue,\r\n            fromString: Boolean.convertFromString,\r\n            toString: Boolean.convertToString\r\n        };\r\n\r\n        const flowConfig: SlotConfig = {\r\n            handleType: HandleType.Arrow,\r\n            handleBorderColor: Colors.Gray[500],\r\n            handleFillColor: Colors.Gray[100],\r\n            inputType: InputType.None,\r\n            defaultInputValue: \"\",\r\n            initialValue: Flow.defaultValue,\r\n            fromString: Flow.convertFromString,\r\n            toString: Flow.convertToString\r\n        }\r\n\r\n        this.configs.set(Number.className, numberConfig);\r\n        this.configs.set(Boolean.className, booleanConfig);\r\n        this.configs.set(Flow.className, flowConfig);\r\n    }\r\n\r\n    getConfig(type: string) {\r\n        return this.configs.get(type);\r\n    }\r\n}\r\n\r\nexport default new SlotConfigManager();\r\n\r\n","import React from 'react';\r\nimport { Circle, Path } from 'react-konva';\r\nimport { HandleType } from '../managers/SlotConfigManager';\r\nimport { KonvaForm } from './KonvaForm';\r\nimport { KonvaEventObject } from 'konva/types/Node';\r\nimport Konva from 'konva';\r\nimport Colors from '../utils/Colors';\r\nimport { Vector2d } from 'konva/types/types';\r\nimport { KonvaUtils } from '../utils/KonvaUtils';\r\n\r\nexport type NodeHandleProps = {\r\n    fill: string;\r\n    stroke: string;\r\n    type: HandleType;\r\n    isInput: boolean;\r\n    isFlow: boolean;\r\n    itemId: number;\r\n    slotId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type NodeHandleState = {\r\n    startPosition: Vector2d;\r\n}\r\n\r\nexport class NodeHandle extends React.Component<NodeHandleProps, NodeHandleState> {\r\n    private static path: Konva.Path | null = null;\r\n\r\n    constructor(props: NodeHandleProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            startPosition: {x: 0, y: 0},\r\n        }\r\n        \r\n        this.onDragStart = this.onDragStart.bind(this);\r\n        this.onDragMove = this.onDragMove.bind(this);\r\n        this.onDragEnd = this.onDragEnd.bind(this);\r\n        this.onMouseEnter = this.onMouseEnter.bind(this);\r\n        this.onMouseExit = this.onMouseExit.bind(this);\r\n    }\r\n\r\n    onDragStart(event: KonvaEventObject<DragEvent>) {\r\n        const layer: Konva.Layer | null = event.target.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        KonvaForm.cancel();\r\n        \r\n        const thisCircle = event.target;\r\n        const parent = thisCircle.parent;\r\n        if (!parent) {\r\n            console.error(`This Konva node should be under a container node.`);\r\n            return;\r\n        }\r\n\r\n        const startPos = thisCircle.getPosition();\r\n        const endPos = startPos;\r\n        const pathData = `M${startPos.x} ${startPos.y - 2} L${endPos.x} ${endPos.y - 2}`;\r\n        const path = new Konva.Path({\r\n            data: pathData,\r\n            stroke: Colors.Gray[800],\r\n            strokeWidth: 4\r\n        });\r\n\r\n        parent.add(path);\r\n        NodeHandle.path = path;\r\n        this.setState({startPosition: startPos});\r\n    }\r\n\r\n    onDragMove(event: KonvaEventObject<DragEvent>) {\r\n        const { isInput } = this.props;\r\n        const { startPosition } = this.state;\r\n\r\n        const layer: Konva.Layer | null = event.target.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const thisCircle = event.target;\r\n        const position = thisCircle.getPosition();\r\n        let startPos, endPos;\r\n\r\n        if (isInput) {\r\n            // The isInput specifies if its either the input handle or the output\r\n            // handle that's being dragged.\r\n            // Gotta flip the start and end positions so the path forms an S shape\r\n            // instead of a mirrored S shape when dragged.\r\n            startPos = position;\r\n            endPos = startPosition;\r\n        } else {\r\n            startPos = startPosition;\r\n            endPos = position;\r\n        }\r\n\r\n        const midpointPos: Vector2d = {\r\n            x: ((endPos.x - startPos.x) / 2) + (startPos.x),\r\n            y: ((endPos.y - startPos.y) / 2) + (startPos.y)\r\n        }\r\n        const pathData = `M${startPos.x} ${startPos.y - 2} Q${startPos.x + 30} ${startPos.y - 2} ${midpointPos.x} ${midpointPos.y - 2} Q${endPos.x - 30} ${endPos.y - 2} ${endPos.x} ${endPos.y - 2}`;\r\n        const path = NodeHandle.path;\r\n        if (!path) {\r\n            console.error(`The Konva path could not be found.`);\r\n            return;\r\n        }\r\n\r\n        path.data(pathData);\r\n    }\r\n\r\n    onDragEnd(event: KonvaEventObject<DragEvent>) {\r\n        const { isInput, isFlow, itemId, onConnect } = this.props;\r\n        const { startPosition } = this.state;\r\n\r\n        const thisCircle = event.target;\r\n        thisCircle.position(startPosition);\r\n\r\n        const path = NodeHandle.path;\r\n        if (path != null) {\r\n            path.destroy();\r\n            NodeHandle.path = null;\r\n        }\r\n\r\n        const stage = thisCircle.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        stage.draw();\r\n\r\n        const pointerPos = stage.getPointerPosition();\r\n        if (!pointerPos) {\r\n            console.error(`The Konva pointer position could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const screenX = Math.floor(pointerPos.x);\r\n        const screenY = Math.floor(pointerPos.y);\r\n\r\n        const elements = stage.getAllIntersections({x: screenX, y: screenY}) as Konva.Shape[];\r\n        \r\n        if (!elements || elements.length <= 0)\r\n            return;\r\n\r\n        let element: Konva.Shape | undefined;\r\n        let otherItemId: number = 0;\r\n        let otherSlotId: number = 0;\r\n\r\n        let i;\r\n        for (i = 0; i < elements.length; i++) {\r\n            const elem = elements[i];\r\n            const type = elem.getAttr(\"data-type\");\r\n            if (!type || (isInput ? type !== \"output\" : type !== \"input\"))\r\n                continue;\r\n            const slotType = elem.getAttr(\"data-slot-type\");\r\n            if (!slotType || (isFlow ? slotType !== \"control\" : slotType !== \"data\"))\r\n                continue;\r\n\r\n            otherItemId = elem.getAttr(\"data-item-id\");\r\n            otherSlotId = elem.getAttr(\"data-slot-id\");\r\n            // NOTE: These ids can be 0 and !id will return true\r\n            // TODO: Make ids to be unique uuids\r\n            if (otherItemId == null || otherSlotId == null) {\r\n                console.error(`No attributes 'data-item-id' or 'data-slot-id' could be found from the element.`);\r\n                continue;\r\n            }\r\n\r\n            if (itemId === otherItemId)\r\n                continue;\r\n\r\n            element = elem;\r\n            break;\r\n        }\r\n\r\n        if (!element)\r\n            return;\r\n\r\n        onConnect(otherItemId, otherSlotId);\r\n    }\r\n\r\n    onMouseEnter(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"pointer\");\r\n    }\r\n\r\n    onMouseExit(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"default\");\r\n    }\r\n\r\n    render() {\r\n        const { fill, stroke, type, isInput, isFlow, itemId, slotId } = this.props;\r\n        \r\n        return(\r\n            <>\r\n            {(type === HandleType.Circle &&\r\n                <Circle x={isInput ? 18 : -18}\r\n                    y={18}\r\n                    radius={4}\r\n                    fill={fill}\r\n                    stroke={stroke}\r\n                    strokeWidth={1}\r\n                    scale={{x: 1.5, y: 1.5}}\r\n                    listening={false} />\r\n            ) ||\r\n            (type === HandleType.Arrow &&\r\n                <Path data=\"M6.659,13.549L12.139,8.753C12.356,8.563 12.481,8.288 12.481,8C12.481,7.712 12.356,7.437 12.139,7.247L6.66,2.451C6.011,1.885 5,2.345 5,3.204L5,12.796C5,12.796 5,12.797 5,12.797C5,13.345 5.451,13.797 6,13.797C6.242,13.797 6.477,13.709 6.659,13.549Z\"\r\n                    x={isInput ? 5 : -31}\r\n                    y={6}\r\n                    fill={fill}\r\n                    stroke={stroke}\r\n                    strokeWidth={1}\r\n                    scale={{x: 1.5, y: 1.5}}\r\n                    listening={false} />\r\n            )}\r\n\r\n            <Circle data-type={`${isInput ? \"input\" : \"output\"}`}\r\n                    data-slot-type={`${isFlow ? \"control\" : \"data\"}`}\r\n                    data-item-id={itemId}\r\n                    data-slot-id={slotId}\r\n                    x={isInput ? 18 : -18}\r\n                    y={22}\r\n                    radius={15}\r\n                    fill=\"transparent\"\r\n                    draggable\r\n                    onDragStart={event => {\r\n                        event.cancelBubble = true;\r\n                        this.onDragStart(event);\r\n                    }}\r\n                    onDragMove={event => {\r\n                        event.cancelBubble = true;\r\n                        this.onDragMove(event);\r\n                    }}\r\n                    onDragEnd={event => {\r\n                        event.cancelBubble = true;\r\n                        this.onDragEnd(event);\r\n                    }}\r\n                    onMouseEnter={this.onMouseEnter}\r\n                    onMouseLeave={this.onMouseExit} />\r\n            </>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Group, Text } from 'react-konva';\r\nimport Konva from 'konva';\r\nimport Colors from '../utils/Colors';\r\nimport { Input, Dropdown } from './KonvaForm';\r\nimport SlotConfigManager, { InputType, HandleType } from '../managers/SlotConfigManager';\r\nimport { NodeHandle } from './NodeHandle';\r\nimport { InputSlot, OutputSlot, InputFlowSlot, OutputFlowSlot, ItemSlotPair } from '../models/NodeSlot';\r\nimport ScripletManager from '../managers/ScripletManager';\r\n\r\nexport type InputSlotProps = {\r\n    inputSlot: InputSlot;\r\n    inputConnection: ItemSlotPair | undefined;\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onInputChange: (value: any) => boolean;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type InputSlotState = {\r\n    labelWidth: number;\r\n    typeWidth: number;\r\n}\r\n\r\nexport class InputSlotDOM extends React.Component<InputSlotProps, InputSlotState> {\r\n    private label: React.RefObject<Konva.Text>;\r\n    private type: React.RefObject<Konva.Text>;\r\n\r\n    constructor(props: InputSlotProps) {\r\n        super(props);\r\n\r\n        this.label = React.createRef();\r\n        this.type = React.createRef();\r\n\r\n        this.state = {\r\n            labelWidth: 100,\r\n            typeWidth: 100\r\n        };\r\n\r\n        this.onInputChanged = this.onInputChanged.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        const labelWidth = this.label.current?.width();\r\n        const typeWidth = this.type.current?.width();\r\n        if (!labelWidth || !typeWidth) {\r\n            console.error(`The referenced Konva label or type text could not be found.`);\r\n            return;\r\n        }\r\n\r\n        this.setState({labelWidth: labelWidth, typeWidth: typeWidth});\r\n    }\r\n\r\n    onInputChanged(value: string): boolean {\r\n        const { inputSlot, onInputChange } = this.props;\r\n        const config = SlotConfigManager.getConfig(inputSlot.type);\r\n        if (!config) {\r\n            console.error(`Cannot find the input initial values for the given type '${inputSlot.type}'.`);\r\n            return false;\r\n        }\r\n\r\n        const val = config.fromString(value);\r\n        if (val == null)\r\n            return false;\r\n\r\n        return onInputChange(val);\r\n    }\r\n\r\n    render() {\r\n        const { inputSlot, inputConnection, x, y, itemId, onConnect } = this.props;\r\n        const { labelWidth, typeWidth } = this.state;\r\n        const config = SlotConfigManager.getConfig(inputSlot.type);\r\n        if (!config) {\r\n            console.error(`Cannot find the input initial values for the given type '${inputSlot.type}'.`);\r\n            return null;\r\n        }\r\n\r\n        const item = ScripletManager.currentScriplet?.getNode(itemId);\r\n        if (!item) {\r\n            console.error(`The node item of id '${itemId}' could not be found.`);\r\n            return null;\r\n        }\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text ref={this.label}\r\n                        x={inputSlot.isConnectable ? 36 : 16}\r\n                        y={0}\r\n                        height={20}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        verticalAlign=\"bottom\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={inputSlot.name} />\r\n                <Text ref={this.type}\r\n                        x={inputSlot.isConnectable ? 36 : 16}\r\n                        y={20}\r\n                        height={20}\r\n                        fontSize={10}\r\n                        verticalAlign=\"top\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={inputSlot.type} />\r\n                {(!inputConnection &&\r\n                ((config.inputType === InputType.Input &&\r\n                    <Input x={inputSlot.isConnectable ? 44 + Math.max(labelWidth, typeWidth) : 24 + Math.max(labelWidth, typeWidth)}\r\n                            y={12}\r\n                            width={30}\r\n                            height={12}\r\n                            fontSize={10}\r\n                            padding={2}\r\n                            borderRadius={2}\r\n                            textColor={Colors.Gray[100]}\r\n                            bgColor={Colors.Gray[700]}\r\n                            hoverColor={Colors.Gray[600]}\r\n                            value={`${item.value ?? inputSlot.defaultValue}`}\r\n                            onChange={this.onInputChanged} />\r\n                ) ||\r\n                (config.inputType === InputType.Dropdown &&\r\n                    <Dropdown x={inputSlot.isConnectable ? 44 + Math.max(labelWidth, typeWidth) : 24 + Math.max(labelWidth, typeWidth)}\r\n                            y={12}\r\n                            width={30}\r\n                            height={12}\r\n                            fontSize={10}\r\n                            padding={2}\r\n                            borderRadius={2}\r\n                            textColor={Colors.Gray[100]}\r\n                            bgColor={Colors.Gray[700]}\r\n                            hoverColor={Colors.Gray[600]}\r\n                            values={config.defaultInputValue as string[]}\r\n                            onChange={this.onInputChanged} />\r\n                )))}\r\n                {(inputSlot.isConnectable &&\r\n                    <NodeHandle fill={inputConnection ? config.handleFillColor : \"transparent\"}\r\n                                stroke={config.handleBorderColor}\r\n                                type={config.handleType}\r\n                                isInput={true}\r\n                                isFlow={false}\r\n                                itemId={itemId}\r\n                                slotId={inputSlot.id}\r\n                                onConnect={onConnect} />\r\n                )}\r\n            </Group>\r\n        );\r\n    }\r\n}\r\n\r\nexport type OutputSlotProps = {\r\n    outputSlot: OutputSlot;\r\n    outputConnections: ItemSlotPair[];\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n};\r\n\r\nexport type OutputSlotState = {\r\n    labelWidth: number;\r\n    typeWidth: number;\r\n}\r\n\r\nexport class OutputSlotDOM extends React.Component<OutputSlotProps, OutputSlotState> {\r\n    private label: React.RefObject<Konva.Text>;\r\n    private type: React.RefObject<Konva.Text>;\r\n\r\n    constructor(props: OutputSlotProps) {\r\n        super(props);\r\n\r\n        this.label = React.createRef();\r\n        this.type = React.createRef();\r\n\r\n        this.state = {\r\n            labelWidth: 100,\r\n            typeWidth: 100\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        const labelWidth = this.label.current?.width();\r\n        const typeWidth = this.type.current?.width();\r\n        if (!labelWidth || !typeWidth) {\r\n            console.error(`The referenced Konva label or type text could not be found.`);\r\n            return;\r\n        }\r\n\r\n        this.setState({labelWidth: labelWidth, typeWidth: typeWidth});\r\n    }\r\n\r\n    render() {\r\n        const { outputSlot, outputConnections, x, y, itemId, onConnect } = this.props;\r\n        const { labelWidth, typeWidth } = this.state;\r\n        const config = SlotConfigManager.getConfig(outputSlot.type);\r\n        if (!config) {\r\n            console.error(`Cannot find the input initial values for the given type '${outputSlot.type}'.`);\r\n            return null;\r\n        }\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text ref={this.label}\r\n                        x={0}\r\n                        y={0}\r\n                        offsetX={36 + labelWidth}\r\n                        height={20}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        align=\"right\"\r\n                        verticalAlign=\"bottom\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={outputSlot.name} />\r\n                <Text ref={this.type}\r\n                        x={0}\r\n                        y={20}\r\n                        offsetX={36 + typeWidth}\r\n                        height={20}\r\n                        fontSize={10}\r\n                        align=\"right\"\r\n                        verticalAlign=\"top\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={outputSlot.type} />\r\n                <NodeHandle fill={outputConnections.length > 0 ? config.handleFillColor : \"transparent\"}\r\n                            stroke={config.handleBorderColor}\r\n                            type={config.handleType}\r\n                            isInput={false}\r\n                            isFlow={false}\r\n                            itemId={itemId}\r\n                            slotId={outputSlot.id}\r\n                            onConnect={onConnect} />\r\n            </Group>\r\n        );\r\n    }\r\n}\r\n\r\nexport type InputFlowSlotProps = {\r\n    inputFlowSlot: InputFlowSlot;\r\n    inputFlowConnection: ItemSlotPair | undefined;\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type InputFlowSlotState = {\r\n    \r\n}\r\n\r\nexport class InputFlowSlotDOM extends React.Component<InputFlowSlotProps, InputFlowSlotState> {\r\n    render() {\r\n        const { inputFlowSlot, inputFlowConnection, x, y, itemId, onConnect } = this.props;\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text x={inputFlowSlot.isConnectable ? 36 : 16}\r\n                        y={0}\r\n                        height={40}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        verticalAlign=\"middle\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={inputFlowSlot.name} />\r\n                {(inputFlowSlot.isConnectable && \r\n                    <NodeHandle fill={inputFlowConnection ? Colors.Gray[100] : \"transparent\"}\r\n                                stroke={Colors.Gray[500]}\r\n                                type={HandleType.Arrow}\r\n                                isInput={true}\r\n                                isFlow={true}\r\n                                itemId={itemId}\r\n                                slotId={inputFlowSlot.id}\r\n                                onConnect={onConnect} />\r\n                )}\r\n            </Group>\r\n        );\r\n    }\r\n}\r\n\r\nexport type OutputFlowSlotProps = {\r\n    outputFlowSlot: OutputFlowSlot;\r\n    outputFlowConnection: ItemSlotPair | undefined;\r\n    x: number;\r\n    y: number;\r\n    itemId: number;\r\n    onConnect: (otherItemId: number, otherSlotId: number) => void;\r\n}\r\n\r\nexport type OutputFlowSlotState = {\r\n    labelWidth: number;\r\n}\r\n\r\nexport class OutputFlowSlotDOM extends React.Component<OutputFlowSlotProps, OutputFlowSlotState> {\r\n    private label: React.RefObject<Konva.Text>;\r\n\r\n    constructor(props: OutputFlowSlotProps) {\r\n        super(props);\r\n\r\n        this.label = React.createRef();\r\n\r\n        this.state = {\r\n            labelWidth: 100\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        const labelWidth = this.label.current?.width();\r\n        if (!labelWidth) {\r\n            console.error(`The referenced Konva label text could not be found.`);\r\n            return;\r\n        }\r\n\r\n        this.setState({labelWidth: labelWidth});\r\n    }\r\n    \r\n    render() {\r\n        const { outputFlowSlot, outputFlowConnection, x, y, itemId, onConnect } = this.props;\r\n        const { labelWidth } = this.state;\r\n\r\n        return(\r\n            <Group x={x}\r\n                    y={y}>\r\n                <Text ref={this.label}\r\n                        x={0}\r\n                        y={0}\r\n                        offsetX={36 + labelWidth}\r\n                        height={40}\r\n                        fontSize={12}\r\n                        fontStyle=\"bold\"\r\n                        align=\"right\"\r\n                        verticalAlign=\"middle\"\r\n                        fill={Colors.Gray[100]}\r\n                        text={outputFlowSlot.name} />\r\n                <NodeHandle fill={outputFlowConnection ? Colors.Gray[100] : \"transparent\"}\r\n                            stroke={Colors.Gray[500]}\r\n                            type={HandleType.Arrow}\r\n                            isInput={false}\r\n                            isFlow={true}\r\n                            itemId={itemId}\r\n                            slotId={outputFlowSlot.id}\r\n                            onConnect={onConnect} />\r\n            </Group>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Rect, Group, Label, Tag, Text } from 'react-konva';\r\nimport { Group as KonvaGroup } from 'konva/types/Group';\r\nimport Colors from '../utils/Colors';\r\nimport NodeConnections from '../managers/NodeConnections';\r\nimport { Input, KonvaForm } from '../components/KonvaForm';\r\nimport { Path } from 'konva/types/shapes/Path';\r\nimport { NodeItem } from '../models/NodeItem';\r\nimport { InputSlot, OutputSlot, InputFlowSlot, OutputFlowSlot } from '../models/NodeSlot';\r\nimport { InputSlotDOM, OutputSlotDOM, InputFlowSlotDOM, OutputFlowSlotDOM } from './NodeSlot';\r\nimport { KonvaUtils } from '../utils/KonvaUtils';\r\nimport '../assets/css/fontawesome.min.css';\r\nimport '../assets/css/solid.min.css';\r\nimport ScripletManager from '../managers/ScripletManager';\r\n\r\nexport type NodeProps = {\r\n    item: NodeItem;\r\n    width: number;\r\n    rowHeight: number;\r\n    topBarHeight: number;\r\n    handleDragNode(index: number, x: number, y: number): any;\r\n    deleteNodeItem(id: number): any;\r\n    updateDOM(): any;\r\n}\r\n\r\nexport type NodeState = {\r\n    draggedHandlePath: Path | null;\r\n    isStateOpen: boolean;\r\n    stateVisual: KonvaGroup | null;\r\n}\r\n\r\nexport default class Node extends React.Component<NodeProps, NodeState> {\r\n    private group: React.RefObject<KonvaGroup>;\r\n    \r\n    constructor(props: NodeProps) {\r\n        super(props);\r\n\r\n        this.group = React.createRef<KonvaGroup>();\r\n\r\n        this.state = {\r\n            draggedHandlePath: null,\r\n            isStateOpen: false,\r\n            stateVisual: null\r\n        }\r\n\r\n        /*\r\n        this.handleHoverEnterEditableText = this.handleHoverEnterEditableText.bind(this);\r\n        this.handleHoverExitEditableText = this.handleHoverExitEditableText.bind(this);\r\n        this.handleHoverEnterToggleState = this.handleHoverEnterToggleState.bind(this);\r\n        this.handleHoverExitToggleState = this.handleHoverExitToggleState.bind(this);\r\n        this.openState = this.openState.bind(this);\r\n        this.closeState = this.closeState.bind(this);\r\n        this.toggleState = this.toggleState.bind(this);\r\n        */\r\n    }\r\n\r\n    componentDidMount() {\r\n        const layer = this.group.current?.getLayer();\r\n        if (layer) {\r\n        }\r\n    }\r\n\r\n    // These commented code below can eventually be used if there are some node schemas\r\n    // in the future that can have some state saved beyond their inputs.\r\n    /* \r\n    handleHoverEnterToggleState(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"pointer\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", Colors.Gray[700]);\r\n        layer.draw();\r\n    }\r\n\r\n    handleHoverExitToggleState(event: KonvaEventObject<Event>) {\r\n        KonvaUtils.setCursor(event, \"default\");\r\n\r\n        const layer = event.currentTarget.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const textBG = event.currentTarget.children[0];\r\n        textBG.setAttr(\"fill\", Colors.Gray[900]);\r\n        layer.draw();\r\n    }\r\n\r\n    openState() {\r\n        if (this.state.stateVisual) {\r\n            console.error(`This node already has an opened state visual. Close it first then try again.`);\r\n            return;\r\n        }\r\n\r\n        const { item, rowHeight, topBarHeight } = this.props;\r\n\r\n        // Show the custom schema state visual here\r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The node schema could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const state = schema.createNewSchema();\r\n\r\n        const stateVisual = schema.state.onShowStateVisual(this.props);\r\n        if (!stateVisual) {\r\n            console.error(`The Konva group to show the node state could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const thisGroup = this.group.current;\r\n        if (!thisGroup) {\r\n            console.error(`The Konva group for this node could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const layer = thisGroup.getLayer();\r\n        if (!layer) {\r\n            console.error(`The Konva layer could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const bgRect = this.group.current?.children[0] as Konva.Rect;\r\n        if (!bgRect) {\r\n            console.error(`The Konva bg rect could not be found.`);\r\n            return;\r\n        }\r\n\r\n        bgRect.cornerRadius([5, 5, 0, 0]);\r\n\r\n        const height = schema.maxLength() * rowHeight + topBarHeight + 10;\r\n        stateVisual.x(0);\r\n        stateVisual.y(height);\r\n        thisGroup.add(stateVisual);\r\n        layer.draw();\r\n\r\n        this.setState({isStateOpen: true, stateVisual: stateVisual});\r\n    }\r\n\r\n    closeState() {\r\n        if (!this.state.stateVisual) {\r\n            console.error(`This node has no state visual to close.`);\r\n            return;\r\n        }\r\n\r\n        const bgRect = this.group.current?.children[0] as Konva.Rect;\r\n        if (!bgRect) {\r\n            console.error(`The Konva bg rect could not be found.`);\r\n            return;\r\n        }\r\n\r\n        bgRect.cornerRadius(5);\r\n\r\n        this.state.stateVisual.destroy();\r\n        this.setState({isStateOpen: false, stateVisual: null});\r\n    }\r\n\r\n    toggleState() {\r\n        if (this.state.isStateOpen)\r\n            this.closeState();\r\n        else\r\n            this.openState();\r\n    }\r\n    */\r\n\r\n\r\n    render() {\r\n        const { item, width, rowHeight, topBarHeight, handleDragNode, deleteNodeItem, updateDOM } = this.props;\r\n        const height = item.schema ? item.schema.maxLength() * rowHeight + topBarHeight : 0;\r\n        \r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The schema for node item '${item.id}' could not be found.`);\r\n            return null;\r\n        }\r\n\r\n        const inputSlots: InputSlot[] = schema.inputSlots;\r\n        const outputSlots: OutputSlot[] = schema.outputSlots;\r\n        const inputFlowSlots: InputFlowSlot[] = schema.inputFlowSlots;\r\n        const outputFlowSlots: OutputFlowSlot[] = schema.outputFlowSlots;\r\n\r\n        let inputs: (InputSlot | InputFlowSlot)[] = [];\r\n        inputs = inputs.concat(inputFlowSlots, inputSlots);\r\n\r\n        let outputs: (OutputSlot | OutputFlowSlot)[] = [];\r\n        outputs = outputs.concat(outputFlowSlots, outputSlots);\r\n\r\n        // TODO: These two seem hackish\r\n        const inputTypeGuard = (input: InputSlot | InputFlowSlot): input is InputSlot => {\r\n            if ((input as InputSlot).type)\r\n                return true;\r\n            return false;\r\n        }\r\n        const outputTypeGuard = (output: OutputSlot | OutputFlowSlot): output is OutputSlot => {\r\n            if ((output as OutputSlot).type)\r\n                return true;\r\n            return false;\r\n        }\r\n        return(\r\n            <Group id={`node-${item.id}`}\r\n                    ref={this.group}\r\n                    x={item.x}\r\n                    y={item.y}\r\n                    width={width}\r\n                    height={height}\r\n                    draggable\r\n                    onDragStart={event => {\r\n                        KonvaUtils.setCursor(event, \"move\");\r\n                        KonvaForm.cancel();\r\n                    }}\r\n                    onDragEnd={event => {\r\n                        KonvaUtils.setCursor(event, \"default\");\r\n                        ScripletManager.currentScriplet?.updateNodes();\r\n                    }}\r\n                    onDragMove={event => handleDragNode(item.id, event.target.x(), event.target.y())}>\r\n                <Rect name=\"background\"\r\n                        x={0}\r\n                        y={0}\r\n                        width={width}\r\n                        height={height + 10}\r\n                        fill={Colors.Gray[900]}\r\n                        cornerRadius={5} />\r\n                <Rect name=\"top-bar\"\r\n                        x={0}\r\n                        y={0}\r\n                        width={width}\r\n                        height={topBarHeight}\r\n                        fill={Colors.Gray[900]}\r\n                        cornerRadius={[5, 5, 0, 0]} />\r\n                <Input x={10}\r\n                        y={2.5}\r\n                        width={schema.isDeletable ? width - 40 : width - 20}\r\n                        height={topBarHeight - 5}\r\n                        borderRadius={2}\r\n                        padding={6}\r\n                        textColor={Colors.Gray[100]}\r\n                        bgColor={Colors.Gray[900]}\r\n                        hoverColor={Colors.Gray[800]}\r\n                        value={(!item.customName || item.customName === \"\") ? item.schema?.name ?? \"undefined\" : item.customName}\r\n                        onChange={value => {\r\n                            item.customName = value; \r\n                            updateDOM();\r\n                            return true;\r\n                        }} />\r\n                {(schema.isDeletable && \r\n                    <Label x={width - 20}\r\n                            y={8}\r\n                            onMouseEnter={event => {\r\n                                event.cancelBubble = true;\r\n                                KonvaUtils.setCursor(event, \"pointer\");\r\n                            }}\r\n                            onMouseLeave={event => {\r\n                                event.cancelBubble = true;\r\n                                KonvaUtils.setCursor(event, \"default\");\r\n                            }}\r\n                            onClick={event => {\r\n                                KonvaUtils.setCursor(event, \"default\");\r\n                                KonvaForm.cancel();\r\n                                deleteNodeItem(item.id);\r\n                            }}>\r\n                        <Tag fill={Colors.Red[500]}\r\n                            cornerRadius={15} />\r\n                        <Text width={12}\r\n                                height={12}\r\n                                fontSize={14}\r\n                                fontStyle=\"bold\"\r\n                                align=\"center\"\r\n                                verticalAlign=\"center\"\r\n                                fill={Colors.Gray[900]}\r\n                                text=\"&#215;\" />\r\n                    </Label>\r\n                )}\r\n                <Rect x={0}\r\n                        y={topBarHeight}\r\n                        width={width}\r\n                        height={rowHeight * (item.schema?.maxLength() ?? 1)}\r\n                        fill={Colors.Gray[800]} />\r\n                {Array.from(Array(item.schema?.maxLength() ?? 0)).map((it, i) => {\r\n                const input: InputSlot | undefined = i < inputs.length && inputTypeGuard(inputs[i]) ? inputs[i] as InputSlot : undefined;\r\n                const output: OutputSlot | undefined = i < outputs.length && outputTypeGuard(outputs[i]) ? outputs[i] as OutputSlot : undefined;\r\n\r\n                if (input && input.name == null)\r\n                    input.name = `Input${i}`;\r\n                if (output && output.name == null)\r\n                    output.name = `Output${i}`;\r\n\r\n                const inputFlow: InputFlowSlot | undefined = i < inputs.length && !inputTypeGuard(inputs[i]) ? inputs[i] as InputFlowSlot : undefined;\r\n                const outputFlow: OutputFlowSlot | undefined = i < outputs.length && !outputTypeGuard(outputs[i]) ? outputs[i] as OutputFlowSlot : undefined;\r\n                \r\n                if (inputFlow && inputFlow.name == null)\r\n                    inputFlow.name = `Flow${i}`;\r\n                if (outputFlow && outputFlow.name == null)\r\n                    outputFlow.name = `Flow${i}`;\r\n                return(\r\n                    <React.Fragment key={`node-slot-${item.id}-${i}`}>\r\n                        {input != null  && \r\n                            <>\r\n                            <InputSlotDOM inputSlot={input}\r\n                                        inputConnection={item.getInputConnection(input.id)}\r\n                                        x={0}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onInputChange={value => {\r\n                                            item.value = value;\r\n                                            ScripletManager.currentScriplet?.updateNodes();\r\n\r\n                                            return true;\r\n                                        }}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addConnection(item.id, input.id, otherItemId, otherSlotId);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                        {output != null &&\r\n                            <>\r\n                            <OutputSlotDOM outputSlot={output}\r\n                                        outputConnections={item.getOutputConnections(output.id)}\r\n                                        x={width}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addConnection(otherItemId, otherSlotId, item.id, output.id);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                        {inputFlow != null  && \r\n                            <>\r\n                            <InputFlowSlotDOM inputFlowSlot={inputFlow}\r\n                                        inputFlowConnection={item.getInputFlowConnection(inputFlow.id)}\r\n                                        x={0}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addFlowConnection(item.id, inputFlow.id, otherItemId, otherSlotId);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                        {outputFlow != null &&\r\n                            <>\r\n                            <OutputFlowSlotDOM outputFlowSlot={outputFlow}\r\n                                        outputFlowConnection={item.getOutputFlowConnection(outputFlow.id)}\r\n                                        x={width}\r\n                                        y={topBarHeight + (i * rowHeight)}\r\n                                        itemId={item.id}\r\n                                        onConnect={(otherItemId, otherSlotId) => {\r\n                                            NodeConnections.addFlowConnection(otherItemId, otherSlotId, item.id, outputFlow.id);\r\n                                            updateDOM();\r\n                                        }} />\r\n                            </>\r\n                        }\r\n                    </React.Fragment>\r\n                );\r\n                })}\r\n                {/*\r\n                <Label name=\"show-state\"\r\n                        x={0}\r\n                        y={height}\r\n                        width={width}\r\n                        height={5}\r\n                        onMouseEnter={this.handleHoverEnterToggleState}\r\n                        onMouseLeave={this.handleHoverExitToggleState}\r\n                        onClick={this.toggleState}>\r\n                    <Tag fill={Colors.Gray[900]}\r\n                            cornerRadius={5} />\r\n                    <Text width={width}\r\n                            height={10}\r\n                            fontFamily=\"Font Awesome\\ 5 Free\"\r\n                            text={`${this.state.isStateOpen ? \"\\uf106\" : \"\\uf107\"}`}\r\n                            fill={Colors.Gray[100]}\r\n                            align=\"center\"\r\n                            verticalAlign=\"middle\" />\r\n                </Label>\r\n                */}\r\n            </Group>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Vector2d } from 'konva/types/types';\r\nimport { Path } from 'react-konva';\r\nimport Colors from '../utils/Colors';\r\n\r\nexport type EdgeProps = {\r\n    startPos: Vector2d;\r\n    endPos: Vector2d;\r\n    nodeWidthOther: number;\r\n    nodeHeight: number;\r\n    handleOnClick?(): any;\r\n    children?(midpointPos: Vector2d, isHovered: boolean): React.ReactNode | null;\r\n}\r\n\r\nexport type EdgeState = {\r\n    isHovered: boolean;\r\n}\r\n\r\nexport default class Edge extends React.Component<EdgeProps, EdgeState> {\r\n    constructor(props: EdgeProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isHovered: false\r\n        };\r\n\r\n        this.handleOnEnter = this.handleOnEnter.bind(this);\r\n        this.handleOnExit = this.handleOnExit.bind(this);\r\n    }\r\n\r\n    handleOnEnter() {\r\n        this.setState({isHovered: true});\r\n    }\r\n\r\n    handleOnExit() {\r\n        this.setState({isHovered: false});\r\n    }\r\n\r\n    render() {\r\n        const { startPos, endPos, nodeWidthOther: nodeWidthOutput, nodeHeight, handleOnClick, children } = this.props;\r\n        const { isHovered } = this.state;\r\n        const halfNodeHeight = nodeHeight / 2;\r\n        const midpointPos: Vector2d = {\r\n            x: ((endPos.x - startPos.x - nodeWidthOutput) / 2) + (startPos.x + nodeWidthOutput),\r\n            y: ((endPos.y + halfNodeHeight - startPos.y - halfNodeHeight) / 2) + (startPos.y + halfNodeHeight)\r\n        }\r\n        const pathData = `M${startPos.x + nodeWidthOutput} ${startPos.y + halfNodeHeight - 2} Q${startPos.x + nodeWidthOutput + 30} ${startPos.y + halfNodeHeight - 2} ${midpointPos.x} ${midpointPos.y - 2} Q${endPos.x - 30} ${endPos.y + halfNodeHeight - 2} ${endPos.x} ${endPos.y + halfNodeHeight - 2}`;\r\n        return(\r\n            <>\r\n                <Path data={pathData}\r\n                    stroke={Colors.Gray[800]}\r\n                    strokeWidth={4} />\r\n                <Path data={pathData}\r\n                    className=\"cursor-pointer\"\r\n                    stroke=\"transparent\"\r\n                    strokeWidth={50}\r\n                    onMouseEnter={event => {\r\n                        this.handleOnEnter();\r\n                        const stage = event.target.getStage();\r\n                        if (!stage) {\r\n                            console.error(`The Konva stage could not be found.`);\r\n                            return;\r\n                        }\r\n                        stage.container().style.cursor = \"pointer\";\r\n                    }}\r\n                    onMouseLeave={event => {\r\n                        this.handleOnExit();\r\n                        const stage = event.target.getStage();\r\n                        if (!stage) {\r\n                            console.error(`The Konva stage could not be found.`);\r\n                            return;\r\n                        }\r\n                        stage.container().style.cursor = \"default\";\r\n                    }}\r\n                    onMouseDown={handleOnClick}\r\n                    onTouchEnd={handleOnClick} />\r\n                {children != null ? children(midpointPos, isHovered) : null}\r\n            </>\r\n        );\r\n    }\r\n}","import { BaseNodeSchema } from \"../models/NodeSchema\";\r\nimport NodeSchemaManager from \"./NodeSchemaManager\";\r\n\r\nexport class Category {\r\n    public name: string;\r\n    public subCategories: Category[];\r\n    public contentChildren: BaseNodeSchema[];\r\n\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.subCategories = [];\r\n        this.contentChildren = [];\r\n    }\r\n\r\n    getSubCategory(name: string) {\r\n        let subCategory = this.subCategories.find(cat => cat.name === name);\r\n        if (!subCategory) {\r\n            subCategory = new Category(name);\r\n            this.subCategories.push(subCategory);\r\n        }\r\n\r\n        return subCategory;\r\n    }\r\n\r\n    addContent(id: string) {\r\n        if (this.contentChildren.find(schema => schema.name === id)) {\r\n            console.error(`A duplicate of the schema '${id}' was found.`);\r\n            return;\r\n        }\r\n\r\n        const schema = NodeSchemaManager.getBaseSchema(id);\r\n        this.contentChildren.push(schema);\r\n    }\r\n}\r\n\r\nclass CategoryManager {\r\n    getRootSchemaCategory(schemas: BaseNodeSchema[]): Category {\r\n        const categoryRoot = new Category(\"root\");\r\n\r\n        let currentCategory = categoryRoot;\r\n        schemas.forEach(schema => {\r\n            const idArr = schema.id.split(\"/\");\r\n            let i;\r\n            for (i = 0; i < idArr.length - 1; i++) {\r\n                currentCategory = currentCategory.getSubCategory(idArr[i]);\r\n            }\r\n            currentCategory.addContent(schema.id);\r\n            currentCategory = categoryRoot;\r\n        });\r\n\r\n        return categoryRoot;\r\n    }\r\n}\r\n\r\nexport default new CategoryManager();","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport NodeSchemaManager from '../managers/NodeSchemaManager';\r\nimport Scrollbar from 'react-scrollbars-custom';\r\nimport { BaseNodeSchema } from '../models/NodeSchema';\r\nimport CategoryManager, { Category } from '../managers/CategoryManager';\r\n\r\nexport type SchemaCategoryProps = {\r\n    category: Category;\r\n    depth: number;\r\n    addNodeItem: (id: string) => any;\r\n}\r\n\r\nexport type SchemaCategoryState = {\r\n    showChildren: boolean;\r\n}\r\n\r\nclass SchemaCategory extends React.Component<SchemaCategoryProps, SchemaCategoryState> {\r\n    constructor(props: SchemaCategoryProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            showChildren: true\r\n        }\r\n\r\n        this.toggleCategory = this.toggleCategory.bind(this);\r\n        this.openCategory = this.openCategory.bind(this);\r\n        this.closeCategory = this.closeCategory.bind(this);\r\n    }\r\n\r\n    toggleCategory() {\r\n        if (this.state.showChildren)\r\n            this.closeCategory();\r\n        else\r\n            this.openCategory();\r\n    }\r\n\r\n    openCategory() {\r\n        this.setState({showChildren: true});\r\n    }\r\n\r\n    closeCategory() {\r\n        this.setState({showChildren: false});\r\n    }\r\n\r\n    render() {\r\n        const { category, depth, addNodeItem } = this.props;\r\n        const { showChildren } = this.state;\r\n        if (category.name.toLowerCase() === \"hidden\")\r\n            return null;\r\n        return (\r\n            <div style={{marginLeft: `${category.name === \"root\" ? -1 : 0}rem`}}>\r\n                {category.name !== \"root\" && (\r\n                    <div className=\"flex flex-row items-center rounded-sm border-b bg-gray-900 hover:bg-gray-800 text-gray-100 cursor-pointer select-none\" \r\n                            style={{borderColor: \"#111111\"}}\r\n                            onClick={this.toggleCategory}>\r\n                        <div className=\"px-2 text-xs\">\r\n                            <FontAwesomeIcon icon=\"chevron-down\" className={`${showChildren ? \"hidden\" : \"\"}`} />\r\n                            <FontAwesomeIcon icon=\"chevron-up\" className={`${showChildren ? \"\" : \"hidden\"}`} />\r\n                        </div>\r\n                        <div className=\"text-sm\">\r\n                            {category.name}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n                <div className={`${showChildren ? \"\" : \"hidden\"} pl-4`}>\r\n                    <div className=\"\">\r\n                        {category.subCategories.map((subCategory, index) => (\r\n                            <SchemaCategory key={`category-${depth}-${index}`}\r\n                                            category={subCategory} \r\n                                            depth={depth + 1}\r\n                                            addNodeItem={addNodeItem} />\r\n                        ))}\r\n                    </div>\r\n                    <div className=\"\">\r\n                        {category.contentChildren.map((child, index) => (\r\n                            <div key={`child-${depth}-${index}`} \r\n                                className=\"px-2 rounded-sm hover:bg-gray-700 text-gray-100 cursor-pointer select-none\"\r\n                                onClick={event => {\r\n                                    event.stopPropagation();\r\n                                    addNodeItem(child.id);\r\n                                }}>\r\n                                {child.name}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nexport type SchemaSelectorProps = {\r\n    isVisible: boolean;\r\n    x: number;\r\n    y: number;\r\n    addNodeItem: (id: string) => any;\r\n}\r\n\r\nexport type SchemaSelectorState = {\r\n    searchValue: string;\r\n    schemaResults: BaseNodeSchema[];\r\n}\r\n\r\n// TODO: Categorized selector\r\nexport default class SchemaSelector extends React.Component<SchemaSelectorProps, SchemaSelectorState> {\r\n    constructor(props: SchemaSelectorProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            searchValue: \"\",\r\n            schemaResults: NodeSchemaManager.getBaseSchemas()\r\n        }\r\n\r\n        this.onSearchChange = this.onSearchChange.bind(this);\r\n        this.onSearchReset = this.onSearchReset.bind(this);\r\n        this.filterSearch = this.filterSearch.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.filterSearch(\"\");\r\n    }\r\n\r\n    onSearchChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n        const searchValue = event.target.value;\r\n        this.filterSearch(searchValue);\r\n    }\r\n\r\n    onSearchReset() {\r\n        this.filterSearch(\"\");\r\n    }\r\n\r\n    filterSearch(searchValue: string) {\r\n        let schemas = NodeSchemaManager.getBaseSchemas();\r\n        schemas = schemas.filter(schema => (schema.name.toLowerCase().includes(searchValue.toLowerCase()) || \r\n                                            schema.id.toLowerCase().includes(searchValue.toLowerCase())) &&\r\n                                            !schema.id.toLowerCase().includes(\"hidden\"));\r\n        this.setState({schemaResults: schemas, searchValue: searchValue});\r\n    }\r\n\r\n    render() {\r\n        const { isVisible, x, y, addNodeItem } = this.props;\r\n        const { schemaResults } = this.state;\r\n\r\n        const width = 250;\r\n        const height = 225;\r\n\r\n        const rootCategory = CategoryManager.getRootSchemaCategory(schemaResults);\r\n        return (\r\n            <div className={`${isVisible ? \"flex\" : \"hidden\"} flex-col absolute rounded bg-gray-900 bg-opacity-90`} \r\n                    style={{top: y, left: x, width: `${Math.min(width, window.innerWidth - x)}px`, height: `${Math.min(height, window.innerHeight - y)}px`}}>\r\n                <div className=\"p-3 h-12 flex flex-row w-full\">\r\n                    <div className=\"px-2 rounded-l-full bg-gray-100\">\r\n                        <FontAwesomeIcon icon=\"search\" \r\n                                            className=\"text-sm text-gray-700\" />\r\n                    </div>\r\n                    \r\n                    <input type=\"text\" \r\n                                value={this.state.searchValue}\r\n                                className=\"w-full bg-gray-100 border-none text-sm\"\r\n                                onChange={this.onSearchChange} />\r\n                    <button className=\"px-2 flex items-center rounded-r-full bg-gray-100\"\r\n                            onClick={this.onSearchReset}>\r\n                        <FontAwesomeIcon icon=\"times-circle\" \r\n                                            className=\"text-sm text-gray-700\" />\r\n                    </button>\r\n                </div>\r\n                <Scrollbar noScrollX>\r\n                    <SchemaCategory category={rootCategory} depth={0} addNodeItem={addNodeItem} />\r\n                </Scrollbar>\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport Node from './Node';\r\nimport { Stage, Layer, Group, Rect, Text } from 'react-konva';\r\nimport { Stage as PortalStage, Layer as PortalLayer, Portal } from 'react-konva-portal';\r\nimport Edge from './Edge';\r\nimport Colors from '../utils/Colors';\r\nimport { KonvaEventObject } from 'konva/types/Node';\r\nimport NodeConnections from '../managers/NodeConnections';\r\nimport ScripletManager from '../managers/ScripletManager';\r\nimport Konva from 'konva';\r\nimport FontFaceObserver from 'fontfaceobserver';\r\nimport { KonvaForm } from './KonvaForm';\r\nimport SchemaSelector from './SchemaSelector';\r\nimport { Vector2d } from 'konva/types/types';\r\nimport { ItemSlotPair } from '../models/NodeSlot';\r\n\r\nexport type ScripletRootProps = {\r\n    scripletId: number;\r\n}\r\n\r\nexport type ScripletRootState = {\r\n    isDirtyDOM: boolean;\r\n    isReadyToMount: boolean;\r\n    isReady: boolean;\r\n    contextMenu: Konva.Node | null;\r\n    inputElement: HTMLInputElement | null;\r\n    isContextMenuShown: boolean;\r\n    contextMenuPos: Vector2d;\r\n    nodeInitPos: Vector2d;\r\n}\r\n\r\nexport default class ScripletRoot extends React.Component<ScripletRootProps, ScripletRootState> {\r\n    private stageContainer: React.RefObject<HTMLDivElement>;\r\n    private stage: React.RefObject<Stage>;\r\n\r\n    constructor(props: ScripletRootProps) {\r\n        super(props);\r\n\r\n        this.stageContainer = React.createRef<HTMLDivElement>();\r\n        this.stage = React.createRef<Stage>();\r\n\r\n        this.state = {\r\n            isDirtyDOM: false,\r\n            isReadyToMount: false,\r\n            isReady: false,\r\n            contextMenu: null,\r\n            inputElement: null,\r\n            isContextMenuShown: false,\r\n            contextMenuPos: {x: 0, y: 0},\r\n            nodeInitPos: {x: 0, y: 0}\r\n        };\r\n\r\n        this.updateDOM = this.updateDOM.bind(this);\r\n        this.addNodeItem = this.addNodeItem.bind(this);\r\n        this.deleteNodeItem = this.deleteNodeItem.bind(this);\r\n        this.handleDragNode = this.handleDragNode.bind(this);\r\n        this.handleDeleteEdge = this.handleDeleteEdge.bind(this);\r\n        this.handleDeleteFlowEdge = this.handleDeleteFlowEdge.bind(this);\r\n        this.handleZoom = this.handleZoom.bind(this);\r\n        this.handleContextMenu = this.handleContextMenu.bind(this);\r\n        this.handleCancelContextMenu = this.handleCancelContextMenu.bind(this);\r\n        this.fitToParent = this.fitToParent.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        ScripletManager.selectScriplet(this.props.scripletId).then(result => {\r\n            console.log(result);\r\n            if (!result)\r\n                return;\r\n\r\n            this.setState({isReadyToMount: true});\r\n        });\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener('resize', this.fitToParent);\r\n    }\r\n\r\n    componentDidUpdate() {\r\n        if (this.state.isReadyToMount) {\r\n            window.addEventListener('resize', this.fitToParent);\r\n            this.fitToParent();\r\n\r\n            const stage = this.stage.current?.getStage();\r\n            if (stage) {\r\n                const fontAwesomeObserver = new FontFaceObserver(\"Font Awesome 5 Free\");\r\n                // This is necessary to show the fontawesome icons at start\r\n                fontAwesomeObserver.load().then(() => {\r\n                    console.log(\"Font Awesome 5 has loaded!\");\r\n                    stage.draw();\r\n                }, () => {\r\n                    console.error(\"Font Awesome 5 has not loaded!\");\r\n                });\r\n            }\r\n\r\n            this.setState({isReadyToMount: false, isReady: true});\r\n        }\r\n\r\n        if (this.state.isDirtyDOM) {\r\n            this.setState({isDirtyDOM: false});\r\n        }\r\n    }\r\n\r\n    updateDOM() {\r\n        this.setState({isDirtyDOM: true});\r\n    }\r\n\r\n    addNodeItem(id: string) {\r\n        const { nodeInitPos } = this.state;\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        scriplet.addNode(nodeInitPos.x, nodeInitPos.y, id, [], [], new Map<number, ItemSlotPair[]>(), []);\r\n        this.handleCancelContextMenu();\r\n        this.updateDOM();\r\n    }\r\n\r\n    deleteNodeItem(id: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const item = scriplet.getNode(id);\r\n        if (!item) {\r\n            console.error(`The node item of id '${id}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The schema of node item '${id}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        if (!schema.isDeletable) {\r\n            console.error(`This schema cannot be deleted.`);\r\n            return;\r\n        }\r\n\r\n        // Delete the node connections to other nodes too\r\n        if (NodeConnections.deleteAllConnections(id)) {\r\n            scriplet.deleteNode(id);\r\n            this.updateDOM();\r\n        }\r\n    }\r\n\r\n    // Should only happen on drag end, but node connections won't follow anymore if not done on drag move\r\n    // TODO: Optimize this!\r\n    handleDragNode(itemId: number, x: number, y: number) {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const node = scriplet.getNode(itemId);\r\n        if (!node) {\r\n            console.error(`The node of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n\r\n        node.x = x;\r\n        node.y = y;\r\n\r\n        scriplet.items.set(itemId, node);\r\n\r\n        // TODO: This lags! If possible, access the edges (konva path) directly and change the coords there\r\n        this.updateDOM();\r\n    }\r\n\r\n    handleDeleteEdge(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        NodeConnections.deleteConnection(inputItemId, inputSlotId, outputItemId, outputSlotId);\r\n        this.updateDOM();\r\n    }\r\n\r\n    handleDeleteFlowEdge(inputItemId: number, inputSlotId: number, outputItemId: number, outputSlotId: number) {\r\n        NodeConnections.deleteFlowConnection(inputItemId, inputSlotId, outputItemId, outputSlotId);\r\n        this.updateDOM();\r\n    }\r\n\r\n    handleZoom(event: KonvaEventObject<WheelEvent>) {\r\n        event.evt.preventDefault();\r\n        const stage = event.target.getStage();\r\n        if (!stage) {\r\n            console.error(`The Konva Stage could not be found.`);\r\n            return;\r\n        }\r\n            \r\n        const oldScale: number = stage.scaleX();\r\n        const scaleBy = 1.1;\r\n        const pointer = stage.getPointerPosition();\r\n        if (!pointer) {\r\n            console.error(`The Konva pointer position could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const mousePosition = {\r\n            x: (pointer.x - stage.x()) / oldScale,\r\n            y: (pointer.y - stage.y()) / oldScale\r\n        };\r\n\r\n        const newScale = event.evt.deltaY < 0 ? oldScale * scaleBy : oldScale / scaleBy;\r\n\r\n        stage.scale({ x: newScale, y: newScale});\r\n\r\n        const newPos = {\r\n            x: pointer.x - mousePosition.x * newScale,\r\n            y: pointer.y - mousePosition.y * newScale\r\n        };\r\n        stage.position(newPos);\r\n        stage.batchDraw();\r\n    }\r\n\r\n    handleContextMenu(event: KonvaEventObject<PointerEvent>) {\r\n        if (event.target.getType() !== \"Stage\")\r\n            return;\r\n        const stage = event.target.getStage();\r\n        const layer: Konva.Layer | null = event.target.getChildren(item => item.getAttr(\"data-name\") === \"context-menu-layer\")[0];\r\n        if (!layer || !stage) {\r\n            console.error(`Either the Konva layer or Konva stage could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const pointerPos = stage.getPointerPosition();\r\n        if (!pointerPos) {\r\n            console.error(`The Konva pointer position could not be found.`);\r\n            return;\r\n        }\r\n\r\n        pointerPos.x = (pointerPos.x - stage.x()) / stage.scaleX();\r\n        pointerPos.y = (pointerPos.y - stage.y()) / stage.scaleY();\r\n\r\n        this.setState({isContextMenuShown: true, contextMenuPos: {x: event.evt.pageX, y: event.evt.pageY}, nodeInitPos: pointerPos});\r\n    }\r\n\r\n    handleCancelContextMenu() {\r\n        this.setState({isContextMenuShown: false});\r\n    }\r\n\r\n    fitToParent() {\r\n        const container = this.stageContainer.current;\r\n        const stage = this.stage.current;\r\n        if (!container || !stage) {\r\n            console.error(`Either the referenced container or referenced stage could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const stageObj = stage.getStage();\r\n        stageObj.width(container.offsetWidth);\r\n        stageObj.height(container.offsetHeight);\r\n        stageObj.draw();\r\n    }\r\n    \r\n    render() {\r\n        const { isReadyToMount, isReady, isContextMenuShown, contextMenuPos } = this.state;\r\n\r\n        if (!isReadyToMount && !isReady)\r\n            return null;\r\n\r\n        const rowHeight = 40;\r\n        const topBarHeight = 30;\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet of id '${this.props.scripletId}' could not be found.`);\r\n            return null;\r\n        }\r\n\r\n        return(\r\n            <div ref={this.stageContainer} className=\"main\">\r\n                <PortalStage ref={this.stage}\r\n                    className=\"bg-gray-200\"\r\n                    onWheel={(event: KonvaEventObject<WheelEvent>) => {\r\n                        this.handleZoom(event);\r\n                        this.handleCancelContextMenu();\r\n                        KonvaForm.cancel();\r\n                    }}\r\n                    onContextMenu={(event: KonvaEventObject<PointerEvent>) => {\r\n                        event.evt.preventDefault();\r\n                        event.cancelBubble = true;\r\n\r\n                        this.handleContextMenu(event);\r\n                    }}\r\n                    onClick={(event: KonvaEventObject<MouseEvent>) => {\r\n                        this.handleCancelContextMenu();\r\n                        KonvaForm.cancel();\r\n                    }}\r\n                    onDragStart={(event: KonvaEventObject<DragEvent>)  => {\r\n                        this.handleCancelContextMenu();\r\n                        KonvaForm.cancel();\r\n                    }}\r\n                    draggable>\r\n                    <PortalLayer id=\"edges-layer\">\r\n                    </PortalLayer>\r\n                    <Layer>\r\n                        {[...scriplet.getNodes()].map(item => {\r\n                        const schema = item.schema;\r\n                        if (!schema) {\r\n                            console.error(`The schema for node item '${item.id}' could not be found.`);\r\n                            return null;\r\n                        }\r\n                        const inputSlots = NodeConnections.getInputConnections(item.id);\r\n                        const inputFlowSlots = NodeConnections.getInputFlowConnections(item.id);\r\n                        return (\r\n                            <Group key={`node-${item.id}`}>\r\n                                {inputSlots.map(conn => {\r\n                                if (!conn)\r\n                                    return null;\r\n                                const otherItem = scriplet.getNode(conn.itemId);\r\n                                if (!otherItem) {\r\n                                    console.error(`The node item of id '${conn.itemId}' could not be found.`);\r\n                                    return null;\r\n                                }\r\n                                const otherSchema = otherItem.schema;\r\n                                if (!otherSchema) {\r\n                                    console.error(`The schema for node item '${otherItem.id}' could not be found.`);\r\n                                    return null;\r\n                                }\r\n                                return(\r\n                                    <Portal key={`edge-${item.id}-${conn.id}-${conn.itemId}-${conn.slotId}`} \r\n                                            containerId=\"edges-layer\">\r\n                                        <Edge \r\n                                            startPos={{x: otherItem.x, y: otherItem.y + (conn.slotId * rowHeight) + topBarHeight}}\r\n                                            endPos={{x: item.x, y: item.y + (conn.id * rowHeight) + topBarHeight}}\r\n                                            nodeWidthOther={otherSchema.width}\r\n                                            nodeHeight={rowHeight}\r\n                                            handleOnClick={() => this.handleDeleteEdge(item.id, conn.id, conn.itemId, conn.slotId)}>\r\n                                            {(midpointPos, isHovered) => (\r\n                                                <>\r\n                                                    <Rect visible={isHovered}\r\n                                                        x={midpointPos.x - 12}\r\n                                                        y={midpointPos.y - 10}\r\n                                                        width={24}\r\n                                                        height={16}\r\n                                                        fill={Colors.Gray[800]}\r\n                                                        listening={false} />\r\n                                                    <Text visible={isHovered}\r\n                                                        x={midpointPos.x - 12}\r\n                                                        y={midpointPos.y - 10}\r\n                                                        width={24}\r\n                                                        height={19}\r\n                                                        text=\"&#215;\"\r\n                                                        fontStyle=\"bold\"\r\n                                                        fontSize={20}\r\n                                                        align=\"center\"\r\n                                                        verticalAlign=\"middle\"\r\n                                                        fill={Colors.Gray[100]}\r\n                                                        listening={false} />\r\n                                                </>\r\n                                            )}\r\n                                        </Edge>\r\n                                    </Portal>\r\n                                );\r\n                                })}\r\n                                {inputFlowSlots.map(conn => {\r\n                                if (!conn)\r\n                                    return null;\r\n                                const otherItem = scriplet.getNode(conn.itemId);\r\n                                if (!otherItem) {\r\n                                    console.error(`The item of id '${conn.itemId}' could not be found.`);\r\n                                    return null;\r\n                                }\r\n                                const otherSchema = otherItem.schema;\r\n                                if (!otherSchema) {\r\n                                    console.error(`The schema for node item '${otherItem.id}' could not be found.`);\r\n                                    return null;\r\n                                }\r\n                                return(\r\n                                    <Portal key={`edge-flow-${item.id}-${conn.id}-${conn.itemId}-${conn.slotId}`} \r\n                                            containerId=\"edges-layer\">\r\n                                        <Edge \r\n                                            startPos={{x: otherItem.x, y: otherItem.y + (conn.slotId * rowHeight) + topBarHeight}}\r\n                                            endPos={{x: item.x, y: item.y + (conn.id * rowHeight) + topBarHeight}}\r\n                                            nodeWidthOther={otherSchema.width}\r\n                                            nodeHeight={rowHeight}\r\n                                            handleOnClick={() => this.handleDeleteFlowEdge(item.id, conn.id, conn.itemId, conn.slotId)}>\r\n                                            {(midpointPos, isHovered) => (\r\n                                                <>\r\n                                                    <Rect visible={isHovered}\r\n                                                        x={midpointPos.x - 12}\r\n                                                        y={midpointPos.y - 10}\r\n                                                        width={24}\r\n                                                        height={16}\r\n                                                        fill={Colors.Gray[800]}\r\n                                                        listening={false} />\r\n                                                    <Text visible={isHovered}\r\n                                                        x={midpointPos.x - 12}\r\n                                                        y={midpointPos.y - 10}\r\n                                                        width={24}\r\n                                                        height={19}\r\n                                                        text=\"&#215;\"\r\n                                                        fontStyle=\"bold\"\r\n                                                        fontSize={20}\r\n                                                        align=\"center\"\r\n                                                        verticalAlign=\"middle\"\r\n                                                        fill={Colors.Gray[100]}\r\n                                                        listening={false} />\r\n                                                </>\r\n                                            )}\r\n                                        </Edge>\r\n                                    </Portal>\r\n                                );\r\n                                })}\r\n                                <Node item={item}\r\n                                    width={schema.width}\r\n                                    rowHeight={rowHeight}\r\n                                    topBarHeight={topBarHeight}\r\n                                    handleDragNode={this.handleDragNode}\r\n                                    deleteNodeItem={this.deleteNodeItem}\r\n                                    updateDOM={this.updateDOM} />\r\n                            </Group>\r\n                        );\r\n                        })}\r\n                    </Layer>\r\n                    <Layer data-name=\"context-menu-layer\">\r\n                    </Layer>\r\n                </PortalStage>\r\n                <SchemaSelector isVisible={isContextMenuShown} x={contextMenuPos.x} y={contextMenuPos.y} addNodeItem={this.addNodeItem} />\r\n            </div>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { Controlled as CodeMirror } from 'react-codemirror2';\r\nimport 'codemirror/lib/codemirror.css';\r\nimport 'codemirror/theme/material.css';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport ScripletManager from '../managers/ScripletManager';\r\n\r\nrequire('codemirror/mode/javascript/javascript');\r\nvar jsbeautify = require('js-beautify').js_beautify;\r\n\r\nexport class EvalResult {\r\n    public inputVars: string[];\r\n    public outputVar: string;\r\n    public evalValue: any;\r\n    public toParent: string;\r\n    public toCode: string;\r\n\r\n    constructor(evalValue: any, toParent: string, toCode: string) {\r\n        this.inputVars = [];\r\n        this.outputVar = \"\";\r\n        this.evalValue = evalValue;\r\n        this.toParent = toParent;\r\n        this.toCode = toCode;\r\n    }\r\n}\r\n\r\nexport type CodeProps = {\r\n    scripletId: number;\r\n}\r\n\r\nexport type CodeState = {\r\n    editorValue: string;\r\n    isCodeOpen: boolean;\r\n    screenWidth: number;\r\n}\r\n\r\nexport default class CodeEditor extends React.Component<CodeProps, CodeState> {\r\n    private codeResult: React.RefObject<HTMLDivElement>;\r\n    constructor(props: CodeProps) {\r\n        super(props);\r\n\r\n        this.codeResult = React.createRef();\r\n        this.state = {\r\n            editorValue: jsbeautify(\"return 42;\", { indent_size: 4 }),\r\n            isCodeOpen: false,\r\n            screenWidth: window.innerWidth\r\n        }\r\n\r\n        this.setScreenWidth = this.setScreenWidth.bind(this);\r\n        this.handleRun = this.handleRun.bind(this);\r\n        this.handleBeautifyCode = this.handleBeautifyCode.bind(this);\r\n        this.handleEvaluateNodes = this.handleEvaluateNodes.bind(this);\r\n        //this.evaluateNodes = this.evaluateNodes.bind(this);\r\n        this.openCode = this.openCode.bind(this);\r\n        this.closeCode = this.closeCode.bind(this);\r\n        this.toggleCode = this.toggleCode.bind(this);\r\n    }\r\n\r\n    componentDidMount() {\r\n        window.addEventListener(\"resize\", this.setScreenWidth);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener(\"resize\", this.setScreenWidth);\r\n    }\r\n\r\n    setScreenWidth() {\r\n        this.setState({screenWidth: window.innerWidth});\r\n    }\r\n\r\n    handleRun() {\r\n        const scriplet = ScripletManager.currentScriplet;\r\n        if (!scriplet) {\r\n            console.error(`The current scriplet could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const startNode = scriplet.getStart();\r\n        const startSchema = startNode.schema;\r\n        if (!startSchema) {\r\n            console.error(`The start node is missing the schema.`);\r\n            return;\r\n        }\r\n\r\n        const startSlot = startSchema.inputFlowSlots[0];\r\n        if (!startSlot) {\r\n            console.error(`The start node is missing the Entry input flow slot.`);\r\n            return;\r\n        }\r\n\r\n        startSlot.evaluateSlot();\r\n    }\r\n\r\n    handleBeautifyCode() {\r\n        this.setState(prevState => ({editorValue: jsbeautify(prevState.editorValue, { indent_size: 4 })}));\r\n    }\r\n\r\n    handleEvaluateNodes() {\r\n        /*\r\n        // Look for the output node\r\n        const scriplet = this.state.scriplet;\r\n        if (!scriplet) {\r\n            console.error(`The scriplet in this state could not be found.`);\r\n            return;\r\n        }\r\n\r\n        const items = [...scriplet.items];\r\n        const inputEntries = items.filter(entry => entry[1].schema?.name === \"Input\");\r\n        if (!inputEntries) {\r\n            console.error(`No input nodes were found in the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n        const outputEntries = items.filter(entry => entry[1].schema?.name === \"Output\");\r\n        if (!outputEntries) {\r\n            console.error(`No output nodes were found in the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n        \r\n        let visited = new Map<number, EvalResult>();\r\n        const results: EvalResult[] = [];\r\n        let inputInitStrs = \"\";\r\n        outputEntries.forEach(entry => {\r\n            const result = this.evaluateNodes(new EvalResult(0, \"\", \"\"), visited, entry[1].id);\r\n            if (result)\r\n                results.push(result);\r\n            \r\n            inputEntries.forEach(entry2 => {\r\n                const inputRes = visited.get(entry2[1].id);\r\n                if (inputRes) {\r\n                    const code = `const ${entry2[1].variableName} = ${inputRes.evalValue}; `;\r\n                    if (!inputInitStrs.includes(code))\r\n                        inputInitStrs += code;\r\n                }\r\n            });\r\n            visited = new Map<number, EvalResult>();\r\n        });\r\n\r\n        if (!results) {\r\n            console.error(`Something went wrong when evaluating the nodes of the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n        \r\n        const codeResult = this.codeResult.current;\r\n        if (!codeResult) {\r\n            console.error(`Could not get the div element of the referenced code result element.`);\r\n            return;\r\n        }\r\n\r\n        let fullCode: string = `${inputInitStrs}`;\r\n        const evalValues: any[] = [];\r\n        results.forEach(result => {\r\n            const code = `function ${result.outputVar}(${result.inputVars}) { ${result.toCode} }`;\r\n            evalValues.push(result.evalValue);\r\n            if (code)\r\n                fullCode += code;\r\n        });\r\n        fullCode += \"return [\";\r\n        results.forEach((result, index) => {\r\n            fullCode += index === results.length - 1 ? `${result.outputVar}(${result.inputVars})` : `${result.outputVar}(${result.inputVars}), `;\r\n        });\r\n        fullCode += \"];\"\r\n\r\n        codeResult.textContent = evalValues.toString();\r\n        this.setState({editorValue: jsbeautify(fullCode, { indent_size: 4 })});\r\n        */\r\n    }\r\n\r\n    /* TODO: This is too hackish\r\n    // What this should do is place all the state data (like evaluated value, )\r\n    evaluateNodes(result: EvalResult, visited: Map<number, EvalResult>, itemId: number): EvalResult | undefined {\r\n        const scriplet = this.state.scriplet;\r\n        if (!scriplet) {\r\n            console.error(`The scriplet in this state could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const items = scriplet.items;\r\n        if (!items) {\r\n            console.error(`Could not get the node items in the scriplet of id '${scriplet.id}'.`);\r\n            return;\r\n        }\r\n\r\n        const item = items.get(itemId);\r\n        if (!item) {\r\n            console.error(`The item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const schema = item.schema;\r\n        if (!schema) {\r\n            console.error(`The schema of the item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n        \r\n        const variableName = schema.state.hasVariable ? item.variableName : \"\";\r\n        if (schema.name === \"Input\") {\r\n            result.evalValue = schema.evalFunction();\r\n            result.toParent = variableName;\r\n            result.inputVars.push(variableName);\r\n            visited.set(item.id, new EvalResult(result.evalValue, result.toParent, result.toCode));\r\n            return result;\r\n        }\r\n\r\n        if (schema.name === \"Output\") {\r\n            result.outputVar = item.variableName;\r\n        }\r\n\r\n        const children = NodeConnections.getInputConnections(itemId);\r\n        if (!children) {\r\n            console.error(`The children of the node item of id '${itemId}' could not be found.`);\r\n            return;\r\n        }\r\n        if (children.size <= 0) {\r\n            const visitedRes = visited.get(itemId);\r\n            if (visitedRes)\r\n                return visitedRes;\r\n            result.evalValue = schema.evalFunction();\r\n            result.toParent = schema.toParent() === \"variable\" ? variableName : schema.toParent();\r\n            result.toCode = `${result.toCode} ${schema.state.hasVariable ? \"const \" + variableName + \" = \" + schema.toCode() : schema.toCode()};`;\r\n            visited.set(item.id, new EvalResult(result.evalValue, result.toParent, result.toCode));\r\n            return result;\r\n        }\r\n        \r\n        var i;\r\n        let arr: any[] = [];\r\n        let arrStr: string[] = [];\r\n        // This for loop is determining the values of the toParent functions of the children\r\n        // TODO: Don't travel to the already visited nodes\r\n        for (i = 0; i < schema.inputSlots.length; i++) {\r\n            const childConn = children.get(schema.inputSlots[i].id);\r\n            if (!childConn) {\r\n                arr.push(schema.inputSlots[i].defaultValue);\r\n                arrStr.push(schema.inputSlots[i].defaultValueStr);\r\n                continue;\r\n            }\r\n\r\n            const childItem = scriplet.items.get(childConn.outputId);\r\n            if (!childItem) {\r\n                console.error(`The node item of id '${childConn.outputId}' could not be found in the scriplet.`);\r\n                return;\r\n            }\r\n            const visitedRes = visited.get(childItem.id);\r\n            if (visitedRes != null) {\r\n                arr.push(visitedRes.evalValue);\r\n                arrStr.push(visitedRes.toParent);\r\n                continue;\r\n            }\r\n            \r\n            const res = this.evaluateNodes(result, visited, childItem.id);\r\n            if (!res) {\r\n                console.error(`Something went wrong when evaluating the child nodes of the node item of id '${childItem.id}'.`);\r\n                return;\r\n            }\r\n            \r\n            arr.push(res.evalValue);\r\n            arrStr.push(res.toParent);\r\n        }\r\n\r\n        schema.state.onEvaluate(...arr);\r\n\r\n        result.evalValue = schema.evalFunction(...arr);\r\n        result.toParent = schema.toParent(...arrStr) === \"variable\" ? variableName : schema.toParent(...arrStr);\r\n        result.toCode = `${result.toCode} ${schema.state.hasVariable ? \"const \" + variableName + \" = \" + schema.toCode(...arrStr) : schema.toCode(...arrStr)};`;\r\n        visited.set(item.id, new EvalResult(result.evalValue, result.toParent, result.toCode));\r\n\r\n        return result;\r\n    }\r\n    /**/\r\n\r\n    openCode() {\r\n        this.setState({isCodeOpen: true});\r\n    }\r\n\r\n    closeCode() {\r\n        this.setState({isCodeOpen: false});\r\n    }\r\n\r\n    toggleCode() {\r\n        if (this.state.isCodeOpen)\r\n            this.closeCode();\r\n        else\r\n            this.openCode();\r\n    }\r\n\r\n    render() {\r\n        return(\r\n            <>\r\n                <div className={`${this.state.isCodeOpen ? \"code-container\" : \"hidden\"} shadow flex flex-row lg:flex-col`}>\r\n                    <CodeMirror value={this.state.editorValue}\r\n                                options={{\r\n                                    mode: 'javascript',\r\n                                    theme: 'code-editor material',\r\n                                    lineNumbers: true\r\n                                }}\r\n                                onBeforeChange={(editor, data, value) => {\r\n                                    this.setState({editorValue: value});\r\n                                }}\r\n                                onChange={(editor, data, value) => {\r\n\r\n                                }} />\r\n                    <button className=\"beautify-code items-center justify-center rounded shadow bg-gray-700 text-gray-200 hover:bg-gray-600 select-none\" onClick={this.handleBeautifyCode}>\r\n                        <FontAwesomeIcon className=\"text-sm\" icon=\"magic\" />&nbsp;\r\n                        Beautify\r\n                    </button>\r\n                    <button className=\"eval-code items-center justify-center rounded shadow bg-gray-700 text-gray-200 hover:bg-gray-600 select-none\" onClick={this.handleEvaluateNodes}>\r\n                        <FontAwesomeIcon className=\"text-sm\" icon=\"lightbulb\" />&nbsp;\r\n                        Evaluate\r\n                    </button>\r\n\r\n                    <div className=\"px-4 py-2 w-1/3 lg:w-auto lg:h-56 flex-grow bg-gray-800 text-gray-200\" ref={this.codeResult}>\r\n                        Run code first\r\n                    </div>\r\n                    <button className=\"run-code items-center justify-center rounded shadow bg-gray-700 text-gray-200 hover:bg-gray-600 select-none\" onClick={this.handleRun}>\r\n                        <FontAwesomeIcon className=\"text-sm\" icon=\"play\"/>&nbsp;\r\n                        Run\r\n                    </button>\r\n                </div>\r\n                <div className={`${this.state.isCodeOpen ? \"hidden\" : \"collapsed-code\"} shadow bg-gray-800 items-center lg:justify-center lg:items-start`}>\r\n                    <div className=\"p-4\">\r\n                        <FontAwesomeIcon icon=\"code\" className=\"text-xl text-gray-300\" />\r\n                    </div>\r\n                </div>\r\n                <button className={`${this.state.isCodeOpen ? \"h-40 mb-8 pb-32\" : \"h-16 mb-8 pb-8\"} ${this.state.screenWidth >= 1024 ? \"hidden\" : \"code-toggle\"} items-center flex-col-reverse rounded-full bg-gray-700`}\r\n                        onClick={this.toggleCode}>\r\n                    <div className=\"inline-block pb-1\">\r\n                        <FontAwesomeIcon icon=\"chevron-down\"\r\n                                            className={`${this.state.isCodeOpen ? \"block\" : \"hidden\"} text-gray-300`} />\r\n                        <FontAwesomeIcon icon=\"chevron-up\"\r\n                                            className={`${this.state.isCodeOpen ? \"hidden\" : \"block\"} text-gray-300`} />\r\n                    </div>\r\n                </button>\r\n                <button className={`${this.state.isCodeOpen ? \"w-64 mr-8 pr-56\" : \"w-16 mr-8 pr-8\"} ${this.state.screenWidth >= 1024 ? \"code-toggle\" : \"hidden\"} items-center flex-row-reverse rounded-full bg-gray-700`}\r\n                        onClick={this.toggleCode}>\r\n                    <div className=\"inline-block pr-2\">\r\n                        <FontAwesomeIcon icon=\"chevron-right\"\r\n                                            className={`${this.state.isCodeOpen ? \"block\" : \"hidden\"} text-gray-300`} />\r\n                        <FontAwesomeIcon icon=\"chevron-left\"\r\n                                            className={`${this.state.isCodeOpen ? \"hidden\" : \"block\"} text-gray-300`} />\r\n                    </div>\r\n                </button>\r\n            </>\r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\nimport './assets/main.css';\r\n\r\nimport { library } from '@fortawesome/fontawesome-svg-core';\r\nimport { fas } from '@fortawesome/free-solid-svg-icons';\r\nimport { Switch, Route, useParams } from 'react-router-dom';\r\n\r\nimport SidebarNav from './components/SidebarNav';\r\nimport ScripletRoot from './components/ScripletRoot';\r\nimport CodeEditor from './components/CodeEditor';\r\n\r\nlibrary.add(fas);\r\n\r\nfunction App() {\r\n    return(\r\n        <div className=\"flex flex-col lg:flex-row\">\r\n            <SidebarNav />\r\n            <main>\r\n                <Switch>\r\n                    <Route path=\"/scriplet/:scripletId\">\r\n                        <ParamsProvider>\r\n                            {(scripletId) => (\r\n                                <>\r\n                                    <ScripletRoot scripletId={scripletId} />\r\n                                    <CodeEditor scripletId={scripletId} />\r\n                                </>\r\n                            )}\r\n                        </ParamsProvider>\r\n                    </Route>\r\n                    <Route path=\"/\">\r\n                        <div className=\"p-6 flex justify-center items-center h-screen w-screen\">\r\n                            <h1 className=\"text-xl text-gray-600\">\r\n                                Please select a scriplet first.\r\n                            </h1>\r\n                        </div>\r\n                    </Route>\r\n                </Switch>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n\r\ntype ParamsProps = {\r\n    children?(scripletId: number): React.ReactNode | null;\r\n}\r\n\r\nfunction ParamsProvider({children}: ParamsProps): JSX.Element {\r\n    const { scripletId } = useParams();\r\n    return (\r\n        <>\r\n            {children != null ? children(parseInt(scripletId)) : null}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport { BrowserRouter } from 'react-router-dom';\n\nReactDOM.render(\n  <React.StrictMode>\n    <BrowserRouter basename=\"/visual-scripting\">\n      <App />\n    </BrowserRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}